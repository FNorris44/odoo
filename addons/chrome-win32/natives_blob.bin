mirrorsZ
(function(a,b){
"use strict";
var c=a.Array;
var d=a.isNaN;
var e=a.JSON.stringify;
var f;
var g;
var h;
var i;
b.Import(function(j){
f=j.MapEntries;
g=j.MapIteratorNext;
h=j.SetIteratorNext;
i=j.SetValues;
});
var k={
UNDEFINED_TYPE:'undefined',
NULL_TYPE:'null',
BOOLEAN_TYPE:'boolean',
NUMBER_TYPE:'number',
STRING_TYPE:'string',
SYMBOL_TYPE:'symbol',
OBJECT_TYPE:'object',
FUNCTION_TYPE:'function',
REGEXP_TYPE:'regexp',
ERROR_TYPE:'error',
PROPERTY_TYPE:'property',
INTERNAL_PROPERTY_TYPE:'internalProperty',
FRAME_TYPE:'frame',
SCRIPT_TYPE:'script',
CONTEXT_TYPE:'context',
SCOPE_TYPE:'scope',
PROMISE_TYPE:'promise',
MAP_TYPE:'map',
SET_TYPE:'set',
ITERATOR_TYPE:'iterator',
GENERATOR_TYPE:'generator',
}
var l=0;
var m=-1;
var n=[];
var o=true;
function MirrorCacheIsEmpty(){
return l==0&&n.length==0;
}
function ToggleMirrorCache(p){
o=p;
ClearMirrorCache();
}
function ClearMirrorCache(p){
l=0;
n=[];
}
function MakeMirror(p,q){
var r;
if(!q&&o){
for(var s in n){
r=n[s];
if(r.value()===p){
return r;
}
if(r.isNumber()&&d(r.value())&&
typeof p=='number'&&d(p)){
return r;
}
}
}
if((p===(void 0))){
r=new UndefinedMirror();
}else if((p===null)){
r=new NullMirror();
}else if((typeof(p)==='boolean')){
r=new BooleanMirror(p);
}else if((typeof(p)==='number')){
r=new NumberMirror(p);
}else if((typeof(p)==='string')){
r=new StringMirror(p);
}else if((typeof(p)==='symbol')){
r=new SymbolMirror(p);
}else if((%_IsArray(p))){
r=new ArrayMirror(p);
}else if((%IsDate(p))){
r=new DateMirror(p);
}else if((%IsFunction(p))){
r=new FunctionMirror(p);
}else if((%_IsRegExp(p))){
r=new RegExpMirror(p);
}else if((%_ClassOf(p)==='Error')){
r=new ErrorMirror(p);
}else if((%_ClassOf(p)==='Script')){
r=new ScriptMirror(p);
}else if((%_ClassOf(p)==='Map')||(%_ClassOf(p)==='WeakMap')){
r=new MapMirror(p);
}else if((%_ClassOf(p)==='Set')||(%_ClassOf(p)==='WeakSet')){
r=new SetMirror(p);
}else if((%_ClassOf(p)==='Map Iterator')||(%_ClassOf(p)==='Set Iterator')){
r=new IteratorMirror(p);
}else if(%is_promise(p)){
r=new PromiseMirror(p);
}else if((%_ClassOf(p)==='Generator')){
r=new GeneratorMirror(p);
}else{
r=new ObjectMirror(p,k.OBJECT_TYPE,q);
}
if(o)n[r.handle()]=r;
return r;
}
function LookupMirror(t){
if(!o){
throw %make_error(2,"Mirror cache is disabled");
}
return n[t];
}
function GetUndefinedMirror(){
return MakeMirror((void 0));
}
function inherits(u,v){
var w=function(){};
w.prototype=v.prototype;
u.super_=v.prototype;
u.prototype=new w();
u.prototype.constructor=u;
}
var x=80;
var y={};
y.Data=0;
y.DataConstant=2;
y.AccessorConstant=3;
var z={};
z.None=0;
z.ReadOnly=1;
z.DontEnum=2;
z.DontDelete=4;
var A={Global:0,
Local:1,
With:2,
Closure:3,
Catch:4,
Block:5,
Script:6,
Eval:7,
Module:8,
};
function Mirror(B){
this.type_=B;
}
Mirror.prototype.type=function(){
return this.type_;
};
Mirror.prototype.isValue=function(){
return this instanceof ValueMirror;
};
Mirror.prototype.isUndefined=function(){
return this instanceof UndefinedMirror;
};
Mirror.prototype.isNull=function(){
return this instanceof NullMirror;
};
Mirror.prototype.isBoolean=function(){
return this instanceof BooleanMirror;
};
Mirror.prototype.isNumber=function(){
return this instanceof NumberMirror;
};
Mirror.prototype.isString=function(){
return this instanceof StringMirror;
};
Mirror.prototype.isSymbol=function(){
return this instanceof SymbolMirror;
};
Mirror.prototype.isObject=function(){
return this instanceof ObjectMirror;
};
Mirror.prototype.isFunction=function(){
return this instanceof FunctionMirror;
};
Mirror.prototype.isUnresolvedFunction=function(){
return this instanceof UnresolvedFunctionMirror;
};
Mirror.prototype.isArray=function(){
return this instanceof ArrayMirror;
};
Mirror.prototype.isDate=function(){
return this instanceof DateMirror;
};
Mirror.prototype.isRegExp=function(){
return this instanceof RegExpMirror;
};
Mirror.prototype.isError=function(){
return this instanceof ErrorMirror;
};
Mirror.prototype.isPromise=function(){
return this instanceof PromiseMirror;
};
Mirror.prototype.isGenerator=function(){
return this instanceof GeneratorMirror;
};
Mirror.prototype.isProperty=function(){
return this instanceof PropertyMirror;
};
Mirror.prototype.isInternalProperty=function(){
return this instanceof InternalPropertyMirror;
};
Mirror.prototype.isFrame=function(){
return this instanceof FrameMirror;
};
Mirror.prototype.isScript=function(){
return this instanceof ScriptMirror;
};
Mirror.prototype.isContext=function(){
return this instanceof ContextMirror;
};
Mirror.prototype.isScope=function(){
return this instanceof ScopeMirror;
};
Mirror.prototype.isMap=function(){
return this instanceof MapMirror;
};
Mirror.prototype.isSet=function(){
return this instanceof SetMirror;
};
Mirror.prototype.isIterator=function(){
return this instanceof IteratorMirror;
};
Mirror.prototype.allocateHandle_=function(){
if(o)this.handle_=l++;
};
Mirror.prototype.allocateTransientHandle_=function(){
this.handle_=m--;
};
Mirror.prototype.toText=function(){
return"#<"+this.constructor.name+">";
};
function ValueMirror(B,p,C){
%_Call(Mirror,this,B);
this.value_=p;
if(!C){
this.allocateHandle_();
}else{
this.allocateTransientHandle_();
}
}
inherits(ValueMirror,Mirror);
Mirror.prototype.handle=function(){
return this.handle_;
};
ValueMirror.prototype.isPrimitive=function(){
var B=this.type();
return B==='undefined'||
B==='null'||
B==='boolean'||
B==='number'||
B==='string'||
B==='symbol';
};
ValueMirror.prototype.value=function(){
return this.value_;
};
function UndefinedMirror(){
%_Call(ValueMirror,this,k.UNDEFINED_TYPE,(void 0));
}
inherits(UndefinedMirror,ValueMirror);
UndefinedMirror.prototype.toText=function(){
return'undefined';
};
function NullMirror(){
%_Call(ValueMirror,this,k.NULL_TYPE,null);
}
inherits(NullMirror,ValueMirror);
NullMirror.prototype.toText=function(){
return'null';
};
function BooleanMirror(p){
%_Call(ValueMirror,this,k.BOOLEAN_TYPE,p);
}
inherits(BooleanMirror,ValueMirror);
BooleanMirror.prototype.toText=function(){
return this.value_?'true':'false';
};
function NumberMirror(p){
%_Call(ValueMirror,this,k.NUMBER_TYPE,p);
}
inherits(NumberMirror,ValueMirror);
NumberMirror.prototype.toText=function(){
return %_NumberToString(this.value_);
};
function StringMirror(p){
%_Call(ValueMirror,this,k.STRING_TYPE,p);
}
inherits(StringMirror,ValueMirror);
StringMirror.prototype.length=function(){
return this.value_.length;
};
StringMirror.prototype.getTruncatedValue=function(D){
if(D!=-1&&this.length()>D){
return this.value_.substring(0,D)+
'... (length: '+this.length()+')';
}
return this.value_;
};
StringMirror.prototype.toText=function(){
return this.getTruncatedValue(x);
};
function SymbolMirror(p){
%_Call(ValueMirror,this,k.SYMBOL_TYPE,p);
}
inherits(SymbolMirror,ValueMirror);
SymbolMirror.prototype.description=function(){
return %SymbolDescription(%ValueOf(this.value_));
}
SymbolMirror.prototype.toText=function(){
return %SymbolDescriptiveString(%ValueOf(this.value_));
}
function ObjectMirror(p,B,C){
B=B||k.OBJECT_TYPE;
%_Call(ValueMirror,this,B,p,C);
}
inherits(ObjectMirror,ValueMirror);
ObjectMirror.prototype.className=function(){
return %_ClassOf(this.value_);
};
ObjectMirror.prototype.constructorFunction=function(){
return MakeMirror(%DebugGetProperty(this.value_,'constructor'));
};
ObjectMirror.prototype.prototypeObject=function(){
return MakeMirror(%DebugGetProperty(this.value_,'prototype'));
};
ObjectMirror.prototype.protoObject=function(){
return MakeMirror(%DebugGetPrototype(this.value_));
};
ObjectMirror.prototype.hasNamedInterceptor=function(){
var E=%GetInterceptorInfo(this.value_);
return(E&2)!=0;
};
ObjectMirror.prototype.hasIndexedInterceptor=function(){
var E=%GetInterceptorInfo(this.value_);
return(E&1)!=0;
};
ObjectMirror.prototype.propertyNames=function(){
return %GetOwnPropertyKeys(this.value_,0);
};
ObjectMirror.prototype.properties=function(){
var F=this.propertyNames();
var G=new c(F.length);
for(var H=0;H<F.length;H++){
G[H]=this.property(F[H]);
}
return G;
};
ObjectMirror.prototype.internalProperties=function(){
return ObjectMirror.GetInternalProperties(this.value_);
}
ObjectMirror.prototype.property=function(I){
var J=%DebugGetPropertyDetails(this.value_,I);
if(J){
return new PropertyMirror(this,I,J);
}
return GetUndefinedMirror();
};
ObjectMirror.prototype.lookupProperty=function(p){
var G=this.properties();
for(var H=0;H<G.length;H++){
var K=G[H];
if(K.propertyType()!=y.AccessorConstant){
if(K.value_===p.value_){
return K;
}
}
}
return GetUndefinedMirror();
};
ObjectMirror.prototype.referencedBy=function(L){
var M=%DebugReferencedBy(this.value_,
Mirror.prototype,L||0);
for(var H=0;H<M.length;H++){
M[H]=MakeMirror(M[H]);
}
return M;
};
ObjectMirror.prototype.toText=function(){
var I;
var u=this.constructorFunction();
if(!u.isFunction()){
I=this.className();
}else{
I=u.name();
if(!I){
I=this.className();
}
}
return'#<'+I+'>';
};
ObjectMirror.GetInternalProperties=function(p){
var G=%DebugGetInternalProperties(p);
var M=[];
for(var H=0;H<G.length;H+=2){
M.push(new InternalPropertyMirror(G[H],G[H+1]));
}
return M;
}
function FunctionMirror(p){
%_Call(ObjectMirror,this,p,k.FUNCTION_TYPE);
this.resolved_=true;
}
inherits(FunctionMirror,ObjectMirror);
FunctionMirror.prototype.resolved=function(){
return this.resolved_;
};
FunctionMirror.prototype.name=function(){
return %FunctionGetName(this.value_);
};
FunctionMirror.prototype.debugName=function(){
return %FunctionGetDebugName(this.value_);
}
FunctionMirror.prototype.inferredName=function(){
return %FunctionGetInferredName(this.value_);
};
FunctionMirror.prototype.source=function(){
if(this.resolved()){
return %FunctionToString(this.value_);
}
};
FunctionMirror.prototype.script=function(){
if(this.resolved()){
if(this.script_){
return this.script_;
}
var N=%FunctionGetScript(this.value_);
if(N){
return this.script_=MakeMirror(N);
}
}
};
FunctionMirror.prototype.sourcePosition_=function(){
if(this.resolved()){
return %FunctionGetScriptSourcePosition(this.value_);
}
};
FunctionMirror.prototype.sourceLocation=function(){
if(this.resolved()){
var N=this.script();
if(N){
return N.locationFromPosition(this.sourcePosition_(),true);
}
}
};
FunctionMirror.prototype.constructedBy=function(O){
if(this.resolved()){
var M=%DebugConstructedBy(this.value_,O||0);
for(var H=0;H<M.length;H++){
M[H]=MakeMirror(M[H]);
}
return M;
}else{
return[];
}
};
FunctionMirror.prototype.scopeCount=function(){
if(this.resolved()){
if((this.scopeCount_===(void 0))){
this.scopeCount_=%GetFunctionScopeCount(this.value());
}
return this.scopeCount_;
}else{
return 0;
}
};
FunctionMirror.prototype.scope=function(P){
if(this.resolved()){
return new ScopeMirror((void 0),this,(void 0),P);
}
};
FunctionMirror.prototype.toText=function(){
return this.source();
};
FunctionMirror.prototype.context=function(){
if(this.resolved()){
if(!this._context)
this._context=new ContextMirror(%FunctionGetContextData(this.value_));
return this._context;
}
};
function UnresolvedFunctionMirror(p){
%_Call(ValueMirror,this,k.FUNCTION_TYPE,p);
this.propertyCount_=0;
this.elementCount_=0;
this.resolved_=false;
}
inherits(UnresolvedFunctionMirror,FunctionMirror);
UnresolvedFunctionMirror.prototype.className=function(){
return'Function';
};
UnresolvedFunctionMirror.prototype.constructorFunction=function(){
return GetUndefinedMirror();
};
UnresolvedFunctionMirror.prototype.prototypeObject=function(){
return GetUndefinedMirror();
};
UnresolvedFunctionMirror.prototype.protoObject=function(){
return GetUndefinedMirror();
};
UnresolvedFunctionMirror.prototype.name=function(){
return this.value_;
};
UnresolvedFunctionMirror.prototype.debugName=function(){
return this.value_;
};
UnresolvedFunctionMirror.prototype.inferredName=function(){
return(void 0);
};
UnresolvedFunctionMirror.prototype.propertyNames=function(Q,R){
return[];
};
function ArrayMirror(p){
%_Call(ObjectMirror,this,p);
}
inherits(ArrayMirror,ObjectMirror);
ArrayMirror.prototype.length=function(){
return this.value_.length;
};
ArrayMirror.prototype.indexedPropertiesFromRange=function(opt_from_index,
opt_to_index){
var S=opt_from_index||0;
var T=opt_to_index||this.length()-1;
if(S>T)return new c();
var U=new c(T-S+1);
for(var H=S;H<=T;H++){
var J=%DebugGetPropertyDetails(this.value_,(%_ToString(H)));
var p;
if(J){
p=new PropertyMirror(this,H,J);
}else{
p=GetUndefinedMirror();
}
U[H-S]=p;
}
return U;
};
function DateMirror(p){
%_Call(ObjectMirror,this,p);
}
inherits(DateMirror,ObjectMirror);
DateMirror.prototype.toText=function(){
var V=e(this.value_);
return V.substring(1,V.length-1);
};
function RegExpMirror(p){
%_Call(ObjectMirror,this,p,k.REGEXP_TYPE);
}
inherits(RegExpMirror,ObjectMirror);
RegExpMirror.prototype.source=function(){
return this.value_.source;
};
RegExpMirror.prototype.global=function(){
return this.value_.global;
};
RegExpMirror.prototype.ignoreCase=function(){
return this.value_.ignoreCase;
};
RegExpMirror.prototype.multiline=function(){
return this.value_.multiline;
};
RegExpMirror.prototype.sticky=function(){
return this.value_.sticky;
};
RegExpMirror.prototype.unicode=function(){
return this.value_.unicode;
};
RegExpMirror.prototype.toText=function(){
return"/"+this.source()+"/";
};
function ErrorMirror(p){
%_Call(ObjectMirror,this,p,k.ERROR_TYPE);
}
inherits(ErrorMirror,ObjectMirror);
ErrorMirror.prototype.message=function(){
return this.value_.message;
};
ErrorMirror.prototype.toText=function(){
var W;
try{
W=%ErrorToString(this.value_);
}catch(e){
W='#<Error>';
}
return W;
};
function PromiseMirror(p){
%_Call(ObjectMirror,this,p,k.PROMISE_TYPE);
}
inherits(PromiseMirror,ObjectMirror);
function PromiseGetStatus_(p){
var X=%PromiseStatus(p);
if(X==0)return"pending";
if(X==1)return"resolved";
return"rejected";
}
function PromiseGetValue_(p){
return %PromiseResult(p);
}
PromiseMirror.prototype.status=function(){
return PromiseGetStatus_(this.value_);
};
PromiseMirror.prototype.promiseValue=function(){
return MakeMirror(PromiseGetValue_(this.value_));
};
function MapMirror(p){
%_Call(ObjectMirror,this,p,k.MAP_TYPE);
}
inherits(MapMirror,ObjectMirror);
MapMirror.prototype.entries=function(Y){
var M=[];
if((%_ClassOf(this.value_)==='WeakMap')){
var Z=%GetWeakMapEntries(this.value_,Y||0);
for(var H=0;H<Z.length;H+=2){
M.push({
key:Z[H],
value:Z[H+1]
});
}
return M;
}
var aa=%_Call(f,this.value_);
var ab;
while((!Y||M.length<Y)&&
!(ab=aa.next()).done){
M.push({
key:ab.value[0],
value:ab.value[1]
});
}
return M;
};
function SetMirror(p){
%_Call(ObjectMirror,this,p,k.SET_TYPE);
}
inherits(SetMirror,ObjectMirror);
function IteratorGetValues_(aa,ac,Y){
var M=[];
var ab;
while((!Y||M.length<Y)&&
!(ab=%_Call(ac,aa)).done){
M.push(ab.value);
}
return M;
}
SetMirror.prototype.values=function(Y){
if((%_ClassOf(this.value_)==='WeakSet')){
return %GetWeakSetValues(this.value_,Y||0);
}
var aa=%_Call(i,this.value_);
return IteratorGetValues_(aa,h,Y);
};
function IteratorMirror(p){
%_Call(ObjectMirror,this,p,k.ITERATOR_TYPE);
}
inherits(IteratorMirror,ObjectMirror);
IteratorMirror.prototype.preview=function(Y){
if((%_ClassOf(this.value_)==='Map Iterator')){
return IteratorGetValues_(%MapIteratorClone(this.value_),
g,
Y);
}else if((%_ClassOf(this.value_)==='Set Iterator')){
return IteratorGetValues_(%SetIteratorClone(this.value_),
h,
Y);
}
};
function GeneratorMirror(p){
%_Call(ObjectMirror,this,p,k.GENERATOR_TYPE);
}
inherits(GeneratorMirror,ObjectMirror);
function GeneratorGetStatus_(p){
var ad=%GeneratorGetContinuation(p);
if(ad<-1)return"running";
if(ad==-1)return"closed";
return"suspended";
}
GeneratorMirror.prototype.status=function(){
return GeneratorGetStatus_(this.value_);
};
GeneratorMirror.prototype.sourcePosition_=function(){
return %GeneratorGetSourcePosition(this.value_);
};
GeneratorMirror.prototype.sourceLocation=function(){
var ae=this.sourcePosition_();
if(!(ae===(void 0))){
var N=this.func().script();
if(N){
return N.locationFromPosition(ae,true);
}
}
};
GeneratorMirror.prototype.func=function(){
if(!this.func_){
this.func_=MakeMirror(%GeneratorGetFunction(this.value_));
}
return this.func_;
};
GeneratorMirror.prototype.receiver=function(){
if(!this.receiver_){
this.receiver_=MakeMirror(%GeneratorGetReceiver(this.value_));
}
return this.receiver_;
};
GeneratorMirror.prototype.scopeCount=function(){
return %GetGeneratorScopeCount(this.value());
};
GeneratorMirror.prototype.scope=function(P){
return new ScopeMirror((void 0),(void 0),this,P);
};
GeneratorMirror.prototype.allScopes=function(){
var af=[];
for(let H=0;H<this.scopeCount();H++){
af.push(this.scope(H));
}
return af;
};
function PropertyMirror(r,I,J){
%_Call(Mirror,this,k.PROPERTY_TYPE);
this.mirror_=r;
this.name_=I;
this.value_=J[0];
this.details_=J[1];
this.is_interceptor_=J[2];
if(J.length>3){
this.exception_=J[3];
this.getter_=J[4];
this.setter_=J[5];
}
}
inherits(PropertyMirror,Mirror);
PropertyMirror.prototype.isReadOnly=function(){
return(this.attributes()&z.ReadOnly)!=0;
};
PropertyMirror.prototype.isEnum=function(){
return(this.attributes()&z.DontEnum)==0;
};
PropertyMirror.prototype.canDelete=function(){
return(this.attributes()&z.DontDelete)==0;
};
PropertyMirror.prototype.name=function(){
return this.name_;
};
PropertyMirror.prototype.toText=function(){
if((typeof(this.name_)==='symbol'))return %SymbolDescriptiveString(this.name_);
return this.name_;
};
PropertyMirror.prototype.isIndexed=function(){
for(var H=0;H<this.name_.length;H++){
if(this.name_[H]<'0'||'9'<this.name_[H]){
return false;
}
}
return true;
};
PropertyMirror.prototype.value=function(){
return MakeMirror(this.value_,false);
};
PropertyMirror.prototype.isException=function(){
return this.exception_?true:false;
};
PropertyMirror.prototype.attributes=function(){
return %DebugPropertyAttributesFromDetails(this.details_);
};
PropertyMirror.prototype.propertyType=function(){
return %DebugPropertyTypeFromDetails(this.details_);
};
PropertyMirror.prototype.hasGetter=function(){
return this.getter_?true:false;
};
PropertyMirror.prototype.hasSetter=function(){
return this.setter_?true:false;
};
PropertyMirror.prototype.getter=function(){
if(this.hasGetter()){
return MakeMirror(this.getter_);
}else{
return GetUndefinedMirror();
}
};
PropertyMirror.prototype.setter=function(){
if(this.hasSetter()){
return MakeMirror(this.setter_);
}else{
return GetUndefinedMirror();
}
};
PropertyMirror.prototype.isNative=function(){
return this.is_interceptor_||
((this.propertyType()==y.AccessorConstant)&&
!this.hasGetter()&&!this.hasSetter());
};
function InternalPropertyMirror(I,p){
%_Call(Mirror,this,k.INTERNAL_PROPERTY_TYPE);
this.name_=I;
this.value_=p;
}
inherits(InternalPropertyMirror,Mirror);
InternalPropertyMirror.prototype.name=function(){
return this.name_;
};
InternalPropertyMirror.prototype.value=function(){
return MakeMirror(this.value_,false);
};
var ag=0;
var ah=1;
var ai=2;
var aj=3;
var ak=4;
var al=5;
var am=6;
var an=7;
var ao=8;
var ap=9;
var aq=10;
var ar=0;
var as=1;
var at=2;
var au=1<<0;
var av=1<<1;
var aw=7<<2;
function FrameDetails(ax,P){
this.break_id_=ax;
this.details_=%GetFrameDetails(ax,P);
}
FrameDetails.prototype.frameId=function(){
%CheckExecutionState(this.break_id_);
return this.details_[ag];
};
FrameDetails.prototype.receiver=function(){
%CheckExecutionState(this.break_id_);
return this.details_[ah];
};
FrameDetails.prototype.func=function(){
%CheckExecutionState(this.break_id_);
return this.details_[ai];
};
FrameDetails.prototype.script=function(){
%CheckExecutionState(this.break_id_);
return this.details_[aj];
};
FrameDetails.prototype.isConstructCall=function(){
%CheckExecutionState(this.break_id_);
return this.details_[an];
};
FrameDetails.prototype.isAtReturn=function(){
%CheckExecutionState(this.break_id_);
return this.details_[ao];
};
FrameDetails.prototype.isDebuggerFrame=function(){
%CheckExecutionState(this.break_id_);
var ay=au;
return(this.details_[ap]&ay)==ay;
};
FrameDetails.prototype.isOptimizedFrame=function(){
%CheckExecutionState(this.break_id_);
var ay=av;
return(this.details_[ap]&ay)==ay;
};
FrameDetails.prototype.isInlinedFrame=function(){
return this.inlinedFrameIndex()>0;
};
FrameDetails.prototype.inlinedFrameIndex=function(){
%CheckExecutionState(this.break_id_);
var ay=aw;
return(this.details_[ap]&ay)>>2;
};
FrameDetails.prototype.argumentCount=function(){
%CheckExecutionState(this.break_id_);
return this.details_[ak];
};
FrameDetails.prototype.argumentName=function(P){
%CheckExecutionState(this.break_id_);
if(P>=0&&P<this.argumentCount()){
return this.details_[aq+
P*at+
ar];
}
};
FrameDetails.prototype.argumentValue=function(P){
%CheckExecutionState(this.break_id_);
if(P>=0&&P<this.argumentCount()){
return this.details_[aq+
P*at+
as];
}
};
FrameDetails.prototype.localCount=function(){
%CheckExecutionState(this.break_id_);
return this.details_[al];
};
FrameDetails.prototype.sourcePosition=function(){
%CheckExecutionState(this.break_id_);
return this.details_[am];
};
FrameDetails.prototype.localName=function(P){
%CheckExecutionState(this.break_id_);
if(P>=0&&P<this.localCount()){
var az=aq+
this.argumentCount()*at;
return this.details_[az+
P*at+
ar];
}
};
FrameDetails.prototype.localValue=function(P){
%CheckExecutionState(this.break_id_);
if(P>=0&&P<this.localCount()){
var az=aq+
this.argumentCount()*at;
return this.details_[az+
P*at+
as];
}
};
FrameDetails.prototype.returnValue=function(){
%CheckExecutionState(this.break_id_);
var aA=
aq+
(this.argumentCount()+this.localCount())*at;
if(this.details_[ao]){
return this.details_[aA];
}
};
FrameDetails.prototype.scopeCount=function(){
if((this.scopeCount_===(void 0))){
this.scopeCount_=%GetScopeCount(this.break_id_,this.frameId());
}
return this.scopeCount_;
};
function FrameMirror(ax,P){
%_Call(Mirror,this,k.FRAME_TYPE);
this.break_id_=ax;
this.index_=P;
this.details_=new FrameDetails(ax,P);
}
inherits(FrameMirror,Mirror);
FrameMirror.prototype.details=function(){
return this.details_;
};
FrameMirror.prototype.index=function(){
return this.index_;
};
FrameMirror.prototype.func=function(){
if(this.func_){
return this.func_;
}
var ay=this.details_.func();
if((%IsFunction(ay))){
return this.func_=MakeMirror(ay);
}else{
return new UnresolvedFunctionMirror(ay);
}
};
FrameMirror.prototype.script=function(){
if(!this.script_){
this.script_=MakeMirror(this.details_.script());
}
return this.script_;
}
FrameMirror.prototype.receiver=function(){
return MakeMirror(this.details_.receiver());
};
FrameMirror.prototype.isConstructCall=function(){
return this.details_.isConstructCall();
};
FrameMirror.prototype.isAtReturn=function(){
return this.details_.isAtReturn();
};
FrameMirror.prototype.isDebuggerFrame=function(){
return this.details_.isDebuggerFrame();
};
FrameMirror.prototype.isOptimizedFrame=function(){
return this.details_.isOptimizedFrame();
};
FrameMirror.prototype.isInlinedFrame=function(){
return this.details_.isInlinedFrame();
};
FrameMirror.prototype.inlinedFrameIndex=function(){
return this.details_.inlinedFrameIndex();
};
FrameMirror.prototype.argumentCount=function(){
return this.details_.argumentCount();
};
FrameMirror.prototype.argumentName=function(P){
return this.details_.argumentName(P);
};
FrameMirror.prototype.argumentValue=function(P){
return MakeMirror(this.details_.argumentValue(P));
};
FrameMirror.prototype.localCount=function(){
return this.details_.localCount();
};
FrameMirror.prototype.localName=function(P){
return this.details_.localName(P);
};
FrameMirror.prototype.localValue=function(P){
return MakeMirror(this.details_.localValue(P));
};
FrameMirror.prototype.returnValue=function(){
return MakeMirror(this.details_.returnValue());
};
FrameMirror.prototype.sourcePosition=function(){
return this.details_.sourcePosition();
};
FrameMirror.prototype.sourceLocation=function(){
var N=this.script();
if(N){
return N.locationFromPosition(this.sourcePosition(),true);
}
};
FrameMirror.prototype.sourceLine=function(){
var aB=this.sourceLocation();
if(aB){
return aB.line;
}
};
FrameMirror.prototype.sourceColumn=function(){
var aB=this.sourceLocation();
if(aB){
return aB.column;
}
};
FrameMirror.prototype.sourceLineText=function(){
var aB=this.sourceLocation();
if(aB){
return aB.sourceText;
}
};
FrameMirror.prototype.scopeCount=function(){
return this.details_.scopeCount();
};
FrameMirror.prototype.scope=function(P){
return new ScopeMirror(this,(void 0),(void 0),P);
};
FrameMirror.prototype.allScopes=function(aC){
var aD=%GetAllScopesDetails(this.break_id_,
this.details_.frameId(),
this.details_.inlinedFrameIndex(),
!!aC);
var M=[];
for(var H=0;H<aD.length;++H){
M.push(new ScopeMirror(this,(void 0),(void 0),H,
aD[H]));
}
return M;
};
FrameMirror.prototype.evaluate=function(source,disable_break,
opt_context_object){
return MakeMirror(%DebugEvaluate(this.break_id_,
this.details_.frameId(),
this.details_.inlinedFrameIndex(),
source,
(!!(disable_break)),
opt_context_object));
};
FrameMirror.prototype.invocationText=function(){
var M='';
var aE=this.func();
var aF=this.receiver();
if(this.isConstructCall()){
M+='new ';
M+=aE.name()?aE.name():'[anonymous]';
}else if(this.isDebuggerFrame()){
M+='[debugger]';
}else{
var aG=
!aF.className||(aF.className()!='global');
if(aG){
M+=aF.toText();
}
var K=GetUndefinedMirror();
if(aF.isObject()){
for(var aH=aF;
!aH.isNull()&&K.isUndefined();
aH=aH.protoObject()){
K=aH.lookupProperty(aE);
}
}
if(!K.isUndefined()){
if(!K.isIndexed()){
if(aG){
M+='.';
}
M+=K.toText();
}else{
M+='[';
M+=K.toText();
M+=']';
}
if(aE.name()&&aE.name()!=K.name()){
M+='(aka '+aE.name()+')';
}
}else{
if(aG){
M+='.';
}
M+=aE.name()?aE.name():'[anonymous]';
}
}
if(!this.isDebuggerFrame()){
M+='(';
for(var H=0;H<this.argumentCount();H++){
if(H!=0)M+=', ';
if(this.argumentName(H)){
M+=this.argumentName(H);
M+='=';
}
M+=this.argumentValue(H).toText();
}
M+=')';
}
if(this.isAtReturn()){
M+=' returning ';
M+=this.returnValue().toText();
}
return M;
};
FrameMirror.prototype.sourceAndPositionText=function(){
var M='';
var aE=this.func();
if(aE.resolved()){
var N=aE.script();
if(N){
if(N.name()){
M+=N.name();
}else{
M+='[unnamed]';
}
if(!this.isDebuggerFrame()){
var aB=this.sourceLocation();
M+=' line ';
M+=!(aB===(void 0))?(aB.line+1):'?';
M+=' column ';
M+=!(aB===(void 0))?(aB.column+1):'?';
if(!(this.sourcePosition()===(void 0))){
M+=' (position '+(this.sourcePosition()+1)+')';
}
}
}else{
M+='[no source]';
}
}else{
M+='[unresolved]';
}
return M;
};
FrameMirror.prototype.localsText=function(){
var M='';
var aI=this.localCount();
if(aI>0){
for(var H=0;H<aI;++H){
M+='      var ';
M+=this.localName(H);
M+=' = ';
M+=this.localValue(H).toText();
if(H<aI-1)M+='\n';
}
}
return M;
};
FrameMirror.prototype.restart=function(){
var M=%LiveEditRestartFrame(this.break_id_,this.index_);
if((M===(void 0))){
M="Failed to find requested frame";
}
return M;
};
FrameMirror.prototype.toText=function(aJ){
var M='';
M+='#'+(this.index()<=9?'0':'')+this.index();
M+=' ';
M+=this.invocationText();
M+=' ';
M+=this.sourceAndPositionText();
if(aJ){
M+='\n';
M+=this.localsText();
}
return M;
};
var aK=0;
var aL=1;
var aM=2;
var aN=3;
var aO=4;
var aP=5;
function ScopeDetails(aQ,aR,aS,P,aT){
if(aQ){
this.break_id_=aQ.break_id_;
this.details_=aT||
%GetScopeDetails(aQ.break_id_,
aQ.details_.frameId(),
aQ.details_.inlinedFrameIndex(),
P);
this.frame_id_=aQ.details_.frameId();
this.inlined_frame_id_=aQ.details_.inlinedFrameIndex();
}else if(aR){
this.details_=aT||%GetFunctionScopeDetails(aR.value(),P);
this.fun_value_=aR.value();
this.break_id_=(void 0);
}else{
this.details_=
aT||%GetGeneratorScopeDetails(aS.value(),P);
this.gen_value_=aS.value();
this.break_id_=(void 0);
}
this.index_=P;
}
ScopeDetails.prototype.type=function(){
if(!(this.break_id_===(void 0))){
%CheckExecutionState(this.break_id_);
}
return this.details_[aK];
};
ScopeDetails.prototype.object=function(){
if(!(this.break_id_===(void 0))){
%CheckExecutionState(this.break_id_);
}
return this.details_[aL];
};
ScopeDetails.prototype.name=function(){
if(!(this.break_id_===(void 0))){
%CheckExecutionState(this.break_id_);
}
return this.details_[aM];
};
ScopeDetails.prototype.startPosition=function(){
if(!(this.break_id_===(void 0))){
%CheckExecutionState(this.break_id_);
}
return this.details_[aN];
}
ScopeDetails.prototype.endPosition=function(){
if(!(this.break_id_===(void 0))){
%CheckExecutionState(this.break_id_);
}
return this.details_[aO];
}
ScopeDetails.prototype.func=function(){
if(!(this.break_id_===(void 0))){
%CheckExecutionState(this.break_id_);
}
return this.details_[aP];
}
ScopeDetails.prototype.setVariableValueImpl=function(I,aU){
var aV;
if(!(this.break_id_===(void 0))){
%CheckExecutionState(this.break_id_);
aV=%SetScopeVariableValue(this.break_id_,this.frame_id_,
this.inlined_frame_id_,this.index_,I,aU);
}else if(!(this.fun_value_===(void 0))){
aV=%SetScopeVariableValue(this.fun_value_,null,null,this.index_,
I,aU);
}else{
aV=%SetScopeVariableValue(this.gen_value_,null,null,this.index_,
I,aU);
}
if(!aV)throw %make_error(2,"Failed to set variable value");
};
function ScopeMirror(aQ,aR,aS,P,aT){
%_Call(Mirror,this,k.SCOPE_TYPE);
if(aQ){
this.frame_index_=aQ.index_;
}else{
this.frame_index_=(void 0);
}
this.scope_index_=P;
this.details_=new ScopeDetails(aQ,aR,aS,P,aT);
}
inherits(ScopeMirror,Mirror);
ScopeMirror.prototype.details=function(){
return this.details_;
};
ScopeMirror.prototype.frameIndex=function(){
return this.frame_index_;
};
ScopeMirror.prototype.scopeIndex=function(){
return this.scope_index_;
};
ScopeMirror.prototype.scopeType=function(){
return this.details_.type();
};
ScopeMirror.prototype.scopeObject=function(){
var C=this.scopeType()==A.Local||
this.scopeType()==A.Closure||
this.scopeType()==A.Script;
return MakeMirror(this.details_.object(),C);
};
ScopeMirror.prototype.setVariableValue=function(I,aU){
this.details_.setVariableValueImpl(I,aU);
};
function ScriptMirror(N){
%_Call(Mirror,this,k.SCRIPT_TYPE);
this.script_=N;
this.context_=new ContextMirror(N.context_data);
this.allocateHandle_();
}
inherits(ScriptMirror,Mirror);
ScriptMirror.prototype.value=function(){
return this.script_;
};
ScriptMirror.prototype.name=function(){
return this.script_.name||this.script_.nameOrSourceURL();
};
ScriptMirror.prototype.id=function(){
return this.script_.id;
};
ScriptMirror.prototype.source=function(){
return this.script_.source;
};
ScriptMirror.prototype.setSource=function(aW){
if(!(typeof(aW)==='string'))throw %make_error(2,"Source is not a string");
%DebugSetScriptSource(this.script_,aW);
};
ScriptMirror.prototype.lineOffset=function(){
return this.script_.line_offset;
};
ScriptMirror.prototype.columnOffset=function(){
return this.script_.column_offset;
};
ScriptMirror.prototype.data=function(){
return this.script_.data;
};
ScriptMirror.prototype.scriptType=function(){
return this.script_.type;
};
ScriptMirror.prototype.compilationType=function(){
return this.script_.compilation_type;
};
ScriptMirror.prototype.lineCount=function(){
return %ScriptLineCount(this.script_);
};
ScriptMirror.prototype.locationFromPosition=function(
position,include_resource_offset){
return this.script_.locationFromPosition(position,include_resource_offset);
};
ScriptMirror.prototype.context=function(){
return this.context_;
};
ScriptMirror.prototype.evalFromScript=function(){
return MakeMirror(this.script_.eval_from_script);
};
ScriptMirror.prototype.evalFromFunctionName=function(){
return MakeMirror(this.script_.eval_from_function_name);
};
ScriptMirror.prototype.evalFromLocation=function(){
var aX=this.evalFromScript();
if(!aX.isUndefined()){
var aY=this.script_.eval_from_script_position;
return aX.locationFromPosition(aY,true);
}
};
ScriptMirror.prototype.toText=function(){
var M='';
M+=this.name();
M+=' (lines: ';
if(this.lineOffset()>0){
M+=this.lineOffset();
M+='-';
M+=this.lineOffset()+this.lineCount()-1;
}else{
M+=this.lineCount();
}
M+=')';
return M;
};
function ContextMirror(aZ){
%_Call(Mirror,this,k.CONTEXT_TYPE);
this.data_=aZ;
this.allocateHandle_();
}
inherits(ContextMirror,Mirror);
ContextMirror.prototype.data=function(){
return this.data_;
};
function MakeMirrorSerializer(J,ba){
return new JSONProtocolSerializer(J,ba);
}
function JSONProtocolSerializer(J,ba){
this.details_=J;
this.options_=ba;
this.mirrors_=[];
}
JSONProtocolSerializer.prototype.serializeReference=function(r){
return this.serialize_(r,true,true);
};
JSONProtocolSerializer.prototype.serializeValue=function(r){
var bb=this.serialize_(r,false,true);
return bb;
};
JSONProtocolSerializer.prototype.serializeReferencedObjects=function(){
var bc=[];
var bd=this.mirrors_.length;
for(var H=0;H<bd;H++){
bc.push(this.serialize_(this.mirrors_[H],false,false));
}
return bc;
};
JSONProtocolSerializer.prototype.includeSource_=function(){
return this.options_&&this.options_.includeSource;
};
JSONProtocolSerializer.prototype.inlineRefs_=function(){
return this.options_&&this.options_.inlineRefs;
};
JSONProtocolSerializer.prototype.maxStringLength_=function(){
if((this.options_===(void 0))||
(this.options_.maxStringLength===(void 0))){
return x;
}
return this.options_.maxStringLength;
};
JSONProtocolSerializer.prototype.add_=function(r){
for(var H=0;H<this.mirrors_.length;H++){
if(this.mirrors_[H]===r){
return;
}
}
this.mirrors_.push(r);
};
JSONProtocolSerializer.prototype.serializeReferenceWithDisplayData_=
function(r){
var be={};
be.ref=r.handle();
be.type=r.type();
switch(r.type()){
case k.UNDEFINED_TYPE:
case k.NULL_TYPE:
case k.BOOLEAN_TYPE:
case k.NUMBER_TYPE:
be.value=r.value();
break;
case k.STRING_TYPE:
be.value=r.getTruncatedValue(this.maxStringLength_());
break;
case k.SYMBOL_TYPE:
be.description=r.description();
break;
case k.FUNCTION_TYPE:
be.name=r.name();
be.inferredName=r.inferredName();
if(r.script()){
be.scriptId=r.script().id();
}
break;
case k.ERROR_TYPE:
case k.REGEXP_TYPE:
be.value=r.toText();
break;
case k.OBJECT_TYPE:
be.className=r.className();
break;
}
return be;
};
JSONProtocolSerializer.prototype.serialize_=function(r,reference,
J){
if(reference&&
(r.isValue()||r.isScript()||r.isContext())){
if(this.inlineRefs_()&&r.isValue()){
return this.serializeReferenceWithDisplayData_(r);
}else{
this.add_(r);
return{'ref':r.handle()};
}
}
var bc={};
if(r.isValue()||r.isScript()||r.isContext()){
bc.handle=r.handle();
}
bc.type=r.type();
switch(r.type()){
case k.UNDEFINED_TYPE:
case k.NULL_TYPE:
break;
case k.BOOLEAN_TYPE:
bc.value=r.value();
break;
case k.NUMBER_TYPE:
bc.value=NumberToJSON_(r.value());
break;
case k.STRING_TYPE:
if(this.maxStringLength_()!=-1&&
r.length()>this.maxStringLength_()){
var bf=r.getTruncatedValue(this.maxStringLength_());
bc.value=bf;
bc.fromIndex=0;
bc.toIndex=this.maxStringLength_();
}else{
bc.value=r.value();
}
bc.length=r.length();
break;
case k.SYMBOL_TYPE:
bc.description=r.description();
break;
case k.OBJECT_TYPE:
case k.FUNCTION_TYPE:
case k.ERROR_TYPE:
case k.REGEXP_TYPE:
case k.PROMISE_TYPE:
case k.GENERATOR_TYPE:
this.serializeObject_(r,bc,J);
break;
case k.PROPERTY_TYPE:
case k.INTERNAL_PROPERTY_TYPE:
throw %make_error(2,
'PropertyMirror cannot be serialized independently');
break;
case k.FRAME_TYPE:
this.serializeFrame_(r,bc);
break;
case k.SCOPE_TYPE:
this.serializeScope_(r,bc);
break;
case k.SCRIPT_TYPE:
if(r.name()){
bc.name=r.name();
}
bc.id=r.id();
bc.lineOffset=r.lineOffset();
bc.columnOffset=r.columnOffset();
bc.lineCount=r.lineCount();
if(r.data()){
bc.data=r.data();
}
if(this.includeSource_()){
bc.source=r.source();
}else{
var bg=r.source().substring(0,80);
bc.sourceStart=bg;
}
bc.sourceLength=r.source().length;
bc.scriptType=r.scriptType();
bc.compilationType=r.compilationType();
if(r.compilationType()==1&&
r.evalFromScript()){
bc.evalFromScript=
this.serializeReference(r.evalFromScript());
var bh=r.evalFromLocation();
if(bh){
bc.evalFromLocation={line:bh.line,
column:bh.column};
}
if(r.evalFromFunctionName()){
bc.evalFromFunctionName=r.evalFromFunctionName();
}
}
if(r.context()){
bc.context=this.serializeReference(r.context());
}
break;
case k.CONTEXT_TYPE:
bc.data=r.data();
break;
}
bc.text=r.toText();
return bc;
};
JSONProtocolSerializer.prototype.serializeObject_=function(r,bc,
J){
bc.className=r.className();
bc.constructorFunction=
this.serializeReference(r.constructorFunction());
bc.protoObject=this.serializeReference(r.protoObject());
bc.prototypeObject=this.serializeReference(r.prototypeObject());
if(r.hasNamedInterceptor()){
bc.namedInterceptor=true;
}
if(r.hasIndexedInterceptor()){
bc.indexedInterceptor=true;
}
if(r.isFunction()){
bc.name=r.name();
if(!(r.inferredName()===(void 0))){
bc.inferredName=r.inferredName();
}
bc.resolved=r.resolved();
if(r.resolved()){
bc.source=r.source();
}
if(r.script()){
bc.script=this.serializeReference(r.script());
bc.scriptId=r.script().id();
serializeLocationFields(r.sourceLocation(),bc);
}
bc.scopes=[];
for(var H=0;H<r.scopeCount();H++){
var bi=r.scope(H);
bc.scopes.push({
type:bi.scopeType(),
index:H
});
}
}
if(r.isGenerator()){
bc.status=r.status();
bc.func=this.serializeReference(r.func())
bc.receiver=this.serializeReference(r.receiver())
serializeLocationFields(r.sourceLocation(),bc);
}
if(r.isDate()){
bc.value=r.value();
}
if(r.isPromise()){
bc.status=r.status();
bc.promiseValue=this.serializeReference(r.promiseValue());
}
var G=r.propertyNames();
for(var H=0;H<G.length;H++){
var bj=r.property(G[H]);
G[H]=this.serializeProperty_(bj);
if(J){
this.add_(bj.value());
}
}
bc.properties=G;
var bk=r.internalProperties();
if(bk.length>0){
var bl=[];
for(var H=0;H<bk.length;H++){
bl.push(this.serializeInternalProperty_(bk[H]));
}
bc.internalProperties=bl;
}
};
function serializeLocationFields(aB,bc){
if(!aB){
return;
}
bc.position=aB.position;
var bm=aB.line;
if(!(bm===(void 0))){
bc.line=bm;
}
var bn=aB.column;
if(!(bn===(void 0))){
bc.column=bn;
}
}
JSONProtocolSerializer.prototype.serializeProperty_=function(bj){
var M={};
M.name=bj.name();
var bo=bj.value();
if(this.inlineRefs_()&&bo.isValue()){
M.value=this.serializeReferenceWithDisplayData_(bo);
}else{
if(bj.attributes()!=z.None){
M.attributes=bj.attributes();
}
M.propertyType=bj.propertyType();
M.ref=bo.handle();
}
return M;
};
JSONProtocolSerializer.prototype.serializeInternalProperty_=
function(bj){
var M={};
M.name=bj.name();
var bo=bj.value();
if(this.inlineRefs_()&&bo.isValue()){
M.value=this.serializeReferenceWithDisplayData_(bo);
}else{
M.ref=bo.handle();
}
return M;
};
JSONProtocolSerializer.prototype.serializeFrame_=function(r,bc){
bc.index=r.index();
bc.receiver=this.serializeReference(r.receiver());
var aE=r.func();
bc.func=this.serializeReference(aE);
var N=aE.script();
if(N){
bc.script=this.serializeReference(N);
}
bc.constructCall=r.isConstructCall();
bc.atReturn=r.isAtReturn();
if(r.isAtReturn()){
bc.returnValue=this.serializeReference(r.returnValue());
}
bc.debuggerFrame=r.isDebuggerFrame();
var E=new c(r.argumentCount());
for(var H=0;H<r.argumentCount();H++){
var bp={};
var bq=r.argumentName(H);
if(bq){
bp.name=bq;
}
bp.value=this.serializeReference(r.argumentValue(H));
E[H]=bp;
}
bc.arguments=E;
var E=new c(r.localCount());
for(var H=0;H<r.localCount();H++){
var br={};
br.name=r.localName(H);
br.value=this.serializeReference(r.localValue(H));
E[H]=br;
}
bc.locals=E;
serializeLocationFields(r.sourceLocation(),bc);
var bs=r.sourceLineText();
if(!(bs===(void 0))){
bc.sourceLineText=bs;
}
bc.scopes=[];
for(var H=0;H<r.scopeCount();H++){
var bi=r.scope(H);
bc.scopes.push({
type:bi.scopeType(),
index:H
});
}
};
JSONProtocolSerializer.prototype.serializeScope_=function(r,bc){
bc.index=r.scopeIndex();
bc.frameIndex=r.frameIndex();
bc.type=r.scopeType();
bc.object=this.inlineRefs_()?
this.serializeValue(r.scopeObject()):
this.serializeReference(r.scopeObject());
};
function NumberToJSON_(p){
if(d(p)){
return'NaN';
}
if(!(%_IsSmi(%IS_VAR(p))||((p==p)&&(p!=1/0)&&(p!=-1/0)))){
if(p>0){
return'Infinity';
}else{
return'-Infinity';
}
}
return p;
}
b.InstallFunctions(a,2,[
"MakeMirror",MakeMirror,
"MakeMirrorSerializer",MakeMirrorSerializer,
"LookupMirror",LookupMirror,
"ToggleMirrorCache",ToggleMirrorCache,
"MirrorCacheIsEmpty",MirrorCacheIsEmpty,
]);
b.InstallConstants(a,[
"ScopeType",A,
"PropertyType",y,
"PropertyAttribute",z,
"Mirror",Mirror,
"ValueMirror",ValueMirror,
"UndefinedMirror",UndefinedMirror,
"NullMirror",NullMirror,
"BooleanMirror",BooleanMirror,
"NumberMirror",NumberMirror,
"StringMirror",StringMirror,
"SymbolMirror",SymbolMirror,
"ObjectMirror",ObjectMirror,
"FunctionMirror",FunctionMirror,
"UnresolvedFunctionMirror",UnresolvedFunctionMirror,
"ArrayMirror",ArrayMirror,
"DateMirror",DateMirror,
"RegExpMirror",RegExpMirror,
"ErrorMirror",ErrorMirror,
"PromiseMirror",PromiseMirror,
"MapMirror",MapMirror,
"SetMirror",SetMirror,
"IteratorMirror",IteratorMirror,
"GeneratorMirror",GeneratorMirror,
"PropertyMirror",PropertyMirror,
"InternalPropertyMirror",InternalPropertyMirror,
"FrameMirror",FrameMirror,
"ScriptMirror",ScriptMirror,
"ScopeMirror",ScopeMirror,
"FrameDetails",FrameDetails,
]);
b.InstallFunctions(b,2,[
"ClearMirrorCache",ClearMirrorCache
]);
b.Export(function(bt){
bt.MirrorType=k;
});
})

debugﬁU
(function(a,b){
"use strict";
var c=a.FrameMirror;
var d=a.Array;
var e=a.RegExp;
var f=a.isNaN;
var g=a.JSON.parse;
var h=a.JSON.stringify;
var i=a.LookupMirror;
var j=a.MakeMirror;
var k=a.MakeMirrorSerializer;
var l=a.Math.min;
var m=a.Mirror;
var n;
var o=a.parseInt;
var p=a.ValueMirror;
b.Import(function(q){
n=q.MirrorType;
});
var r=10;
var s={};
var t=/^(?:\s*(?:\/\*.*?\*\/)*)*/;
s.DebugEvent={Break:1,
Exception:2,
AfterCompile:3,
CompileError:4,
AsyncTaskEvent:5};
s.ExceptionBreak={Caught:0,
Uncaught:1};
s.StepAction={StepOut:0,
StepNext:1,
StepIn:2,
StepFrame:3};
s.ScriptType={Native:0,
Extension:1,
Normal:2,
Wasm:3};
s.ScriptCompilationType={Host:0,
Eval:1,
JSON:2};
s.ScriptBreakPointType={ScriptId:0,
ScriptName:1,
ScriptRegExp:2};
s.BreakPositionAlignment={
Statement:0,
BreakPosition:1
};
function ScriptTypeFlag(u){
return(1<<u);
}
var v=0;
var w=1;
var x=[];
var y=[];
var z={
breakPointsActive:{
value:true,
getValue:function(){return this.value;},
setValue:function(A){
this.value=!!A;
%SetBreakPointsActive(this.value);
}
},
breakOnCaughtException:{
getValue:function(){return s.isBreakOnException();},
setValue:function(A){
if(A){
s.setBreakOnException();
}else{
s.clearBreakOnException();
}
}
},
breakOnUncaughtException:{
getValue:function(){return s.isBreakOnUncaughtException();},
setValue:function(A){
if(A){
s.setBreakOnUncaughtException();
}else{
s.clearBreakOnUncaughtException();
}
}
},
};
function MakeBreakPoint(B,C){
var D=new BreakPoint(B,C);
x.push(D);
return D;
}
function BreakPoint(B,C){
this.source_position_=B;
if(C){
this.script_break_point_=C;
}else{
this.number_=w++;
}
this.active_=true;
this.condition_=null;
}
BreakPoint.prototype.number=function(){
return this.number_;
};
BreakPoint.prototype.func=function(){
return this.func_;
};
BreakPoint.prototype.source_position=function(){
return this.source_position_;
};
BreakPoint.prototype.active=function(){
if(this.script_break_point()){
return this.script_break_point().active();
}
return this.active_;
};
BreakPoint.prototype.condition=function(){
if(this.script_break_point()&&this.script_break_point().condition()){
return this.script_break_point().condition();
}
return this.condition_;
};
BreakPoint.prototype.script_break_point=function(){
return this.script_break_point_;
};
BreakPoint.prototype.enable=function(){
this.active_=true;
};
BreakPoint.prototype.disable=function(){
this.active_=false;
};
BreakPoint.prototype.setCondition=function(E){
this.condition_=E;
};
BreakPoint.prototype.isTriggered=function(F){
if(!this.active())return false;
if(this.condition()){
try{
var G=F.frame(0).evaluate(this.condition());
if(!(G instanceof p)||!G.value_){
return false;
}
}catch(e){
return false;
}
}
return true;
};
function IsBreakPointTriggered(H,D){
return D.isTriggered(MakeExecutionState(H));
}
function ScriptBreakPoint(u,script_id_or_name,opt_line,opt_column,
opt_groupId,opt_position_alignment){
this.type_=u;
if(u==s.ScriptBreakPointType.ScriptId){
this.script_id_=script_id_or_name;
}else if(u==s.ScriptBreakPointType.ScriptName){
this.script_name_=script_id_or_name;
}else if(u==s.ScriptBreakPointType.ScriptRegExp){
this.script_regexp_object_=new e(script_id_or_name);
}else{
throw %make_error(2,"Unexpected breakpoint type "+u);
}
this.line_=opt_line||0;
this.column_=opt_column;
this.groupId_=opt_groupId;
this.position_alignment_=(opt_position_alignment===(void 0))
?s.BreakPositionAlignment.Statement:opt_position_alignment;
this.active_=true;
this.condition_=null;
this.break_points_=[];
}
ScriptBreakPoint.prototype.number=function(){
return this.number_;
};
ScriptBreakPoint.prototype.groupId=function(){
return this.groupId_;
};
ScriptBreakPoint.prototype.type=function(){
return this.type_;
};
ScriptBreakPoint.prototype.script_id=function(){
return this.script_id_;
};
ScriptBreakPoint.prototype.script_name=function(){
return this.script_name_;
};
ScriptBreakPoint.prototype.script_regexp_object=function(){
return this.script_regexp_object_;
};
ScriptBreakPoint.prototype.line=function(){
return this.line_;
};
ScriptBreakPoint.prototype.column=function(){
return this.column_;
};
ScriptBreakPoint.prototype.actual_locations=function(){
var I=[];
for(var J=0;J<this.break_points_.length;J++){
I.push(this.break_points_[J].actual_location);
}
return I;
};
ScriptBreakPoint.prototype.update_positions=function(K,L){
this.line_=K;
this.column_=L;
};
ScriptBreakPoint.prototype.active=function(){
return this.active_;
};
ScriptBreakPoint.prototype.condition=function(){
return this.condition_;
};
ScriptBreakPoint.prototype.enable=function(){
this.active_=true;
};
ScriptBreakPoint.prototype.disable=function(){
this.active_=false;
};
ScriptBreakPoint.prototype.setCondition=function(E){
this.condition_=E;
};
ScriptBreakPoint.prototype.matchesScript=function(M){
if(this.type_==s.ScriptBreakPointType.ScriptId){
return this.script_id_==M.id;
}else{
if(!(M.line_offset<=this.line_&&
this.line_<M.line_offset+%ScriptLineCount(M))){
return false;
}
if(this.type_==s.ScriptBreakPointType.ScriptName){
return this.script_name_==M.nameOrSourceURL();
}else if(this.type_==s.ScriptBreakPointType.ScriptRegExp){
return this.script_regexp_object_.test(M.nameOrSourceURL());
}else{
throw %make_error(2,"Unexpected breakpoint type "+this.type_);
}
}
};
ScriptBreakPoint.prototype.set=function(M){
var L=this.column();
var K=this.line();
if((L===(void 0))){
var N=%ScriptSourceLine(M,K||M.line_offset);
if(!M.sourceColumnStart_){
M.sourceColumnStart_=new d(%ScriptLineCount(M));
}
if((M.sourceColumnStart_[K]===(void 0))){
M.sourceColumnStart_[K]=
N.match(t)[0].length;
}
L=M.sourceColumnStart_[K];
}
var O=s.findScriptSourcePosition(M,this.line(),L);
if((O===null))return;
var D=MakeBreakPoint(O,this);
var P=%SetScriptBreakPoint(M,O,
this.position_alignment_,
D);
if((P===(void 0))){
P=O;
}
var Q=M.locationFromPosition(P,true);
D.actual_location={line:Q.line,
column:Q.column,
script_id:M.id};
this.break_points_.push(D);
return D;
};
ScriptBreakPoint.prototype.clear=function(){
var R=[];
for(var J=0;J<x.length;J++){
if(x[J].script_break_point()&&
x[J].script_break_point()===this){
%ClearBreakPoint(x[J]);
}else{
R.push(x[J]);
}
}
x=R;
this.break_points_=[];
};
s.setListener=function(S,T){
if(!(%IsFunction(S))&&!(S===(void 0))&&!(S===null)){
throw %make_type_error(34);
}
%SetDebugEventListener(S,T);
};
s.findScript=function(U){
if((%IsFunction(U))){
return %FunctionGetScript(U);
}else if((%_IsRegExp(U))){
var V=this.scripts();
var W=null;
var X=0;
for(var J in V){
var M=V[J];
if(U.test(M.name)){
W=M;
X++;
}
}
if(X==1){
return W;
}else{
return(void 0);
}
}else{
return %GetScript(U);
}
};
s.scriptSource=function(U){
return this.findScript(U).source;
};
s.source=function(Y){
if(!(%IsFunction(Y)))throw %make_type_error(34);
return %FunctionGetSourceCode(Y);
};
s.sourcePosition=function(Y){
if(!(%IsFunction(Y)))throw %make_type_error(34);
return %FunctionGetScriptSourcePosition(Y);
};
s.findFunctionSourceLocation=function(Z,aa,ab){
var M=%FunctionGetScript(Z);
var ac=%FunctionGetScriptSourcePosition(Z);
return %ScriptLocationFromLine(M,aa,ab,ac);
};
s.findScriptSourcePosition=function(M,aa,ab){
var ad=%ScriptLocationFromLine(M,aa,ab,0);
return ad?ad.position:null;
};
s.findBreakPoint=function(ae,af){
var D;
for(var J=0;J<x.length;J++){
if(x[J].number()==ae){
D=x[J];
if(af){
x.splice(J,1);
}
break;
}
}
if(D){
return D;
}else{
return this.findScriptBreakPoint(ae,af);
}
};
s.findBreakPointActualLocations=function(ae){
for(var J=0;J<y.length;J++){
if(y[J].number()==ae){
return y[J].actual_locations();
}
}
for(var J=0;J<x.length;J++){
if(x[J].number()==ae){
return[x[J].actual_location];
}
}
return[];
};
s.setBreakPoint=function(Z,aa,ab,ag){
if(!(%IsFunction(Z)))throw %make_type_error(34);
if(%FunctionIsAPIFunction(Z)){
throw %make_error(2,'Cannot set break point in native code.');
}
var B=
this.findFunctionSourceLocation(Z,aa,ab).position;
var M=%FunctionGetScript(Z);
if(M.type==s.ScriptType.Native){
throw %make_error(2,'Cannot set break point in native code.');
}
if(M&&M.id){
var ad=M.locationFromPosition(B,false);
return this.setScriptBreakPointById(M.id,
ad.line,ad.column,
ag);
}else{
var D=MakeBreakPoint(B);
var P=
%SetFunctionBreakPoint(Z,B,D);
var Q=M.locationFromPosition(P,true);
D.actual_location={line:Q.line,
column:Q.column,
script_id:M.id};
D.setCondition(ag);
return D.number();
}
};
s.setBreakPointByScriptIdAndPosition=function(script_id,O,
E,enabled,
opt_position_alignment)
{
var D=MakeBreakPoint(O);
D.setCondition(E);
if(!enabled){
D.disable();
}
var M=scriptById(script_id);
if(M){
var ah=(opt_position_alignment===(void 0))
?s.BreakPositionAlignment.Statement:opt_position_alignment;
D.actual_position=%SetScriptBreakPoint(M,O,
ah,D);
}
return D;
};
s.enableBreakPoint=function(ae){
var D=this.findBreakPoint(ae,false);
if(D){
D.enable();
}
};
s.disableBreakPoint=function(ae){
var D=this.findBreakPoint(ae,false);
if(D){
D.disable();
}
};
s.changeBreakPointCondition=function(ae,E){
var D=this.findBreakPoint(ae,false);
D.setCondition(E);
};
s.clearBreakPoint=function(ae){
var D=this.findBreakPoint(ae,true);
if(D){
return %ClearBreakPoint(D);
}else{
D=this.findScriptBreakPoint(ae,true);
if(!D)throw %make_error(2,'Invalid breakpoint');
}
};
s.clearAllBreakPoints=function(){
for(var J=0;J<x.length;J++){
var D=x[J];
%ClearBreakPoint(D);
}
x=[];
};
s.disableAllBreakPoints=function(){
for(var J=1;J<w;J++){
s.disableBreakPoint(J);
}
%ChangeBreakOnException(s.ExceptionBreak.Caught,false);
%ChangeBreakOnException(s.ExceptionBreak.Uncaught,false);
};
s.findScriptBreakPoint=function(ae,af){
var ai;
for(var J=0;J<y.length;J++){
if(y[J].number()==ae){
ai=y[J];
if(af){
ai.clear();
y.splice(J,1);
}
break;
}
}
return ai;
};
s.setScriptBreakPoint=function(u,script_id_or_name,
aa,ab,ag,
opt_groupId,opt_position_alignment){
var ai=
new ScriptBreakPoint(u,script_id_or_name,aa,ab,
opt_groupId,opt_position_alignment);
ai.number_=w++;
ai.setCondition(ag);
y.push(ai);
var V=this.scripts();
for(var J=0;J<V.length;J++){
if(ai.matchesScript(V[J])){
ai.set(V[J]);
}
}
return ai.number();
};
s.setScriptBreakPointById=function(script_id,
aa,ab,
ag,opt_groupId,
opt_position_alignment){
return this.setScriptBreakPoint(s.ScriptBreakPointType.ScriptId,
script_id,aa,ab,
ag,opt_groupId,
opt_position_alignment);
};
s.setScriptBreakPointByName=function(script_name,
aa,ab,
ag,opt_groupId){
return this.setScriptBreakPoint(s.ScriptBreakPointType.ScriptName,
script_name,aa,ab,
ag,opt_groupId);
};
s.setScriptBreakPointByRegExp=function(script_regexp,
aa,ab,
ag,opt_groupId){
return this.setScriptBreakPoint(s.ScriptBreakPointType.ScriptRegExp,
script_regexp,aa,ab,
ag,opt_groupId);
};
s.enableScriptBreakPoint=function(ae){
var ai=this.findScriptBreakPoint(ae,false);
ai.enable();
};
s.disableScriptBreakPoint=function(ae){
var ai=this.findScriptBreakPoint(ae,false);
ai.disable();
};
s.changeScriptBreakPointCondition=function(
ae,E){
var ai=this.findScriptBreakPoint(ae,false);
ai.setCondition(E);
};
s.scriptBreakPoints=function(){
return y;
};
s.clearStepping=function(){
%ClearStepping();
};
s.setBreakOnException=function(){
return %ChangeBreakOnException(s.ExceptionBreak.Caught,true);
};
s.clearBreakOnException=function(){
return %ChangeBreakOnException(s.ExceptionBreak.Caught,false);
};
s.isBreakOnException=function(){
return!!%IsBreakOnException(s.ExceptionBreak.Caught);
};
s.setBreakOnUncaughtException=function(){
return %ChangeBreakOnException(s.ExceptionBreak.Uncaught,true);
};
s.clearBreakOnUncaughtException=function(){
return %ChangeBreakOnException(s.ExceptionBreak.Uncaught,false);
};
s.isBreakOnUncaughtException=function(){
return!!%IsBreakOnException(s.ExceptionBreak.Uncaught);
};
s.showBreakPoints=function(Y,aj,ak){
if(!(%IsFunction(Y)))throw %make_error(34);
var al=aj?this.scriptSource(Y):this.source(Y);
var am=aj?0:this.sourcePosition(Y);
var ah=(ak===(void 0))
?s.BreakPositionAlignment.Statement:ak;
var I=%GetBreakLocations(Y,ah);
if(!I)return al;
I.sort(function(an,ao){return an-ao;});
var ap="";
var aq=0;
var ar;
for(var J=0;J<I.length;J++){
ar=I[J]-am;
ap+=al.slice(aq,ar);
ap+="[B"+J+"]";
aq=ar;
}
ar=al.length;
ap+=al.substring(aq,ar);
return ap;
};
s.scripts=function(){
return %DebugGetLoadedScripts();
};
function scriptById(as){
var V=s.scripts();
for(var M of V){
if(M.id==as)return M;
}
return(void 0);
};
s.debuggerFlags=function(){
return z;
};
s.MakeMirror=j;
function MakeExecutionState(H){
return new ExecutionState(H);
}
function ExecutionState(H){
this.break_id=H;
this.selected_frame=0;
}
ExecutionState.prototype.prepareStep=function(at){
if(at===s.StepAction.StepIn||
at===s.StepAction.StepOut||
at===s.StepAction.StepNext||
at===s.StepAction.StepFrame){
return %PrepareStep(this.break_id,at);
}
throw %make_type_error(34);
};
ExecutionState.prototype.evaluateGlobal=function(al,disable_break,
opt_additional_context){
return j(%DebugEvaluateGlobal(this.break_id,al,
(!!(disable_break)),
opt_additional_context));
};
ExecutionState.prototype.frameCount=function(){
return %GetFrameCount(this.break_id);
};
ExecutionState.prototype.frame=function(au){
if(au==null)au=this.selected_frame;
if(au<0||au>=this.frameCount()){
throw %make_type_error(33);
}
return new c(this.break_id,au);
};
ExecutionState.prototype.setSelectedFrame=function(av){
var J=(%_ToNumber(av));
if(J<0||J>=this.frameCount()){
throw %make_type_error(33);
}
this.selected_frame=J;
};
ExecutionState.prototype.selectedFrame=function(){
return this.selected_frame;
};
ExecutionState.prototype.debugCommandProcessor=function(aw){
return new DebugCommandProcessor(this,aw);
};
function MakeBreakEvent(H,ax){
return new BreakEvent(H,ax);
}
function BreakEvent(H,ax){
this.frame_=new c(H,0);
this.break_points_hit_=ax;
}
BreakEvent.prototype.eventType=function(){
return s.DebugEvent.Break;
};
BreakEvent.prototype.func=function(){
return this.frame_.func();
};
BreakEvent.prototype.sourceLine=function(){
return this.frame_.sourceLine();
};
BreakEvent.prototype.sourceColumn=function(){
return this.frame_.sourceColumn();
};
BreakEvent.prototype.sourceLineText=function(){
return this.frame_.sourceLineText();
};
BreakEvent.prototype.breakPointsHit=function(){
return this.break_points_hit_;
};
BreakEvent.prototype.toJSONProtocol=function(){
var ay={seq:v++,
type:"event",
event:"break",
body:{invocationText:this.frame_.invocationText()}
};
var M=this.func().script();
if(M){
ay.body.sourceLine=this.sourceLine(),
ay.body.sourceColumn=this.sourceColumn(),
ay.body.sourceLineText=this.sourceLineText(),
ay.body.script=MakeScriptObject_(M,false);
}
if(this.breakPointsHit()){
ay.body.breakpoints=[];
for(var J=0;J<this.breakPointsHit().length;J++){
var az=this.breakPointsHit()[J];
var ai=az.script_break_point();
var aA;
if(ai){
aA=ai.number();
}else{
aA=az.number();
}
ay.body.breakpoints.push(aA);
}
}
return h(ObjectToProtocolObject_(ay));
};
function MakeExceptionEvent(H,aB,aC,aD){
return new ExceptionEvent(H,aB,aC,aD);
}
function ExceptionEvent(H,aB,aC,aD){
this.exec_state_=new ExecutionState(H);
this.exception_=aB;
this.uncaught_=aC;
this.promise_=aD;
}
ExceptionEvent.prototype.eventType=function(){
return s.DebugEvent.Exception;
};
ExceptionEvent.prototype.exception=function(){
return this.exception_;
};
ExceptionEvent.prototype.uncaught=function(){
return this.uncaught_;
};
ExceptionEvent.prototype.promise=function(){
return this.promise_;
};
ExceptionEvent.prototype.func=function(){
return this.exec_state_.frame(0).func();
};
ExceptionEvent.prototype.sourceLine=function(){
return this.exec_state_.frame(0).sourceLine();
};
ExceptionEvent.prototype.sourceColumn=function(){
return this.exec_state_.frame(0).sourceColumn();
};
ExceptionEvent.prototype.sourceLineText=function(){
return this.exec_state_.frame(0).sourceLineText();
};
ExceptionEvent.prototype.toJSONProtocol=function(){
var ay=new ProtocolMessage();
ay.event="exception";
ay.body={uncaught:this.uncaught_,
exception:j(this.exception_)
};
if(this.exec_state_.frameCount()>0){
ay.body.sourceLine=this.sourceLine();
ay.body.sourceColumn=this.sourceColumn();
ay.body.sourceLineText=this.sourceLineText();
var M=this.func().script();
if(M){
ay.body.script=MakeScriptObject_(M,false);
}
}else{
ay.body.sourceLine=-1;
}
return ay.toJSONProtocol();
};
function MakeCompileEvent(M,u){
return new CompileEvent(M,u);
}
function CompileEvent(M,u){
this.script_=j(M);
this.type_=u;
}
CompileEvent.prototype.eventType=function(){
return this.type_;
};
CompileEvent.prototype.script=function(){
return this.script_;
};
CompileEvent.prototype.toJSONProtocol=function(){
var ay=new ProtocolMessage();
ay.running=true;
switch(this.type_){
case s.DebugEvent.BeforeCompile:
ay.event="beforeCompile";
break;
case s.DebugEvent.AfterCompile:
ay.event="afterCompile";
break;
case s.DebugEvent.CompileError:
ay.event="compileError";
break;
}
ay.body={};
ay.body.script=this.script_;
return ay.toJSONProtocol();
};
function MakeScriptObject_(M,aE){
var ay={id:M.id(),
name:M.name(),
lineOffset:M.lineOffset(),
columnOffset:M.columnOffset(),
lineCount:M.lineCount(),
};
if(!(M.data()===(void 0))){
ay.data=M.data();
}
if(aE){
ay.source=M.source();
}
return ay;
}
function MakeAsyncTaskEvent(u,aF,aG){
return new AsyncTaskEvent(u,aF,aG);
}
function AsyncTaskEvent(u,aF,aG){
this.type_=u;
this.id_=aF;
this.name_=aG;
}
AsyncTaskEvent.prototype.type=function(){
return this.type_;
}
AsyncTaskEvent.prototype.name=function(){
return this.name_;
}
AsyncTaskEvent.prototype.id=function(){
return this.id_;
}
function DebugCommandProcessor(F,aw){
this.exec_state_=F;
this.running_=aw||false;
}
DebugCommandProcessor.prototype.processDebugRequest=function(aH){
return this.processDebugJSONRequest(aH);
};
function ProtocolMessage(aH){
this.seq=v++;
if(aH){
this.type='response';
this.request_seq=aH.seq;
this.command=aH.command;
}else{
this.type='event';
}
this.success=true;
this.running=(void 0);
}
ProtocolMessage.prototype.setOption=function(aG,A){
if(!this.options_){
this.options_={};
}
this.options_[aG]=A;
};
ProtocolMessage.prototype.failed=function(aI,aJ){
this.success=false;
this.message=aI;
if((typeof(aJ)==='object')){
this.error_details=aJ;
}
};
ProtocolMessage.prototype.toJSONProtocol=function(){
var aK={};
aK.seq=this.seq;
if(this.request_seq){
aK.request_seq=this.request_seq;
}
aK.type=this.type;
if(this.event){
aK.event=this.event;
}
if(this.command){
aK.command=this.command;
}
if(this.success){
aK.success=this.success;
}else{
aK.success=false;
}
if(this.body){
var aL;
var aM=k(true,this.options_);
if(this.body instanceof m){
aL=aM.serializeValue(this.body);
}else if(this.body instanceof d){
aL=[];
for(var J=0;J<this.body.length;J++){
if(this.body[J]instanceof m){
aL.push(aM.serializeValue(this.body[J]));
}else{
aL.push(ObjectToProtocolObject_(this.body[J],aM));
}
}
}else{
aL=ObjectToProtocolObject_(this.body,aM);
}
aK.body=aL;
aK.refs=aM.serializeReferencedObjects();
}
if(this.message){
aK.message=this.message;
}
if(this.error_details){
aK.error_details=this.error_details;
}
aK.running=this.running;
return h(aK);
};
DebugCommandProcessor.prototype.createResponse=function(aH){
return new ProtocolMessage(aH);
};
DebugCommandProcessor.prototype.processDebugJSONRequest=function(
json_request){
var aH;
var aN;
try{
try{
aH=g(json_request);
aN=this.createResponse(aH);
if(!aH.type){
throw %make_error(2,'Type not specified');
}
if(aH.type!='request'){
throw %make_error(2,
"Illegal type '"+aH.type+"' in request");
}
if(!aH.command){
throw %make_error(2,'Command not specified');
}
if(aH.arguments){
var aO=aH.arguments;
if(aO.inlineRefs||aO.compactFormat){
aN.setOption('inlineRefs',true);
}
if(!(aO.maxStringLength===(void 0))){
aN.setOption('maxStringLength',aO.maxStringLength);
}
}
var aP=aH.command.toLowerCase();
var aQ=DebugCommandProcessor.prototype.dispatch_[aP];
if((%IsFunction(aQ))){
%_Call(aQ,this,aH,aN);
}else{
throw %make_error(2,
'Unknown command "'+aH.command+'" in request');
}
}catch(e){
if(!aN){
aN=this.createResponse();
}
aN.success=false;
aN.message=(%_ToString(e));
}
try{
if(!(aN.running===(void 0))){
this.running_=aN.running;
}
aN.running=this.running_;
return aN.toJSONProtocol();
}catch(e){
return'{"seq":'+aN.seq+','+
'"request_seq":'+aH.seq+','+
'"type":"response",'+
'"success":false,'+
'"message":"Internal error: '+(%_ToString(e))+'"}';
}
}catch(e){
return'{"seq":0,"type":"response","success":false,"message":"Internal error"}';
}
};
DebugCommandProcessor.prototype.continueRequest_=function(aH,aN){
if(aH.arguments){
var at=s.StepAction.StepIn;
var aR=aH.arguments.stepaction;
if(aR){
if(aR=='in'){
at=s.StepAction.StepIn;
}else if(aR=='next'){
at=s.StepAction.StepNext;
}else if(aR=='out'){
at=s.StepAction.StepOut;
}else{
throw %make_error(2,
'Invalid stepaction argument "'+aR+'".');
}
}
this.exec_state_.prepareStep(at);
}
aN.running=true;
};
DebugCommandProcessor.prototype.breakRequest_=function(aH,aN){
};
DebugCommandProcessor.prototype.setBreakPointRequest_=
function(aH,aN){
if(!aH.arguments){
aN.failed('Missing arguments');
return;
}
var u=aH.arguments.type;
var aS=aH.arguments.target;
var K=aH.arguments.line;
var L=aH.arguments.column;
var aT=(aH.arguments.enabled===(void 0))?
true:aH.arguments.enabled;
var E=aH.arguments.condition;
var aU=aH.arguments.groupId;
if(!u||(aS===(void 0))){
aN.failed('Missing argument "type" or "target"');
return;
}
var ae;
if(u=='function'){
if(!(typeof(aS)==='string')){
aN.failed('Argument "target" is not a string value');
return;
}
var Y;
try{
Y=this.exec_state_.evaluateGlobal(aS).value();
}catch(e){
aN.failed('Error: "'+(%_ToString(e))+
'" evaluating "'+aS+'"');
return;
}
if(!(%IsFunction(Y))){
aN.failed('"'+aS+'" does not evaluate to a function');
return;
}
ae=s.setBreakPoint(Y,K,L,E);
}else if(u=='handle'){
var aV=o(aS,10);
var G=i(aV);
if(!G){
return aN.failed('Object #'+aV+'# not found');
}
if(!G.isFunction()){
return aN.failed('Object #'+aV+'# is not a function');
}
ae=s.setBreakPoint(G.value(),
K,L,E);
}else if(u=='script'){
ae=
s.setScriptBreakPointByName(aS,K,L,E,
aU);
}else if(u=='scriptId'){
ae=
s.setScriptBreakPointById(aS,K,L,E,aU);
}else if(u=='scriptRegExp'){
ae=
s.setScriptBreakPointByRegExp(aS,K,L,E,
aU);
}else{
aN.failed('Illegal type "'+u+'"');
return;
}
var D=s.findBreakPoint(ae);
if(!aT){
s.disableBreakPoint(ae);
}
aN.body={type:u,
breakpoint:ae};
if(D instanceof ScriptBreakPoint){
if(D.type()==s.ScriptBreakPointType.ScriptId){
aN.body.type='scriptId';
aN.body.script_id=D.script_id();
}else if(D.type()==s.ScriptBreakPointType.ScriptName){
aN.body.type='scriptName';
aN.body.script_name=D.script_name();
}else if(D.type()==s.ScriptBreakPointType.ScriptRegExp){
aN.body.type='scriptRegExp';
aN.body.script_regexp=D.script_regexp_object().source;
}else{
throw %make_error(2,
"Unexpected breakpoint type: "+D.type());
}
aN.body.line=D.line();
aN.body.column=D.column();
aN.body.actual_locations=D.actual_locations();
}else{
aN.body.type='function';
aN.body.actual_locations=[D.actual_location];
}
};
DebugCommandProcessor.prototype.changeBreakPointRequest_=function(
aH,aN){
if(!aH.arguments){
aN.failed('Missing arguments');
return;
}
var D=(%_ToNumber(aH.arguments.breakpoint));
var aT=aH.arguments.enabled;
var E=aH.arguments.condition;
if(!D){
aN.failed('Missing argument "breakpoint"');
return;
}
if(!(aT===(void 0))){
if(aT){
s.enableBreakPoint(D);
}else{
s.disableBreakPoint(D);
}
}
if(!(E===(void 0))){
s.changeBreakPointCondition(D,E);
}
};
DebugCommandProcessor.prototype.clearBreakPointGroupRequest_=function(
aH,aN){
if(!aH.arguments){
aN.failed('Missing arguments');
return;
}
var aW=aH.arguments.groupId;
if(!aW){
aN.failed('Missing argument "groupId"');
return;
}
var aX=[];
var aY=[];
for(var J=0;J<y.length;J++){
var aZ=y[J];
if(aZ.groupId()==aW){
aX.push(aZ.number());
aZ.clear();
}else{
aY.push(aZ);
}
}
y=aY;
aN.body={breakpoints:aX};
};
DebugCommandProcessor.prototype.clearBreakPointRequest_=function(
aH,aN){
if(!aH.arguments){
aN.failed('Missing arguments');
return;
}
var D=(%_ToNumber(aH.arguments.breakpoint));
if(!D){
aN.failed('Missing argument "breakpoint"');
return;
}
s.clearBreakPoint(D);
aN.body={breakpoint:D};
};
DebugCommandProcessor.prototype.listBreakpointsRequest_=function(
aH,aN){
var ba=[];
for(var J=0;J<y.length;J++){
var D=y[J];
var bb={
number:D.number(),
line:D.line(),
column:D.column(),
groupId:D.groupId(),
active:D.active(),
condition:D.condition(),
actual_locations:D.actual_locations()
};
if(D.type()==s.ScriptBreakPointType.ScriptId){
bb.type='scriptId';
bb.script_id=D.script_id();
}else if(D.type()==s.ScriptBreakPointType.ScriptName){
bb.type='scriptName';
bb.script_name=D.script_name();
}else if(D.type()==s.ScriptBreakPointType.ScriptRegExp){
bb.type='scriptRegExp';
bb.script_regexp=D.script_regexp_object().source;
}else{
throw %make_error(2,
"Unexpected breakpoint type: "+D.type());
}
ba.push(bb);
}
aN.body={
breakpoints:ba,
breakOnExceptions:s.isBreakOnException(),
breakOnUncaughtExceptions:s.isBreakOnUncaughtException()
};
};
DebugCommandProcessor.prototype.disconnectRequest_=
function(aH,aN){
s.disableAllBreakPoints();
this.continueRequest_(aH,aN);
};
DebugCommandProcessor.prototype.setExceptionBreakRequest_=
function(aH,aN){
if(!aH.arguments){
aN.failed('Missing arguments');
return;
}
var u=aH.arguments.type;
if(!u){
aN.failed('Missing argument "type"');
return;
}
var aT;
if(u=='all'){
aT=!s.isBreakOnException();
}else if(u=='uncaught'){
aT=!s.isBreakOnUncaughtException();
}
if(!(aH.arguments.enabled===(void 0))){
aT=aH.arguments.enabled;
if((aT!=true)&&(aT!=false)){
aN.failed('Illegal value for "enabled":"'+aT+'"');
}
}
if(u=='all'){
%ChangeBreakOnException(s.ExceptionBreak.Caught,aT);
}else if(u=='uncaught'){
%ChangeBreakOnException(s.ExceptionBreak.Uncaught,aT);
}else{
aN.failed('Unknown "type":"'+u+'"');
}
aN.body={'type':u,'enabled':aT};
};
DebugCommandProcessor.prototype.backtraceRequest_=function(
aH,aN){
var bc=this.exec_state_.frameCount();
if(bc==0){
aN.body={
totalFrames:bc
};
return;
}
var bd=0;
var be=r;
if(aH.arguments){
if(aH.arguments.fromFrame){
bd=aH.arguments.fromFrame;
}
if(aH.arguments.toFrame){
be=aH.arguments.toFrame;
}
if(aH.arguments.bottom){
var bf=bc-bd;
bd=bc-be;
be=bf;
}
if(bd<0||be<0){
return aN.failed('Invalid frame number');
}
}
be=l(bc,be);
if(be<=bd){
var bg='Invalid frame range';
return aN.failed(bg);
}
var bh=[];
for(var J=bd;J<be;J++){
bh.push(this.exec_state_.frame(J));
}
aN.body={
fromFrame:bd,
toFrame:be,
totalFrames:bc,
frames:bh
};
};
DebugCommandProcessor.prototype.frameRequest_=function(aH,aN){
if(this.exec_state_.frameCount()==0){
return aN.failed('No frames');
}
if(aH.arguments){
var av=aH.arguments.number;
if(av<0||this.exec_state_.frameCount()<=av){
return aN.failed('Invalid frame number');
}
this.exec_state_.setSelectedFrame(aH.arguments.number);
}
aN.body=this.exec_state_.frame();
};
DebugCommandProcessor.prototype.resolveFrameFromScopeDescription_=
function(bi){
if(bi&&!(bi.frameNumber===(void 0))){
var bj=bi.frameNumber;
if(bj<0||this.exec_state_.frameCount()<=bj){
throw %make_type_error(33);
}
return this.exec_state_.frame(bj);
}else{
return this.exec_state_.frame();
}
};
DebugCommandProcessor.prototype.resolveScopeHolder_=
function(bi){
if(bi&&"functionHandle"in bi){
if(!(typeof(bi.functionHandle)==='number')){
throw %make_error(2,'Function handle must be a number');
}
var bk=i(bi.functionHandle);
if(!bk){
throw %make_error(2,'Failed to find function object by handle');
}
if(!bk.isFunction()){
throw %make_error(2,
'Value of non-function type is found by handle');
}
return bk;
}else{
if(this.exec_state_.frameCount()==0){
throw %make_error(2,'No scopes');
}
var bl=this.resolveFrameFromScopeDescription_(bi);
return bl;
}
}
DebugCommandProcessor.prototype.scopesRequest_=function(aH,aN){
var bm=this.resolveScopeHolder_(aH.arguments);
var bn=bm.scopeCount();
var bo=[];
for(var J=0;J<bn;J++){
bo.push(bm.scope(J));
}
aN.body={
fromScope:0,
toScope:bn,
totalScopes:bn,
scopes:bo
};
};
DebugCommandProcessor.prototype.scopeRequest_=function(aH,aN){
var bm=this.resolveScopeHolder_(aH.arguments);
var bp=0;
if(aH.arguments&&!(aH.arguments.number===(void 0))){
bp=(%_ToNumber(aH.arguments.number));
if(bp<0||bm.scopeCount()<=bp){
return aN.failed('Invalid scope number');
}
}
aN.body=bm.scope(bp);
};
DebugCommandProcessor.resolveValue_=function(bq){
if("handle"in bq){
var br=i(bq.handle);
if(!br){
throw %make_error(2,"Failed to resolve value by handle, ' #"+
bq.handle+"# not found");
}
return br.value();
}else if("stringDescription"in bq){
if(bq.type==n.BOOLEAN_TYPE){
return(!!(bq.stringDescription));
}else if(bq.type==n.NUMBER_TYPE){
return(%_ToNumber(bq.stringDescription));
}if(bq.type==n.STRING_TYPE){
return(%_ToString(bq.stringDescription));
}else{
throw %make_error(2,"Unknown type");
}
}else if("value"in bq){
return bq.value;
}else if(bq.type==n.UNDEFINED_TYPE){
return(void 0);
}else if(bq.type==n.NULL_TYPE){
return null;
}else{
throw %make_error(2,"Failed to parse value description");
}
};
DebugCommandProcessor.prototype.setVariableValueRequest_=
function(aH,aN){
if(!aH.arguments){
aN.failed('Missing arguments');
return;
}
if((aH.arguments.name===(void 0))){
aN.failed('Missing variable name');
}
var bs=aH.arguments.name;
var bi=aH.arguments.scope;
var bm=this.resolveScopeHolder_(bi);
if((bi.number===(void 0))){
aN.failed('Missing scope number');
}
var bp=(%_ToNumber(bi.number));
var bt=bm.scope(bp);
var bu=
DebugCommandProcessor.resolveValue_(aH.arguments.newValue);
bt.setVariableValue(bs,bu);
var bv=j(bu);
aN.body={
newValue:bv
};
};
DebugCommandProcessor.prototype.evaluateRequest_=function(aH,aN){
if(!aH.arguments){
return aN.failed('Missing arguments');
}
var bw=aH.arguments.expression;
var bl=aH.arguments.frame;
var a=aH.arguments.global;
var bx=aH.arguments.disable_break;
var by=aH.arguments.additional_context;
try{
bw=(%_ToString(bw));
}catch(e){
return aN.failed('Failed to convert expression argument to string');
}
if(!(bl===(void 0))&&a){
return aN.failed('Arguments "frame" and "global" are exclusive');
}
var bz;
if(by){
bz={};
for(var J=0;J<by.length;J++){
var bA=by[J];
if(!(typeof(bA.name)==='string')){
return aN.failed("Context element #"+J+
" doesn't contain name:string property");
}
var bB=DebugCommandProcessor.resolveValue_(bA);
bz[bA.name]=bB;
}
}
if(a){
aN.body=this.exec_state_.evaluateGlobal(
bw,(!!(bx)),bz);
return;
}
if((bx===(void 0))){
bx=true;
}
if(this.exec_state_.frameCount()==0){
return aN.failed('No frames');
}
if(!(bl===(void 0))){
var bC=(%_ToNumber(bl));
if(bC<0||bC>=this.exec_state_.frameCount()){
return aN.failed('Invalid frame "'+bl+'"');
}
aN.body=this.exec_state_.frame(bC).evaluate(
bw,(!!(bx)),bz);
return;
}else{
aN.body=this.exec_state_.frame().evaluate(
bw,(!!(bx)),bz);
return;
}
};
DebugCommandProcessor.prototype.lookupRequest_=function(aH,aN){
if(!aH.arguments){
return aN.failed('Missing arguments');
}
var bD=aH.arguments.handles;
if((bD===(void 0))){
return aN.failed('Argument "handles" missing');
}
if(!(aH.arguments.includeSource===(void 0))){
var bE=(!!(aH.arguments.includeSource));
aN.setOption('includeSource',bE);
}
var bF={};
for(var J=0;J<bD.length;J++){
var aV=bD[J];
var G=i(aV);
if(!G){
return aN.failed('Object #'+aV+'# not found');
}
bF[aV]=G;
}
aN.body=bF;
};
DebugCommandProcessor.prototype.referencesRequest_=
function(aH,aN){
if(!aH.arguments){
return aN.failed('Missing arguments');
}
var u=aH.arguments.type;
var aV=aH.arguments.handle;
if((u===(void 0))){
return aN.failed('Argument "type" missing');
}
if((aV===(void 0))){
return aN.failed('Argument "handle" missing');
}
if(u!='referencedBy'&&u!='constructedBy'){
return aN.failed('Invalid type "'+u+'"');
}
var G=i(aV);
if(G){
if(u=='referencedBy'){
aN.body=G.referencedBy();
}else{
aN.body=G.constructedBy();
}
}else{
return aN.failed('Object #'+aV+'# not found');
}
};
DebugCommandProcessor.prototype.sourceRequest_=function(aH,aN){
if(this.exec_state_.frameCount()==0){
return aN.failed('No source');
}
var bG;
var bH;
var bl=this.exec_state_.frame();
if(aH.arguments){
bG=aH.arguments.fromLine;
bH=aH.arguments.toLine;
if(!(aH.arguments.frame===(void 0))){
var bC=(%_ToNumber(aH.arguments.frame));
if(bC<0||bC>=this.exec_state_.frameCount()){
return aN.failed('Invalid frame "'+bl+'"');
}
bl=this.exec_state_.frame(bC);
}
}
var M=bl.func().script();
if(!M){
return aN.failed('No source');
}
var bI=M.value();
var bJ=bI.line_offset;
var bK=%ScriptLineCount(bI);
bG=(bG===(void 0))?0:bG-bJ;
bH=(bH===(void 0))?bK:bH-bJ;
if(bG<0)bG=0;
if(bH>bK)bH=bK;
if(bG>=bK||bH<0||bG>bH){
return aN.failed('Invalid line interval');
}
aN.body={};
aN.body.fromLine=bG+bJ;
aN.body.toLine=bH+bJ;
aN.body.fromPosition=%ScriptLineStartPosition(bI,bG);
aN.body.toPosition=
(bH==0)?0:%ScriptLineEndPosition(bI,bH-1);
aN.body.totalLines=%ScriptLineCount(bI);
aN.body.source=%_SubString(bI.source,
aN.body.fromPosition,
aN.body.toPosition);
};
DebugCommandProcessor.prototype.scriptsRequest_=function(aH,aN){
var bL=ScriptTypeFlag(s.ScriptType.Normal);
var bE=false;
var bM=null;
if(aH.arguments){
if(!(aH.arguments.types===(void 0))){
bL=(%_ToNumber(aH.arguments.types));
if(f(bL)||bL<0){
return aN.failed('Invalid types "'+
aH.arguments.types+'"');
}
}
if(!(aH.arguments.includeSource===(void 0))){
bE=(!!(aH.arguments.includeSource));
aN.setOption('includeSource',bE);
}
if((%_IsArray(aH.arguments.ids))){
bM={};
var bN=aH.arguments.ids;
for(var J=0;J<bN.length;J++){
bM[bN[J]]=true;
}
}
var bO=null;
var bP=null;
if(!(aH.arguments.filter===(void 0))){
var bQ=(%_ToNumber(aH.arguments.filter));
if(!f(bQ)){
bP=bQ;
}
bO=aH.arguments.filter;
}
}
var V=s.scripts();
aN.body=[];
for(var J=0;J<V.length;J++){
if(bM&&!bM[V[J].id]){
continue;
}
if(bO||bP){
var M=V[J];
var bR=false;
if(bP&&!bR){
if(M.id&&M.id===bP){
bR=true;
}
}
if(bO&&!bR){
if(M.name&&M.name.indexOf(bO)>=0){
bR=true;
}
}
if(!bR)continue;
}
if(bL&ScriptTypeFlag(V[J].type)){
aN.body.push(j(V[J]));
}
}
};
DebugCommandProcessor.prototype.suspendRequest_=function(aH,aN){
aN.running=false;
};
DebugCommandProcessor.prototype.versionRequest_=function(aH,aN){
aN.body={
V8Version:%GetV8Version()
};
};
DebugCommandProcessor.prototype.changeLiveRequest_=function(
aH,aN){
if(!aH.arguments){
return aN.failed('Missing arguments');
}
var bS=aH.arguments.script_id;
var bT=!!aH.arguments.preview_only;
var bU=scriptById(bS);
if(!bU){
aN.failed('Script not found');
return;
}
var bV=new d();
if(!(typeof(aH.arguments.new_source)==='string')){
throw"new_source argument expected";
}
var bW=aH.arguments.new_source;
var bX;
try{
bX=s.LiveEdit.SetScriptSource(bU,
bW,bT,bV);
}catch(e){
if(e instanceof s.LiveEdit.Failure&&"details"in e){
aN.failed(e.message,e.details);
return;
}
throw e;
}
aN.body={change_log:bV,result:bX};
if(!bT&&!this.running_&&bX.stack_modified){
aN.body.stepin_recommended=true;
}
};
DebugCommandProcessor.prototype.restartFrameRequest_=function(
aH,aN){
if(!aH.arguments){
return aN.failed('Missing arguments');
}
var bl=aH.arguments.frame;
if(this.exec_state_.frameCount()==0){
return aN.failed('No frames');
}
var bY;
if(!(bl===(void 0))){
var bC=(%_ToNumber(bl));
if(bC<0||bC>=this.exec_state_.frameCount()){
return aN.failed('Invalid frame "'+bl+'"');
}
bY=this.exec_state_.frame(bC);
}else{
bY=this.exec_state_.frame();
}
var bX=bY.restart();
aN.body={result:bX};
};
DebugCommandProcessor.prototype.debuggerFlagsRequest_=function(aH,
aN){
if(!aH.arguments){
aN.failed('Missing arguments');
return;
}
var bZ=aH.arguments.flags;
aN.body={flags:[]};
if(!(bZ===(void 0))){
for(var J=0;J<bZ.length;J++){
var aG=bZ[J].name;
var ca=z[aG];
if(!ca){
continue;
}
if('value'in bZ[J]){
ca.setValue(bZ[J].value);
}
aN.body.flags.push({name:aG,value:ca.getValue()});
}
}else{
for(var aG in z){
var A=z[aG].getValue();
aN.body.flags.push({name:aG,value:A});
}
}
};
DebugCommandProcessor.prototype.v8FlagsRequest_=function(aH,aN){
var bZ=aH.arguments.flags;
if(!bZ)bZ='';
%SetFlags(bZ);
};
DebugCommandProcessor.prototype.gcRequest_=function(aH,aN){
var u=aH.arguments.type;
if(!u)u='all';
var cb=%GetHeapUsage();
%CollectGarbage(u);
var cc=%GetHeapUsage();
aN.body={"before":cb,"after":cc};
};
DebugCommandProcessor.prototype.dispatch_=(function(){
var cd=DebugCommandProcessor.prototype;
return{
"continue":cd.continueRequest_,
"break":cd.breakRequest_,
"setbreakpoint":cd.setBreakPointRequest_,
"changebreakpoint":cd.changeBreakPointRequest_,
"clearbreakpoint":cd.clearBreakPointRequest_,
"clearbreakpointgroup":cd.clearBreakPointGroupRequest_,
"disconnect":cd.disconnectRequest_,
"setexceptionbreak":cd.setExceptionBreakRequest_,
"listbreakpoints":cd.listBreakpointsRequest_,
"backtrace":cd.backtraceRequest_,
"frame":cd.frameRequest_,
"scopes":cd.scopesRequest_,
"scope":cd.scopeRequest_,
"setvariablevalue":cd.setVariableValueRequest_,
"evaluate":cd.evaluateRequest_,
"lookup":cd.lookupRequest_,
"references":cd.referencesRequest_,
"source":cd.sourceRequest_,
"scripts":cd.scriptsRequest_,
"suspend":cd.suspendRequest_,
"version":cd.versionRequest_,
"changelive":cd.changeLiveRequest_,
"restartframe":cd.restartFrameRequest_,
"flags":cd.debuggerFlagsRequest_,
"v8flag":cd.v8FlagsRequest_,
"gc":cd.gcRequest_,
};
})();
DebugCommandProcessor.prototype.isRunning=function(){
return this.running_;
};
DebugCommandProcessor.prototype.systemBreak=function(ce,aO){
return %SystemBreak();
};
function ObjectToProtocolObject_(cf,cg){
var ch={};
for(var aP in cf){
if(typeof aP=='string'){
var ci=ValueToProtocolValue_(cf[aP],
cg);
if(!(ci===(void 0))){
ch[aP]=ci;
}
}
}
return ch;
}
function ArrayToProtocolArray_(ba,cg){
var aK=[];
for(var J=0;J<ba.length;J++){
aK.push(ValueToProtocolValue_(ba[J],cg));
}
return aK;
}
function ValueToProtocolValue_(A,cg){
var aK;
switch(typeof A){
case'object':
if(A instanceof m){
aK=cg.serializeValue(A);
}else if((%_IsArray(A))){
aK=ArrayToProtocolArray_(A,cg);
}else{
aK=ObjectToProtocolObject_(A,cg);
}
break;
case'boolean':
case'string':
case'number':
aK=A;
break;
default:
aK=null;
}
return aK;
}
b.InstallConstants(a,[
"Debug",s,
"DebugCommandProcessor",DebugCommandProcessor,
"BreakEvent",BreakEvent,
"CompileEvent",CompileEvent,
"BreakPoint",BreakPoint,
]);
b.InstallFunctions(b,2,[
"MakeExecutionState",MakeExecutionState,
"MakeExceptionEvent",MakeExceptionEvent,
"MakeBreakEvent",MakeBreakEvent,
"MakeCompileEvent",MakeCompileEvent,
"MakeAsyncTaskEvent",MakeAsyncTaskEvent,
"IsBreakPointTriggered",IsBreakPointTriggered,
]);
})

 liveeditÖË
(function(a,b){
"use strict";
var c=a.Debug.findScriptSourcePosition;
var d=a.Array;
var e=a.Math.floor;
var f=a.SyntaxError;
var g;
function ApplyPatchMultiChunk(script,diff_array,new_source,preview_only,
change_log){
var h=script.source;
var i=GatherCompileInfo(h,script);
var j=BuildCodeInfoTree(i);
var k=new PosTranslator(diff_array);
MarkChangedFunctions(j,k.GetChunks());
FindLiveSharedInfos(j,script);
var l;
try{
l=GatherCompileInfo(new_source,script);
}catch(e){
var m=
new Failure("Failed to compile new version of script: "+e);
if(e instanceof f){
var n={
type:"liveedit_compile_error",
syntaxErrorMessage:e.message
};
CopyErrorPositionToDetails(e,n);
m.details=n;
}
throw m;
}
var o=BuildCodeInfoTree(l);
FindCorrespondingFunctions(j,o);
var p=new d();
var q=new d();
var r=new d();
var s=new d();
function HarvestTodo(t){
function CollectDamaged(u){
q.push(u);
for(var v=0;v<u.children.length;v++){
CollectDamaged(u.children[v]);
}
}
function CollectNew(w){
for(var v=0;v<w.length;v++){
r.push(w[v]);
CollectNew(w[v].children);
}
}
if(t.status==g.DAMAGED){
CollectDamaged(t);
return;
}
if(t.status==g.UNCHANGED){
s.push(t);
}else if(t.status==g.SOURCE_CHANGED){
s.push(t);
}else if(t.status==g.CHANGED){
p.push(t);
CollectNew(t.unmatched_new_nodes);
}
for(var v=0;v<t.children.length;v++){
HarvestTodo(t.children[v]);
}
}
var x={
change_tree:DescribeChangeTree(j),
textual_diff:{
old_len:h.length,
new_len:new_source.length,
chunks:diff_array
},
updated:false
};
if(preview_only){
return x;
}
HarvestTodo(j);
var y=new d();
var z=new d();
for(var v=0;v<p.length;v++){
var A=p[v].live_shared_function_infos;
var B=
p[v].corresponding_node.info.shared_function_info;
if(A){
for(var C=0;C<A.length;C++){
y.push(A[C]);
z.push(B);
}
}
}
var D=
CheckStackActivations(y,
z,
change_log);
x.stack_modified=D!=0;
var E;
if(q.length==0){
%LiveEditReplaceScript(script,new_source,null);
E=(void 0);
}else{
var F=CreateNameForOldScript(script);
E=%LiveEditReplaceScript(script,new_source,
F);
var G=new d();
change_log.push({linked_to_old_script:G});
for(var v=0;v<q.length;v++){
LinkToOldScript(q[v],E,
G);
}
x.created_script_name=F;
}
for(var v=0;v<r.length;v++){
%LiveEditFunctionSetScript(
r[v].info.shared_function_info,script);
}
for(var v=0;v<p.length;v++){
PatchFunctionCode(p[v],change_log);
}
var H=new d();
change_log.push({position_patched:H});
for(var v=0;v<s.length;v++){
PatchPositions(s[v],diff_array,
H);
if(s[v].live_shared_function_infos){
s[v].live_shared_function_infos.
forEach(function(I){
%LiveEditFunctionSourceUpdated(I.raw_array);
});
}
}
x.updated=true;
return x;
}
function GatherCompileInfo(J,K){
var L=%LiveEditGatherCompileInfo(K,J);
var M=new d();
var N=new d();
for(var v=0;v<L.length;v++){
var I=new FunctionCompileInfo(L[v]);
%LiveEditFunctionSetScript(I.shared_function_info,(void 0));
M.push(I);
N.push(v);
}
for(var v=0;v<M.length;v++){
var O=v;
for(var C=v+1;C<M.length;C++){
if(M[O].start_position>M[C].start_position){
O=C;
}
}
if(O!=v){
var P=M[O];
var Q=N[O];
M[O]=M[v];
N[O]=N[v];
M[v]=P;
N[v]=Q;
}
}
var R=0;
function ResetIndexes(S,T){
var U=-1;
while(R<M.length&&
M[R].outer_index==T){
var V=R;
M[V].outer_index=S;
if(U!=-1){
M[U].next_sibling_index=V;
}
U=V;
R++;
ResetIndexes(V,N[V]);
}
if(U!=-1){
M[U].next_sibling_index=-1;
}
}
ResetIndexes(-1,-1);
Assert(R==M.length);
return M;
}
function PatchFunctionCode(t,W){
var B=t.corresponding_node.info;
if(t.live_shared_function_infos){
t.live_shared_function_infos.forEach(function(X){
%LiveEditReplaceFunctionCode(B.raw_array,
X.raw_array);
for(var v=0;v<t.children.length;v++){
if(t.children[v].corresponding_node){
var Y=
t.children[v].corresponding_node.info.
shared_function_info;
if(t.children[v].live_shared_function_infos){
t.children[v].live_shared_function_infos.
forEach(function(Z){
%LiveEditReplaceRefToNestedFunction(
X.info,
Y,
Z.info);
});
}
}
}
});
W.push({function_patched:B.function_name});
}else{
W.push({function_patched:B.function_name,
function_info_not_found:true});
}
}
function LinkToOldScript(aa,E,ab){
if(aa.live_shared_function_infos){
aa.live_shared_function_infos.
forEach(function(I){
%LiveEditFunctionSetScript(I.info,E);
});
ab.push({name:aa.info.function_name});
}else{
ab.push(
{name:aa.info.function_name,not_found:true});
}
}
function Assert(ac,ad){
if(!ac){
if(ad){
throw"Assert "+ad;
}else{
throw"Assert";
}
}
}
function DiffChunk(ae,af,ag,ah){
this.pos1=ae;
this.pos2=af;
this.len1=ag;
this.len2=ah;
}
function PosTranslator(ai){
var aj=new d();
var ak=0;
for(var v=0;v<ai.length;v+=3){
var al=ai[v];
var am=al+ak;
var an=ai[v+1];
var ao=ai[v+2];
aj.push(new DiffChunk(al,am,an-al,
ao-am));
ak=ao-an;
}
this.chunks=aj;
}
PosTranslator.prototype.GetChunks=function(){
return this.chunks;
};
PosTranslator.prototype.Translate=function(ap,aq){
var ar=this.chunks;
if(ar.length==0||ap<ar[0].pos1){
return ap;
}
var as=0;
var at=ar.length-1;
while(as<at){
var au=e((as+at)/2);
if(ap<ar[au+1].pos1){
at=au;
}else{
as=au+1;
}
}
var av=ar[as];
if(ap>=av.pos1+av.len1){
return ap+av.pos2+av.len2-av.pos1-av.len1;
}
if(!aq){
aq=PosTranslator.DefaultInsideChunkHandler;
}
return aq(ap,av);
};
PosTranslator.DefaultInsideChunkHandler=function(ap,aw){
Assert(false,"Cannot translate position in changed area");
};
PosTranslator.ShiftWithTopInsideChunkHandler=
function(ap,aw){
return ap-aw.pos1+aw.pos2;
};
var g={
UNCHANGED:"unchanged",
SOURCE_CHANGED:"source changed",
CHANGED:"changed",
DAMAGED:"damaged"
};
function CodeInfoTreeNode(ax,ay,az){
this.info=ax;
this.children=ay;
this.array_index=az;
this.parent=(void 0);
this.status=g.UNCHANGED;
this.status_explanation=(void 0);
this.new_start_pos=(void 0);
this.new_end_pos=(void 0);
this.corresponding_node=(void 0);
this.unmatched_new_nodes=(void 0);
this.textual_corresponding_node=(void 0);
this.textually_unmatched_new_nodes=(void 0);
this.live_shared_function_infos=(void 0);
}
function BuildCodeInfoTree(aA){
var aB=0;
function BuildNode(){
var aC=aB;
aB++;
var aD=new d();
while(aB<aA.length&&
aA[aB].outer_index==aC){
aD.push(BuildNode());
}
var u=new CodeInfoTreeNode(aA[aC],aD,
aC);
for(var v=0;v<aD.length;v++){
aD[v].parent=u;
}
return u;
}
var aE=BuildNode();
Assert(aB==aA.length);
return aE;
}
function MarkChangedFunctions(aF,aj){
var aG=new function(){
var aH=0;
var aI=0;
this.current=function(){return aj[aH];};
this.next=function(){
var av=aj[aH];
aI=av.pos2+av.len2-(av.pos1+av.len1);
aH++;
};
this.done=function(){return aH>=aj.length;};
this.TranslatePos=function(ap){return ap+aI;};
};
function ProcessInternals(aJ){
aJ.new_start_pos=aG.TranslatePos(
aJ.info.start_position);
var aK=0;
var aL=false;
var aM=false;
while(!aG.done()&&
aG.current().pos1<aJ.info.end_position){
if(aK<aJ.children.length){
var aN=aJ.children[aK];
if(aN.info.end_position<=aG.current().pos1){
ProcessUnchangedChild(aN);
aK++;
continue;
}else if(aN.info.start_position>=
aG.current().pos1+aG.current().len1){
aL=true;
aG.next();
continue;
}else if(aN.info.start_position<=aG.current().pos1&&
aN.info.end_position>=aG.current().pos1+
aG.current().len1){
ProcessInternals(aN);
aM=aM||
(aN.status!=g.UNCHANGED);
aL=aL||
(aN.status==g.DAMAGED);
aK++;
continue;
}else{
aL=true;
aN.status=g.DAMAGED;
aN.status_explanation=
"Text diff overlaps with function boundary";
aK++;
continue;
}
}else{
if(aG.current().pos1+aG.current().len1<=
aJ.info.end_position){
aJ.status=g.CHANGED;
aG.next();
continue;
}else{
aJ.status=g.DAMAGED;
aJ.status_explanation=
"Text diff overlaps with function boundary";
return;
}
}
Assert("Unreachable",false);
}
while(aK<aJ.children.length){
var aN=aJ.children[aK];
ProcessUnchangedChild(aN);
aK++;
}
if(aL){
aJ.status=g.CHANGED;
}else if(aM){
aJ.status=g.SOURCE_CHANGED;
}
aJ.new_end_pos=
aG.TranslatePos(aJ.info.end_position);
}
function ProcessUnchangedChild(u){
u.new_start_pos=aG.TranslatePos(u.info.start_position);
u.new_end_pos=aG.TranslatePos(u.info.end_position);
}
ProcessInternals(aF);
}
function FindCorrespondingFunctions(aO,aP){
function ProcessNode(t,aQ){
var aR=
IsFunctionContextLocalsChanged(t.info,aQ.info);
if(aR){
t.status=g.CHANGED;
}
var aS=t.children;
var aT=aQ.children;
var aU=[];
var aV=[];
var aW=0;
var aX=0;
while(aW<aS.length){
if(aS[aW].status==g.DAMAGED){
aW++;
}else if(aX<aT.length){
if(aT[aX].info.start_position<
aS[aW].new_start_pos){
aU.push(aT[aX]);
aV.push(aT[aX]);
aX++;
}else if(aT[aX].info.start_position==
aS[aW].new_start_pos){
if(aT[aX].info.end_position==
aS[aW].new_end_pos){
aS[aW].corresponding_node=
aT[aX];
aS[aW].textual_corresponding_node=
aT[aX];
if(aR){
aS[aW].status=g.DAMAGED;
aS[aW].status_explanation=
"Enclosing function is now incompatible. "+
aR;
aS[aW].corresponding_node=(void 0);
}else if(aS[aW].status!=
g.UNCHANGED){
ProcessNode(aS[aW],
aT[aX]);
if(aS[aW].status==g.DAMAGED){
aU.push(
aS[aW].corresponding_node);
aS[aW].corresponding_node=(void 0);
t.status=g.CHANGED;
}
}
}else{
aS[aW].status=g.DAMAGED;
aS[aW].status_explanation=
"No corresponding function in new script found";
t.status=g.CHANGED;
aU.push(aT[aX]);
aV.push(aT[aX]);
}
aX++;
aW++;
}else{
aS[aW].status=g.DAMAGED;
aS[aW].status_explanation=
"No corresponding function in new script found";
t.status=g.CHANGED;
aW++;
}
}else{
aS[aW].status=g.DAMAGED;
aS[aW].status_explanation=
"No corresponding function in new script found";
t.status=g.CHANGED;
aW++;
}
}
while(aX<aT.length){
aU.push(aT[aX]);
aV.push(aT[aX]);
aX++;
}
if(t.status==g.CHANGED){
if(t.info.param_num!=aQ.info.param_num){
t.status=g.DAMAGED;
t.status_explanation="Changed parameter number: "+
t.info.param_num+" and "+aQ.info.param_num;
}
}
t.unmatched_new_nodes=aU;
t.textually_unmatched_new_nodes=
aV;
}
ProcessNode(aO,aP);
aO.corresponding_node=aP;
aO.textual_corresponding_node=aP;
Assert(aO.status!=g.DAMAGED,
"Script became damaged");
}
function FindLiveSharedInfos(aO,K){
var aY=%LiveEditFindSharedFunctionInfosForScript(K);
var aZ=new d();
for(var v=0;v<aY.length;v++){
aZ.push(new SharedInfoWrapper(aY[v]));
}
function FindFunctionInfos(M){
var ba=[];
for(var v=0;v<aZ.length;v++){
var bb=aZ[v];
if(bb.start_position==M.start_position&&
bb.end_position==M.end_position){
ba.push(bb);
}
}
if(ba.length>0){
return ba;
}
}
function TraverseTree(u){
u.live_shared_function_infos=FindFunctionInfos(u.info);
for(var v=0;v<u.children.length;v++){
TraverseTree(u.children[v]);
}
}
TraverseTree(aO);
}
function FunctionCompileInfo(bc){
this.function_name=bc[0];
this.start_position=bc[1];
this.end_position=bc[2];
this.param_num=bc[3];
this.scope_info=bc[4];
this.outer_index=bc[5];
this.shared_function_info=bc[6];
this.next_sibling_index=null;
this.raw_array=bc;
}
function SharedInfoWrapper(bc){
this.function_name=bc[0];
this.start_position=bc[1];
this.end_position=bc[2];
this.info=bc[3];
this.raw_array=bc;
}
function PatchPositions(aa,ai,ab){
if(aa.live_shared_function_infos){
aa.live_shared_function_infos.forEach(function(I){
%LiveEditPatchFunctionPositions(I.raw_array,
ai);
});
ab.push({name:aa.info.function_name});
}else{
ab.push(
{name:aa.info.function_name,info_not_found:true});
}
}
function CreateNameForOldScript(K){
return K.name+" (old)";
}
function IsFunctionContextLocalsChanged(bd,be){
var bf=bd.scope_info;
var bg=be.scope_info;
var bh;
var bi;
if(bf){
bh=bf.toString();
}else{
bh="";
}
if(bg){
bi=bg.toString();
}else{
bi="";
}
if(bh!=bi){
return"Variable map changed: ["+bh+
"] => ["+bi+"]";
}
return;
}
var bj;
function CheckStackActivations(old_shared_wrapper_list,
new_shared_list,
W){
var bk=new d();
for(var v=0;v<old_shared_wrapper_list.length;v++){
bk[v]=old_shared_wrapper_list[v].info;
}
var bl=%LiveEditCheckAndDropActivations(
bk,new_shared_list,true);
if(bl[old_shared_wrapper_list.length]){
throw new Failure(bl[old_shared_wrapper_list.length]);
}
var bm=new d();
var bn=new d();
for(var v=0;v<bk.length;v++){
var bo=old_shared_wrapper_list[v];
if(bl[v]==bj.REPLACED_ON_ACTIVE_STACK){
bn.push({name:bo.function_name});
}else if(bl[v]!=bj.AVAILABLE_FOR_PATCH){
var bp={
name:bo.function_name,
start_pos:bo.start_position,
end_pos:bo.end_position,
replace_problem:
bj.SymbolName(bl[v])
};
bm.push(bp);
}
}
if(bn.length>0){
W.push({dropped_from_stack:bn});
}
if(bm.length>0){
W.push({functions_on_stack:bm});
throw new Failure("Blocked by functions on stack");
}
return bn.length;
}
var bj={
AVAILABLE_FOR_PATCH:1,
BLOCKED_ON_ACTIVE_STACK:2,
BLOCKED_ON_OTHER_STACK:3,
BLOCKED_UNDER_NATIVE_CODE:4,
REPLACED_ON_ACTIVE_STACK:5,
BLOCKED_UNDER_GENERATOR:6,
BLOCKED_ACTIVE_GENERATOR:7,
BLOCKED_NO_NEW_TARGET_ON_RESTART:8
};
bj.SymbolName=function(bq){
var br=bj;
for(var bs in br){
if(br[bs]==bq){
return bs;
}
}
};
function Failure(ad){
this.message=ad;
}
Failure.prototype.toString=function(){
return"LiveEdit Failure: "+this.message;
};
function CopyErrorPositionToDetails(bt,n){
function createPositionStruct(K,bu){
if(bu==-1)return;
var bv=K.locationFromPosition(bu,true);
if(bv==null)return;
return{
line:bv.line+1,
column:bv.column+1,
position:bu
};
}
if(!("scriptObject"in bt)||!("startPosition"in bt)){
return;
}
var K=bt.scriptObject;
var bw={
start:createPositionStruct(K,bt.startPosition),
end:createPositionStruct(K,bt.endPosition)
};
n.position=bw;
}
function SetScriptSource(K,bx,by,W){
var h=K.source;
var bz=CompareStrings(h,bx);
return ApplyPatchMultiChunk(K,bz,bx,by,
W);
}
function CompareStrings(bA,bB){
return %LiveEditCompareStrings(bA,bB);
}
function ApplySingleChunkPatch(K,change_pos,change_len,new_str,
W){
var h=K.source;
var bx=h.substring(0,change_pos)+
new_str+h.substring(change_pos+change_len);
return ApplyPatchMultiChunk(K,
[change_pos,change_pos+change_len,change_pos+new_str.length],
bx,false,W);
}
function DescribeChangeTree(aO){
function ProcessOldNode(u){
var bC=[];
for(var v=0;v<u.children.length;v++){
var aN=u.children[v];
if(aN.status!=g.UNCHANGED){
bC.push(ProcessOldNode(aN));
}
}
var bD=[];
if(u.textually_unmatched_new_nodes){
for(var v=0;v<u.textually_unmatched_new_nodes.length;v++){
var aN=u.textually_unmatched_new_nodes[v];
bD.push(ProcessNewNode(aN));
}
}
var bE={
name:u.info.function_name,
positions:DescribePositions(u),
status:u.status,
children:bC,
new_children:bD
};
if(u.status_explanation){
bE.status_explanation=u.status_explanation;
}
if(u.textual_corresponding_node){
bE.new_positions=DescribePositions(u.textual_corresponding_node);
}
return bE;
}
function ProcessNewNode(u){
var bC=[];
if(false){
for(var v=0;v<u.children.length;v++){
bC.push(ProcessNewNode(u.children[v]));
}
}
var bE={
name:u.info.function_name,
positions:DescribePositions(u),
children:bC,
};
return bE;
}
function DescribePositions(u){
return{
start_position:u.info.start_position,
end_position:u.info.end_position
};
}
return ProcessOldNode(aO);
}
var bF={};
bF.SetScriptSource=SetScriptSource;
bF.ApplyPatchMultiChunk=ApplyPatchMultiChunk;
bF.Failure=Failure;
bF.TestApi={
PosTranslator:PosTranslator,
CompareStrings:CompareStrings,
ApplySingleChunkPatch:ApplySingleChunkPatch
};
a.Debug.LiveEdit=bF;
})

D prologueÂF
(function(a,b,c){
"use strict";
%CheckIsBootstrapping();
var d=(void 0);
var e=(void 0);
var f=%ExportFromRuntime({});
var g=(void 0);
function SetupTypedArray(h){
h.next=g;
g=h;
}
function Export(h){
h(f);
}
function Import(h){
h.next=d;
d=h;
}
function ImportNow(i){
return f[i];
}
function ImportFromExperimental(h){
h.next=e;
e=h;
}
function SetFunctionName(h,i,j){
if((typeof(i)==='symbol')){
i="["+%SymbolDescription(i)+"]";
}
if((j===(void 0))){
%FunctionSetName(h,i);
}else{
%FunctionSetName(h,j+" "+i);
}
}
function InstallConstants(k,l){
%CheckIsBootstrapping();
%OptimizeObjectForAddingMultipleProperties(k,l.length>>1);
var m=2|4|1;
for(var n=0;n<l.length;n+=2){
var i=l[n];
var o=l[n+1];
%AddNamedProperty(k,i,o,m);
}
%ToFastProperties(k);
}
function InstallFunctions(k,m,p){
%CheckIsBootstrapping();
%OptimizeObjectForAddingMultipleProperties(k,p.length>>1);
for(var n=0;n<p.length;n+=2){
var q=p[n];
var h=p[n+1];
SetFunctionName(h,q);
%FunctionRemovePrototype(h);
%AddNamedProperty(k,q,h,m);
%SetNativeFlag(h);
}
%ToFastProperties(k);
}
function InstallGetter(k,i,r,m,j){
%CheckIsBootstrapping();
if((m===(void 0)))m=2;
SetFunctionName(r,i,(j===(void 0))?"get":j);
%FunctionRemovePrototype(r);
%DefineGetterPropertyUnchecked(k,i,r,m);
%SetNativeFlag(r);
}
function InstallGetterSetter(k,i,r,s,m){
%CheckIsBootstrapping();
if((m===(void 0)))m=2;
SetFunctionName(r,i,"get");
SetFunctionName(s,i,"set");
%FunctionRemovePrototype(r);
%FunctionRemovePrototype(s);
%DefineAccessorPropertyUnchecked(k,i,r,s,m);
%SetNativeFlag(r);
%SetNativeFlag(s);
}
function OverrideFunction(k,i,h,t){
%CheckIsBootstrapping();
%object_define_property(k,i,{value:h,
writeable:true,
configurable:true,
enumerable:false});
SetFunctionName(h,i);
if(!t)%FunctionRemovePrototype(h);
%SetNativeFlag(h);
}
function SetUpLockedPrototype(
constructor,fields,methods){
%CheckIsBootstrapping();
var u=constructor.prototype;
var v=(methods.length>>1)+(fields?fields.length:0);
if(v>=4){
%OptimizeObjectForAddingMultipleProperties(u,v);
}
if(fields){
for(var n=0;n<fields.length;n++){
%AddNamedProperty(u,fields[n],
(void 0),2|4);
}
}
for(var n=0;n<methods.length;n+=2){
var q=methods[n];
var h=methods[n+1];
%AddNamedProperty(u,q,h,2|4|1);
%SetNativeFlag(h);
}
%InternalSetPrototype(u,null);
%ToFastProperties(u);
}
function PostNatives(b){
%CheckIsBootstrapping();
for(;!(d===(void 0));d=d.next){
d(f);
}
var w=[
"FormatDateToParts",
"MapEntries",
"MapIterator",
"MapIteratorNext",
"MaxSimple",
"MinSimple",
"SetIterator",
"SetIteratorNext",
"SetValues",
"ToLocaleLowerCaseI18N",
"ToLocaleUpperCaseI18N",
"ToLowerCaseI18N",
"ToUpperCaseI18N",
"promise_result_symbol",
"promise_state_symbol",
"reflect_apply",
"to_string_tag_symbol",
];
var x={};
%OptimizeObjectForAddingMultipleProperties(
x,w.length);
for(var q of w){
x[q]=f[q];
}
%ToFastProperties(x);
f=x;
b.PostNatives=(void 0);
b.ImportFromExperimental=(void 0);
}
function PostExperimentals(b){
%CheckIsBootstrapping();
%ExportExperimentalFromRuntime(f);
for(;!(d===(void 0));d=d.next){
d(f);
}
for(;!(e===(void 0));
e=e.next){
e(f);
}
b.Export=(void 0);
b.PostDebug=(void 0);
b.PostExperimentals=(void 0);
g=(void 0);
}
function PostDebug(b){
for(;!(d===(void 0));d=d.next){
d(f);
}
f=(void 0);
b.Export=(void 0);
b.Import=(void 0);
b.ImportNow=(void 0);
b.PostDebug=(void 0);
b.PostExperimentals=(void 0);
g=(void 0);
}
function InitializeBuiltinTypedArrays(b,y,z){
var A=g;
for(;!(A===(void 0));A=A.next){
A(y,z);
}
}
%OptimizeObjectForAddingMultipleProperties(b,14);
b.Import=Import;
b.ImportNow=ImportNow;
b.Export=Export;
b.ImportFromExperimental=ImportFromExperimental;
b.SetFunctionName=SetFunctionName;
b.InstallConstants=InstallConstants;
b.InstallFunctions=InstallFunctions;
b.InstallGetter=InstallGetter;
b.InstallGetterSetter=InstallGetterSetter;
b.OverrideFunction=OverrideFunction;
b.SetUpLockedPrototype=SetUpLockedPrototype;
b.PostNatives=PostNatives;
b.PostExperimentals=PostExperimentals;
b.PostDebug=PostDebug;
%ToFastProperties(b);
%OptimizeObjectForAddingMultipleProperties(c,5);
c.logStackTrace=function logStackTrace(){
%DebugTrace();
};
c.log=function log(){
let message='';
for(const arg of arguments){
message+=arg;
}
%GlobalPrint(message);
};
c.createPrivateSymbol=function createPrivateSymbol(i){
return %CreatePrivateSymbol(i);
};
c.simpleBind=function simpleBind(B,C){
return function(...args){
return %reflect_apply(B,C,args);
};
};
c.uncurryThis=function uncurryThis(B){
return function(C,...args){
return %reflect_apply(B,C,args);
};
};
%ToFastProperties(c);
})

runtime5
(function(a,b){
%CheckIsBootstrapping();
var c=a.Array;
var d=a.Boolean;
var e=a.String;
var f;
b.Import(function(g){
f=g.species_symbol;
});
function ToPositiveInteger(h,i){
var j=(%_ToInteger(h))+0;
if(j<0)throw %make_range_error(i);
return j;
}
function ToIndex(h,i){
var j=(%_ToInteger(h))+0;
if(j<0||j>9007199254740991)throw %make_range_error(i);
return j;
}
function MaxSimple(k,l){
return k>l?k:l;
}
function MinSimple(k,l){
return k>l?l:k;
}
%SetForceInlineFlag(MaxSimple);
%SetForceInlineFlag(MinSimple);
function SpeciesConstructor(m,n){
var o=m.constructor;
if((o===(void 0))){
return n;
}
if(!(%_IsJSReceiver(o))){
throw %make_type_error(28);
}
var p=o[f];
if((p==null)){
return n;
}
if(%IsConstructor(p)){
return p;
}
throw %make_type_error(236);
}
%FunctionSetPrototype(c,new c(0));
b.Export(function(q){
q.MaxSimple=MaxSimple;
q.MinSimple=MinSimple;
q.ToPositiveInteger=ToPositiveInteger;
q.ToIndex=ToIndex;
q.SpeciesConstructor=SpeciesConstructor;
});
})

$v8nativesu
(function(a,b){
%CheckIsBootstrapping();
var c=a.Number;
var d=a.Object;
var e=b.ImportNow("iterator_symbol");
var f=%GetRootNaN();
var g=b.ImportNow("object_to_string");
var h=2|4|1;
b.InstallConstants(a,[
"Infinity",(1/0),
"NaN",f,
"undefined",(void 0),
]);
function ObjectToLocaleString(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Object.prototype.toLocaleString");
return this.toString();
}
function ObjectValueOf(){
return(%_ToObject(this));
}
function ObjectIsPrototypeOf(i){
if(!(%_IsJSReceiver(i)))return false;
var j=(%_ToObject(this));
return %HasInPrototypeChain(i,j);
}
function GetMethod(k,l){
var m=k[l];
if((m==null))return(void 0);
if((typeof(m)==='function'))return m;
throw %make_type_error(15,typeof m);
}
function ObjectConstructor(n){
if(d!=new.target&&!(new.target===(void 0))){
return this;
}
if((n===null)||(n===(void 0)))return{};
return(%_ToObject(n));
}
%SetNativeFlag(d);
%SetCode(d,ObjectConstructor);
%AddNamedProperty(d.prototype,"constructor",d,
2);
b.InstallFunctions(d.prototype,2,[
"toString",g,
"toLocaleString",ObjectToLocaleString,
"valueOf",ObjectValueOf,
"isPrototypeOf",ObjectIsPrototypeOf,
]);
b.InstallConstants(c,[
"MAX_VALUE",1.7976931348623157e+308,
"MIN_VALUE",5e-324,
"NaN",f,
"NEGATIVE_INFINITY",-(1/0),
"POSITIVE_INFINITY",(1/0),
"MAX_SAFE_INTEGER",9007199254740991,
"MIN_SAFE_INTEGER",-9007199254740991,
"EPSILON",2.220446049250313e-16,
]);
function GetIterator(k,o){
if((o===(void 0))){
o=k[e];
}
if(!(typeof(o)==='function')){
throw %make_type_error(71,k);
}
var p=%_Call(o,k);
if(!(%_IsJSReceiver(p))){
throw %make_type_error(65,p);
}
return p;
}
b.Export(function(q){
q.GetIterator=GetIterator;
q.GetMethod=GetMethod;
q.ObjectHasOwnProperty=d.prototype.hasOwnProperty;
});
%InstallToContext([
"object_value_of",ObjectValueOf,
]);
})

arrayBk
(function(a,b,c){
"use strict";
%CheckIsBootstrapping();
var d;
var e;
var f=a.Array;
var g=b.InternalArray;
var h=b.InternalPackedArray;
var i;
var j;
var k;
var l=b.ImportNow("object_to_string");
var m=b.ImportNow("iterator_symbol");
var n=b.ImportNow("species_symbol");
var o=b.ImportNow("unscopables_symbol");
b.Import(function(p){
d=p.GetIterator;
e=p.GetMethod;
i=p.MaxSimple;
j=p.MinSimple;
k=p.ObjectHasOwnProperty;
});
function ArraySpeciesCreate(q,r){
r=((r)+0);
var s=%ArraySpeciesConstructor(q);
return new s(r);
}
function KeySortCompare(t,u){
return t-u;
}
function GetSortedArrayKeys(q,v){
if((typeof(v)==='number')){
var w=v;
var x=new g();
for(var y=0;y<w;++y){
var z=q[y];
if(!(z===(void 0))||y in q){
x.push(y);
}
}
return x;
}
return InnerArraySort(v,v.length,KeySortCompare);
}
function SparseJoinWithSeparatorJS(q,x,r,A,B){
var C=x.length;
var D=new g(C*2);
for(var y=0;y<C;y++){
var E=x[y];
D[y*2]=E;
D[y*2+1]=ConvertToString(A,q[E]);
}
return %SparseJoinWithSeparator(D,r,B);
}
function SparseJoin(q,x,A){
var C=x.length;
var D=new g(C);
for(var y=0;y<C;y++){
D[y]=ConvertToString(A,q[x[y]]);
}
return %StringBuilderConcat(D,C,'');
}
function UseSparseVariant(q,r,F,G){
if(!F||r<1000||%HasComplexElements(q)){
return false;
}
if(!%_IsSmi(r)){
return true;
}
var H=r>>2;
var I=%EstimateNumberOfElements(q);
return(I<H)&&
(G>I*4);
}
function Stack(){
this.length=0;
this.values=new g();
}
Stack.prototype.length=null;
Stack.prototype.values=null;
function StackPush(J,K){
J.values[J.length++]=K;
}
function StackPop(J){
J.values[--J.length]=null
}
function StackHas(J,L){
var r=J.length;
var M=J.values;
for(var y=0;y<r;y++){
if(M[y]===L)return true;
}
return false;
}
var N=new Stack();
function DoJoin(q,r,F,B,A){
if(UseSparseVariant(q,r,F,r)){
%NormalizeElements(q);
var x=GetSortedArrayKeys(q,%GetArrayKeys(q,r));
if(B===''){
if(x.length===0)return'';
return SparseJoin(q,x,A);
}else{
return SparseJoinWithSeparatorJS(
q,x,r,A,B);
}
}
if(r===1){
return ConvertToString(A,q[0]);
}
var D=new g(r);
for(var y=0;y<r;y++){
D[y]=ConvertToString(A,q[y]);
}
if(B===''){
return %StringBuilderConcat(D,r,'');
}else{
return %StringBuilderJoin(D,r,B);
}
}
function Join(q,r,B,A){
if(r===0)return'';
var F=(%_IsArray(q));
if(F){
if(StackHas(N,q))return'';
StackPush(N,q);
}
try{
return DoJoin(q,r,F,B,A);
}finally{
if(F)StackPop(N);
}
}
function ConvertToString(A,O){
if((O==null))return'';
return(%_ToString(A?O.toLocaleString():O));
}
function SparseSlice(q,P,Q,R,S){
var v=%GetArrayKeys(q,P+Q);
if((typeof(v)==='number')){
var w=v;
for(var y=P;y<w;++y){
var T=q[y];
if(!(T===(void 0))||y in q){
%CreateDataProperty(S,y-P,T);
}
}
}else{
var r=v.length;
for(var U=0;U<r;++U){
var E=v[U];
if(E>=P){
var T=q[E];
if(!(T===(void 0))||E in q){
%CreateDataProperty(S,E-P,T);
}
}
}
}
}
function SparseMove(q,P,Q,R,V){
if(V===Q)return;
var W=new g(
j(R-Q+V,0xffffffff));
var X;
var v=%GetArrayKeys(q,R);
if((typeof(v)==='number')){
var w=v;
for(var y=0;y<P&&y<w;++y){
var T=q[y];
if(!(T===(void 0))||y in q){
W[y]=T;
}
}
for(var y=P+Q;y<w;++y){
var T=q[y];
if(!(T===(void 0))||y in q){
W[y-Q+V]=T;
}
}
}else{
var r=v.length;
for(var U=0;U<r;++U){
var E=v[U];
if(E<P){
var T=q[E];
if(!(T===(void 0))||E in q){
W[E]=T;
}
}else if(E>=P+Q){
var T=q[E];
if(!(T===(void 0))||E in q){
var Y=E-Q+V;
W[Y]=T;
if(Y>0xfffffffe){
X=X||new g();
X.push(Y);
}
}
}
}
}
%MoveArrayContents(W,q);
if(!(X===(void 0))){
var r=X.length;
for(var y=0;y<r;++y){
var E=X[y];
q[E]=W[E];
}
}
}
function SimpleSlice(q,P,Q,R,S){
for(var y=0;y<Q;y++){
var Z=P+y;
if(Z in q){
var T=q[Z];
%CreateDataProperty(S,y,T);
}
}
}
function SimpleMove(q,P,Q,R,V){
if(V!==Q){
if(V>Q){
for(var y=R-Q;y>P;y--){
var aa=y+Q-1;
var ab=y+V-1;
if(aa in q){
q[ab]=q[aa];
}else{
delete q[ab];
}
}
}else{
for(var y=P;y<R-Q;y++){
var aa=y+Q;
var ab=y+V;
if(aa in q){
q[ab]=q[aa];
}else{
delete q[ab];
}
}
for(var y=R;y>R-Q+V;y--){
delete q[y-1];
}
}
}
}
function ArrayToString(){
var q;
var ac;
if((%_IsArray(this))){
ac=this.join;
if(ac===ArrayJoin){
return Join(this,this.length,',',false);
}
q=this;
}else{
q=(%_ToObject(this));
ac=q.join;
}
if(!(typeof(ac)==='function')){
return %_Call(l,q);
}
return %_Call(ac,q);
}
function InnerArrayToLocaleString(q,r){
return Join(q,(%_ToLength(r)),',',true);
}
function ArrayToLocaleString(){
var q=(%_ToObject(this));
var ad=q.length;
return InnerArrayToLocaleString(q,ad);
}
function InnerArrayJoin(B,q,r){
if((B===(void 0))){
B=',';
}else{
B=(%_ToString(B));
}
if(r===1){
var z=q[0];
if((z==null))return'';
return(%_ToString(z));
}
return Join(q,r,B,false);
}
function ArrayJoin(B){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.join");
var q=(%_ToObject(this));
var r=(%_ToLength(q.length));
return InnerArrayJoin(B,q,r);
}
function ArrayPop(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.pop");
var q=(%_ToObject(this));
var ae=(%_ToLength(q.length));
if(ae==0){
q.length=ae;
return;
}
ae--;
var K=q[ae];
%DeleteProperty_Strict(q,ae);
q.length=ae;
return K;
}
function ArrayPush(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.push");
var q=(%_ToObject(this));
var ae=(%_ToLength(q.length));
var af=arguments.length;
if(af>9007199254740991-ae)throw %make_type_error(228,af,ae);
for(var y=0;y<af;y++){
q[y+ae]=arguments[y];
}
var ag=ae+af;
q.length=ag;
return ag;
}
function SparseReverse(q,R){
var x=GetSortedArrayKeys(q,%GetArrayKeys(q,R));
var ah=x.length-1;
var ai=0;
while(ai<=ah){
var y=x[ai];
var aj=x[ah];
var ak=R-aj-1;
var al,am;
if(ak<=y){
am=aj;
while(x[--ah]==aj){}
al=ak;
}
if(ak>=y){
al=y;
while(x[++ai]==y){}
am=R-y-1;
}
var an=q[al];
if(!(an===(void 0))||al in q){
var ao=q[am];
if(!(ao===(void 0))||am in q){
q[al]=ao;
q[am]=an;
}else{
q[am]=an;
delete q[al];
}
}else{
var ao=q[am];
if(!(ao===(void 0))||am in q){
q[al]=ao;
delete q[am];
}
}
}
}
function PackedArrayReverse(q,R){
var aj=R-1;
for(var y=0;y<aj;y++,aj--){
var an=q[y];
var ao=q[aj];
q[y]=ao;
q[aj]=an;
}
return q;
}
function GenericArrayReverse(q,R){
var aj=R-1;
for(var y=0;y<aj;y++,aj--){
if(y in q){
var an=q[y];
if(aj in q){
var ao=q[aj];
q[y]=ao;
q[aj]=an;
}else{
q[aj]=an;
delete q[y];
}
}else{
if(aj in q){
var ao=q[aj];
q[y]=ao;
delete q[aj];
}
}
}
return q;
}
function ArrayReverse(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.reverse");
var q=(%_ToObject(this));
var R=(%_ToLength(q.length));
var ap=(%_IsArray(q));
if(UseSparseVariant(q,R,ap,R)){
%NormalizeElements(q);
SparseReverse(q,R);
return q;
}else if(ap&&%_HasFastPackedElements(q)){
return PackedArrayReverse(q,R);
}else{
return GenericArrayReverse(q,R);
}
}
function ArrayShift(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.shift");
var q=(%_ToObject(this));
var R=(%_ToLength(q.length));
if(R===0){
q.length=0;
return;
}
if(%object_is_sealed(q))throw %make_type_error(13);
var aq=q[0];
if(UseSparseVariant(q,R,(%_IsArray(q)),R)){
SparseMove(q,0,1,R,0);
}else{
SimpleMove(q,0,1,R,0);
}
q.length=R-1;
return aq;
}
function ArrayUnshift(ar){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.unshift");
var q=(%_ToObject(this));
var R=(%_ToLength(q.length));
var as=arguments.length;
if(R>0&&UseSparseVariant(q,R,(%_IsArray(q)),R)&&
!%object_is_sealed(q)){
SparseMove(q,0,0,R,as);
}else{
SimpleMove(q,0,0,R,as);
}
for(var y=0;y<as;y++){
q[y]=arguments[y];
}
var ag=R+as;
q.length=ag;
return ag;
}
function ArraySlice(at,au){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.slice");
var q=(%_ToObject(this));
var R=(%_ToLength(q.length));
var P=(%_ToInteger(at));
var av=R;
if(!(au===(void 0)))av=(%_ToInteger(au));
if(P<0){
P+=R;
if(P<0)P=0;
}else{
if(P>R)P=R;
}
if(av<0){
av+=R;
if(av<0)av=0;
}else{
if(av>R)av=R;
}
var aw=ArraySpeciesCreate(q,i(av-P,0));
if(av<P)return aw;
if(UseSparseVariant(q,R,(%_IsArray(q)),av-P)){
%NormalizeElements(q);
if((%_IsArray(aw)))%NormalizeElements(aw);
SparseSlice(q,P,av-P,R,aw);
}else{
SimpleSlice(q,P,av-P,R,aw);
}
aw.length=av-P;
return aw;
}
function ComputeSpliceStartIndex(P,R){
if(P<0){
P+=R;
return P<0?0:P;
}
return P>R?R:P;
}
function ComputeSpliceDeleteCount(ax,as,R,P){
var Q=0;
if(as==1)
return R-P;
Q=(%_ToInteger(ax));
if(Q<0)
return 0;
if(Q>R-P)
return R-P;
return Q;
}
function ArraySplice(at,ax){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.splice");
var as=arguments.length;
var q=(%_ToObject(this));
var R=(%_ToLength(q.length));
var P=ComputeSpliceStartIndex((%_ToInteger(at)),R);
var Q=ComputeSpliceDeleteCount(ax,as,R,
P);
var S=ArraySpeciesCreate(q,Q);
S.length=Q;
var ay=as>2?as-2:0;
if(Q!=ay&&%object_is_sealed(q)){
throw %make_type_error(13);
}else if(Q>0&&%object_is_frozen(q)){
throw %make_type_error(12);
}
var az=Q;
if(ay!=Q){
az+=R-P-Q;
}
if(UseSparseVariant(q,R,(%_IsArray(q)),az)){
%NormalizeElements(q);
if((%_IsArray(S)))%NormalizeElements(S);
SparseSlice(q,P,Q,R,S);
SparseMove(q,P,Q,R,ay);
}else{
SimpleSlice(q,P,Q,R,S);
SimpleMove(q,P,Q,R,ay);
}
var y=P;
var aA=2;
var aB=arguments.length;
while(aA<aB){
q[y++]=arguments[aA++];
}
q.length=R-Q+ay;
return S;
}
function InnerArraySort(q,r,aC){
if(!(typeof(aC)==='function')){
aC=function(O,aD){
if(O===aD)return 0;
if(%_IsSmi(O)&&%_IsSmi(aD)){
return %SmiLexicographicCompare(O,aD);
}
O=(%_ToString(O));
aD=(%_ToString(aD));
if(O==aD)return 0;
else return O<aD?-1:1;
};
}
function InsertionSort(t,p,aE){
for(var y=p+1;y<aE;y++){
var aF=t[y];
for(var aj=y-1;aj>=p;aj--){
var aG=t[aj];
var aH=aC(aG,aF);
if(aH>0){
t[aj+1]=aG;
}else{
break;
}
}
t[aj+1]=aF;
}
};
function GetThirdIndex(t,p,aE){
var aI=new g();
var aJ=200+((aE-p)&15);
var aj=0;
p+=1;
aE-=1;
for(var y=p;y<aE;y+=aJ){
aI[aj]=[y,t[y]];
aj++;
}
aI.sort(function(t,u){
return aC(t[1],u[1]);
});
var aK=aI[aI.length>>1][0];
return aK;
}
function QuickSort(t,p,aE){
var aK=0;
while(true){
if(aE-p<=10){
InsertionSort(t,p,aE);
return;
}
if(aE-p>1000){
aK=GetThirdIndex(t,p,aE);
}else{
aK=p+((aE-p)>>1);
}
var aL=t[p];
var aM=t[aE-1];
var aN=t[aK];
var aO=aC(aL,aM);
if(aO>0){
var aG=aL;
aL=aM;
aM=aG;
}
var aP=aC(aL,aN);
if(aP>=0){
var aG=aL;
aL=aN;
aN=aM;
aM=aG;
}else{
var aQ=aC(aM,aN);
if(aQ>0){
var aG=aM;
aM=aN;
aN=aG;
}
}
t[p]=aL;
t[aE-1]=aN;
var aR=aM;
var aS=p+1;
var aT=aE-1;
t[aK]=t[aS];
t[aS]=aR;
partition:for(var y=aS+1;y<aT;y++){
var aF=t[y];
var aH=aC(aF,aR);
if(aH<0){
t[y]=t[aS];
t[aS]=aF;
aS++;
}else if(aH>0){
do{
aT--;
if(aT==y)break partition;
var aU=t[aT];
aH=aC(aU,aR);
}while(aH>0);
t[y]=t[aT];
t[aT]=aF;
if(aH<0){
aF=t[y];
t[y]=t[aS];
t[aS]=aF;
aS++;
}
}
}
if(aE-aT<aS-p){
QuickSort(t,aT,aE);
aE=aS;
}else{
QuickSort(t,p,aS);
p=aT;
}
}
};
function CopyFromPrototype(aV,r){
var aW=0;
for(var aX=%object_get_prototype_of(aV);aX;
aX=%object_get_prototype_of(aX)){
var v=(%_IsJSProxy(aX))?r:%GetArrayKeys(aX,r);
if((typeof(v)==='number')){
var aY=v;
for(var y=0;y<aY;y++){
if(!(%_Call(k,aV,y))&&(%_Call(k,aX,y))){
aV[y]=aX[y];
if(y>=aW){aW=y+1;}
}
}
}else{
for(var y=0;y<v.length;y++){
var Z=v[y];
if(!(%_Call(k,aV,Z))&&(%_Call(k,aX,Z))){
aV[Z]=aX[Z];
if(Z>=aW){aW=Z+1;}
}
}
}
}
return aW;
};
function ShadowPrototypeElements(aV,p,aE){
for(var aX=%object_get_prototype_of(aV);aX;
aX=%object_get_prototype_of(aX)){
var v=(%_IsJSProxy(aX))?aE:%GetArrayKeys(aX,aE);
if((typeof(v)==='number')){
var aY=v;
for(var y=p;y<aY;y++){
if((%_Call(k,aX,y))){
aV[y]=(void 0);
}
}
}else{
for(var y=0;y<v.length;y++){
var Z=v[y];
if(p<=Z&&(%_Call(k,aX,Z))){
aV[Z]=(void 0);
}
}
}
}
};
function SafeRemoveArrayHoles(aV){
var aZ=0;
var ba=r-1;
var bb=0;
while(aZ<ba){
while(aZ<ba&&
!(aV[aZ]===(void 0))){
aZ++;
}
if(!(%_Call(k,aV,aZ))){
bb++;
}
while(aZ<ba&&
(aV[ba]===(void 0))){
if(!(%_Call(k,aV,ba))){
bb++;
}
ba--;
}
if(aZ<ba){
aV[aZ]=aV[ba];
aV[ba]=(void 0);
}
}
if(!(aV[aZ]===(void 0)))aZ++;
var y;
for(y=aZ;y<r-bb;y++){
aV[y]=(void 0);
}
for(y=r-bb;y<r;y++){
if(y in %object_get_prototype_of(aV)){
aV[y]=(void 0);
}else{
delete aV[y];
}
}
return aZ;
};
if(r<2)return q;
var F=(%_IsArray(q));
var bc;
if(!F){
bc=CopyFromPrototype(q,r);
}
var bd=%RemoveArrayHoles(q,r);
if(bd==-1){
bd=SafeRemoveArrayHoles(q);
}
QuickSort(q,0,bd);
if(!F&&(bd+1<bc)){
ShadowPrototypeElements(q,bd,bc);
}
return q;
}
function ArraySort(aC){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.sort");
var q=(%_ToObject(this));
var r=(%_ToLength(q.length));
return InnerArraySort(q,r,aC);
}
function InnerArrayFilter(be,bf,q,r,aw){
var bg=0;
for(var y=0;y<r;y++){
if(y in q){
var aF=q[y];
if(%_Call(be,bf,aF,y,q)){
%CreateDataProperty(aw,bg,aF);
bg++;
}
}
}
return aw;
}
function ArrayFilter(be,bf){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.filter");
var q=(%_ToObject(this));
var r=(%_ToLength(q.length));
if(!(typeof(be)==='function'))throw %make_type_error(15,be);
var aw=ArraySpeciesCreate(q,0);
return InnerArrayFilter(be,bf,q,r,aw);
}
function InnerArrayForEach(be,bf,q,r){
if(!(typeof(be)==='function'))throw %make_type_error(15,be);
if((bf===(void 0))){
for(var y=0;y<r;y++){
if(y in q){
var aF=q[y];
be(aF,y,q);
}
}
}else{
for(var y=0;y<r;y++){
if(y in q){
var aF=q[y];
%_Call(be,bf,aF,y,q);
}
}
}
}
function ArrayForEach(be,bf){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.forEach");
var q=(%_ToObject(this));
var r=(%_ToLength(q.length));
InnerArrayForEach(be,bf,q,r);
}
function InnerArraySome(be,bf,q,r){
if(!(typeof(be)==='function'))throw %make_type_error(15,be);
for(var y=0;y<r;y++){
if(y in q){
var aF=q[y];
if(%_Call(be,bf,aF,y,q))return true;
}
}
return false;
}
function ArraySome(be,bf){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.some");
var q=(%_ToObject(this));
var r=(%_ToLength(q.length));
return InnerArraySome(be,bf,q,r);
}
function InnerArrayEvery(be,bf,q,r){
if(!(typeof(be)==='function'))throw %make_type_error(15,be);
for(var y=0;y<r;y++){
if(y in q){
var aF=q[y];
if(!%_Call(be,bf,aF,y,q))return false;
}
}
return true;
}
function ArrayEvery(be,bf){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.every");
var q=(%_ToObject(this));
var r=(%_ToLength(q.length));
return InnerArrayEvery(be,bf,q,r);
}
function ArrayMap(be,bf){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.map");
var q=(%_ToObject(this));
var r=(%_ToLength(q.length));
if(!(typeof(be)==='function'))throw %make_type_error(15,be);
var aw=ArraySpeciesCreate(q,r);
for(var y=0;y<r;y++){
if(y in q){
var aF=q[y];
%CreateDataProperty(aw,y,%_Call(be,bf,aF,y,q));
}
}
return aw;
}
function InnerArrayLastIndexOf(q,aF,Z,r,bh){
if(r==0)return-1;
if(bh<2){
Z=r-1;
}else{
Z=(((%_ToInteger(Z)))+0);
if(Z<0)Z+=r;
if(Z<0)return-1;
else if(Z>=r)Z=r-1;
}
var bi=0;
var aW=Z;
if(UseSparseVariant(q,r,(%_IsArray(q)),Z)){
%NormalizeElements(q);
var v=%GetArrayKeys(q,Z+1);
if((typeof(v)==='number')){
aW=v;
}else{
if(v.length==0)return-1;
var bj=GetSortedArrayKeys(q,v);
var y=bj.length-1;
while(y>=0){
var E=bj[y];
if(q[E]===aF)return E;
y--;
}
return-1;
}
}
if(!(aF===(void 0))){
for(var y=aW;y>=bi;y--){
if(q[y]===aF)return y;
}
return-1;
}
for(var y=aW;y>=bi;y--){
if((q[y]===(void 0))&&y in q){
return y;
}
}
return-1;
}
function ArrayLastIndexOf(aF,Z){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.lastIndexOf");
var r=(%_ToLength(this.length));
return InnerArrayLastIndexOf(this,aF,Z,r,
arguments.length);
}
function InnerArrayReduce(bk,T,q,r,bh){
if(!(typeof(bk)==='function')){
throw %make_type_error(15,bk);
}
var y=0;
find_initial:if(bh<2){
for(;y<r;y++){
if(y in q){
T=q[y++];
break find_initial;
}
}
throw %make_type_error(122);
}
for(;y<r;y++){
if(y in q){
var aF=q[y];
T=bk(T,aF,y,q);
}
}
return T;
}
function ArrayReduce(bk,T){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.reduce");
var q=(%_ToObject(this));
var r=(%_ToLength(q.length));
return InnerArrayReduce(bk,T,q,r,
arguments.length);
}
function InnerArrayReduceRight(bk,T,q,r,
bh){
if(!(typeof(bk)==='function')){
throw %make_type_error(15,bk);
}
var y=r-1;
find_initial:if(bh<2){
for(;y>=0;y--){
if(y in q){
T=q[y--];
break find_initial;
}
}
throw %make_type_error(122);
}
for(;y>=0;y--){
if(y in q){
var aF=q[y];
T=bk(T,aF,y,q);
}
}
return T;
}
function ArrayReduceRight(bk,T){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.reduceRight");
var q=(%_ToObject(this));
var r=(%_ToLength(q.length));
return InnerArrayReduceRight(bk,T,q,r,
arguments.length);
}
function InnerArrayCopyWithin(bl,at,au,q,r){
bl=(%_ToInteger(bl));
var aE;
if(bl<0){
aE=i(r+bl,0);
}else{
aE=j(bl,r);
}
at=(%_ToInteger(at));
var p;
if(at<0){
p=i(r+at,0);
}else{
p=j(at,r);
}
au=(au===(void 0))?r:(%_ToInteger(au));
var bm;
if(au<0){
bm=i(r+au,0);
}else{
bm=j(au,r);
}
var bn=j(bm-p,r-aE);
var bo=1;
if(p<aE&&aE<(p+bn)){
bo=-1;
p=p+bn-1;
aE=aE+bn-1;
}
while(bn>0){
if(p in q){
q[aE]=q[p];
}else{
delete q[aE];
}
p=p+bo;
aE=aE+bo;
bn--;
}
return q;
}
function ArrayCopyWithin(bl,at,au){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.copyWithin");
var q=(%_ToObject(this));
var r=(%_ToLength(q.length));
return InnerArrayCopyWithin(bl,at,au,q,r);
}
function InnerArrayFind(bp,bq,q,r){
if(!(typeof(bp)==='function')){
throw %make_type_error(15,bp);
}
for(var y=0;y<r;y++){
var aF=q[y];
if(%_Call(bp,bq,aF,y,q)){
return aF;
}
}
return;
}
function ArrayFind(bp,bq){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.find");
var q=(%_ToObject(this));
var r=(%_ToInteger(q.length));
return InnerArrayFind(bp,bq,q,r);
}
function InnerArrayFindIndex(bp,bq,q,r){
if(!(typeof(bp)==='function')){
throw %make_type_error(15,bp);
}
for(var y=0;y<r;y++){
var aF=q[y];
if(%_Call(bp,bq,aF,y,q)){
return y;
}
}
return-1;
}
function ArrayFindIndex(bp,bq){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.findIndex");
var q=(%_ToObject(this));
var r=(%_ToInteger(q.length));
return InnerArrayFindIndex(bp,bq,q,r);
}
function InnerArrayFill(K,at,au,q,r){
var y=(at===(void 0))?0:(%_ToInteger(at));
var au=(au===(void 0))?r:(%_ToInteger(au));
if(y<0){
y+=r;
if(y<0)y=0;
}else{
if(y>r)y=r;
}
if(au<0){
au+=r;
if(au<0)au=0;
}else{
if(au>r)au=r;
}
if((au-y)>0&&%object_is_frozen(q)){
throw %make_type_error(12);
}
for(;y<au;y++)
q[y]=K;
return q;
}
function ArrayFill(K,at,au){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Array.prototype.fill");
var q=(%_ToObject(this));
var r=(%_ToLength(q.length));
return InnerArrayFill(K,at,au,q,r);
}
function ArrayFrom(br,bs,bf){
var bt=(%_ToObject(br));
var bu=!(bs===(void 0));
if(bu){
if(!(typeof(bs)==='function')){
throw %make_type_error(15,bs);
}
}
var bv=e(bt,m);
var U;
var aw;
var bw;
var bx;
if(!(bv===(void 0))){
aw=%IsConstructor(this)?new this():[];
U=0;
for(bx of
{[m](){return d(bt,bv)}}){
if(bu){
bw=%_Call(bs,bf,bx,U);
}else{
bw=bx;
}
%CreateDataProperty(aw,U,bw);
U++;
}
aw.length=U;
return aw;
}else{
var R=(%_ToLength(bt.length));
aw=%IsConstructor(this)?new this(R):new f(R);
for(U=0;U<R;++U){
bx=bt[U];
if(bu){
bw=%_Call(bs,bf,bx,U);
}else{
bw=bx;
}
%CreateDataProperty(aw,U,bw);
}
aw.length=U;
return aw;
}
}
function ArrayOf(...args){
var r=args.length;
var s=this;
var q=%IsConstructor(s)?new s(r):[];
for(var y=0;y<r;y++){
%CreateDataProperty(q,y,args[y]);
}
q.length=r;
return q;
}
function ArraySpecies(){
return this;
}
%AddNamedProperty(f.prototype,"constructor",f,
2);
var by={
__proto__:null,
copyWithin:true,
entries:true,
fill:true,
find:true,
findIndex:true,
includes:true,
keys:true,
};
%AddNamedProperty(f.prototype,o,by,
2|1);
%FunctionSetLength(ArrayFrom,1);
b.InstallFunctions(f,2,[
"from",ArrayFrom,
"of",ArrayOf
]);
var bz=%SpecialArrayFunctions();
function getFunction(bA,bB,R){
var be=bB;
if(bz.hasOwnProperty(bA)){
be=bz[bA];
}
if(!(R===(void 0))){
%FunctionSetLength(be,R);
}
return be;
};
var bC=getFunction("values",null,0);
b.InstallFunctions(f.prototype,2,[
"toString",getFunction("toString",ArrayToString),
"toLocaleString",getFunction("toLocaleString",ArrayToLocaleString),
"join",getFunction("join",ArrayJoin),
"pop",getFunction("pop",ArrayPop),
"push",getFunction("push",ArrayPush,1),
"reverse",getFunction("reverse",ArrayReverse),
"shift",getFunction("shift",ArrayShift),
"unshift",getFunction("unshift",ArrayUnshift,1),
"slice",getFunction("slice",ArraySlice,2),
"splice",getFunction("splice",ArraySplice,2),
"sort",getFunction("sort",ArraySort),
"filter",getFunction("filter",ArrayFilter,1),
"forEach",getFunction("forEach",ArrayForEach,1),
"some",getFunction("some",ArraySome,1),
"every",getFunction("every",ArrayEvery,1),
"map",getFunction("map",ArrayMap,1),
"indexOf",getFunction("indexOf",null,1),
"lastIndexOf",getFunction("lastIndexOf",ArrayLastIndexOf,1),
"reduce",getFunction("reduce",ArrayReduce,1),
"reduceRight",getFunction("reduceRight",ArrayReduceRight,1),
"copyWithin",getFunction("copyWithin",ArrayCopyWithin,2),
"find",getFunction("find",ArrayFind,1),
"findIndex",getFunction("findIndex",ArrayFindIndex,1),
"fill",getFunction("fill",ArrayFill,1),
"includes",getFunction("includes",null,1),
"keys",getFunction("keys",null,0),
"entries",getFunction("entries",null,0),
m,bC
]);
%FunctionSetName(bC,"values");
b.InstallGetter(f,n,ArraySpecies);
%FinishArrayPrototypeSetup(f.prototype);
b.SetUpLockedPrototype(g,f(),[
"indexOf",getFunction("indexOf",null),
"join",getFunction("join",ArrayJoin),
"pop",getFunction("pop",ArrayPop),
"push",getFunction("push",ArrayPush),
"shift",getFunction("shift",ArrayShift),
"sort",getFunction("sort",ArraySort),
"splice",getFunction("splice",ArraySplice)
]);
b.SetUpLockedPrototype(h,f(),[
"join",getFunction("join",ArrayJoin),
"pop",getFunction("pop",ArrayPop),
"push",getFunction("push",ArrayPush),
"shift",getFunction("shift",ArrayShift)
]);
b.SetUpLockedPrototype(c.InternalPackedArray,f(),[
"push",getFunction("push",ArrayPush),
"pop",getFunction("pop",ArrayPop),
"shift",getFunction("shift",ArrayShift),
"unshift",getFunction("unshift",ArrayUnshift),
"splice",getFunction("splice",ArraySplice),
"slice",getFunction("slice",ArraySlice)
]);
b.Export(function(aE){
aE.ArrayFrom=ArrayFrom;
aE.ArrayJoin=ArrayJoin;
aE.ArrayPush=ArrayPush;
aE.ArrayToString=ArrayToString;
aE.ArrayValues=bC;
aE.InnerArrayCopyWithin=InnerArrayCopyWithin;
aE.InnerArrayEvery=InnerArrayEvery;
aE.InnerArrayFill=InnerArrayFill;
aE.InnerArrayFilter=InnerArrayFilter;
aE.InnerArrayFind=InnerArrayFind;
aE.InnerArrayFindIndex=InnerArrayFindIndex;
aE.InnerArrayForEach=InnerArrayForEach;
aE.InnerArrayJoin=InnerArrayJoin;
aE.InnerArrayLastIndexOf=InnerArrayLastIndexOf;
aE.InnerArrayReduce=InnerArrayReduce;
aE.InnerArrayReduceRight=InnerArrayReduceRight;
aE.InnerArraySome=InnerArraySome;
aE.InnerArraySort=InnerArraySort;
aE.InnerArrayToLocaleString=InnerArrayToLocaleString;
aE.PackedArrayReverse=PackedArrayReverse;
});
%InstallToContext([
"array_pop",ArrayPop,
"array_push",ArrayPush,
"array_shift",ArrayShift,
"array_splice",ArraySplice,
"array_slice",ArraySlice,
"array_unshift",ArrayUnshift,
"array_values_iterator",bC,
]);
});

stringÜ
(function(a,b){
%CheckIsBootstrapping();
var c;
var d=a.RegExp;
var e=a.String;
var f;
var g;
var h=b.ImportNow("match_symbol");
var i=b.ImportNow("replace_symbol");
var j=b.ImportNow("search_symbol");
var k=b.ImportNow("split_symbol");
b.Import(function(l){
c=l.ArrayJoin;
f=l.MaxSimple;
g=l.MinSimple;
});
function StringConcat(m){
"use strict";
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.concat");
var n=(%_ToString(this));
var o=arguments.length;
for(var p=0;p<o;++p){
n=n+(%_ToString(arguments[p]));
}
return n;
}
function StringMatchJS(q){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.match");
if(!(q==null)){
var r=q[h];
if(!(r===(void 0))){
return %_Call(r,q,this);
}
}
var s=(%_ToString(this));
var t=%RegExpCreate(q);
return t[h](s);
}
function GetSubstitution(u,v,w,x,y){
var z=u.length;
var A=v.length;
var B=x.length;
var C=w+z;
var D="";
var E,F,G,H,I,J,K;
var H=%StringIndexOf(y,'$',0);
if(H<0){
D+=y;
return D;
}
if(H>0)D+=%_SubString(y,0,H);
while(true){
F='$';
E=H+1;
if(E<y.length){
G=%_StringCharCodeAt(y,E);
if(G==36){
++E;
D+='$';
}else if(G==38){
++E;
D+=u;
}else if(G==96){
++E;
D+=%_SubString(v,0,w);
}else if(G==39){
++E;
D+=%_SubString(v,C,A);
}else if(G>=48&&G<=57){
I=(G-48);
J=1;
if(E+1<y.length){
H=%_StringCharCodeAt(y,E+1);
if(H>=48&&H<=57){
K=I*10+((H-48));
if(K<B){
I=K;
J=2;
}
}
}
if(I!=0&&I<B){
var L=x.at(I);
if(!(L===(void 0)))D+=L;
E+=J;
}else{
D+='$';
}
}else{
D+='$';
}
}else{
D+='$';
}
H=%StringIndexOf(y,'$',E);
if(H<0){
if(E<y.length){
D+=%_SubString(y,E,y.length);
}
return D;
}
if(H>E){
D+=%_SubString(y,E,H);
}
}
return D;
}
function StringReplace(M,N){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.replace");
if(!(M==null)){
var O=M[i];
if(!(O===(void 0))){
return %_Call(O,M,this,N);
}
}
var s=(%_ToString(this));
M=(%_ToString(M));
if(M.length==1&&
s.length>0xFF&&
(typeof(N)==='string')&&
%StringIndexOf(N,'$',0)<0){
return %StringReplaceOneCharWithString(s,M,N);
}
var P=%StringIndexOf(s,M,0);
if(P<0)return s;
var Q=P+M.length;
var D=%_SubString(s,0,P);
if((typeof(N)==='function')){
D+=N(M,P,s);
}else{
const x={length:1};
const u=%_SubString(s,P,Q);
D+=GetSubstitution(u,s,P,x,
(%_ToString(N)));
}
return D+%_SubString(s,Q,s.length);
}
function StringSearch(q){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.search");
if(!(q==null)){
var R=q[j];
if(!(R===(void 0))){
return %_Call(R,q,this);
}
}
var s=(%_ToString(this));
var t=%RegExpCreate(q);
return %_Call(t[j],t,s);
}
function StringSlice(P,Q){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.slice");
var n=(%_ToString(this));
var S=n.length;
var T=(%_ToInteger(P));
var U=S;
if(!(Q===(void 0))){
U=(%_ToInteger(Q));
}
if(T<0){
T+=S;
if(T<0){
T=0;
}
}else{
if(T>S){
return'';
}
}
if(U<0){
U+=S;
if(U<0){
return'';
}
}else{
if(U>S){
U=S;
}
}
if(U<=T){
return'';
}
return %_SubString(n,T,U);
}
function StringSplitJS(V,W){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.split");
if(!(V==null)){
var X=V[k];
if(!(X===(void 0))){
return %_Call(X,V,this,W);
}
}
var s=(%_ToString(this));
W=((W===(void 0)))?4294967295:((W)>>>0);
var Y=s.length;
var Z=(%_ToString(V));
if(W===0)return[];
if((V===(void 0)))return[s];
var aa=Z.length;
if(aa===0)return %StringToArray(s,W);
return %StringSplit(s,Z,W);
}
function StringToLowerCaseJS(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.toLowerCase");
return %StringToLowerCase((%_ToString(this)));
}
function StringToLocaleLowerCase(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.toLocaleLowerCase");
return %StringToLowerCase((%_ToString(this)));
}
function StringToUpperCaseJS(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.toUpperCase");
return %StringToUpperCase((%_ToString(this)));
}
function StringToLocaleUpperCase(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.toLocaleUpperCase");
return %StringToUpperCase((%_ToString(this)));
}
function HtmlEscape(ab){
return %_Call(StringReplace,(%_ToString(ab)),/"/g,"&quot;");
}
function StringAnchor(ac){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.anchor");
return"<a name=\""+HtmlEscape(ac)+"\">"+(%_ToString(this))+
"</a>";
}
function StringBig(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.big");
return"<big>"+(%_ToString(this))+"</big>";
}
function StringBlink(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.blink");
return"<blink>"+(%_ToString(this))+"</blink>";
}
function StringBold(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.bold");
return"<b>"+(%_ToString(this))+"</b>";
}
function StringFixed(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.fixed");
return"<tt>"+(%_ToString(this))+"</tt>";
}
function StringFontcolor(ad){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.fontcolor");
return"<font color=\""+HtmlEscape(ad)+"\">"+(%_ToString(this))+
"</font>";
}
function StringFontsize(ae){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.fontsize");
return"<font size=\""+HtmlEscape(ae)+"\">"+(%_ToString(this))+
"</font>";
}
function StringItalics(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.italics");
return"<i>"+(%_ToString(this))+"</i>";
}
function StringLink(n){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.link");
return"<a href=\""+HtmlEscape(n)+"\">"+(%_ToString(this))+"</a>";
}
function StringSmall(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.small");
return"<small>"+(%_ToString(this))+"</small>";
}
function StringStrike(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.strike");
return"<strike>"+(%_ToString(this))+"</strike>";
}
function StringSub(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.sub");
return"<sub>"+(%_ToString(this))+"</sub>";
}
function StringSup(){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.sup");
return"<sup>"+(%_ToString(this))+"</sup>";
}
function StringRepeat(af){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.repeat");
var n=(%_ToString(this));
var ag=(%_ToInteger(af));
if(ag<0||ag===(1/0))throw %make_range_error(158);
if(n.length===0)return"";
if(ag>%_MaxSmi())throw %make_range_error(158);
var ah="";
while(true){
if(ag&1)ah+=n;
ag>>=1;
if(ag===0)return ah;
n+=n;
}
}
function StringCodePointAt(E){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.codePointAt");
var v=(%_ToString(this));
var ae=v.length;
E=(%_ToInteger(E));
if(E<0||E>=ae){
return(void 0);
}
var ai=%_StringCharCodeAt(v,E);
if(ai<0xD800||ai>0xDBFF||E+1==ae){
return ai;
}
var aj=%_StringCharCodeAt(v,E+1);
if(aj<0xDC00||aj>0xDFFF){
return ai;
}
return(ai-0xD800)*0x400+aj+0x2400;
}
function StringRaw(ak){
"use strict";
var al=arguments.length;
var am=(%_ToObject(ak));
var an=(%_ToObject(am.raw));
var ao=(%_ToLength(an.length));
if(ao<=0)return"";
var D=(%_ToString(an[0]));
for(var p=1;p<ao;++p){
if(p<al){
D+=(%_ToString(arguments[p]));
}
D+=(%_ToString(an[p]));
}
return D;
}
b.InstallFunctions(e,2,[
"raw",StringRaw
]);
b.InstallFunctions(e.prototype,2,[
"codePointAt",StringCodePointAt,
"concat",StringConcat,
"match",StringMatchJS,
"repeat",StringRepeat,
"replace",StringReplace,
"search",StringSearch,
"slice",StringSlice,
"split",StringSplitJS,
"toLowerCase",StringToLowerCaseJS,
"toLocaleLowerCase",StringToLocaleLowerCase,
"toUpperCase",StringToUpperCaseJS,
"toLocaleUpperCase",StringToLocaleUpperCase,
"link",StringLink,
"anchor",StringAnchor,
"fontcolor",StringFontcolor,
"fontsize",StringFontsize,
"big",StringBig,
"blink",StringBlink,
"bold",StringBold,
"fixed",StringFixed,
"italics",StringItalics,
"small",StringSmall,
"strike",StringStrike,
"sub",StringSub,
"sup",StringSup
]);
b.Export(function(ap){
ap.StringMatch=StringMatchJS;
ap.StringReplace=StringReplace;
ap.StringSlice=StringSlice;
ap.StringSplit=StringSplitJS;
});
})

,arraybufferâ
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c=a.ArrayBuffer;
var d;
var e;
var f;
var g=b.ImportNow("species_symbol");
b.Import(function(h){
d=h.MaxSimple;
e=h.MinSimple;
f=h.SpeciesConstructor;
});
function ArrayBufferSlice(i,j){
if(!(%_ClassOf(this)==='ArrayBuffer')){
throw %make_type_error(45,
'ArrayBuffer.prototype.slice',this);
}
var k=(%_ToInteger(i));
if(!(j===(void 0))){
j=(%_ToInteger(j));
}
var l;
var m=%_ArrayBufferGetByteLength(this);
if(k<0){
l=d(m+k,0);
}else{
l=e(k,m);
}
var n=(j===(void 0))?m:j;
var o;
if(n<0){
o=d(m+n,0);
}else{
o=e(n,m);
}
if(o<l){
o=l;
}
var p=o-l;
var q=f(this,c,true);
var r=new q(p);
if(!(%_ClassOf(r)==='ArrayBuffer')){
throw %make_type_error(45,
'ArrayBuffer.prototype.slice',r);
}
if(r===this){
throw %make_type_error(11);
}
if(%_ArrayBufferGetByteLength(r)<p){
throw %make_type_error(10);
}
%ArrayBufferSliceImpl(this,r,l,p);
return r;
}
function ArrayBufferSpecies(){
return this;
}
b.InstallGetter(c,g,ArrayBufferSpecies);
b.InstallFunctions(c.prototype,2,[
"slice",ArrayBufferSlice
]);
})

(typedarrayÓq
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c=b.ImportNow("ArrayToString");
var d;
var e;
var f;
var g=a.Array;
var h=a.ArrayBuffer;
var i=h.prototype;
var j=a.Object;
var k;
var l;
var m;
var n;
var o;
var p;
var q;
var r;
var s;
var t;
var u;
var v;
var w;
var x=b.InternalArray;
var y;
var z;
var A;
var B;
var C;
var D;
var E=b.ImportNow("iterator_symbol");
var F=b.ImportNow("species_symbol");
var G=b.ImportNow("to_string_tag_symbol");
var H=a.Uint8Array;

var I=a.Int8Array;

var J=a.Uint16Array;

var K=a.Int16Array;

var L=a.Uint32Array;

var M=a.Int32Array;

var N=a.Float32Array;

var O=a.Float64Array;

var P=a.Uint8ClampedArray;


var Q=%object_get_prototype_of(H);
b.Import(function(R){
d=R.ArrayValues;
e=R.GetIterator;
f=R.GetMethod;
k=R.InnerArrayCopyWithin;
l=R.InnerArrayEvery;
m=R.InnerArrayFill;
n=R.InnerArrayFilter;
o=R.InnerArrayFind;
p=R.InnerArrayFindIndex;
q=R.InnerArrayForEach;
r=R.InnerArrayJoin;
s=R.InnerArrayReduce;
t=R.InnerArrayReduceRight;
u=R.InnerArraySome;
v=R.InnerArraySort;
w=R.InnerArrayToLocaleString;
y=R.MaxSimple;
z=R.MinSimple;
A=R.PackedArrayReverse;
B=R.SpeciesConstructor;
C=R.ToPositiveInteger;
D=R.ToIndex;
});
function TypedArrayDefaultConstructor(S){
switch(%_ClassOf(S)){
case"Uint8Array":
return H;

case"Int8Array":
return I;

case"Uint16Array":
return J;

case"Int16Array":
return K;

case"Uint32Array":
return L;

case"Int32Array":
return M;

case"Float32Array":
return N;

case"Float64Array":
return O;

case"Uint8ClampedArray":
return P;


}
throw %make_type_error(45,
"TypedArrayDefaultConstructor",this);
}
function TypedArrayCreate(T,U,V,W){
if((V===(void 0))){
var X=new T(U);
}else{
var X=new T(U,V,W);
}
if(!(%_IsTypedArray(X)))throw %make_type_error(73);
if((typeof(U)==='number')&&%_TypedArrayGetLength(X)<U){
throw %make_type_error(250);
}
return X;
}
function TypedArraySpeciesCreate(Y,U,V,W,Z){
var aa=TypedArrayDefaultConstructor(Y);
var T=B(Y,aa,
Z);
return TypedArrayCreate(T,U,V,W);
}
function Uint8ArrayConstructByArrayBuffer(ab,ac,ad,ae){
if(!(ad===(void 0))){
ad=D(ad,171);
}
if(!(ae===(void 0))){
ae=D(ae,171);
}
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var af=%_ArrayBufferGetByteLength(ac);
var ag;
if((ad===(void 0))){
ag=0;
}else{
ag=ad;
if(ag % 1!==0){
throw %make_range_error(169,
"start offset","Uint8Array",1);
}
}
var ah;
if((ae===(void 0))){
if(af % 1!==0){
throw %make_range_error(169,
"byte length","Uint8Array",1);
}
ah=af-ag;
if(ah<0){
throw %make_range_error(169,
"byte length","Uint8Array",1);
}
}else{
ah=ae*1;
if(ag+ah>af){
throw %make_range_error(171);
}
}
%_TypedArrayInitialize(ab,1,ac,ag,ah,true);
}
function Uint8ArrayConstructByLength(ab,ae){
var ai=(ae===(void 0))?
0:D(ae,171);
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var aj=ai*1;
if(aj>%_TypedArrayMaxSizeInHeap()){
var ac=new h(aj);
%_TypedArrayInitialize(ab,1,ac,0,aj,true);
}else{
%_TypedArrayInitialize(ab,1,null,0,aj,true);
}
}
function Uint8ArrayConstructByArrayLike(ab,ak,ae){
var ai=C(ae,171);
if(ai>%_MaxSmi()){
throw %make_range_error(171);
}
var al=false;
var aj=ai*1;
if(aj<=%_TypedArrayMaxSizeInHeap()){
%_TypedArrayInitialize(ab,1,null,0,aj,false);
}else{
al=
%TypedArrayInitializeFromArrayLike(ab,1,ak,ai);
}
if(!al){
for(var am=0;am<ai;am++){
ab[am]=ak[am];
}
}
}
function Uint8ArrayConstructByIterable(ab,an,ao){
var ap=new x();
var aq=%_Call(ao,an);
var ar={
__proto__:null
};
ar[E]=function(){return aq;}
for(var as of ar){
ap.push(as);
}
Uint8ArrayConstructByArrayLike(ab,ap,ap.length);
}
function Uint8ArrayConstructByTypedArray(ab,S){
var at=%TypedArrayGetBuffer(S);
var ae=%_TypedArrayGetLength(S);
var aj=%_ArrayBufferViewGetByteLength(S);
var ah=ae*1;
Uint8ArrayConstructByArrayLike(ab,S,ae);
var au=B(at,h);
var av=au.prototype;
if((%_IsJSReceiver(av))&&av!==i){
%InternalSetPrototype(%TypedArrayGetBuffer(ab),av);
}
}
function Uint8ArrayConstructor(V,W,aw){
if(!(new.target===(void 0))){
if((%_ClassOf(V)==='ArrayBuffer')||(%_ClassOf(V)==='SharedArrayBuffer')){
Uint8ArrayConstructByArrayBuffer(this,V,W,aw);
}else if((%_IsTypedArray(V))){
Uint8ArrayConstructByTypedArray(this,V);
}else if((%_IsJSReceiver(V))){
var ao=V[E];
if((ao===(void 0))){
Uint8ArrayConstructByArrayLike(this,V,V.length);
}else{
Uint8ArrayConstructByIterable(this,V,ao);
}
}else{
Uint8ArrayConstructByLength(this,V);
}
}else{
throw %make_type_error(27,"Uint8Array")
}
}
function Uint8ArraySubArray(ax,ay){
var az=(%_ToInteger(ax));
if(!(ay===(void 0))){
var aA=(%_ToInteger(ay));
var aB=%_TypedArrayGetLength(this);
}else{
var aB=%_TypedArrayGetLength(this);
var aA=aB;
}
if(az<0){
az=y(0,aB+az);
}else{
az=z(az,aB);
}
if(aA<0){
aA=y(0,aB+aA);
}else{
aA=z(aA,aB);
}
if(aA<az){
aA=az;
}
var aC=aA-az;
var aD=
%_ArrayBufferViewGetByteOffset(this)+az*1;
return new H(%TypedArrayGetBuffer(this),aD,aC);
}

function Int8ArrayConstructByArrayBuffer(ab,ac,ad,ae){
if(!(ad===(void 0))){
ad=D(ad,171);
}
if(!(ae===(void 0))){
ae=D(ae,171);
}
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var af=%_ArrayBufferGetByteLength(ac);
var ag;
if((ad===(void 0))){
ag=0;
}else{
ag=ad;
if(ag % 1!==0){
throw %make_range_error(169,
"start offset","Int8Array",1);
}
}
var ah;
if((ae===(void 0))){
if(af % 1!==0){
throw %make_range_error(169,
"byte length","Int8Array",1);
}
ah=af-ag;
if(ah<0){
throw %make_range_error(169,
"byte length","Int8Array",1);
}
}else{
ah=ae*1;
if(ag+ah>af){
throw %make_range_error(171);
}
}
%_TypedArrayInitialize(ab,2,ac,ag,ah,true);
}
function Int8ArrayConstructByLength(ab,ae){
var ai=(ae===(void 0))?
0:D(ae,171);
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var aj=ai*1;
if(aj>%_TypedArrayMaxSizeInHeap()){
var ac=new h(aj);
%_TypedArrayInitialize(ab,2,ac,0,aj,true);
}else{
%_TypedArrayInitialize(ab,2,null,0,aj,true);
}
}
function Int8ArrayConstructByArrayLike(ab,ak,ae){
var ai=C(ae,171);
if(ai>%_MaxSmi()){
throw %make_range_error(171);
}
var al=false;
var aj=ai*1;
if(aj<=%_TypedArrayMaxSizeInHeap()){
%_TypedArrayInitialize(ab,2,null,0,aj,false);
}else{
al=
%TypedArrayInitializeFromArrayLike(ab,2,ak,ai);
}
if(!al){
for(var am=0;am<ai;am++){
ab[am]=ak[am];
}
}
}
function Int8ArrayConstructByIterable(ab,an,ao){
var ap=new x();
var aq=%_Call(ao,an);
var ar={
__proto__:null
};
ar[E]=function(){return aq;}
for(var as of ar){
ap.push(as);
}
Int8ArrayConstructByArrayLike(ab,ap,ap.length);
}
function Int8ArrayConstructByTypedArray(ab,S){
var at=%TypedArrayGetBuffer(S);
var ae=%_TypedArrayGetLength(S);
var aj=%_ArrayBufferViewGetByteLength(S);
var ah=ae*1;
Int8ArrayConstructByArrayLike(ab,S,ae);
var au=B(at,h);
var av=au.prototype;
if((%_IsJSReceiver(av))&&av!==i){
%InternalSetPrototype(%TypedArrayGetBuffer(ab),av);
}
}
function Int8ArrayConstructor(V,W,aw){
if(!(new.target===(void 0))){
if((%_ClassOf(V)==='ArrayBuffer')||(%_ClassOf(V)==='SharedArrayBuffer')){
Int8ArrayConstructByArrayBuffer(this,V,W,aw);
}else if((%_IsTypedArray(V))){
Int8ArrayConstructByTypedArray(this,V);
}else if((%_IsJSReceiver(V))){
var ao=V[E];
if((ao===(void 0))){
Int8ArrayConstructByArrayLike(this,V,V.length);
}else{
Int8ArrayConstructByIterable(this,V,ao);
}
}else{
Int8ArrayConstructByLength(this,V);
}
}else{
throw %make_type_error(27,"Int8Array")
}
}
function Int8ArraySubArray(ax,ay){
var az=(%_ToInteger(ax));
if(!(ay===(void 0))){
var aA=(%_ToInteger(ay));
var aB=%_TypedArrayGetLength(this);
}else{
var aB=%_TypedArrayGetLength(this);
var aA=aB;
}
if(az<0){
az=y(0,aB+az);
}else{
az=z(az,aB);
}
if(aA<0){
aA=y(0,aB+aA);
}else{
aA=z(aA,aB);
}
if(aA<az){
aA=az;
}
var aC=aA-az;
var aD=
%_ArrayBufferViewGetByteOffset(this)+az*1;
return new I(%TypedArrayGetBuffer(this),aD,aC);
}

function Uint16ArrayConstructByArrayBuffer(ab,ac,ad,ae){
if(!(ad===(void 0))){
ad=D(ad,171);
}
if(!(ae===(void 0))){
ae=D(ae,171);
}
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var af=%_ArrayBufferGetByteLength(ac);
var ag;
if((ad===(void 0))){
ag=0;
}else{
ag=ad;
if(ag % 2!==0){
throw %make_range_error(169,
"start offset","Uint16Array",2);
}
}
var ah;
if((ae===(void 0))){
if(af % 2!==0){
throw %make_range_error(169,
"byte length","Uint16Array",2);
}
ah=af-ag;
if(ah<0){
throw %make_range_error(169,
"byte length","Uint16Array",2);
}
}else{
ah=ae*2;
if(ag+ah>af){
throw %make_range_error(171);
}
}
%_TypedArrayInitialize(ab,3,ac,ag,ah,true);
}
function Uint16ArrayConstructByLength(ab,ae){
var ai=(ae===(void 0))?
0:D(ae,171);
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var aj=ai*2;
if(aj>%_TypedArrayMaxSizeInHeap()){
var ac=new h(aj);
%_TypedArrayInitialize(ab,3,ac,0,aj,true);
}else{
%_TypedArrayInitialize(ab,3,null,0,aj,true);
}
}
function Uint16ArrayConstructByArrayLike(ab,ak,ae){
var ai=C(ae,171);
if(ai>%_MaxSmi()){
throw %make_range_error(171);
}
var al=false;
var aj=ai*2;
if(aj<=%_TypedArrayMaxSizeInHeap()){
%_TypedArrayInitialize(ab,3,null,0,aj,false);
}else{
al=
%TypedArrayInitializeFromArrayLike(ab,3,ak,ai);
}
if(!al){
for(var am=0;am<ai;am++){
ab[am]=ak[am];
}
}
}
function Uint16ArrayConstructByIterable(ab,an,ao){
var ap=new x();
var aq=%_Call(ao,an);
var ar={
__proto__:null
};
ar[E]=function(){return aq;}
for(var as of ar){
ap.push(as);
}
Uint16ArrayConstructByArrayLike(ab,ap,ap.length);
}
function Uint16ArrayConstructByTypedArray(ab,S){
var at=%TypedArrayGetBuffer(S);
var ae=%_TypedArrayGetLength(S);
var aj=%_ArrayBufferViewGetByteLength(S);
var ah=ae*2;
Uint16ArrayConstructByArrayLike(ab,S,ae);
var au=B(at,h);
var av=au.prototype;
if((%_IsJSReceiver(av))&&av!==i){
%InternalSetPrototype(%TypedArrayGetBuffer(ab),av);
}
}
function Uint16ArrayConstructor(V,W,aw){
if(!(new.target===(void 0))){
if((%_ClassOf(V)==='ArrayBuffer')||(%_ClassOf(V)==='SharedArrayBuffer')){
Uint16ArrayConstructByArrayBuffer(this,V,W,aw);
}else if((%_IsTypedArray(V))){
Uint16ArrayConstructByTypedArray(this,V);
}else if((%_IsJSReceiver(V))){
var ao=V[E];
if((ao===(void 0))){
Uint16ArrayConstructByArrayLike(this,V,V.length);
}else{
Uint16ArrayConstructByIterable(this,V,ao);
}
}else{
Uint16ArrayConstructByLength(this,V);
}
}else{
throw %make_type_error(27,"Uint16Array")
}
}
function Uint16ArraySubArray(ax,ay){
var az=(%_ToInteger(ax));
if(!(ay===(void 0))){
var aA=(%_ToInteger(ay));
var aB=%_TypedArrayGetLength(this);
}else{
var aB=%_TypedArrayGetLength(this);
var aA=aB;
}
if(az<0){
az=y(0,aB+az);
}else{
az=z(az,aB);
}
if(aA<0){
aA=y(0,aB+aA);
}else{
aA=z(aA,aB);
}
if(aA<az){
aA=az;
}
var aC=aA-az;
var aD=
%_ArrayBufferViewGetByteOffset(this)+az*2;
return new J(%TypedArrayGetBuffer(this),aD,aC);
}

function Int16ArrayConstructByArrayBuffer(ab,ac,ad,ae){
if(!(ad===(void 0))){
ad=D(ad,171);
}
if(!(ae===(void 0))){
ae=D(ae,171);
}
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var af=%_ArrayBufferGetByteLength(ac);
var ag;
if((ad===(void 0))){
ag=0;
}else{
ag=ad;
if(ag % 2!==0){
throw %make_range_error(169,
"start offset","Int16Array",2);
}
}
var ah;
if((ae===(void 0))){
if(af % 2!==0){
throw %make_range_error(169,
"byte length","Int16Array",2);
}
ah=af-ag;
if(ah<0){
throw %make_range_error(169,
"byte length","Int16Array",2);
}
}else{
ah=ae*2;
if(ag+ah>af){
throw %make_range_error(171);
}
}
%_TypedArrayInitialize(ab,4,ac,ag,ah,true);
}
function Int16ArrayConstructByLength(ab,ae){
var ai=(ae===(void 0))?
0:D(ae,171);
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var aj=ai*2;
if(aj>%_TypedArrayMaxSizeInHeap()){
var ac=new h(aj);
%_TypedArrayInitialize(ab,4,ac,0,aj,true);
}else{
%_TypedArrayInitialize(ab,4,null,0,aj,true);
}
}
function Int16ArrayConstructByArrayLike(ab,ak,ae){
var ai=C(ae,171);
if(ai>%_MaxSmi()){
throw %make_range_error(171);
}
var al=false;
var aj=ai*2;
if(aj<=%_TypedArrayMaxSizeInHeap()){
%_TypedArrayInitialize(ab,4,null,0,aj,false);
}else{
al=
%TypedArrayInitializeFromArrayLike(ab,4,ak,ai);
}
if(!al){
for(var am=0;am<ai;am++){
ab[am]=ak[am];
}
}
}
function Int16ArrayConstructByIterable(ab,an,ao){
var ap=new x();
var aq=%_Call(ao,an);
var ar={
__proto__:null
};
ar[E]=function(){return aq;}
for(var as of ar){
ap.push(as);
}
Int16ArrayConstructByArrayLike(ab,ap,ap.length);
}
function Int16ArrayConstructByTypedArray(ab,S){
var at=%TypedArrayGetBuffer(S);
var ae=%_TypedArrayGetLength(S);
var aj=%_ArrayBufferViewGetByteLength(S);
var ah=ae*2;
Int16ArrayConstructByArrayLike(ab,S,ae);
var au=B(at,h);
var av=au.prototype;
if((%_IsJSReceiver(av))&&av!==i){
%InternalSetPrototype(%TypedArrayGetBuffer(ab),av);
}
}
function Int16ArrayConstructor(V,W,aw){
if(!(new.target===(void 0))){
if((%_ClassOf(V)==='ArrayBuffer')||(%_ClassOf(V)==='SharedArrayBuffer')){
Int16ArrayConstructByArrayBuffer(this,V,W,aw);
}else if((%_IsTypedArray(V))){
Int16ArrayConstructByTypedArray(this,V);
}else if((%_IsJSReceiver(V))){
var ao=V[E];
if((ao===(void 0))){
Int16ArrayConstructByArrayLike(this,V,V.length);
}else{
Int16ArrayConstructByIterable(this,V,ao);
}
}else{
Int16ArrayConstructByLength(this,V);
}
}else{
throw %make_type_error(27,"Int16Array")
}
}
function Int16ArraySubArray(ax,ay){
var az=(%_ToInteger(ax));
if(!(ay===(void 0))){
var aA=(%_ToInteger(ay));
var aB=%_TypedArrayGetLength(this);
}else{
var aB=%_TypedArrayGetLength(this);
var aA=aB;
}
if(az<0){
az=y(0,aB+az);
}else{
az=z(az,aB);
}
if(aA<0){
aA=y(0,aB+aA);
}else{
aA=z(aA,aB);
}
if(aA<az){
aA=az;
}
var aC=aA-az;
var aD=
%_ArrayBufferViewGetByteOffset(this)+az*2;
return new K(%TypedArrayGetBuffer(this),aD,aC);
}

function Uint32ArrayConstructByArrayBuffer(ab,ac,ad,ae){
if(!(ad===(void 0))){
ad=D(ad,171);
}
if(!(ae===(void 0))){
ae=D(ae,171);
}
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var af=%_ArrayBufferGetByteLength(ac);
var ag;
if((ad===(void 0))){
ag=0;
}else{
ag=ad;
if(ag % 4!==0){
throw %make_range_error(169,
"start offset","Uint32Array",4);
}
}
var ah;
if((ae===(void 0))){
if(af % 4!==0){
throw %make_range_error(169,
"byte length","Uint32Array",4);
}
ah=af-ag;
if(ah<0){
throw %make_range_error(169,
"byte length","Uint32Array",4);
}
}else{
ah=ae*4;
if(ag+ah>af){
throw %make_range_error(171);
}
}
%_TypedArrayInitialize(ab,5,ac,ag,ah,true);
}
function Uint32ArrayConstructByLength(ab,ae){
var ai=(ae===(void 0))?
0:D(ae,171);
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var aj=ai*4;
if(aj>%_TypedArrayMaxSizeInHeap()){
var ac=new h(aj);
%_TypedArrayInitialize(ab,5,ac,0,aj,true);
}else{
%_TypedArrayInitialize(ab,5,null,0,aj,true);
}
}
function Uint32ArrayConstructByArrayLike(ab,ak,ae){
var ai=C(ae,171);
if(ai>%_MaxSmi()){
throw %make_range_error(171);
}
var al=false;
var aj=ai*4;
if(aj<=%_TypedArrayMaxSizeInHeap()){
%_TypedArrayInitialize(ab,5,null,0,aj,false);
}else{
al=
%TypedArrayInitializeFromArrayLike(ab,5,ak,ai);
}
if(!al){
for(var am=0;am<ai;am++){
ab[am]=ak[am];
}
}
}
function Uint32ArrayConstructByIterable(ab,an,ao){
var ap=new x();
var aq=%_Call(ao,an);
var ar={
__proto__:null
};
ar[E]=function(){return aq;}
for(var as of ar){
ap.push(as);
}
Uint32ArrayConstructByArrayLike(ab,ap,ap.length);
}
function Uint32ArrayConstructByTypedArray(ab,S){
var at=%TypedArrayGetBuffer(S);
var ae=%_TypedArrayGetLength(S);
var aj=%_ArrayBufferViewGetByteLength(S);
var ah=ae*4;
Uint32ArrayConstructByArrayLike(ab,S,ae);
var au=B(at,h);
var av=au.prototype;
if((%_IsJSReceiver(av))&&av!==i){
%InternalSetPrototype(%TypedArrayGetBuffer(ab),av);
}
}
function Uint32ArrayConstructor(V,W,aw){
if(!(new.target===(void 0))){
if((%_ClassOf(V)==='ArrayBuffer')||(%_ClassOf(V)==='SharedArrayBuffer')){
Uint32ArrayConstructByArrayBuffer(this,V,W,aw);
}else if((%_IsTypedArray(V))){
Uint32ArrayConstructByTypedArray(this,V);
}else if((%_IsJSReceiver(V))){
var ao=V[E];
if((ao===(void 0))){
Uint32ArrayConstructByArrayLike(this,V,V.length);
}else{
Uint32ArrayConstructByIterable(this,V,ao);
}
}else{
Uint32ArrayConstructByLength(this,V);
}
}else{
throw %make_type_error(27,"Uint32Array")
}
}
function Uint32ArraySubArray(ax,ay){
var az=(%_ToInteger(ax));
if(!(ay===(void 0))){
var aA=(%_ToInteger(ay));
var aB=%_TypedArrayGetLength(this);
}else{
var aB=%_TypedArrayGetLength(this);
var aA=aB;
}
if(az<0){
az=y(0,aB+az);
}else{
az=z(az,aB);
}
if(aA<0){
aA=y(0,aB+aA);
}else{
aA=z(aA,aB);
}
if(aA<az){
aA=az;
}
var aC=aA-az;
var aD=
%_ArrayBufferViewGetByteOffset(this)+az*4;
return new L(%TypedArrayGetBuffer(this),aD,aC);
}

function Int32ArrayConstructByArrayBuffer(ab,ac,ad,ae){
if(!(ad===(void 0))){
ad=D(ad,171);
}
if(!(ae===(void 0))){
ae=D(ae,171);
}
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var af=%_ArrayBufferGetByteLength(ac);
var ag;
if((ad===(void 0))){
ag=0;
}else{
ag=ad;
if(ag % 4!==0){
throw %make_range_error(169,
"start offset","Int32Array",4);
}
}
var ah;
if((ae===(void 0))){
if(af % 4!==0){
throw %make_range_error(169,
"byte length","Int32Array",4);
}
ah=af-ag;
if(ah<0){
throw %make_range_error(169,
"byte length","Int32Array",4);
}
}else{
ah=ae*4;
if(ag+ah>af){
throw %make_range_error(171);
}
}
%_TypedArrayInitialize(ab,6,ac,ag,ah,true);
}
function Int32ArrayConstructByLength(ab,ae){
var ai=(ae===(void 0))?
0:D(ae,171);
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var aj=ai*4;
if(aj>%_TypedArrayMaxSizeInHeap()){
var ac=new h(aj);
%_TypedArrayInitialize(ab,6,ac,0,aj,true);
}else{
%_TypedArrayInitialize(ab,6,null,0,aj,true);
}
}
function Int32ArrayConstructByArrayLike(ab,ak,ae){
var ai=C(ae,171);
if(ai>%_MaxSmi()){
throw %make_range_error(171);
}
var al=false;
var aj=ai*4;
if(aj<=%_TypedArrayMaxSizeInHeap()){
%_TypedArrayInitialize(ab,6,null,0,aj,false);
}else{
al=
%TypedArrayInitializeFromArrayLike(ab,6,ak,ai);
}
if(!al){
for(var am=0;am<ai;am++){
ab[am]=ak[am];
}
}
}
function Int32ArrayConstructByIterable(ab,an,ao){
var ap=new x();
var aq=%_Call(ao,an);
var ar={
__proto__:null
};
ar[E]=function(){return aq;}
for(var as of ar){
ap.push(as);
}
Int32ArrayConstructByArrayLike(ab,ap,ap.length);
}
function Int32ArrayConstructByTypedArray(ab,S){
var at=%TypedArrayGetBuffer(S);
var ae=%_TypedArrayGetLength(S);
var aj=%_ArrayBufferViewGetByteLength(S);
var ah=ae*4;
Int32ArrayConstructByArrayLike(ab,S,ae);
var au=B(at,h);
var av=au.prototype;
if((%_IsJSReceiver(av))&&av!==i){
%InternalSetPrototype(%TypedArrayGetBuffer(ab),av);
}
}
function Int32ArrayConstructor(V,W,aw){
if(!(new.target===(void 0))){
if((%_ClassOf(V)==='ArrayBuffer')||(%_ClassOf(V)==='SharedArrayBuffer')){
Int32ArrayConstructByArrayBuffer(this,V,W,aw);
}else if((%_IsTypedArray(V))){
Int32ArrayConstructByTypedArray(this,V);
}else if((%_IsJSReceiver(V))){
var ao=V[E];
if((ao===(void 0))){
Int32ArrayConstructByArrayLike(this,V,V.length);
}else{
Int32ArrayConstructByIterable(this,V,ao);
}
}else{
Int32ArrayConstructByLength(this,V);
}
}else{
throw %make_type_error(27,"Int32Array")
}
}
function Int32ArraySubArray(ax,ay){
var az=(%_ToInteger(ax));
if(!(ay===(void 0))){
var aA=(%_ToInteger(ay));
var aB=%_TypedArrayGetLength(this);
}else{
var aB=%_TypedArrayGetLength(this);
var aA=aB;
}
if(az<0){
az=y(0,aB+az);
}else{
az=z(az,aB);
}
if(aA<0){
aA=y(0,aB+aA);
}else{
aA=z(aA,aB);
}
if(aA<az){
aA=az;
}
var aC=aA-az;
var aD=
%_ArrayBufferViewGetByteOffset(this)+az*4;
return new M(%TypedArrayGetBuffer(this),aD,aC);
}

function Float32ArrayConstructByArrayBuffer(ab,ac,ad,ae){
if(!(ad===(void 0))){
ad=D(ad,171);
}
if(!(ae===(void 0))){
ae=D(ae,171);
}
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var af=%_ArrayBufferGetByteLength(ac);
var ag;
if((ad===(void 0))){
ag=0;
}else{
ag=ad;
if(ag % 4!==0){
throw %make_range_error(169,
"start offset","Float32Array",4);
}
}
var ah;
if((ae===(void 0))){
if(af % 4!==0){
throw %make_range_error(169,
"byte length","Float32Array",4);
}
ah=af-ag;
if(ah<0){
throw %make_range_error(169,
"byte length","Float32Array",4);
}
}else{
ah=ae*4;
if(ag+ah>af){
throw %make_range_error(171);
}
}
%_TypedArrayInitialize(ab,7,ac,ag,ah,true);
}
function Float32ArrayConstructByLength(ab,ae){
var ai=(ae===(void 0))?
0:D(ae,171);
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var aj=ai*4;
if(aj>%_TypedArrayMaxSizeInHeap()){
var ac=new h(aj);
%_TypedArrayInitialize(ab,7,ac,0,aj,true);
}else{
%_TypedArrayInitialize(ab,7,null,0,aj,true);
}
}
function Float32ArrayConstructByArrayLike(ab,ak,ae){
var ai=C(ae,171);
if(ai>%_MaxSmi()){
throw %make_range_error(171);
}
var al=false;
var aj=ai*4;
if(aj<=%_TypedArrayMaxSizeInHeap()){
%_TypedArrayInitialize(ab,7,null,0,aj,false);
}else{
al=
%TypedArrayInitializeFromArrayLike(ab,7,ak,ai);
}
if(!al){
for(var am=0;am<ai;am++){
ab[am]=ak[am];
}
}
}
function Float32ArrayConstructByIterable(ab,an,ao){
var ap=new x();
var aq=%_Call(ao,an);
var ar={
__proto__:null
};
ar[E]=function(){return aq;}
for(var as of ar){
ap.push(as);
}
Float32ArrayConstructByArrayLike(ab,ap,ap.length);
}
function Float32ArrayConstructByTypedArray(ab,S){
var at=%TypedArrayGetBuffer(S);
var ae=%_TypedArrayGetLength(S);
var aj=%_ArrayBufferViewGetByteLength(S);
var ah=ae*4;
Float32ArrayConstructByArrayLike(ab,S,ae);
var au=B(at,h);
var av=au.prototype;
if((%_IsJSReceiver(av))&&av!==i){
%InternalSetPrototype(%TypedArrayGetBuffer(ab),av);
}
}
function Float32ArrayConstructor(V,W,aw){
if(!(new.target===(void 0))){
if((%_ClassOf(V)==='ArrayBuffer')||(%_ClassOf(V)==='SharedArrayBuffer')){
Float32ArrayConstructByArrayBuffer(this,V,W,aw);
}else if((%_IsTypedArray(V))){
Float32ArrayConstructByTypedArray(this,V);
}else if((%_IsJSReceiver(V))){
var ao=V[E];
if((ao===(void 0))){
Float32ArrayConstructByArrayLike(this,V,V.length);
}else{
Float32ArrayConstructByIterable(this,V,ao);
}
}else{
Float32ArrayConstructByLength(this,V);
}
}else{
throw %make_type_error(27,"Float32Array")
}
}
function Float32ArraySubArray(ax,ay){
var az=(%_ToInteger(ax));
if(!(ay===(void 0))){
var aA=(%_ToInteger(ay));
var aB=%_TypedArrayGetLength(this);
}else{
var aB=%_TypedArrayGetLength(this);
var aA=aB;
}
if(az<0){
az=y(0,aB+az);
}else{
az=z(az,aB);
}
if(aA<0){
aA=y(0,aB+aA);
}else{
aA=z(aA,aB);
}
if(aA<az){
aA=az;
}
var aC=aA-az;
var aD=
%_ArrayBufferViewGetByteOffset(this)+az*4;
return new N(%TypedArrayGetBuffer(this),aD,aC);
}

function Float64ArrayConstructByArrayBuffer(ab,ac,ad,ae){
if(!(ad===(void 0))){
ad=D(ad,171);
}
if(!(ae===(void 0))){
ae=D(ae,171);
}
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var af=%_ArrayBufferGetByteLength(ac);
var ag;
if((ad===(void 0))){
ag=0;
}else{
ag=ad;
if(ag % 8!==0){
throw %make_range_error(169,
"start offset","Float64Array",8);
}
}
var ah;
if((ae===(void 0))){
if(af % 8!==0){
throw %make_range_error(169,
"byte length","Float64Array",8);
}
ah=af-ag;
if(ah<0){
throw %make_range_error(169,
"byte length","Float64Array",8);
}
}else{
ah=ae*8;
if(ag+ah>af){
throw %make_range_error(171);
}
}
%_TypedArrayInitialize(ab,8,ac,ag,ah,true);
}
function Float64ArrayConstructByLength(ab,ae){
var ai=(ae===(void 0))?
0:D(ae,171);
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var aj=ai*8;
if(aj>%_TypedArrayMaxSizeInHeap()){
var ac=new h(aj);
%_TypedArrayInitialize(ab,8,ac,0,aj,true);
}else{
%_TypedArrayInitialize(ab,8,null,0,aj,true);
}
}
function Float64ArrayConstructByArrayLike(ab,ak,ae){
var ai=C(ae,171);
if(ai>%_MaxSmi()){
throw %make_range_error(171);
}
var al=false;
var aj=ai*8;
if(aj<=%_TypedArrayMaxSizeInHeap()){
%_TypedArrayInitialize(ab,8,null,0,aj,false);
}else{
al=
%TypedArrayInitializeFromArrayLike(ab,8,ak,ai);
}
if(!al){
for(var am=0;am<ai;am++){
ab[am]=ak[am];
}
}
}
function Float64ArrayConstructByIterable(ab,an,ao){
var ap=new x();
var aq=%_Call(ao,an);
var ar={
__proto__:null
};
ar[E]=function(){return aq;}
for(var as of ar){
ap.push(as);
}
Float64ArrayConstructByArrayLike(ab,ap,ap.length);
}
function Float64ArrayConstructByTypedArray(ab,S){
var at=%TypedArrayGetBuffer(S);
var ae=%_TypedArrayGetLength(S);
var aj=%_ArrayBufferViewGetByteLength(S);
var ah=ae*8;
Float64ArrayConstructByArrayLike(ab,S,ae);
var au=B(at,h);
var av=au.prototype;
if((%_IsJSReceiver(av))&&av!==i){
%InternalSetPrototype(%TypedArrayGetBuffer(ab),av);
}
}
function Float64ArrayConstructor(V,W,aw){
if(!(new.target===(void 0))){
if((%_ClassOf(V)==='ArrayBuffer')||(%_ClassOf(V)==='SharedArrayBuffer')){
Float64ArrayConstructByArrayBuffer(this,V,W,aw);
}else if((%_IsTypedArray(V))){
Float64ArrayConstructByTypedArray(this,V);
}else if((%_IsJSReceiver(V))){
var ao=V[E];
if((ao===(void 0))){
Float64ArrayConstructByArrayLike(this,V,V.length);
}else{
Float64ArrayConstructByIterable(this,V,ao);
}
}else{
Float64ArrayConstructByLength(this,V);
}
}else{
throw %make_type_error(27,"Float64Array")
}
}
function Float64ArraySubArray(ax,ay){
var az=(%_ToInteger(ax));
if(!(ay===(void 0))){
var aA=(%_ToInteger(ay));
var aB=%_TypedArrayGetLength(this);
}else{
var aB=%_TypedArrayGetLength(this);
var aA=aB;
}
if(az<0){
az=y(0,aB+az);
}else{
az=z(az,aB);
}
if(aA<0){
aA=y(0,aB+aA);
}else{
aA=z(aA,aB);
}
if(aA<az){
aA=az;
}
var aC=aA-az;
var aD=
%_ArrayBufferViewGetByteOffset(this)+az*8;
return new O(%TypedArrayGetBuffer(this),aD,aC);
}

function Uint8ClampedArrayConstructByArrayBuffer(ab,ac,ad,ae){
if(!(ad===(void 0))){
ad=D(ad,171);
}
if(!(ae===(void 0))){
ae=D(ae,171);
}
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var af=%_ArrayBufferGetByteLength(ac);
var ag;
if((ad===(void 0))){
ag=0;
}else{
ag=ad;
if(ag % 1!==0){
throw %make_range_error(169,
"start offset","Uint8ClampedArray",1);
}
}
var ah;
if((ae===(void 0))){
if(af % 1!==0){
throw %make_range_error(169,
"byte length","Uint8ClampedArray",1);
}
ah=af-ag;
if(ah<0){
throw %make_range_error(169,
"byte length","Uint8ClampedArray",1);
}
}else{
ah=ae*1;
if(ag+ah>af){
throw %make_range_error(171);
}
}
%_TypedArrayInitialize(ab,9,ac,ag,ah,true);
}
function Uint8ClampedArrayConstructByLength(ab,ae){
var ai=(ae===(void 0))?
0:D(ae,171);
if(ae>%_MaxSmi()){
throw %make_range_error(171);
}
var aj=ai*1;
if(aj>%_TypedArrayMaxSizeInHeap()){
var ac=new h(aj);
%_TypedArrayInitialize(ab,9,ac,0,aj,true);
}else{
%_TypedArrayInitialize(ab,9,null,0,aj,true);
}
}
function Uint8ClampedArrayConstructByArrayLike(ab,ak,ae){
var ai=C(ae,171);
if(ai>%_MaxSmi()){
throw %make_range_error(171);
}
var al=false;
var aj=ai*1;
if(aj<=%_TypedArrayMaxSizeInHeap()){
%_TypedArrayInitialize(ab,9,null,0,aj,false);
}else{
al=
%TypedArrayInitializeFromArrayLike(ab,9,ak,ai);
}
if(!al){
for(var am=0;am<ai;am++){
ab[am]=ak[am];
}
}
}
function Uint8ClampedArrayConstructByIterable(ab,an,ao){
var ap=new x();
var aq=%_Call(ao,an);
var ar={
__proto__:null
};
ar[E]=function(){return aq;}
for(var as of ar){
ap.push(as);
}
Uint8ClampedArrayConstructByArrayLike(ab,ap,ap.length);
}
function Uint8ClampedArrayConstructByTypedArray(ab,S){
var at=%TypedArrayGetBuffer(S);
var ae=%_TypedArrayGetLength(S);
var aj=%_ArrayBufferViewGetByteLength(S);
var ah=ae*1;
Uint8ClampedArrayConstructByArrayLike(ab,S,ae);
var au=B(at,h);
var av=au.prototype;
if((%_IsJSReceiver(av))&&av!==i){
%InternalSetPrototype(%TypedArrayGetBuffer(ab),av);
}
}
function Uint8ClampedArrayConstructor(V,W,aw){
if(!(new.target===(void 0))){
if((%_ClassOf(V)==='ArrayBuffer')||(%_ClassOf(V)==='SharedArrayBuffer')){
Uint8ClampedArrayConstructByArrayBuffer(this,V,W,aw);
}else if((%_IsTypedArray(V))){
Uint8ClampedArrayConstructByTypedArray(this,V);
}else if((%_IsJSReceiver(V))){
var ao=V[E];
if((ao===(void 0))){
Uint8ClampedArrayConstructByArrayLike(this,V,V.length);
}else{
Uint8ClampedArrayConstructByIterable(this,V,ao);
}
}else{
Uint8ClampedArrayConstructByLength(this,V);
}
}else{
throw %make_type_error(27,"Uint8ClampedArray")
}
}
function Uint8ClampedArraySubArray(ax,ay){
var az=(%_ToInteger(ax));
if(!(ay===(void 0))){
var aA=(%_ToInteger(ay));
var aB=%_TypedArrayGetLength(this);
}else{
var aB=%_TypedArrayGetLength(this);
var aA=aB;
}
if(az<0){
az=y(0,aB+az);
}else{
az=z(az,aB);
}
if(aA<0){
aA=y(0,aB+aA);
}else{
aA=z(aA,aB);
}
if(aA<az){
aA=az;
}
var aC=aA-az;
var aD=
%_ArrayBufferViewGetByteOffset(this)+az*1;
return new P(%TypedArrayGetBuffer(this),aD,aC);
}


function TypedArraySubArray(ax,ay){
switch(%_ClassOf(this)){
case"Uint8Array":
return %_Call(Uint8ArraySubArray,this,ax,ay);

case"Int8Array":
return %_Call(Int8ArraySubArray,this,ax,ay);

case"Uint16Array":
return %_Call(Uint16ArraySubArray,this,ax,ay);

case"Int16Array":
return %_Call(Int16ArraySubArray,this,ax,ay);

case"Uint32Array":
return %_Call(Uint32ArraySubArray,this,ax,ay);

case"Int32Array":
return %_Call(Int32ArraySubArray,this,ax,ay);

case"Float32Array":
return %_Call(Float32ArraySubArray,this,ax,ay);

case"Float64Array":
return %_Call(Float64ArraySubArray,this,ax,ay);

case"Uint8ClampedArray":
return %_Call(Uint8ClampedArraySubArray,this,ax,ay);


}
throw %make_type_error(45,
"get TypedArray.prototype.subarray",this);
}
%SetForceInlineFlag(TypedArraySubArray);
function TypedArraySetFromArrayLike(aE,aF,aG,ag){
if(ag>0){
for(var am=0;am<aG;am++){
aE[ag+am]=aF[am];
}
}
else{
for(var am=0;am<aG;am++){
aE[am]=aF[am];
}
}
}
function TypedArraySetFromOverlappingTypedArray(aE,aF,ag){
var aH=aF.BYTES_PER_ELEMENT;
var aI=aE.BYTES_PER_ELEMENT;
var aG=%_TypedArrayGetLength(aF);
function CopyLeftPart(){
var aJ=aE.byteOffset+(ag+1)*aI;
var aK=aF.byteOffset;
for(var aL=0;
aL<aG&&aJ<=aK;
aL++){
aE[ag+aL]=aF[aL];
aJ+=aI;
aK+=aH;
}
return aL;
}
var aL=CopyLeftPart();
function CopyRightPart(){
var aJ=
aE.byteOffset+(ag+aG-1)*aI;
var aK=
aF.byteOffset+aG*aH;
for(var aM=aG-1;
aM>=aL&&aJ>=aK;
aM--){
aE[ag+aM]=aF[aM];
aJ-=aI;
aK-=aH;
}
return aM;
}
var aM=CopyRightPart();
var aN=new g(aM+1-aL);
for(var am=aL;am<=aM;am++){
aN[am-aL]=aF[am];
}
for(am=aL;am<=aM;am++){
aE[ag+am]=aN[am-aL];
}
}
function TypedArraySet(ab,ag){
var aO=(ag===(void 0))?0:(%_ToInteger(ag));
if(aO<0)throw %make_type_error(182);
if(aO>%_MaxSmi()){
throw %make_range_error(183);
}
switch(%TypedArraySetFastCases(this,ab,aO)){
case 0:
return;
case 1:
TypedArraySetFromOverlappingTypedArray(this,ab,aO);
return;
case 2:
TypedArraySetFromArrayLike(this,
ab,%_TypedArrayGetLength(ab),aO);
return;
case 3:
var ai=ab.length;
if((ai===(void 0))){
if((typeof(ab)==='number')){
throw %make_type_error(47);
}
return;
}
ai=(%_ToLength(ai));
if(aO+ai>%_TypedArrayGetLength(this)){
throw %make_range_error(183);
}
TypedArraySetFromArrayLike(this,ab,ai,aO);
return;
}
}
%FunctionSetLength(TypedArraySet,1);
function TypedArrayGetToStringTag(){
if(!(%_IsTypedArray(this)))return;
var aP=%_ClassOf(this);
if((aP===(void 0)))return;
return aP;
}
function TypedArrayCopyWithin(aE,aQ,ay){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
return k(aE,aQ,ay,this,ae);
}
%FunctionSetLength(TypedArrayCopyWithin,2);
function TypedArrayEvery(aR,aS){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
return l(aR,aS,this,ae);
}
%FunctionSetLength(TypedArrayEvery,1);
function TypedArrayForEach(aR,aS){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
q(aR,aS,this,ae);
}
%FunctionSetLength(TypedArrayForEach,1);
function TypedArrayFill(as,aQ,ay){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
return m(as,aQ,ay,this,ae);
}
%FunctionSetLength(TypedArrayFill,1);
function TypedArrayFilter(aR,aT){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
if(!(typeof(aR)==='function'))throw %make_type_error(15,aR);
var aU=new x();
n(aR,aT,this,ae,aU);
var aV=aU.length;
var aW=TypedArraySpeciesCreate(this,aV);
for(var am=0;am<aV;am++){
aW[am]=aU[am];
}
return aW;
}
%FunctionSetLength(TypedArrayFilter,1);
function TypedArrayFind(aX,aT){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
return o(aX,aT,this,ae);
}
%FunctionSetLength(TypedArrayFind,1);
function TypedArrayFindIndex(aX,aT){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
return p(aX,aT,this,ae);
}
%FunctionSetLength(TypedArrayFindIndex,1);
function TypedArrayReverse(){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
return A(this,ae);
}
function TypedArrayComparefn(aY,aZ){
if(aY===0&&aY===aZ){
aY=1/aY;
aZ=1/aZ;
}
if(aY<aZ){
return-1;
}else if(aY>aZ){
return 1;
}else if((!%_IsSmi(%IS_VAR(aY))&&!(aY==aY))&&(!%_IsSmi(%IS_VAR(aZ))&&!(aZ==aZ))){
return(!%_IsSmi(%IS_VAR(aZ))&&!(aZ==aZ))?0:1;
}else if((!%_IsSmi(%IS_VAR(aY))&&!(aY==aY))){
return 1;
}
return 0;
}
function TypedArraySort(ba){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
if((ba===(void 0))){
ba=TypedArrayComparefn;
}
return v(this,ae,ba);
}
function TypedArrayIndexOf(bb,bc){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
if(ae===0)return-1;
if(!(typeof(bb)==='number'))return-1;
var bd=(%_ToInteger(bc));
var be;
if(bd===0){
be=0;
}else if(bd>0){
be=bd;
}else{
be=ae+bd;
if(be<0){
be=0;
}
}
while(be<ae){
var bf=this[be];
if(bb===bf){
return be;
}
++be;
}
return-1;
}
%FunctionSetLength(TypedArrayIndexOf,1);
function TypedArrayLastIndexOf(bb,bc){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
if(ae===0)return-1;
if(!(typeof(bb)==='number'))return-1;
var bd;
if(arguments.length<2){
bd=ae-1;
}else{
bd=(%_ToInteger(bc));
}
var be;
if(bd>=0){
if(ae<=bd){
be=ae-1;
}else if(bd===0){
be=0;
}else{
be=bd;
}
}else{
be=ae+bd;
}
while(be>=0){
var bf=this[be];
if(bb===bf){
return be;
}
--be;
}
return-1;
}
%FunctionSetLength(TypedArrayLastIndexOf,1);
function TypedArrayMap(aR,aT){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
var aU=TypedArraySpeciesCreate(this,ae);
if(!(typeof(aR)==='function'))throw %make_type_error(15,aR);
for(var am=0;am<ae;am++){
var bb=this[am];
aU[am]=%_Call(aR,aT,bb,am,this);
}
return aU;
}
%FunctionSetLength(TypedArrayMap,1);
function TypedArraySome(aR,aS){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
return u(aR,aS,this,ae);
}
%FunctionSetLength(TypedArraySome,1);
function TypedArrayToLocaleString(){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
return w(this,ae);
}
function TypedArrayJoin(bg){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
return r(bg,this,ae);
}
function TypedArrayReduce(bh,bi){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
return s(bh,bi,this,ae,
arguments.length);
}
%FunctionSetLength(TypedArrayReduce,1);
function TypedArrayReduceRight(bh,bi){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
return t(bh,bi,this,ae,
arguments.length);
}
%FunctionSetLength(TypedArrayReduceRight,1);
function TypedArraySlice(aQ,ay){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var bj=%_TypedArrayGetLength(this);
var bk=(%_ToInteger(aQ));
var be;
if(bk<0){
be=y(bj+bk,0);
}else{
be=z(bk,bj);
}
var bl;
if((ay===(void 0))){
bl=bj;
}else{
bl=(%_ToInteger(ay));
}
var bm;
if(bl<0){
bm=y(bj+bl,0);
}else{
bm=z(bl,bj);
}
var bn=y(bm-be,0);
var bo=TypedArraySpeciesCreate(this,bn);
var bd=0;
while(be<bm){
var bp=this[be];
bo[bd]=bp;
be++;
bd++;
}
return bo;
}
function TypedArrayIncludes(bq,br){
if(!(%_IsTypedArray(this)))throw %make_type_error(73);
var ae=%_TypedArrayGetLength(this);
if(ae===0)return false;
var bd=(%_ToInteger(br));
var be;
if(bd>=0){
be=bd;
}else{
be=ae+bd;
if(be<0){
be=0;
}
}
while(be<ae){
var bf=this[be];
if(%SameValueZero(bq,bf)){
return true;
}
++be;
}
return false;
}
%FunctionSetLength(TypedArrayIncludes,1);
function TypedArrayOf(){
var ae=arguments.length;
var bo=TypedArrayCreate(this,ae);
for(var am=0;am<ae;am++){
bo[am]=arguments[am];
}
return bo;
}
function IterableToArrayLike(bs){
var an=f(bs,E);
if(!(an===(void 0))){
var bt=new x();
var am=0;
for(var as of
{[E](){return e(bs,an)}}){
bt[am]=as;
am++;
}
var bo=[];
%MoveArrayContents(bt,bo);
return bo;
}
return(%_ToObject(bs));
}
function TypedArrayFrom(aF,bu,aT){
if(!%IsConstructor(this))throw %make_type_error(67,this);
var bv;
if(!(bu===(void 0))){
if(!(typeof(bu)==='function'))throw %make_type_error(15,this);
bv=true;
}else{
bv=false;
}
var ak=IterableToArrayLike(aF);
var ae=(%_ToLength(ak.length));
var bw=TypedArrayCreate(this,ae);
var as,bx;
for(var am=0;am<ae;am++){
as=ak[am];
if(bv){
bx=%_Call(bu,aT,as,am);
}else{
bx=as;
}
bw[am]=bx;
}
return bw;
}
%FunctionSetLength(TypedArrayFrom,1);
function TypedArrayConstructor(){
if((new.target===(void 0))){
throw %make_type_error(26,"TypedArray");
}
if(new.target===Q){
throw %make_type_error(24,"TypedArray");
}
}
function TypedArraySpecies(){
return this;
}
%SetCode(Q,TypedArrayConstructor);
b.InstallFunctions(Q,2,[
"from",TypedArrayFrom,
"of",TypedArrayOf
]);
b.InstallGetter(Q,F,TypedArraySpecies);
b.InstallGetter(Q.prototype,G,
TypedArrayGetToStringTag);
b.InstallFunctions(Q.prototype,2,[
"subarray",TypedArraySubArray,
"set",TypedArraySet,
"copyWithin",TypedArrayCopyWithin,
"every",TypedArrayEvery,
"fill",TypedArrayFill,
"filter",TypedArrayFilter,
"find",TypedArrayFind,
"findIndex",TypedArrayFindIndex,
"includes",TypedArrayIncludes,
"indexOf",TypedArrayIndexOf,
"join",TypedArrayJoin,
"lastIndexOf",TypedArrayLastIndexOf,
"forEach",TypedArrayForEach,
"map",TypedArrayMap,
"reduce",TypedArrayReduce,
"reduceRight",TypedArrayReduceRight,
"reverse",TypedArrayReverse,
"slice",TypedArraySlice,
"some",TypedArraySome,
"sort",TypedArraySort,
"toLocaleString",TypedArrayToLocaleString
]);
%AddNamedProperty(Q.prototype,"toString",c,
2);
%SetCode(H,Uint8ArrayConstructor);
%FunctionSetPrototype(H,new j());
%InternalSetPrototype(H,Q);
%InternalSetPrototype(H.prototype,Q.prototype);
%AddNamedProperty(H,"BYTES_PER_ELEMENT",1,
1|2|4);
%AddNamedProperty(H.prototype,
"constructor",a.Uint8Array,2);
%AddNamedProperty(H.prototype,
"BYTES_PER_ELEMENT",1,
1|2|4);

%SetCode(I,Int8ArrayConstructor);
%FunctionSetPrototype(I,new j());
%InternalSetPrototype(I,Q);
%InternalSetPrototype(I.prototype,Q.prototype);
%AddNamedProperty(I,"BYTES_PER_ELEMENT",1,
1|2|4);
%AddNamedProperty(I.prototype,
"constructor",a.Int8Array,2);
%AddNamedProperty(I.prototype,
"BYTES_PER_ELEMENT",1,
1|2|4);

%SetCode(J,Uint16ArrayConstructor);
%FunctionSetPrototype(J,new j());
%InternalSetPrototype(J,Q);
%InternalSetPrototype(J.prototype,Q.prototype);
%AddNamedProperty(J,"BYTES_PER_ELEMENT",2,
1|2|4);
%AddNamedProperty(J.prototype,
"constructor",a.Uint16Array,2);
%AddNamedProperty(J.prototype,
"BYTES_PER_ELEMENT",2,
1|2|4);

%SetCode(K,Int16ArrayConstructor);
%FunctionSetPrototype(K,new j());
%InternalSetPrototype(K,Q);
%InternalSetPrototype(K.prototype,Q.prototype);
%AddNamedProperty(K,"BYTES_PER_ELEMENT",2,
1|2|4);
%AddNamedProperty(K.prototype,
"constructor",a.Int16Array,2);
%AddNamedProperty(K.prototype,
"BYTES_PER_ELEMENT",2,
1|2|4);

%SetCode(L,Uint32ArrayConstructor);
%FunctionSetPrototype(L,new j());
%InternalSetPrototype(L,Q);
%InternalSetPrototype(L.prototype,Q.prototype);
%AddNamedProperty(L,"BYTES_PER_ELEMENT",4,
1|2|4);
%AddNamedProperty(L.prototype,
"constructor",a.Uint32Array,2);
%AddNamedProperty(L.prototype,
"BYTES_PER_ELEMENT",4,
1|2|4);

%SetCode(M,Int32ArrayConstructor);
%FunctionSetPrototype(M,new j());
%InternalSetPrototype(M,Q);
%InternalSetPrototype(M.prototype,Q.prototype);
%AddNamedProperty(M,"BYTES_PER_ELEMENT",4,
1|2|4);
%AddNamedProperty(M.prototype,
"constructor",a.Int32Array,2);
%AddNamedProperty(M.prototype,
"BYTES_PER_ELEMENT",4,
1|2|4);

%SetCode(N,Float32ArrayConstructor);
%FunctionSetPrototype(N,new j());
%InternalSetPrototype(N,Q);
%InternalSetPrototype(N.prototype,Q.prototype);
%AddNamedProperty(N,"BYTES_PER_ELEMENT",4,
1|2|4);
%AddNamedProperty(N.prototype,
"constructor",a.Float32Array,2);
%AddNamedProperty(N.prototype,
"BYTES_PER_ELEMENT",4,
1|2|4);

%SetCode(O,Float64ArrayConstructor);
%FunctionSetPrototype(O,new j());
%InternalSetPrototype(O,Q);
%InternalSetPrototype(O.prototype,Q.prototype);
%AddNamedProperty(O,"BYTES_PER_ELEMENT",8,
1|2|4);
%AddNamedProperty(O.prototype,
"constructor",a.Float64Array,2);
%AddNamedProperty(O.prototype,
"BYTES_PER_ELEMENT",8,
1|2|4);

%SetCode(P,Uint8ClampedArrayConstructor);
%FunctionSetPrototype(P,new j());
%InternalSetPrototype(P,Q);
%InternalSetPrototype(P.prototype,Q.prototype);
%AddNamedProperty(P,"BYTES_PER_ELEMENT",1,
1|2|4);
%AddNamedProperty(P.prototype,
"constructor",a.Uint8ClampedArray,2);
%AddNamedProperty(P.prototype,
"BYTES_PER_ELEMENT",1,
1|2|4);


})

(collectionŸÖ
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c=a.Map;
var d=a.Object;
var e=a.Set;
var f=b.ImportNow("hash_code_symbol");
var g=a.Math.random;
var h;
var i;
var j=b.ImportNow("species_symbol");
var k=b.ImportNow("to_string_tag_symbol");
b.Import(function(l){
h=l.MapIterator;
i=l.SetIterator;
});
function HashToEntry(m,n,o){
var p=(n&((o)-1));
return((%_FixedArrayGet(m,(3+(p))|0)));
}
%SetForceInlineFlag(HashToEntry);
function SetFindEntry(m,o,q,n){
var r=HashToEntry(m,n,o);
if(r===-1)return r;
var s=((%_FixedArrayGet(m,((3+(o)+((r)<<1)))|0)));
if(q===s)return r;
var t=(!%_IsSmi(%IS_VAR(q))&&!(q==q));
while(true){
if(t&&(!%_IsSmi(%IS_VAR(s))&&!(s==s))){
return r;
}
r=((%_FixedArrayGet(m,((3+(o)+((r)<<1))+1)|0)));
if(r===-1)return r;
s=((%_FixedArrayGet(m,((3+(o)+((r)<<1)))|0)));
if(q===s)return r;
}
return-1;
}
%SetForceInlineFlag(SetFindEntry);
function MapFindEntry(m,o,q,n){
var r=HashToEntry(m,n,o);
if(r===-1)return r;
var s=((%_FixedArrayGet(m,((3+(o)+((r)*3)))|0)));
if(q===s)return r;
var t=(!%_IsSmi(%IS_VAR(q))&&!(q==q));
while(true){
if(t&&(!%_IsSmi(%IS_VAR(s))&&!(s==s))){
return r;
}
r=((%_FixedArrayGet(m,((3+(o)+((r)*3))+2)|0)));
if(r===-1)return r;
s=((%_FixedArrayGet(m,((3+(o)+((r)*3)))|0)));
if(q===s)return r;
}
return-1;
}
%SetForceInlineFlag(MapFindEntry);
function ComputeIntegerHash(q,u){
var n=q;
n=n^u;
n=~n+(n<<15);
n=n^(n>>>12);
n=n+(n<<2);
n=n^(n>>>4);
n=(n*2057)|0;
n=n^(n>>>16);
return n&0x3fffffff;
}
%SetForceInlineFlag(ComputeIntegerHash);
function GetExistingHash(q){
if(%_IsSmi(q)){
return ComputeIntegerHash(q,0);
}
if((typeof(q)==='string')){
var v=%_StringGetRawHashField(q);
if((v&1)===0){
return v>>>2;
}
}else if((%_IsJSReceiver(q))&&!(%_IsJSProxy(q))&&!(%_ClassOf(q)==='global')){
var n=(q[f]);
return n;
}
return %GenericHash(q);
}
%SetForceInlineFlag(GetExistingHash);
function GetHash(q){
var n=GetExistingHash(q);
if((n===(void 0))){
n=(g()*0x40000000)|0;
if(n===0)n=1;
(q[f]=n);
}
return n;
}
%SetForceInlineFlag(GetHash);
function SetConstructor(w){
if((new.target===(void 0))){
throw %make_type_error(27,"Set");
}
%_SetInitialize(this);
if(!(w==null)){
var x=this.add;
if(!(typeof(x)==='function')){
throw %make_type_error(87,x,'add',this);
}
for(var y of w){
%_Call(x,this,y);
}
}
}
function SetAdd(q){
if(!(%_ClassOf(this)==='Set')){
throw %make_type_error(45,'Set.prototype.add',this);
}
if(q===0){
q=0;
}
var m=%_JSCollectionGetTable(this);
var o=((%_FixedArrayGet(m,(0)|0)));
var n=GetHash(q);
if(SetFindEntry(m,o,q,n)!==-1)return this;
var z=((%_FixedArrayGet(m,(1)|0)));
var A=((%_FixedArrayGet(m,(2)|0)));
var B=o<<1;
if((z+A)>=B){
%SetGrow(this);
m=%_JSCollectionGetTable(this);
o=((%_FixedArrayGet(m,(0)|0)));
z=((%_FixedArrayGet(m,(1)|0)));
A=((%_FixedArrayGet(m,(2)|0)));
}
var r=z+A;
var C=(3+(o)+((r)<<1));
var p=(n&((o)-1));
var D=((%_FixedArrayGet(m,(3+(p))|0)));
((%_FixedArraySet(m,(3+(p))|0,r)));
(((%_FixedArraySet(m,(1)|0,(z+1)|0))));
(%_FixedArraySet(m,(C)|0,q));
((%_FixedArraySet(m,(C+1)|0,(D)|0)));
return this;
}
function SetHas(q){
if(!(%_ClassOf(this)==='Set')){
throw %make_type_error(45,'Set.prototype.has',this);
}
var m=%_JSCollectionGetTable(this);
var o=((%_FixedArrayGet(m,(0)|0)));
var n=GetExistingHash(q);
if((n===(void 0)))return false;
return SetFindEntry(m,o,q,n)!==-1;
}
function SetDelete(q){
if(!(%_ClassOf(this)==='Set')){
throw %make_type_error(45,
'Set.prototype.delete',this);
}
var m=%_JSCollectionGetTable(this);
var o=((%_FixedArrayGet(m,(0)|0)));
var n=GetExistingHash(q);
if((n===(void 0)))return false;
var r=SetFindEntry(m,o,q,n);
if(r===-1)return false;
var z=((%_FixedArrayGet(m,(1)|0)))-1;
var A=((%_FixedArrayGet(m,(2)|0)))+1;
var C=(3+(o)+((r)<<1));
(%_FixedArraySet(m,(C)|0,%_TheHole()));
(((%_FixedArraySet(m,(1)|0,(z)|0))));
(((%_FixedArraySet(m,(2)|0,(A)|0))));
if(z<(o>>>1))%SetShrink(this);
return true;
}
function SetGetSize(){
if(!(%_ClassOf(this)==='Set')){
throw %make_type_error(45,
'Set.prototype.size',this);
}
var m=%_JSCollectionGetTable(this);
return((%_FixedArrayGet(m,(1)|0)));
}
function SetClearJS(){
if(!(%_ClassOf(this)==='Set')){
throw %make_type_error(45,
'Set.prototype.clear',this);
}
%_SetClear(this);
}
function SetForEach(E,F){
if(!(%_ClassOf(this)==='Set')){
throw %make_type_error(45,
'Set.prototype.forEach',this);
}
if(!(typeof(E)==='function'))throw %make_type_error(15,E);
var G=new i(this,2);
var q;
var H=[(void 0)];
while(%SetIteratorNext(G,H)){
q=H[0];
%_Call(E,F,q,q,this);
}
}
function SetSpecies(){
return this;
}
%SetCode(e,SetConstructor);
%FunctionSetLength(e,0);
%FunctionSetPrototype(e,new d());
%AddNamedProperty(e.prototype,"constructor",e,2);
%AddNamedProperty(e.prototype,k,"Set",
2|1);
%FunctionSetLength(SetForEach,1);
b.InstallGetter(e,j,SetSpecies);
b.InstallGetter(e.prototype,"size",SetGetSize);
b.InstallFunctions(e.prototype,2,[
"add",SetAdd,
"has",SetHas,
"delete",SetDelete,
"clear",SetClearJS,
"forEach",SetForEach
]);
function MapConstructor(w){
if((new.target===(void 0))){
throw %make_type_error(27,"Map");
}
%_MapInitialize(this);
if(!(w==null)){
var x=this.set;
if(!(typeof(x)==='function')){
throw %make_type_error(87,x,'set',this);
}
for(var I of w){
if(!(%_IsJSReceiver(I))){
throw %make_type_error(52,I);
}
%_Call(x,this,I[0],I[1]);
}
}
}
function MapGet(q){
if(!(%_ClassOf(this)==='Map')){
throw %make_type_error(45,
'Map.prototype.get',this);
}
var m=%_JSCollectionGetTable(this);
var o=((%_FixedArrayGet(m,(0)|0)));
var n=GetExistingHash(q);
if((n===(void 0)))return(void 0);
var r=MapFindEntry(m,o,q,n);
if(r===-1)return(void 0);
return((%_FixedArrayGet(m,((3+(o)+((r)*3))+1)|0)));
}
function MapSet(q,y){
if(!(%_ClassOf(this)==='Map')){
throw %make_type_error(45,
'Map.prototype.set',this);
}
if(q===0){
q=0;
}
var m=%_JSCollectionGetTable(this);
var o=((%_FixedArrayGet(m,(0)|0)));
var n=GetHash(q);
var r=MapFindEntry(m,o,q,n);
if(r!==-1){
var J=(3+(o)+((r)*3));
(%_FixedArraySet(m,(J+1)|0,y));
return this;
}
var z=((%_FixedArrayGet(m,(1)|0)));
var A=((%_FixedArrayGet(m,(2)|0)));
var B=o<<1;
if((z+A)>=B){
%MapGrow(this);
m=%_JSCollectionGetTable(this);
o=((%_FixedArrayGet(m,(0)|0)));
z=((%_FixedArrayGet(m,(1)|0)));
A=((%_FixedArrayGet(m,(2)|0)));
}
r=z+A;
var C=(3+(o)+((r)*3));
var p=(n&((o)-1));
var D=((%_FixedArrayGet(m,(3+(p))|0)));
((%_FixedArraySet(m,(3+(p))|0,r)));
(((%_FixedArraySet(m,(1)|0,(z+1)|0))));
(%_FixedArraySet(m,(C)|0,q));
(%_FixedArraySet(m,(C+1)|0,y));
(%_FixedArraySet(m,(C+2)|0,D));
return this;
}
function MapHas(q){
if(!(%_ClassOf(this)==='Map')){
throw %make_type_error(45,
'Map.prototype.has',this);
}
var m=%_JSCollectionGetTable(this);
var o=((%_FixedArrayGet(m,(0)|0)));
var n=GetHash(q);
return MapFindEntry(m,o,q,n)!==-1;
}
function MapDelete(q){
if(!(%_ClassOf(this)==='Map')){
throw %make_type_error(45,
'Map.prototype.delete',this);
}
var m=%_JSCollectionGetTable(this);
var o=((%_FixedArrayGet(m,(0)|0)));
var n=GetHash(q);
var r=MapFindEntry(m,o,q,n);
if(r===-1)return false;
var z=((%_FixedArrayGet(m,(1)|0)))-1;
var A=((%_FixedArrayGet(m,(2)|0)))+1;
var C=(3+(o)+((r)*3));
(%_FixedArraySet(m,(C)|0,%_TheHole()));
(%_FixedArraySet(m,(C+1)|0,%_TheHole()));
(((%_FixedArraySet(m,(1)|0,(z)|0))));
(((%_FixedArraySet(m,(2)|0,(A)|0))));
if(z<(o>>>1))%MapShrink(this);
return true;
}
function MapGetSize(){
if(!(%_ClassOf(this)==='Map')){
throw %make_type_error(45,
'Map.prototype.size',this);
}
var m=%_JSCollectionGetTable(this);
return((%_FixedArrayGet(m,(1)|0)));
}
function MapClearJS(){
if(!(%_ClassOf(this)==='Map')){
throw %make_type_error(45,
'Map.prototype.clear',this);
}
%_MapClear(this);
}
function MapForEach(E,F){
if(!(%_ClassOf(this)==='Map')){
throw %make_type_error(45,
'Map.prototype.forEach',this);
}
if(!(typeof(E)==='function'))throw %make_type_error(15,E);
var G=new h(this,3);
var H=[(void 0),(void 0)];
while(%MapIteratorNext(G,H)){
%_Call(E,F,H[1],H[0],this);
}
}
function MapSpecies(){
return this;
}
%SetCode(c,MapConstructor);
%FunctionSetLength(c,0);
%FunctionSetPrototype(c,new d());
%AddNamedProperty(c.prototype,"constructor",c,2);
%AddNamedProperty(
c.prototype,k,"Map",2|1);
%FunctionSetLength(MapForEach,1);
b.InstallGetter(c,j,MapSpecies);
b.InstallGetter(c.prototype,"size",MapGetSize);
b.InstallFunctions(c.prototype,2,[
"get",MapGet,
"set",MapSet,
"has",MapHas,
"delete",MapDelete,
"clear",MapClearJS,
"forEach",MapForEach
]);
%InstallToContext([
"map_get",MapGet,
"map_set",MapSet,
"map_has",MapHas,
"map_delete",MapDelete,
"set_add",SetAdd,
"set_has",SetHas,
"set_delete",SetDelete,
]);
b.Export(function(K){
K.GetExistingHash=GetExistingHash;
K.GetHash=GetHash;
});
})

<weak-collectionµ0
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c;
var d;
var e=a.Object;
var f=a.WeakMap;
var g=a.WeakSet;
var h=b.ImportNow("to_string_tag_symbol");
b.Import(function(i){
c=i.GetExistingHash;
d=i.GetHash;
});
function WeakMapConstructor(j){
if((new.target===(void 0))){
throw %make_type_error(27,"WeakMap");
}
%WeakCollectionInitialize(this);
if(!(j==null)){
var k=this.set;
if(!(typeof(k)==='function')){
throw %make_type_error(87,k,'set',this);
}
for(var l of j){
if(!(%_IsJSReceiver(l))){
throw %make_type_error(52,l);
}
%_Call(k,this,l[0],l[1]);
}
}
}
function WeakMapGet(m){
if(!(%_ClassOf(this)==='WeakMap')){
throw %make_type_error(45,
'WeakMap.prototype.get',this);
}
if(!(%_IsJSReceiver(m)))return(void 0);
var n=c(m);
if((n===(void 0)))return(void 0);
return %WeakCollectionGet(this,m,n);
}
function WeakMapSet(m,o){
if(!(%_ClassOf(this)==='WeakMap')){
throw %make_type_error(45,
'WeakMap.prototype.set',this);
}
if(!(%_IsJSReceiver(m)))throw %make_type_error(165);
return %WeakCollectionSet(this,m,o,d(m));
}
function WeakMapHas(m){
if(!(%_ClassOf(this)==='WeakMap')){
throw %make_type_error(45,
'WeakMap.prototype.has',this);
}
if(!(%_IsJSReceiver(m)))return false;
var n=c(m);
if((n===(void 0)))return false;
return %WeakCollectionHas(this,m,n);
}
function WeakMapDelete(m){
if(!(%_ClassOf(this)==='WeakMap')){
throw %make_type_error(45,
'WeakMap.prototype.delete',this);
}
if(!(%_IsJSReceiver(m)))return false;
var n=c(m);
if((n===(void 0)))return false;
return %WeakCollectionDelete(this,m,n);
}
%SetCode(f,WeakMapConstructor);
%FunctionSetLength(f,0);
%FunctionSetPrototype(f,new e());
%AddNamedProperty(f.prototype,"constructor",f,
2);
%AddNamedProperty(f.prototype,h,"WeakMap",
2|1);
b.InstallFunctions(f.prototype,2,[
"get",WeakMapGet,
"set",WeakMapSet,
"has",WeakMapHas,
"delete",WeakMapDelete
]);
function WeakSetConstructor(j){
if((new.target===(void 0))){
throw %make_type_error(27,"WeakSet");
}
%WeakCollectionInitialize(this);
if(!(j==null)){
var k=this.add;
if(!(typeof(k)==='function')){
throw %make_type_error(87,k,'add',this);
}
for(var o of j){
%_Call(k,this,o);
}
}
}
function WeakSetAdd(o){
if(!(%_ClassOf(this)==='WeakSet')){
throw %make_type_error(45,
'WeakSet.prototype.add',this);
}
if(!(%_IsJSReceiver(o)))throw %make_type_error(166);
return %WeakCollectionSet(this,o,true,d(o));
}
function WeakSetHas(o){
if(!(%_ClassOf(this)==='WeakSet')){
throw %make_type_error(45,
'WeakSet.prototype.has',this);
}
if(!(%_IsJSReceiver(o)))return false;
var n=c(o);
if((n===(void 0)))return false;
return %WeakCollectionHas(this,o,n);
}
function WeakSetDelete(o){
if(!(%_ClassOf(this)==='WeakSet')){
throw %make_type_error(45,
'WeakSet.prototype.delete',this);
}
if(!(%_IsJSReceiver(o)))return false;
var n=c(o);
if((n===(void 0)))return false;
return %WeakCollectionDelete(this,o,n);
}
%SetCode(g,WeakSetConstructor);
%FunctionSetLength(g,0);
%FunctionSetPrototype(g,new e());
%AddNamedProperty(g.prototype,"constructor",g,
2);
%AddNamedProperty(g.prototype,h,"WeakSet",
2|1);
b.InstallFunctions(g.prototype,2,[
"add",WeakSetAdd,
"has",WeakSetHas,
"delete",WeakSetDelete
]);
})

Lcollection-iteratorÒ(
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c=a.Map;
var d=a.Set;
var e=b.ImportNow("iterator_symbol");
var f=b.ImportNow("MapIterator");
var g=b.ImportNow("to_string_tag_symbol");
var h=b.ImportNow("SetIterator");
function SetIteratorConstructor(i,j){
%SetIteratorInitialize(this,i,j);
}
function SetIteratorNextJS(){
if(!(%_ClassOf(this)==='Set Iterator')){
throw %make_type_error(45,
'Set Iterator.prototype.next',this);
}
var k=[(void 0),(void 0)];
var l=%_CreateIterResultObject(k,false);
switch(%SetIteratorNext(this,k)){
case 0:
l.value=(void 0);
l.done=true;
break;
case 2:
l.value=k[0];
break;
case 3:
k[1]=k[0];
break;
}
return l;
}
function SetEntries(){
if(!(%_ClassOf(this)==='Set')){
throw %make_type_error(45,
'Set.prototype.entries',this);
}
return new h(this,3);
}
function SetValues(){
if(!(%_ClassOf(this)==='Set')){
throw %make_type_error(45,
'Set.prototype.values',this);
}
return new h(this,2);
}
%SetCode(h,SetIteratorConstructor);
%FunctionSetInstanceClassName(h,'Set Iterator');
b.InstallFunctions(h.prototype,2,[
'next',SetIteratorNextJS
]);
%AddNamedProperty(h.prototype,g,
"Set Iterator",1|2);
b.InstallFunctions(d.prototype,2,[
'entries',SetEntries,
'keys',SetValues,
'values',SetValues
]);
%AddNamedProperty(d.prototype,e,SetValues,2);
function MapIteratorConstructor(m,j){
%MapIteratorInitialize(this,m,j);
}
function MapIteratorNextJS(){
if(!(%_ClassOf(this)==='Map Iterator')){
throw %make_type_error(45,
'Map Iterator.prototype.next',this);
}
var k=[(void 0),(void 0)];
var l=%_CreateIterResultObject(k,false);
switch(%MapIteratorNext(this,k)){
case 0:
l.value=(void 0);
l.done=true;
break;
case 1:
l.value=k[0];
break;
case 2:
l.value=k[1];
break;
}
return l;
}
function MapEntries(){
if(!(%_ClassOf(this)==='Map')){
throw %make_type_error(45,
'Map.prototype.entries',this);
}
return new f(this,3);
}
function MapKeys(){
if(!(%_ClassOf(this)==='Map')){
throw %make_type_error(45,
'Map.prototype.keys',this);
}
return new f(this,1);
}
function MapValues(){
if(!(%_ClassOf(this)==='Map')){
throw %make_type_error(45,
'Map.prototype.values',this);
}
return new f(this,2);
}
%SetCode(f,MapIteratorConstructor);
%FunctionSetInstanceClassName(f,'Map Iterator');
b.InstallFunctions(f.prototype,2,[
'next',MapIteratorNextJS
]);
%AddNamedProperty(f.prototype,g,
"Map Iterator",1|2);
b.InstallFunctions(c.prototype,2,[
'entries',MapEntries,
'keys',MapKeys,
'values',MapValues
]);
%AddNamedProperty(c.prototype,e,MapEntries,2);
b.Export(function(n){
n.MapEntries=MapEntries;
n.MapIteratorNext=MapIteratorNextJS;
n.SetIteratorNext=SetIteratorNextJS;
n.SetValues=SetValues;
});
})

promiseyj
(function(a,b,c){
"use strict";
%CheckIsBootstrapping();
var d=b.InternalArray;
var e=
b.ImportNow("promise_async_stack_id_symbol");
var f=
b.ImportNow("promise_handled_by_symbol");
var g=
b.ImportNow("promise_forwarding_handler_symbol");
var h=
b.ImportNow("promise_has_handler_symbol");
var i=
b.ImportNow("promise_handled_hint_symbol");
var j=b.ImportNow("promise_raw_symbol");
var k=b.ImportNow("promise_state_symbol");
var l=b.ImportNow("promise_result_symbol");
var m;
var n=b.ImportNow("species_symbol");
var o=b.ImportNow("to_string_tag_symbol");
var p;
var q=a.Promise;
var r=q.prototype.then;
b.Import(function(s){
p=s.ObjectHasOwnProperty;
m=s.SpeciesConstructor;
});
function PromiseHandle(t,u,v){
var w=(%_DebugIsActive()!=0);
try{
if(w)%DebugPushPromise(v.promise);
var x=u(t);
if((v.resolve===(void 0))){
ResolvePromise(v.promise,x);
}else{
%_Call(v.resolve,(void 0),x);
}
}%catch(exception){
try{
if((v.reject===(void 0))){
%PromiseReject(v.promise,exception,false);
}else{
%_Call(v.reject,(void 0),exception);
}
}catch(e){}
}finally{
if(w)%DebugPopPromise();
}
}
function PromiseDebugGetInfo(y,z){
var A,B,C=(%_DebugIsActive()!=0);
if(C){
if(!(y===(void 0))&&
(%_Call(p,y.promise,f))&&
(%_Call(p,(y.promise[f]),e))){
A=((y.promise[f])[e]);
B="async function";
}else{
A=%DebugNextMicrotaskId();
B=z===1?"Promise.resolve":"Promise.reject";
%DebugAsyncTaskEvent("enqueue",A,B);
}
}
return[A,B];
}
function PromiseIdResolveHandler(D){return D;}
function PromiseIdRejectHandler(E){%_ReThrow(E);}
(PromiseIdRejectHandler[g]=true);
function PromiseCreate(){
return %promise_internal_constructor();
}
function ResolvePromise(F,G){
if(G===F){
var H=%make_type_error(83,G);
%PromiseReject(F,H,true);
return;
}
if((%_IsJSReceiver(G))){
try{
var I=G.then;
}catch(e){
%PromiseReject(F,e,true);
return;
}
if(%is_promise(G)&&I===r){
var J=%PromiseStatus(G);
if(J===1){
var K=%PromiseResult(G);
%PromiseFulfill(F,1,K);
(F[h]=true);
return;
}else if(J===2){
var K=%PromiseResult(G);
if(!(!(G[h]===(void 0)))){
%PromiseRevokeReject(G);
}
%PromiseReject(F,K,false);
(G[h]=true);
return;
}
}
if((typeof(I)==='function')){
if((%_DebugIsActive()!=0)&&%is_promise(G)){
(G[f]=F);
}
%EnqueuePromiseResolveThenableJob(F,G,I);
return;
}
}
%PromiseFulfill(F,1,G);
}
function RejectPromise(F,L,M){
%PromiseReject(F,L,M);
}
function DoRejectPromise(F,L){
%PromiseReject(F,L,true);
}
function CreateInternalPromiseCapability(){
return{
promise:%promise_internal_constructor(),
resolve:(void 0),
reject:(void 0)
};
}
function NewPromiseCapability(N,M){
if(N===q){
var F=%promise_internal_constructor();
var O=%create_resolving_functions(F,M);
return{
promise:F,
resolve:O[0],
reject:O[1]
};
}
var x={promise:(void 0),resolve:(void 0),reject:(void 0)};
x.promise=new N((resolve,reject)=>{
if(!(x.resolve===(void 0))||!(x.reject===(void 0)))
throw %make_type_error(84);
x.resolve=resolve;
x.reject=reject;
});
if(!(typeof(x.resolve)==='function')||!(typeof(x.reject)==='function'))
throw %make_type_error(85);
return x;
}
function PromiseReject(E){
if(!(%_IsJSReceiver(this))){
throw %make_type_error(16,PromiseResolve);
}
if(this===q){
var F=%promise_create_and_set(2,E);
%PromiseRejectEventFromStack(F,E);
return F;
}else{
var P=NewPromiseCapability(this,true);
%_Call(P.reject,(void 0),E);
return P.promise;
}
}
function PromiseCatch(Q){
return this.then((void 0),Q);
}
function PromiseResolve(D){
if(!(%_IsJSReceiver(this))){
throw %make_type_error(16,PromiseResolve);
}
if(%is_promise(D)&&D.constructor===this)return D;
if(this===q){
var F=%promise_internal_constructor();
ResolvePromise(F,D);
return F;
}
var P=NewPromiseCapability(this,true);
%_Call(P.resolve,(void 0),D);
return P.promise;
}
function PromiseAll(R){
if(!(%_IsJSReceiver(this))){
throw %make_type_error(16,"Promise.all");
}
var v=NewPromiseCapability(this,false);
var S=new d();
var T;
var C=(%_DebugIsActive()!=0);
if(C){
(v.reject[g]=true);
}
function CreateResolveElementFunction(U,V,P){
var W=false;
return(D)=>{
if(W===true)return;
W=true;
V[U]=D;
if(--T===0){
var X=[];
%MoveArrayContents(V,X);
%_Call(P.resolve,(void 0),X);
}
};
}
try{
var Y=0;
T=1;
for(var t of R){
var Z=this.resolve(t);
++T;
var aa=Z.then(
CreateResolveElementFunction(Y,S,v),
v.reject);
if(C&&%is_promise(aa)){
(aa[f]=v.promise);
}
++Y;
}
if(--T===0){
var X=[];
%MoveArrayContents(S,X);
%_Call(v.resolve,(void 0),X);
}
}catch(e){
%_Call(v.reject,(void 0),e);
}
return v.promise;
}
function PromiseRace(R){
if(!(%_IsJSReceiver(this))){
throw %make_type_error(16,PromiseRace);
}
var v=NewPromiseCapability(this,false);
var C=(%_DebugIsActive()!=0);
if(C){
(v.reject[g]=true);
}
try{
for(var t of R){
var aa=this.resolve(t).then(v.resolve,
v.reject);
if(C&&%is_promise(aa)){
(aa[f]=v.promise);
}
}
}catch(e){
%_Call(v.reject,(void 0),e);
}
return v.promise;
}
function PromiseHasUserDefinedRejectHandlerCheck(u,v){
if((u[g])){
return PromiseHasUserDefinedRejectHandlerRecursive(v.promise);
}
return true;
}
function PromiseHasUserDefinedRejectHandlerRecursive(F){
if((F[i]))return true;
var ab=(F[f]);
if(ab&&
PromiseHasUserDefinedRejectHandlerRecursive(ab)){
return true;
}
if(!%is_promise(F))return false;
var ac=%PromiseRejectReactions(F);
var v=%PromiseDeferred(F);
if((ac===(void 0)))return false;
if(!(%_IsArray(ac))){
return PromiseHasUserDefinedRejectHandlerCheck(ac,v);
}
for(var Y=0;Y<ac.length;Y++){
if(PromiseHasUserDefinedRejectHandlerCheck(ac[Y],v[Y])){
return true;
}
}
return false;
}
function PromiseHasUserDefinedRejectHandler(){
return PromiseHasUserDefinedRejectHandlerRecursive(this);
};
function MarkPromiseAsHandled(F){
(F[h]=true);
}
function PromiseSpecies(){
return this;
}
b.InstallFunctions(q,2,[
"reject",PromiseReject,
"all",PromiseAll,
"race",PromiseRace,
"resolve",PromiseResolve
]);
b.InstallGetter(q,n,PromiseSpecies);
b.InstallFunctions(q.prototype,2,[
"catch",PromiseCatch
]);
%InstallToContext([
"promise_catch",PromiseCatch,
"promise_create",PromiseCreate,
"promise_has_user_defined_reject_handler",PromiseHasUserDefinedRejectHandler,
"promise_reject",DoRejectPromise,
"promise_internal_reject",RejectPromise,
"promise_resolve",ResolvePromise,
"promise_then",r,
"promise_handle",PromiseHandle,
"promise_debug_get_info",PromiseDebugGetInfo,
"new_promise_capability",NewPromiseCapability,
"internal_promise_capability",CreateInternalPromiseCapability,
"promise_id_resolve_handler",PromiseIdResolveHandler,
"promise_id_reject_handler",PromiseIdRejectHandler
]);
b.InstallFunctions(c,0,[
"createPromise",PromiseCreate,
"resolvePromise",ResolvePromise,
"rejectPromise",DoRejectPromise,
"markPromiseAsHandled",MarkPromiseAsHandled
]);
b.Export(function(ad){
ad.PromiseCreate=PromiseCreate;
ad.PromiseThen=r;
ad.CreateInternalPromiseCapability=CreateInternalPromiseCapability;
ad.ResolvePromise=ResolvePromise;
ad.RejectPromise=RejectPromise;
});
})

 messagesÕ	
(function(a,b){
%CheckIsBootstrapping();
var c=b.ImportNow("Script");
%FunctionSetInstanceClassName(c,'Script');
%AddNamedProperty(c.prototype,'constructor',c,
2|4|1);
function ScriptLocationFromPosition(position,
include_resource_offset){
return %ScriptPositionInfo(this,position,!!include_resource_offset);
}
function ScriptNameOrSourceURL(){
if(this.source_url)return this.source_url;
return this.name;
}
b.SetUpLockedPrototype(c,[
"source",
"name",
"source_url",
"source_mapping_url",
"line_offset",
"column_offset"
],[
"locationFromPosition",ScriptLocationFromPosition,
"nameOrSourceURL",ScriptNameOrSourceURL,
]
);
});

$templates
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c=a.Map;
var d=b.InternalArray;
var e=new c;
var f=c.prototype.get;
var g=c.prototype.set;
function SameCallSiteElements(h,i){
var j=h.length;
var i=i.raw;
if(j!==i.length)return false;
for(var k=0;k<j;++k){
if(h[k]!==i[k])return false;
}
return true;
}
function GetCachedCallSite(l,m){
var n=%_Call(f,e,m);
if((n===(void 0)))return;
var j=n.length;
for(var k=0;k<j;++k){
if(SameCallSiteElements(l,n[k]))return n[k];
}
}
function SetCachedCallSite(l,m){
var n=%_Call(f,e,m);
var o;
if((n===(void 0))){
o=new d(1);
o[0]=l;
%_Call(g,e,m,o);
}else{
n.push(l);
}
return l;
}
function GetTemplateCallSite(l,h,m){
var p=GetCachedCallSite(h,m);
if(!(p===(void 0)))return p;
%AddNamedProperty(l,"raw",%object_freeze(h),
1|2|4);
return SetCachedCallSite(%object_freeze(l),m);
}
%InstallToContext(["get_template_call_site",GetTemplateCallSite]);
})

spread5
(function(a,b){
'use strict';
var c=b.InternalArray;
function SpreadArguments(){
var d=arguments.length;
var e=new c();
for(var f=0;f<d;++f){
var g=arguments[f];
var h=g.length;
for(var i=0;i<h;++i){
e.push(g[i]);
}
}
return e;
}
function SpreadIterable(j){
if((j==null)){
throw %make_type_error(71,j);
}
var e=new c();
for(var k of j){
e.push(k);
}
return e;
}
%InstallToContext([
"spread_arguments",SpreadArguments,
"spread_iterable",SpreadIterable,
]);
})

proxyΩ
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c=a.Proxy;
function ProxyCreateRevocable(d,e){
var f=new c(d,e);
return{proxy:f,revoke:()=>%JSProxyRevoke(f)};
}
b.InstallFunctions(c,2,[
"revocable",ProxyCreateRevocable
]);
})

,async-awaitm
(function(a,b,c){
"use strict";
%CheckIsBootstrapping();
var d;
var e;
var f;
var g;
var h;
var i;
var j;
b.Import(function(k){
d=k.AsyncFunctionNext;
e=k.AsyncFunctionThrow;
f=k.CreateInternalPromiseCapability;
g=k.PromiseCreate;
i=k.RejectPromise;
j=k.ResolvePromise;
});
var l=
b.ImportNow("promise_async_stack_id_symbol");
var m=
b.ImportNow("promise_handled_by_symbol");
var n=
b.ImportNow("promise_forwarding_handler_symbol");
var o=
b.ImportNow("promise_handled_hint_symbol");
var p=
b.ImportNow("promise_has_handler_symbol");
function PromiseCastResolved(q){
if(%is_promise(q)){
return q;
}else{
var r=g();
j(r,q);
return r;
}
}
function AsyncFunctionAwait(s,t,u){
var r=PromiseCastResolved(t);
var v=sentValue=>{
%_Call(d,s,sentValue);
return;
};
var w=sentError=>{
%_Call(e,s,sentError);
return;
}
var x=f();
(x.promise[p]=true);
if((%_DebugIsActive()!=0)){
if(%is_promise(t)){
(w[n]=true);
}
(x.promise[m]=u);
}
%perform_promise_then(r,v,w,x);
}
function AsyncFunctionAwaitUncaught(s,t,u){
AsyncFunctionAwait(s,t,u);
}
function AsyncFunctionAwaitCaught(s,t,u){
if((%_DebugIsActive()!=0)&&%is_promise(t)){
(t[o]=true);
}
AsyncFunctionAwait(s,t,u);
}
function RejectPromiseNoDebugEvent(r,y){
return i(r,y,false);
}
function AsyncFunctionPromiseCreate(){
var r=g();
if((%_DebugIsActive()!=0)){
%DebugPushPromise(r);
var z=%DebugNextMicrotaskId();
(r[l]=z);
%DebugAsyncTaskEvent("enqueueRecurring",z,"async function");
}
return r;
}
function AsyncFunctionPromiseRelease(r){
if((%_DebugIsActive()!=0)){
var z=(r[l]);
if(!(z===(void 0))){
%DebugAsyncTaskEvent("cancel",z,"async function");
}
%DebugPopPromise();
}
}
%InstallToContext([
"async_function_await_caught",AsyncFunctionAwaitCaught,
"async_function_await_uncaught",AsyncFunctionAwaitUncaught,
"reject_promise_no_debug_event",RejectPromiseNoDebugEvent,
"async_function_promise_create",AsyncFunctionPromiseCreate,
"async_function_promise_release",AsyncFunctionPromiseRelease,
]);
})

i18n*
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c;
var d;
var e=a.Date;
var f=a.Number;
var g=a.RegExp;
var h=a.String;
var i=b.InstallFunctions;
var j=b.InstallGetter;
var k=b.InternalArray;
var l=b.ImportNow("ObjectHasOwnProperty");
var m=b.OverrideFunction;
var n=b.ImportNow("intl_pattern_symbol");
var o=b.ImportNow("intl_resolved_symbol");
var p=b.SetFunctionName;
var q=h.prototype.substr;
var r=h.prototype.substring;
b.Import(function(s){
c=s.ArrayJoin;
d=s.ArrayPush;
});
function InstallFunction(t,u,v){
i(t,2,[u,v]);
}
function InstallConstructor(t,u,v){
%CheckIsBootstrapping();
p(v,u);
%AddNamedProperty(t,u,v,2);
%SetNativeFlag(v);
%ToFastProperties(t);
}
function AddBoundMethod(w,x,y,z,A){
%CheckIsBootstrapping();
var B=%CreatePrivateSymbol(x);
var C=(0,(function(){
if(!%IsInitializedIntlObjectOfType(this,A)){
throw %make_type_error(54,x);
}
if((this[B]===(void 0))){
var D;
if((z===(void 0))||z===2){
D=
(0,((fst,snd)=>y(this,fst,snd)));
}else if(z===1){
D=(0,(fst=>y(this,fst)));
}else{
D=(0,((...args)=>{
if(args.length>0){
return y(this,args[0]);
}else{
return y(this);
}
}));
}
%SetNativeFlag(D);
this[B]=D;
}
return this[B];
}));
%FunctionRemovePrototype(C);
%DefineGetterPropertyUnchecked(w.prototype,x,C,2);
%SetNativeFlag(C);
}
var E={};
%AddNamedProperty(a,"Intl",E,2);
var F={
'collator':(void 0),
'numberformat':(void 0),
'dateformat':(void 0),
'breakiterator':(void 0)
};
var G=(void 0);
function GetDefaultICULocaleJS(){
if((G===(void 0))){
G=%GetDefaultICULocale();
}
return G;
}
var H=(void 0);
function GetUnicodeExtensionRE(){
if(((void 0)===(void 0))){
H=new g('-u(-[a-z0-9]{2,8})+','g');
}
return H;
}
var I=(void 0);
function GetAnyExtensionRE(){
if((I===(void 0))){
I=new g('-[a-z0-9]{1}-.*','g');
}
return I;
}
var J=(void 0);
function GetQuotedStringRE(){
if((J===(void 0))){
J=new g("'[^']+'",'g');
}
return J;
}
var K=(void 0);
function GetServiceRE(){
if((K===(void 0))){
K=
new g('^(collator|numberformat|dateformat|breakiterator)$');
}
return K;
}
var L=(void 0);
function GetLanguageTagRE(){
if((L===(void 0))){
BuildLanguageTagREs();
}
return L;
}
var M=(void 0);
function GetLanguageVariantRE(){
if((M===(void 0))){
BuildLanguageTagREs();
}
return M;
}
var N=(void 0);
function GetLanguageSingletonRE(){
if((N===(void 0))){
BuildLanguageTagREs();
}
return N;
}
var O=(void 0);
function GetTimezoneNameCheckRE(){
if((O===(void 0))){
O=new g(
'^([A-Za-z]+)/([A-Za-z_-]+)((?:\/[A-Za-z_-]+)+)*$');
}
return O;
}
var P=(void 0);
function GetTimezoneNameLocationPartRE(){
if((P===(void 0))){
P=
new g('^([A-Za-z]+)((?:[_-][A-Za-z]+)+)*$');
}
return P;
}
function supportedLocalesOf(Q,R,S){
if((%regexp_internal_match(GetServiceRE(),Q)===null)){
throw %make_error(7,Q);
}
if((S===(void 0))){
S={};
}else{
S=(%_ToObject(S));
}
var T=S.localeMatcher;
if(!(T===(void 0))){
T=(%_ToString(T));
if(T!=='lookup'&&T!=='best fit'){
throw %make_range_error(175,T);
}
}else{
T='best fit';
}
var U=initializeLocaleList(R);
if((F[Q]===(void 0))){
F[Q]=getAvailableLocalesOf(Q);
}
if(T==='best fit'){
return initializeLocaleList(bestFitSupportedLocalesOf(
U,F[Q]));
}
return initializeLocaleList(lookupSupportedLocalesOf(
U,F[Q]));
}
function lookupSupportedLocalesOf(U,V){
var W=new k();
for(var X=0;X<U.length;++X){
var Y=%RegExpInternalReplace(
GetUnicodeExtensionRE(),U[X],'');
do{
if(!(V[Y]===(void 0))){
%_Call(d,W,U[X]);
break;
}
var Z=%StringLastIndexOf(Y,'-');
if(Z===-1){
break;
}
Y=%_Call(r,Y,0,Z);
}while(true);
}
return W;
}
function bestFitSupportedLocalesOf(U,V){
return lookupSupportedLocalesOf(U,V);
}
function getGetOption(S,aa){
if((S===(void 0)))throw %make_error(4,aa);
var ab=function getOption(ac,A,ad,ae){
if(!(S[ac]===(void 0))){
var af=S[ac];
switch(A){
case'boolean':
af=(!!(af));
break;
case'string':
af=(%_ToString(af));
break;
case'number':
af=(%_ToNumber(af));
break;
default:
throw %make_error(8);
}
if(!(ad===(void 0))&&%ArrayIndexOf(ad,af,0)===-1){
throw %make_range_error(185,af,aa,ac);
}
return af;
}
return ae;
}
return ab;
}
function resolveLocale(Q,U,S){
U=initializeLocaleList(U);
var ab=getGetOption(S,Q);
var T=ab('localeMatcher','string',
['lookup','best fit'],'best fit');
var ag;
if(T==='lookup'){
ag=lookupMatcher(Q,U);
}else{
ag=bestFitMatcher(Q,U);
}
return ag;
}
function lookupMatcher(Q,U){
if((%regexp_internal_match(GetServiceRE(),Q)===null)){
throw %make_error(7,Q);
}
if((F[Q]===(void 0))){
F[Q]=getAvailableLocalesOf(Q);
}
for(var X=0;X<U.length;++X){
var Y=%RegExpInternalReplace(
GetAnyExtensionRE(),U[X],'');
do{
if(!(F[Q][Y]===(void 0))){
var ah=%regexp_internal_match(
GetUnicodeExtensionRE(),U[X]);
var ai=(ah===null)?'':ah[0];
return{'locale':Y,'extension':ai,'position':X};
}
var Z=%StringLastIndexOf(Y,'-');
if(Z===-1){
break;
}
Y=%_Call(r,Y,0,Z);
}while(true);
}
return{'locale':GetDefaultICULocaleJS(),'extension':'','position':-1};
}
function bestFitMatcher(Q,U){
return lookupMatcher(Q,U);
}
function parseExtension(ai){
var aj=%StringSplit(ai,'-',4294967295);
if(aj.length<=2||
(aj[0]!==''&&aj[1]!=='u')){
return{};
}
var ak={};
var al=(void 0);
var af=(void 0);
for(var X=2;X<aj.length;++X){
var z=aj[X].length;
var am=aj[X];
if(z===2){
if(!(al===(void 0))){
if(!(al in ak)){
ak[al]=af;
}
af=(void 0);
}
al=am;
}else if(z>=3&&z<=8&&!(al===(void 0))){
if((af===(void 0))){
af=am;
}else{
af=af+"-"+am;
}
}else{
return{};
}
}
if(!(al===(void 0))&&!(al in ak)){
ak[al]=af;
}
return ak;
}
function setOptions(an,ak,ao,ab,ap){
var ai='';
var aq=function updateExtension(al,af){
return'-'+al+'-'+(%_ToString(af));
}
var ar=function updateProperty(ac,A,af){
if(A==='boolean'&&(typeof af==='string')){
af=(af==='true')?true:false;
}
if(!(ac===(void 0))){
defineWEProperty(ap,ac,af);
}
}
for(var al in ao){
if((%_Call(l,ao,al))){
var af=(void 0);
var as=ao[al];
if(!(as.property===(void 0))){
af=ab(as.property,as.type,as.values);
}
if(!(af===(void 0))){
ar(as.property,as.type,af);
ai+=aq(al,af);
continue;
}
if((%_Call(l,ak,al))){
af=ak[al];
if(!(af===(void 0))){
ar(as.property,as.type,af);
ai+=aq(al,af);
}else if(as.type==='boolean'){
ar(as.property,as.type,true);
ai+=aq(al,true);
}
}
}
}
return ai===''?'':'-u'+ai;
}
function freezeArray(at){
var au=[];
var av=at.length;
for(var X=0;X<av;X++){
if(X in at){
%object_define_property(au,X,{value:at[X],
configurable:false,
writable:false,
enumerable:true});
}
}
%object_define_property(au,'length',{value:av,writable:false});
return au;
}
function makeArray(at){
var au=[];
%MoveArrayContents(at,au);
return au;
}
function getOptimalLanguageTag(aw,ag){
if(aw===ag){
return aw;
}
var R=%GetLanguageTagVariants([aw,ag]);
if(R[0].maximized!==R[1].maximized){
return ag;
}
var ax=new g('^'+R[1].base,'g');
return %RegExpInternalReplace(ax,ag,R[0].base);
}
function getAvailableLocalesOf(Q){
var ay=%AvailableLocalesOf(Q);
for(var X in ay){
if((%_Call(l,ay,X))){
var az=%regexp_internal_match(
/^([a-z]{2,3})-([A-Z][a-z]{3})-([A-Z]{2})$/,X);
if(!(az===null)){
ay[az[1]+'-'+az[3]]=null;
}
}
}
return ay;
}
function defineWEProperty(t,ac,af){
%object_define_property(t,ac,
{value:af,writable:true,enumerable:true});
}
function addWEPropertyIfDefined(t,ac,af){
if(!(af===(void 0))){
defineWEProperty(t,ac,af);
}
}
function defineWECProperty(t,ac,af){
%object_define_property(t,ac,{value:af,
writable:true,
enumerable:true,
configurable:true});
}
function addWECPropertyIfDefined(t,ac,af){
if(!(af===(void 0))){
defineWECProperty(t,ac,af);
}
}
function toTitleCaseWord(aA){
return %StringToUpperCase(%_Call(q,aA,0,1))+
%StringToLowerCase(%_Call(q,aA,1));
}
function toTitleCaseTimezoneLocation(aB){
var aC=%regexp_internal_match(GetTimezoneNameLocationPartRE(),aB)
if((aC===null))throw %make_range_error(152,aB);
var aD=toTitleCaseWord(aC[1]);
if(!(aC[2]===(void 0))&&2<aC.length){
var aE=%_Call(r,aC[2],0,1);
var az=%StringSplit(aC[2],aE,4294967295);
for(var X=1;X<az.length;X++){
var aF=az[X]
var aG=%StringToLowerCase(aF);
aD=aD+aE+
((aG!=='es'&&
aG!=='of'&&aG!=='au')?
toTitleCaseWord(aF):aG);
}
}
return aD;
}
function canonicalizeLanguageTag(aH){
if((!(typeof(aH)==='string')&&!(%_IsJSReceiver(aH)))||
(aH===null)){
throw %make_type_error(53);
}
if((typeof(aH)==='string')&&
!(%regexp_internal_match(/^[a-z]{2,3}$/,aH)===null)){
return aH;
}
var aI=(%_ToString(aH));
if(isStructuallyValidLanguageTag(aI)===false){
throw %make_range_error(164,aI);
}
var aJ=%CanonicalizeLanguageTag(aI);
if(aJ==='invalid-tag'){
throw %make_range_error(164,aI);
}
return aJ;
}
function canonicalizeLocaleList(R){
var aK=new k();
if(!(R===(void 0))){
if(typeof R==='string'){
%_Call(d,aK,canonicalizeLanguageTag(R));
return aK;
}
var aL=(%_ToObject(R));
var aM=(%_ToLength(aL.length));
for(var aN=0;aN<aM;aN++){
if(aN in aL){
var af=aL[aN];
var aJ=canonicalizeLanguageTag(af);
if(%ArrayIndexOf(aK,aJ,0)===-1){
%_Call(d,aK,aJ);
}
}
}
}
return aK;
}
function initializeLocaleList(R){
return freezeArray(canonicalizeLocaleList(R));
}
function isStructuallyValidLanguageTag(Y){
if((%regexp_internal_match(GetLanguageTagRE(),Y)===null)){
return false;
}
if(%StringIndexOf(Y,'x-',0)===0){
return true;
}
Y=%StringSplit(Y,'-x-',4294967295)[0];
var aO=new k();
var aP=new k();
var az=%StringSplit(Y,'-',4294967295);
for(var X=1;X<az.length;X++){
var af=az[X];
if(!(%regexp_internal_match(GetLanguageVariantRE(),af)===null)&&
aP.length===0){
if(%ArrayIndexOf(aO,af,0)===-1){
%_Call(d,aO,af);
}else{
return false;
}
}
if(!(%regexp_internal_match(GetLanguageSingletonRE(),af)===null)){
if(%ArrayIndexOf(aP,af,0)===-1){
%_Call(d,aP,af);
}else{
return false;
}
}
}
return true;
}
function BuildLanguageTagREs(){
var aQ='[a-zA-Z]';
var aR='[0-9]';
var aS='('+aQ+'|'+aR+')';
var aT='(art-lojban|cel-gaulish|no-bok|no-nyn|zh-guoyu|zh-hakka|'+
'zh-min|zh-min-nan|zh-xiang)';
var aU='(en-GB-oed|i-ami|i-bnn|i-default|i-enochian|i-hak|'+
'i-klingon|i-lux|i-mingo|i-navajo|i-pwn|i-tao|i-tay|'+
'i-tsu|sgn-BE-FR|sgn-BE-NL|sgn-CH-DE)';
var aV='('+aU+'|'+aT+')';
var aW='(x(-'+aS+'{1,8})+)';
var aX='('+aR+'|[A-WY-Za-wy-z])';
N=new g('^'+aX+'$','i');
var ai='('+aX+'(-'+aS+'{2,8})+)';
var aY='('+aS+'{5,8}|('+aR+aS+'{3}))';
M=new g('^'+aY+'$','i');
var aZ='('+aQ+'{2}|'+aR+'{3})';
var ba='('+aQ+'{4})';
var bb='('+aQ+'{3}(-'+aQ+'{3}){0,2})';
var bc='('+aQ+'{2,3}(-'+bb+')?|'+aQ+'{4}|'+
aQ+'{5,8})';
var bd=bc+'(-'+ba+')?(-'+aZ+')?(-'+
aY+')*(-'+ai+')*(-'+aW+')?';
var be=
'^('+bd+'|'+aW+'|'+aV+')$';
L=new g(be,'i');
}
var bf={
get(){
%IncrementUseCounter(16);
return this[o];
},
set(af){
this[o]=af;
}
};
InstallFunction(E,'getCanonicalLocales',function(R){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
return makeArray(canonicalizeLocaleList(R));
}
);
function initializeCollator(bg,R,S){
if(%IsInitializedIntlObject(bg)){
throw %make_type_error(126,"Collator");
}
if((S===(void 0))){
S={};
}
var ab=getGetOption(S,'collator');
var bh={};
defineWEProperty(bh,'usage',ab(
'usage','string',['sort','search'],'sort'));
var bi=ab('sensitivity','string',
['base','accent','case','variant']);
if((bi===(void 0))&&bh.usage==='sort'){
bi='variant';
}
defineWEProperty(bh,'sensitivity',bi);
defineWEProperty(bh,'ignorePunctuation',ab(
'ignorePunctuation','boolean',(void 0),false));
var Y=resolveLocale('collator',R,S);
var ak=parseExtension(Y.extension);
var bj={
'kn':{'property':'numeric','type':'boolean'},
'kf':{'property':'caseFirst','type':'string',
'values':['false','lower','upper']}
};
setOptions(
S,ak,bj,ab,bh);
var bk='default';
var ai='';
if((%_Call(l,ak,'co'))&&bh.usage==='sort'){
var bl=[
'big5han','dict','direct','ducet','gb2312','phonebk','phonetic',
'pinyin','reformed','searchjl','stroke','trad','unihan','zhuyin'
];
if(%ArrayIndexOf(bl,ak.co,0)!==-1){
ai='-u-co-'+ak.co;
bk=ak.co;
}
}else if(bh.usage==='search'){
ai='-u-co-search';
}
defineWEProperty(bh,'collation',bk);
var bm=Y.locale+ai;
var ag=%object_define_properties({},{
caseFirst:{writable:true},
collation:{value:bh.collation,writable:true},
ignorePunctuation:{writable:true},
locale:{writable:true},
numeric:{writable:true},
requestedLocale:{value:bm,writable:true},
sensitivity:{writable:true},
strength:{writable:true},
usage:{value:bh.usage,writable:true}
});
var bn=%CreateCollator(bm,
bh,
ag);
%MarkAsInitializedIntlObjectOfType(bg,'collator',bn);
bg[o]=ag;
return bg;
}
InstallConstructor(E,'Collator',function(){
var R=arguments[0];
var S=arguments[1];
if(!this||this===E){
return new E.Collator(R,S);
}
return initializeCollator((%_ToObject(this)),R,S);
}
);
InstallFunction(E.Collator.prototype,'resolvedOptions',function(){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if(!%IsInitializedIntlObjectOfType(this,'collator')){
throw %make_type_error(127,"Collator");
}
var bo=this;
var Y=getOptimalLanguageTag(bo[o].requestedLocale,
bo[o].locale);
return{
locale:Y,
usage:bo[o].usage,
sensitivity:bo[o].sensitivity,
ignorePunctuation:bo[o].ignorePunctuation,
numeric:bo[o].numeric,
caseFirst:bo[o].caseFirst,
collation:bo[o].collation
};
}
);
InstallFunction(E.Collator,'supportedLocalesOf',function(R){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
return supportedLocalesOf('collator',R,arguments[1]);
}
);
function compare(bg,bp,bq){
return %InternalCompare(%GetImplFromInitializedIntlObject(bg),
(%_ToString(bp)),(%_ToString(bq)));
};
AddBoundMethod(E.Collator,'compare',compare,2,'collator');
function isWellFormedCurrencyCode(br){
return typeof br=="string"&&br.length==3&&
(%regexp_internal_match(/[^A-Za-z]/,br)===null);
}
function getNumberOption(S,ac,bs,bt,bu){
var af=S[ac];
if(!(af===(void 0))){
af=(%_ToNumber(af));
if((!%_IsSmi(%IS_VAR(af))&&!(af==af))||af<bs||af>bt){
throw %make_range_error(178,ac);
}
return %math_floor(af);
}
return bu;
}
var bv={
get(){
%IncrementUseCounter(15);
return this[n];
},
set(af){
this[n]=af;
}
};
function initializeNumberFormat(bw,R,S){
if(%IsInitializedIntlObject(bw)){
throw %make_type_error(126,"NumberFormat");
}
if((S===(void 0))){
S={};
}
var ab=getGetOption(S,'numberformat');
var Y=resolveLocale('numberformat',R,S);
var bh={};
defineWEProperty(bh,'style',ab(
'style','string',['decimal','percent','currency'],'decimal'));
var br=ab('currency','string');
if(!(br===(void 0))&&!isWellFormedCurrencyCode(br)){
throw %make_range_error(159,br);
}
if(bh.style==='currency'&&(br===(void 0))){
throw %make_type_error(29);
}
var bx=ab(
'currencyDisplay','string',['code','symbol','name'],'symbol');
if(bh.style==='currency'){
defineWEProperty(bh,'currency',%StringToUpperCase(br));
defineWEProperty(bh,'currencyDisplay',bx);
}
var by=getNumberOption(S,'minimumIntegerDigits',1,21,1);
defineWEProperty(bh,'minimumIntegerDigits',by);
var bz=S['minimumFractionDigits'];
var bA=S['maximumFractionDigits'];
if(!(bz===(void 0))||bh.style!=='currency'){
bz=getNumberOption(S,'minimumFractionDigits',0,20,0);
defineWEProperty(bh,'minimumFractionDigits',bz);
}
if(!(bA===(void 0))||bh.style!=='currency'){
var bB=bh.style==='percent'?0:3;
bz=(bz===(void 0))?0:bz;
var bC=(bz>bB)?bz:bB;
bA=getNumberOption(S,'maximumFractionDigits',bz,20,bC);
defineWEProperty(bh,'maximumFractionDigits',bA);
}
var bD=S['minimumSignificantDigits'];
var bE=S['maximumSignificantDigits'];
if(!(bD===(void 0))||!(bE===(void 0))){
bD=getNumberOption(S,'minimumSignificantDigits',1,21,0);
defineWEProperty(bh,'minimumSignificantDigits',bD);
bE=getNumberOption(S,'maximumSignificantDigits',bD,21,21);
defineWEProperty(bh,'maximumSignificantDigits',bE);
}
defineWEProperty(bh,'useGrouping',ab(
'useGrouping','boolean',(void 0),true));
var ak=parseExtension(Y.extension);
var bF={
'nu':{'property':(void 0),'type':'string'}
};
var ai=setOptions(S,ak,bF,
ab,bh);
var bm=Y.locale+ai;
var ag=%object_define_properties({},{
currency:{writable:true},
currencyDisplay:{writable:true},
locale:{writable:true},
maximumFractionDigits:{writable:true},
minimumFractionDigits:{writable:true},
minimumIntegerDigits:{writable:true},
numberingSystem:{writable:true},
requestedLocale:{value:bm,writable:true},
style:{value:bh.style,writable:true},
useGrouping:{writable:true}
});
if((%_Call(l,bh,'minimumSignificantDigits'))){
defineWEProperty(ag,'minimumSignificantDigits',(void 0));
}
if((%_Call(l,bh,'maximumSignificantDigits'))){
defineWEProperty(ag,'maximumSignificantDigits',(void 0));
}
var bG=%CreateNumberFormat(bm,
bh,
ag);
if(bh.style==='currency'){
%object_define_property(ag,'currencyDisplay',
{value:bx,writable:true});
}
%MarkAsInitializedIntlObjectOfType(bw,'numberformat',bG);
bw[o]=ag;
return bw;
}
InstallConstructor(E,'NumberFormat',function(){
var R=arguments[0];
var S=arguments[1];
if(!this||this===E){
return new E.NumberFormat(R,S);
}
return initializeNumberFormat((%_ToObject(this)),R,S);
}
);
InstallFunction(E.NumberFormat.prototype,'resolvedOptions',function(){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if(!%IsInitializedIntlObjectOfType(this,'numberformat')){
throw %make_type_error(127,"NumberFormat");
}
var bH=this;
var Y=getOptimalLanguageTag(bH[o].requestedLocale,
bH[o].locale);
var aD={
locale:Y,
numberingSystem:bH[o].numberingSystem,
style:bH[o].style,
useGrouping:bH[o].useGrouping,
minimumIntegerDigits:bH[o].minimumIntegerDigits,
minimumFractionDigits:bH[o].minimumFractionDigits,
maximumFractionDigits:bH[o].maximumFractionDigits,
};
if(aD.style==='currency'){
defineWECProperty(aD,'currency',bH[o].currency);
defineWECProperty(aD,'currencyDisplay',
bH[o].currencyDisplay);
}
if((%_Call(l,bH[o],'minimumSignificantDigits'))){
defineWECProperty(aD,'minimumSignificantDigits',
bH[o].minimumSignificantDigits);
}
if((%_Call(l,bH[o],'maximumSignificantDigits'))){
defineWECProperty(aD,'maximumSignificantDigits',
bH[o].maximumSignificantDigits);
}
return aD;
}
);
InstallFunction(E.NumberFormat,'supportedLocalesOf',function(R){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
return supportedLocalesOf('numberformat',R,arguments[1]);
}
);
function formatNumber(bG,af){
var bI=(%_ToNumber(af))+0;
return %InternalNumberFormat(%GetImplFromInitializedIntlObject(bG),
bI);
}
AddBoundMethod(E.NumberFormat,'format',formatNumber,1,'numberformat');
function toLDMLString(S){
var ab=getGetOption(S,'dateformat');
var bJ='';
var bK=ab('weekday','string',['narrow','short','long']);
bJ+=appendToLDMLString(
bK,{narrow:'EEEEE',short:'EEE',long:'EEEE'});
bK=ab('era','string',['narrow','short','long']);
bJ+=appendToLDMLString(
bK,{narrow:'GGGGG',short:'GGG',long:'GGGG'});
bK=ab('year','string',['2-digit','numeric']);
bJ+=appendToLDMLString(bK,{'2-digit':'yy','numeric':'y'});
bK=ab('month','string',
['2-digit','numeric','narrow','short','long']);
bJ+=appendToLDMLString(bK,{'2-digit':'MM','numeric':'M',
'narrow':'MMMMM','short':'MMM','long':'MMMM'});
bK=ab('day','string',['2-digit','numeric']);
bJ+=appendToLDMLString(
bK,{'2-digit':'dd','numeric':'d'});
var bL=ab('hour12','boolean');
bK=ab('hour','string',['2-digit','numeric']);
if((bL===(void 0))){
bJ+=appendToLDMLString(bK,{'2-digit':'jj','numeric':'j'});
}else if(bL===true){
bJ+=appendToLDMLString(bK,{'2-digit':'hh','numeric':'h'});
}else{
bJ+=appendToLDMLString(bK,{'2-digit':'HH','numeric':'H'});
}
bK=ab('minute','string',['2-digit','numeric']);
bJ+=appendToLDMLString(bK,{'2-digit':'mm','numeric':'m'});
bK=ab('second','string',['2-digit','numeric']);
bJ+=appendToLDMLString(bK,{'2-digit':'ss','numeric':'s'});
bK=ab('timeZoneName','string',['short','long']);
bJ+=appendToLDMLString(bK,{short:'z',long:'zzzz'});
return bJ;
}
function appendToLDMLString(bK,bM){
if(!(bK===(void 0))){
return bM[bK];
}else{
return'';
}
}
function fromLDMLString(bJ){
bJ=%RegExpInternalReplace(GetQuotedStringRE(),bJ,'');
var S={};
var aC=%regexp_internal_match(/E{3,5}/,bJ);
S=appendToDateTimeObject(
S,'weekday',aC,{EEEEE:'narrow',EEE:'short',EEEE:'long'});
aC=%regexp_internal_match(/G{3,5}/,bJ);
S=appendToDateTimeObject(
S,'era',aC,{GGGGG:'narrow',GGG:'short',GGGG:'long'});
aC=%regexp_internal_match(/y{1,2}/,bJ);
S=appendToDateTimeObject(
S,'year',aC,{y:'numeric',yy:'2-digit'});
aC=%regexp_internal_match(/M{1,5}/,bJ);
S=appendToDateTimeObject(S,'month',aC,{MM:'2-digit',
M:'numeric',MMMMM:'narrow',MMM:'short',MMMM:'long'});
aC=%regexp_internal_match(/L{1,5}/,bJ);
S=appendToDateTimeObject(S,'month',aC,{LL:'2-digit',
L:'numeric',LLLLL:'narrow',LLL:'short',LLLL:'long'});
aC=%regexp_internal_match(/d{1,2}/,bJ);
S=appendToDateTimeObject(
S,'day',aC,{d:'numeric',dd:'2-digit'});
aC=%regexp_internal_match(/h{1,2}/,bJ);
if(aC!==null){
S['hour12']=true;
}
S=appendToDateTimeObject(
S,'hour',aC,{h:'numeric',hh:'2-digit'});
aC=%regexp_internal_match(/H{1,2}/,bJ);
if(aC!==null){
S['hour12']=false;
}
S=appendToDateTimeObject(
S,'hour',aC,{H:'numeric',HH:'2-digit'});
aC=%regexp_internal_match(/m{1,2}/,bJ);
S=appendToDateTimeObject(
S,'minute',aC,{m:'numeric',mm:'2-digit'});
aC=%regexp_internal_match(/s{1,2}/,bJ);
S=appendToDateTimeObject(
S,'second',aC,{s:'numeric',ss:'2-digit'});
aC=%regexp_internal_match(/z|zzzz/,bJ);
S=appendToDateTimeObject(
S,'timeZoneName',aC,{z:'short',zzzz:'long'});
return S;
}
function appendToDateTimeObject(S,bK,aC,bM){
if((aC===null)){
if(!(%_Call(l,S,bK))){
defineWEProperty(S,bK,(void 0));
}
return S;
}
var ac=aC[0];
defineWEProperty(S,bK,bM[ac]);
return S;
}
function toDateTimeOptions(S,bN,bO){
if((S===(void 0))){
S={};
}else{
S=(%_ToObject(S));
}
var bP=true;
if((bN==='date'||bN==='any')&&
(!(S.weekday===(void 0))||!(S.year===(void 0))||
!(S.month===(void 0))||!(S.day===(void 0)))){
bP=false;
}
if((bN==='time'||bN==='any')&&
(!(S.hour===(void 0))||!(S.minute===(void 0))||
!(S.second===(void 0)))){
bP=false;
}
if(bP&&(bO==='date'||bO==='all')){
%object_define_property(S,'year',{value:'numeric',
writable:true,
enumerable:true,
configurable:true});
%object_define_property(S,'month',{value:'numeric',
writable:true,
enumerable:true,
configurable:true});
%object_define_property(S,'day',{value:'numeric',
writable:true,
enumerable:true,
configurable:true});
}
if(bP&&(bO==='time'||bO==='all')){
%object_define_property(S,'hour',{value:'numeric',
writable:true,
enumerable:true,
configurable:true});
%object_define_property(S,'minute',{value:'numeric',
writable:true,
enumerable:true,
configurable:true});
%object_define_property(S,'second',{value:'numeric',
writable:true,
enumerable:true,
configurable:true});
}
return S;
}
function initializeDateTimeFormat(bQ,R,S){
if(%IsInitializedIntlObject(bQ)){
throw %make_type_error(126,"DateTimeFormat");
}
if((S===(void 0))){
S={};
}
var Y=resolveLocale('dateformat',R,S);
S=toDateTimeOptions(S,'any','date');
var ab=getGetOption(S,'dateformat');
var T=ab('formatMatcher','string',
['basic','best fit'],'best fit');
var bJ=toLDMLString(S);
var bR=canonicalizeTimeZoneID(S.timeZone);
var bh={};
var ak=parseExtension(Y.extension);
var bS={
'ca':{'property':(void 0),'type':'string'},
'nu':{'property':(void 0),'type':'string'}
};
var ai=setOptions(S,ak,bS,
ab,bh);
var bm=Y.locale+ai;
var ag=%object_define_properties({},{
calendar:{writable:true},
day:{writable:true},
era:{writable:true},
hour12:{writable:true},
hour:{writable:true},
locale:{writable:true},
minute:{writable:true},
month:{writable:true},
numberingSystem:{writable:true},
[n]:{writable:true},
requestedLocale:{value:bm,writable:true},
second:{writable:true},
timeZone:{writable:true},
timeZoneName:{writable:true},
tz:{value:bR,writable:true},
weekday:{writable:true},
year:{writable:true}
});
var bG=%CreateDateTimeFormat(
bm,{skeleton:bJ,timeZone:bR},ag);
if(ag.timeZone==="Etc/Unknown"){
throw %make_range_error(184,bR);
}
%MarkAsInitializedIntlObjectOfType(bQ,'dateformat',bG);
bQ[o]=ag;
return bQ;
}
InstallConstructor(E,'DateTimeFormat',function(){
var R=arguments[0];
var S=arguments[1];
if(!this||this===E){
return new E.DateTimeFormat(R,S);
}
return initializeDateTimeFormat((%_ToObject(this)),R,S);
}
);
InstallFunction(E.DateTimeFormat.prototype,'resolvedOptions',function(){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if(!%IsInitializedIntlObjectOfType(this,'dateformat')){
throw %make_type_error(127,"DateTimeFormat");
}
var bT={
'gregorian':'gregory',
'ethiopic-amete-alem':'ethioaa'
};
var bH=this;
var bU=fromLDMLString(bH[o][n]);
var bV=bT[bH[o].calendar];
if((bV===(void 0))){
bV=bH[o].calendar;
}
var Y=getOptimalLanguageTag(bH[o].requestedLocale,
bH[o].locale);
var aD={
locale:Y,
numberingSystem:bH[o].numberingSystem,
calendar:bV,
timeZone:bH[o].timeZone
};
addWECPropertyIfDefined(aD,'timeZoneName',bU.timeZoneName);
addWECPropertyIfDefined(aD,'era',bU.era);
addWECPropertyIfDefined(aD,'year',bU.year);
addWECPropertyIfDefined(aD,'month',bU.month);
addWECPropertyIfDefined(aD,'day',bU.day);
addWECPropertyIfDefined(aD,'weekday',bU.weekday);
addWECPropertyIfDefined(aD,'hour12',bU.hour12);
addWECPropertyIfDefined(aD,'hour',bU.hour);
addWECPropertyIfDefined(aD,'minute',bU.minute);
addWECPropertyIfDefined(aD,'second',bU.second);
return aD;
}
);
InstallFunction(E.DateTimeFormat,'supportedLocalesOf',function(R){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
return supportedLocalesOf('dateformat',R,arguments[1]);
}
);
function formatDate(bG,bW){
var bX;
if((bW===(void 0))){
bX=%DateCurrentTime();
}else{
bX=(%_ToNumber(bW));
}
if(!(%_IsSmi(%IS_VAR(bX))||((bX==bX)&&(bX!=1/0)&&(bX!=-1/0))))throw %make_range_error(150);
return %InternalDateFormat(%GetImplFromInitializedIntlObject(bG),
new e(bX));
}
function FormatDateToParts(bW){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"Intl.DateTimeFormat.prototype.formatToParts");
if(!(typeof(this)==='object')){
throw %make_type_error(16,this);
}
var bX;
if((bW===(void 0))){
bX=%DateCurrentTime();
}else{
bX=(%_ToNumber(bW));
}
if(!(%_IsSmi(%IS_VAR(bX))||((bX==bX)&&(bX!=1/0)&&(bX!=-1/0))))throw %make_range_error(150);
return %InternalDateFormatToParts(
%GetImplFromInitializedIntlObject(this),new e(bX));
}
%FunctionSetLength(FormatDateToParts,0);
AddBoundMethod(E.DateTimeFormat,'format',formatDate,0,'dateformat');
function canonicalizeTimeZoneID(bY){
if((bY===(void 0))){
return bY;
}
bY=(%_ToString(bY));
var bZ=%StringToUpperCase(bY);
if(bZ==='UTC'||bZ==='GMT'||
bZ==='ETC/UTC'||bZ==='ETC/GMT'){
return'UTC';
}
var aC=%regexp_internal_match(GetTimezoneNameCheckRE(),bY);
if((aC===null))throw %make_range_error(151,bY);
var aD=toTitleCaseTimezoneLocation(aC[1])+'/'+
toTitleCaseTimezoneLocation(aC[2]);
if(!(aC[3]===(void 0))&&3<aC.length){
var ca=%StringSplit(aC[3],'/',4294967295);
for(var X=1;X<ca.length;X++){
aD=aD+'/'+toTitleCaseTimezoneLocation(ca[X]);
}
}
return aD;
}
function initializeBreakIterator(cb,R,S){
if(%IsInitializedIntlObject(cb)){
throw %make_type_error(126,"v8BreakIterator");
}
if((S===(void 0))){
S={};
}
var ab=getGetOption(S,'breakiterator');
var bh={};
defineWEProperty(bh,'type',ab(
'type','string',['character','word','sentence','line'],'word'));
var Y=resolveLocale('breakiterator',R,S);
var ag=%object_define_properties({},{
requestedLocale:{value:Y.locale,writable:true},
type:{value:bh.type,writable:true},
locale:{writable:true}
});
var cc=%CreateBreakIterator(Y.locale,
bh,
ag);
%MarkAsInitializedIntlObjectOfType(cb,'breakiterator',
cc);
cb[o]=ag;
return cb;
}
InstallConstructor(E,'v8BreakIterator',function(){
var R=arguments[0];
var S=arguments[1];
if(!this||this===E){
return new E.v8BreakIterator(R,S);
}
return initializeBreakIterator((%_ToObject(this)),R,S);
}
);
InstallFunction(E.v8BreakIterator.prototype,'resolvedOptions',
function(){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if(!%IsInitializedIntlObjectOfType(this,'breakiterator')){
throw %make_type_error(127,"v8BreakIterator");
}
var cd=this;
var Y=
getOptimalLanguageTag(cd[o].requestedLocale,
cd[o].locale);
return{
locale:Y,
type:cd[o].type
};
}
);
InstallFunction(E.v8BreakIterator,'supportedLocalesOf',
function(R){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
return supportedLocalesOf('breakiterator',R,arguments[1]);
}
);
function adoptText(cb,ce){
%BreakIteratorAdoptText(%GetImplFromInitializedIntlObject(cb),
(%_ToString(ce)));
}
function first(cb){
return %BreakIteratorFirst(%GetImplFromInitializedIntlObject(cb));
}
function next(cb){
return %BreakIteratorNext(%GetImplFromInitializedIntlObject(cb));
}
function current(cb){
return %BreakIteratorCurrent(%GetImplFromInitializedIntlObject(cb));
}
function breakType(cb){
return %BreakIteratorBreakType(%GetImplFromInitializedIntlObject(cb));
}
AddBoundMethod(E.v8BreakIterator,'adoptText',adoptText,1,
'breakiterator');
AddBoundMethod(E.v8BreakIterator,'first',first,0,'breakiterator');
AddBoundMethod(E.v8BreakIterator,'next',next,0,'breakiterator');
AddBoundMethod(E.v8BreakIterator,'current',current,0,'breakiterator');
AddBoundMethod(E.v8BreakIterator,'breakType',breakType,0,
'breakiterator');
var cf={
'collator':E.Collator,
'numberformat':E.NumberFormat,
'dateformatall':E.DateTimeFormat,
'dateformatdate':E.DateTimeFormat,
'dateformattime':E.DateTimeFormat
};
var cg={
'collator':(void 0),
'numberformat':(void 0),
'dateformatall':(void 0),
'dateformatdate':(void 0),
'dateformattime':(void 0),
};
function clearDefaultObjects(){
cg['dateformatall']=(void 0);
cg['dateformatdate']=(void 0);
cg['dateformattime']=(void 0);
}
var ch=0;
function checkDateCacheCurrent(){
var ci=%DateCacheVersion();
if(ci==ch){
return;
}
ch=ci;
clearDefaultObjects();
}
function cachedOrNewService(Q,R,S,bO){
var cj=((bO===(void 0)))?S:bO;
if((R===(void 0))&&(S===(void 0))){
checkDateCacheCurrent();
if((cg[Q]===(void 0))){
cg[Q]=new cf[Q](R,cj);
}
return cg[Q];
}
return new cf[Q](R,cj);
}
function LocaleConvertCase(ck,R,cl){
var bc;
if((R===(void 0))){
bc=GetDefaultICULocaleJS();
}else if((typeof(R)==='string')){
bc=canonicalizeLanguageTag(R);
}else{
var R=initializeLocaleList(R);
bc=R.length>0?R[0]:GetDefaultICULocaleJS();
}
var Z=%StringIndexOf(bc,'-',0);
if(Z!=-1){
bc=%_Call(r,bc,0,Z);
}
var cm=['az','el','lt','tr'];
var cn=%ArrayIndexOf(cm,bc,0);
if(cn==-1){
return cl?%StringToUpperCaseI18N(ck):%StringToLowerCaseI18N(ck);
}
return %StringLocaleConvertCase(ck,cl,
cm[cn]);
}
m(h.prototype,'localeCompare',function(co){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if((this==null)){
throw %make_type_error(55);
}
var R=arguments[1];
var S=arguments[2];
var bg=cachedOrNewService('collator',R,S);
return compare(bg,this,co);
}
);
m(h.prototype,'normalize',function(){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.normalize");
var ck=(%_ToString(this));
var cp=arguments[0];
var cq=(cp===(void 0))?'NFC':(%_ToString(cp));
var cr=['NFC','NFD','NFKC','NFKD'];
var cs=%ArrayIndexOf(cr,cq,0);
if(cs===-1){
throw %make_range_error(176,
%_Call(c,cr,', '));
}
return %StringNormalize(ck,cs);
}
);
function ToLowerCaseI18N(){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.toLowerCase");
var ck=(%_ToString(this));
return %StringToLowerCaseI18N(ck);
}
function ToUpperCaseI18N(){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.toUpperCase");
var ck=(%_ToString(this));
return %StringToUpperCaseI18N(ck);
}
function ToLocaleLowerCaseI18N(R){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.toLocaleLowerCase");
return LocaleConvertCase((%_ToString(this)),R,false);
}
%FunctionSetLength(ToLocaleLowerCaseI18N,0);
function ToLocaleUpperCaseI18N(R){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.toLocaleUpperCase");
return LocaleConvertCase((%_ToString(this)),R,true);
}
%FunctionSetLength(ToLocaleUpperCaseI18N,0);
%FunctionRemovePrototype(ToLowerCaseI18N);
%FunctionRemovePrototype(ToUpperCaseI18N);
%FunctionRemovePrototype(ToLocaleLowerCaseI18N);
%FunctionRemovePrototype(ToLocaleUpperCaseI18N);
b.Export(function(ct){
ct.ToLowerCaseI18N=ToLowerCaseI18N;
ct.ToUpperCaseI18N=ToUpperCaseI18N;
ct.ToLocaleLowerCaseI18N=ToLocaleLowerCaseI18N;
ct.ToLocaleUpperCaseI18N=ToLocaleUpperCaseI18N;
});
m(f.prototype,'toLocaleString',function(){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
if(!(this instanceof f)&&typeof(this)!=='number'){
throw %make_type_error(56,"Number");
}
var R=arguments[0];
var S=arguments[1];
var bw=cachedOrNewService('numberformat',R,S);
return formatNumber(bw,this);
}
);
function toLocaleDateTime(cu,R,S,bN,bO,Q){
if(!(cu instanceof e)){
throw %make_type_error(56,"Date");
}
var bW=(%_ToNumber(cu));
if((!%_IsSmi(%IS_VAR(bW))&&!(bW==bW)))return'Invalid Date';
var bh=toDateTimeOptions(S,bN,bO);
var bQ=
cachedOrNewService(Q,R,S,bh);
return formatDate(bQ,cu);
}
m(e.prototype,'toLocaleString',function(){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
var R=arguments[0];
var S=arguments[1];
return toLocaleDateTime(
this,R,S,'any','all','dateformatall');
}
);
m(e.prototype,'toLocaleDateString',function(){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
var R=arguments[0];
var S=arguments[1];
return toLocaleDateTime(
this,R,S,'date','date','dateformatdate');
}
);
m(e.prototype,'toLocaleTimeString',function(){
if(!(new.target===(void 0))){
throw %make_type_error(82);
}
var R=arguments[0];
var S=arguments[1];
return toLocaleDateTime(
this,R,S,'time','time','dateformattime');
}
);
%FunctionRemovePrototype(FormatDateToParts);
b.Export(function(ct){
ct.FormatDateToParts=FormatDateToParts;
});
})

 <harmony-atomicsÖ(
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c=a.Object;
var d;
var e=b.ImportNow("to_string_tag_symbol");
b.Import(function(f){
d=f.MaxSimple;
});
function CheckSharedIntegerTypedArray(g){
if(!%IsSharedIntegerTypedArray(g)){
throw %make_type_error(75,g);
}
}
function CheckSharedInteger32TypedArray(g){
CheckSharedIntegerTypedArray(g);
if(!%IsSharedInteger32TypedArray(g)){
throw %make_type_error(76,g);
}
}
function ValidateIndex(h,i){
var j=(%_ToNumber(h));
var k=(%_ToInteger(j));
if(j!==k){
throw %make_range_error(156);
}
if(k<0||k>=i){
throw %make_range_error(156);
}
return k;
}
function AtomicsCompareExchangeJS(l,h,m,n){
CheckSharedIntegerTypedArray(l);
h=ValidateIndex(h,%_TypedArrayGetLength(l));
m=(%_ToNumber(m));
n=(%_ToNumber(n));
return %_AtomicsCompareExchange(l,h,m,n);
}
function AtomicsAddJS(g,h,o){
CheckSharedIntegerTypedArray(g);
h=ValidateIndex(h,%_TypedArrayGetLength(g));
o=(%_ToNumber(o));
return %_AtomicsAdd(g,h,o);
}
function AtomicsSubJS(g,h,o){
CheckSharedIntegerTypedArray(g);
h=ValidateIndex(h,%_TypedArrayGetLength(g));
o=(%_ToNumber(o));
return %_AtomicsSub(g,h,o);
}
function AtomicsAndJS(g,h,o){
CheckSharedIntegerTypedArray(g);
h=ValidateIndex(h,%_TypedArrayGetLength(g));
o=(%_ToNumber(o));
return %_AtomicsAnd(g,h,o);
}
function AtomicsOrJS(g,h,o){
CheckSharedIntegerTypedArray(g);
h=ValidateIndex(h,%_TypedArrayGetLength(g));
o=(%_ToNumber(o));
return %_AtomicsOr(g,h,o);
}
function AtomicsXorJS(g,h,o){
CheckSharedIntegerTypedArray(g);
h=ValidateIndex(h,%_TypedArrayGetLength(g));
o=(%_ToNumber(o));
return %_AtomicsXor(g,h,o);
}
function AtomicsExchangeJS(g,h,o){
CheckSharedIntegerTypedArray(g);
h=ValidateIndex(h,%_TypedArrayGetLength(g));
o=(%_ToNumber(o));
return %_AtomicsExchange(g,h,o);
}
function AtomicsIsLockFreeJS(p){
return %_AtomicsIsLockFree(p);
}
function AtomicsWaitJS(g,h,o,q){
CheckSharedInteger32TypedArray(g);
h=ValidateIndex(h,%_TypedArrayGetLength(g));
if((q===(void 0))){
q=(1/0);
}else{
q=(%_ToNumber(q));
if((!%_IsSmi(%IS_VAR(q))&&!(q==q))){
q=(1/0);
}else{
q=d(0,q);
}
}
return %AtomicsWait(g,h,o,q);
}
function AtomicsWakeJS(g,h,r){
CheckSharedInteger32TypedArray(g);
h=ValidateIndex(h,%_TypedArrayGetLength(g));
r=d(0,(%_ToInteger(r)));
return %AtomicsWake(g,h,r);
}
var s=a.Atomics;
%AddNamedProperty(s,e,"Atomics",1|2);
b.InstallFunctions(s,2,[
"compareExchange",AtomicsCompareExchangeJS,
"add",AtomicsAddJS,
"sub",AtomicsSubJS,
"and",AtomicsAndJS,
"or",AtomicsOrJS,
"xor",AtomicsXorJS,
"exchange",AtomicsExchangeJS,
"isLockFree",AtomicsIsLockFreeJS,
"wait",AtomicsWaitJS,
"wake",AtomicsWakeJS,
]);
})

0harmony-simdé¥
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c=a.SIMD;
var d=b.ImportNow("to_string_tag_symbol");
var e=c.Float32x4;


var f=c.Int32x4;

var g=c.Int16x8;

var h=c.Int8x16;


var i=c.Uint32x4;

var j=c.Uint16x8;

var k=c.Uint8x16;


var l=c.Bool32x4;

var m=c.Bool16x8;

var n=c.Bool8x16;



function Float32x4CheckJS(o){
return %Float32x4Check(o);
}
function Float32x4ToString(){
var p=%ValueOf(this);
if(typeof(p)!=='float32x4'){
throw %make_type_error(45,
"Float32x4.prototype.toString",this);
}
var q="SIMD.Float32x4(";
q+=%Float32x4ExtractLane(p,0);
for(var r=1;r<4;r++){
q+=", "+%Float32x4ExtractLane(p,r);
}
return q+")";
}
function Float32x4ToLocaleString(){
var p=%ValueOf(this);
if(typeof(p)!=='float32x4'){
throw %make_type_error(45,
"Float32x4.prototype.toLocaleString",this);
}
var q="SIMD.Float32x4(";
q+=%Float32x4ExtractLane(p,0).toLocaleString();
for(var r=1;r<4;r++){
q+=", "+%Float32x4ExtractLane(p,r).toLocaleString();
}
return q+")";
}
function Float32x4ValueOf(){
var p=%ValueOf(this);
if(typeof(p)!=='float32x4'){
throw %make_type_error(45,
"Float32x4.prototype.valueOf",this);
}
return p;
}
function Float32x4ExtractLaneJS(s,t){
return %Float32x4ExtractLane(s,t);
}


function Int32x4CheckJS(o){
return %Int32x4Check(o);
}
function Int32x4ToString(){
var p=%ValueOf(this);
if(typeof(p)!=='int32x4'){
throw %make_type_error(45,
"Int32x4.prototype.toString",this);
}
var q="SIMD.Int32x4(";
q+=%Int32x4ExtractLane(p,0);
for(var r=1;r<4;r++){
q+=", "+%Int32x4ExtractLane(p,r);
}
return q+")";
}
function Int32x4ToLocaleString(){
var p=%ValueOf(this);
if(typeof(p)!=='int32x4'){
throw %make_type_error(45,
"Int32x4.prototype.toLocaleString",this);
}
var q="SIMD.Int32x4(";
q+=%Int32x4ExtractLane(p,0).toLocaleString();
for(var r=1;r<4;r++){
q+=", "+%Int32x4ExtractLane(p,r).toLocaleString();
}
return q+")";
}
function Int32x4ValueOf(){
var p=%ValueOf(this);
if(typeof(p)!=='int32x4'){
throw %make_type_error(45,
"Int32x4.prototype.valueOf",this);
}
return p;
}
function Int32x4ExtractLaneJS(s,t){
return %Int32x4ExtractLane(s,t);
}

function Int16x8CheckJS(o){
return %Int16x8Check(o);
}
function Int16x8ToString(){
var p=%ValueOf(this);
if(typeof(p)!=='int16x8'){
throw %make_type_error(45,
"Int16x8.prototype.toString",this);
}
var q="SIMD.Int16x8(";
q+=%Int16x8ExtractLane(p,0);
for(var r=1;r<8;r++){
q+=", "+%Int16x8ExtractLane(p,r);
}
return q+")";
}
function Int16x8ToLocaleString(){
var p=%ValueOf(this);
if(typeof(p)!=='int16x8'){
throw %make_type_error(45,
"Int16x8.prototype.toLocaleString",this);
}
var q="SIMD.Int16x8(";
q+=%Int16x8ExtractLane(p,0).toLocaleString();
for(var r=1;r<8;r++){
q+=", "+%Int16x8ExtractLane(p,r).toLocaleString();
}
return q+")";
}
function Int16x8ValueOf(){
var p=%ValueOf(this);
if(typeof(p)!=='int16x8'){
throw %make_type_error(45,
"Int16x8.prototype.valueOf",this);
}
return p;
}
function Int16x8ExtractLaneJS(s,t){
return %Int16x8ExtractLane(s,t);
}

function Int8x16CheckJS(o){
return %Int8x16Check(o);
}
function Int8x16ToString(){
var p=%ValueOf(this);
if(typeof(p)!=='int8x16'){
throw %make_type_error(45,
"Int8x16.prototype.toString",this);
}
var q="SIMD.Int8x16(";
q+=%Int8x16ExtractLane(p,0);
for(var r=1;r<16;r++){
q+=", "+%Int8x16ExtractLane(p,r);
}
return q+")";
}
function Int8x16ToLocaleString(){
var p=%ValueOf(this);
if(typeof(p)!=='int8x16'){
throw %make_type_error(45,
"Int8x16.prototype.toLocaleString",this);
}
var q="SIMD.Int8x16(";
q+=%Int8x16ExtractLane(p,0).toLocaleString();
for(var r=1;r<16;r++){
q+=", "+%Int8x16ExtractLane(p,r).toLocaleString();
}
return q+")";
}
function Int8x16ValueOf(){
var p=%ValueOf(this);
if(typeof(p)!=='int8x16'){
throw %make_type_error(45,
"Int8x16.prototype.valueOf",this);
}
return p;
}
function Int8x16ExtractLaneJS(s,t){
return %Int8x16ExtractLane(s,t);
}


function Uint32x4CheckJS(o){
return %Uint32x4Check(o);
}
function Uint32x4ToString(){
var p=%ValueOf(this);
if(typeof(p)!=='uint32x4'){
throw %make_type_error(45,
"Uint32x4.prototype.toString",this);
}
var q="SIMD.Uint32x4(";
q+=%Uint32x4ExtractLane(p,0);
for(var r=1;r<4;r++){
q+=", "+%Uint32x4ExtractLane(p,r);
}
return q+")";
}
function Uint32x4ToLocaleString(){
var p=%ValueOf(this);
if(typeof(p)!=='uint32x4'){
throw %make_type_error(45,
"Uint32x4.prototype.toLocaleString",this);
}
var q="SIMD.Uint32x4(";
q+=%Uint32x4ExtractLane(p,0).toLocaleString();
for(var r=1;r<4;r++){
q+=", "+%Uint32x4ExtractLane(p,r).toLocaleString();
}
return q+")";
}
function Uint32x4ValueOf(){
var p=%ValueOf(this);
if(typeof(p)!=='uint32x4'){
throw %make_type_error(45,
"Uint32x4.prototype.valueOf",this);
}
return p;
}
function Uint32x4ExtractLaneJS(s,t){
return %Uint32x4ExtractLane(s,t);
}

function Uint16x8CheckJS(o){
return %Uint16x8Check(o);
}
function Uint16x8ToString(){
var p=%ValueOf(this);
if(typeof(p)!=='uint16x8'){
throw %make_type_error(45,
"Uint16x8.prototype.toString",this);
}
var q="SIMD.Uint16x8(";
q+=%Uint16x8ExtractLane(p,0);
for(var r=1;r<8;r++){
q+=", "+%Uint16x8ExtractLane(p,r);
}
return q+")";
}
function Uint16x8ToLocaleString(){
var p=%ValueOf(this);
if(typeof(p)!=='uint16x8'){
throw %make_type_error(45,
"Uint16x8.prototype.toLocaleString",this);
}
var q="SIMD.Uint16x8(";
q+=%Uint16x8ExtractLane(p,0).toLocaleString();
for(var r=1;r<8;r++){
q+=", "+%Uint16x8ExtractLane(p,r).toLocaleString();
}
return q+")";
}
function Uint16x8ValueOf(){
var p=%ValueOf(this);
if(typeof(p)!=='uint16x8'){
throw %make_type_error(45,
"Uint16x8.prototype.valueOf",this);
}
return p;
}
function Uint16x8ExtractLaneJS(s,t){
return %Uint16x8ExtractLane(s,t);
}

function Uint8x16CheckJS(o){
return %Uint8x16Check(o);
}
function Uint8x16ToString(){
var p=%ValueOf(this);
if(typeof(p)!=='uint8x16'){
throw %make_type_error(45,
"Uint8x16.prototype.toString",this);
}
var q="SIMD.Uint8x16(";
q+=%Uint8x16ExtractLane(p,0);
for(var r=1;r<16;r++){
q+=", "+%Uint8x16ExtractLane(p,r);
}
return q+")";
}
function Uint8x16ToLocaleString(){
var p=%ValueOf(this);
if(typeof(p)!=='uint8x16'){
throw %make_type_error(45,
"Uint8x16.prototype.toLocaleString",this);
}
var q="SIMD.Uint8x16(";
q+=%Uint8x16ExtractLane(p,0).toLocaleString();
for(var r=1;r<16;r++){
q+=", "+%Uint8x16ExtractLane(p,r).toLocaleString();
}
return q+")";
}
function Uint8x16ValueOf(){
var p=%ValueOf(this);
if(typeof(p)!=='uint8x16'){
throw %make_type_error(45,
"Uint8x16.prototype.valueOf",this);
}
return p;
}
function Uint8x16ExtractLaneJS(s,t){
return %Uint8x16ExtractLane(s,t);
}


function Bool32x4CheckJS(o){
return %Bool32x4Check(o);
}
function Bool32x4ToString(){
var p=%ValueOf(this);
if(typeof(p)!=='bool32x4'){
throw %make_type_error(45,
"Bool32x4.prototype.toString",this);
}
var q="SIMD.Bool32x4(";
q+=%Bool32x4ExtractLane(p,0);
for(var r=1;r<4;r++){
q+=", "+%Bool32x4ExtractLane(p,r);
}
return q+")";
}
function Bool32x4ToLocaleString(){
var p=%ValueOf(this);
if(typeof(p)!=='bool32x4'){
throw %make_type_error(45,
"Bool32x4.prototype.toLocaleString",this);
}
var q="SIMD.Bool32x4(";
q+=%Bool32x4ExtractLane(p,0).toLocaleString();
for(var r=1;r<4;r++){
q+=", "+%Bool32x4ExtractLane(p,r).toLocaleString();
}
return q+")";
}
function Bool32x4ValueOf(){
var p=%ValueOf(this);
if(typeof(p)!=='bool32x4'){
throw %make_type_error(45,
"Bool32x4.prototype.valueOf",this);
}
return p;
}
function Bool32x4ExtractLaneJS(s,t){
return %Bool32x4ExtractLane(s,t);
}

function Bool16x8CheckJS(o){
return %Bool16x8Check(o);
}
function Bool16x8ToString(){
var p=%ValueOf(this);
if(typeof(p)!=='bool16x8'){
throw %make_type_error(45,
"Bool16x8.prototype.toString",this);
}
var q="SIMD.Bool16x8(";
q+=%Bool16x8ExtractLane(p,0);
for(var r=1;r<8;r++){
q+=", "+%Bool16x8ExtractLane(p,r);
}
return q+")";
}
function Bool16x8ToLocaleString(){
var p=%ValueOf(this);
if(typeof(p)!=='bool16x8'){
throw %make_type_error(45,
"Bool16x8.prototype.toLocaleString",this);
}
var q="SIMD.Bool16x8(";
q+=%Bool16x8ExtractLane(p,0).toLocaleString();
for(var r=1;r<8;r++){
q+=", "+%Bool16x8ExtractLane(p,r).toLocaleString();
}
return q+")";
}
function Bool16x8ValueOf(){
var p=%ValueOf(this);
if(typeof(p)!=='bool16x8'){
throw %make_type_error(45,
"Bool16x8.prototype.valueOf",this);
}
return p;
}
function Bool16x8ExtractLaneJS(s,t){
return %Bool16x8ExtractLane(s,t);
}

function Bool8x16CheckJS(o){
return %Bool8x16Check(o);
}
function Bool8x16ToString(){
var p=%ValueOf(this);
if(typeof(p)!=='bool8x16'){
throw %make_type_error(45,
"Bool8x16.prototype.toString",this);
}
var q="SIMD.Bool8x16(";
q+=%Bool8x16ExtractLane(p,0);
for(var r=1;r<16;r++){
q+=", "+%Bool8x16ExtractLane(p,r);
}
return q+")";
}
function Bool8x16ToLocaleString(){
var p=%ValueOf(this);
if(typeof(p)!=='bool8x16'){
throw %make_type_error(45,
"Bool8x16.prototype.toLocaleString",this);
}
var q="SIMD.Bool8x16(";
q+=%Bool8x16ExtractLane(p,0).toLocaleString();
for(var r=1;r<16;r++){
q+=", "+%Bool8x16ExtractLane(p,r).toLocaleString();
}
return q+")";
}
function Bool8x16ValueOf(){
var p=%ValueOf(this);
if(typeof(p)!=='bool8x16'){
throw %make_type_error(45,
"Bool8x16.prototype.valueOf",this);
}
return p;
}
function Bool8x16ExtractLaneJS(s,t){
return %Bool8x16ExtractLane(s,t);
}



function Int32x4ShiftLeftByScalarJS(s,u){
return %Int32x4ShiftLeftByScalar(s,u);
}
function Int32x4ShiftRightByScalarJS(s,u){
return %Int32x4ShiftRightByScalar(s,u);
}

function Int16x8ShiftLeftByScalarJS(s,u){
return %Int16x8ShiftLeftByScalar(s,u);
}
function Int16x8ShiftRightByScalarJS(s,u){
return %Int16x8ShiftRightByScalar(s,u);
}

function Int8x16ShiftLeftByScalarJS(s,u){
return %Int8x16ShiftLeftByScalar(s,u);
}
function Int8x16ShiftRightByScalarJS(s,u){
return %Int8x16ShiftRightByScalar(s,u);
}


function Uint32x4ShiftLeftByScalarJS(s,u){
return %Uint32x4ShiftLeftByScalar(s,u);
}
function Uint32x4ShiftRightByScalarJS(s,u){
return %Uint32x4ShiftRightByScalar(s,u);
}

function Uint16x8ShiftLeftByScalarJS(s,u){
return %Uint16x8ShiftLeftByScalar(s,u);
}
function Uint16x8ShiftRightByScalarJS(s,u){
return %Uint16x8ShiftRightByScalar(s,u);
}

function Uint8x16ShiftLeftByScalarJS(s,u){
return %Uint8x16ShiftLeftByScalar(s,u);
}
function Uint8x16ShiftRightByScalarJS(s,u){
return %Uint8x16ShiftRightByScalar(s,u);
}


function Int16x8AddSaturateJS(o,v){
return %Int16x8AddSaturate(o,v);
}
function Int16x8SubSaturateJS(o,v){
return %Int16x8SubSaturate(o,v);
}

function Int8x16AddSaturateJS(o,v){
return %Int8x16AddSaturate(o,v);
}
function Int8x16SubSaturateJS(o,v){
return %Int8x16SubSaturate(o,v);
}

function Uint8x16AddSaturateJS(o,v){
return %Uint8x16AddSaturate(o,v);
}
function Uint8x16SubSaturateJS(o,v){
return %Uint8x16SubSaturate(o,v);
}

function Uint16x8AddSaturateJS(o,v){
return %Uint16x8AddSaturate(o,v);
}
function Uint16x8SubSaturateJS(o,v){
return %Uint16x8SubSaturate(o,v);
}


function Float32x4NegJS(o){
return %Float32x4Neg(o);
}


function Int32x4NegJS(o){
return %Int32x4Neg(o);
}

function Int16x8NegJS(o){
return %Int16x8Neg(o);
}

function Int8x16NegJS(o){
return %Int8x16Neg(o);
}


function Bool32x4ReplaceLaneJS(s,t,p){
return %Bool32x4ReplaceLane(s,t,p);
}
function Bool32x4AnyTrueJS(w){
return %Bool32x4AnyTrue(w);
}
function Bool32x4AllTrueJS(w){
return %Bool32x4AllTrue(w);
}

function Bool16x8ReplaceLaneJS(s,t,p){
return %Bool16x8ReplaceLane(s,t,p);
}
function Bool16x8AnyTrueJS(w){
return %Bool16x8AnyTrue(w);
}
function Bool16x8AllTrueJS(w){
return %Bool16x8AllTrue(w);
}

function Bool8x16ReplaceLaneJS(s,t,p){
return %Bool8x16ReplaceLane(s,t,p);
}
function Bool8x16AnyTrueJS(w){
return %Bool8x16AnyTrue(w);
}
function Bool8x16AllTrueJS(w){
return %Bool8x16AllTrue(w);
}


function Float32x4ReplaceLaneJS(s,t,p){
return %Float32x4ReplaceLane(s,t,(%_ToNumber(p)));
}
function Float32x4SelectJS(x,o,v){
return %Float32x4Select(x,o,v);
}
function Float32x4AddJS(o,v){
return %Float32x4Add(o,v);
}
function Float32x4SubJS(o,v){
return %Float32x4Sub(o,v);
}
function Float32x4MulJS(o,v){
return %Float32x4Mul(o,v);
}
function Float32x4MinJS(o,v){
return %Float32x4Min(o,v);
}
function Float32x4MaxJS(o,v){
return %Float32x4Max(o,v);
}
function Float32x4EqualJS(o,v){
return %Float32x4Equal(o,v);
}
function Float32x4NotEqualJS(o,v){
return %Float32x4NotEqual(o,v);
}
function Float32x4LessThanJS(o,v){
return %Float32x4LessThan(o,v);
}
function Float32x4LessThanOrEqualJS(o,v){
return %Float32x4LessThanOrEqual(o,v);
}
function Float32x4GreaterThanJS(o,v){
return %Float32x4GreaterThan(o,v);
}
function Float32x4GreaterThanOrEqualJS(o,v){
return %Float32x4GreaterThanOrEqual(o,v);
}
function Float32x4LoadJS(y,z){
return %Float32x4Load(y,z);
}
function Float32x4StoreJS(y,z,o){
return %Float32x4Store(y,z,o);
}


function Int32x4ReplaceLaneJS(s,t,p){
return %Int32x4ReplaceLane(s,t,(%_ToNumber(p)));
}
function Int32x4SelectJS(x,o,v){
return %Int32x4Select(x,o,v);
}
function Int32x4AddJS(o,v){
return %Int32x4Add(o,v);
}
function Int32x4SubJS(o,v){
return %Int32x4Sub(o,v);
}
function Int32x4MulJS(o,v){
return %Int32x4Mul(o,v);
}
function Int32x4MinJS(o,v){
return %Int32x4Min(o,v);
}
function Int32x4MaxJS(o,v){
return %Int32x4Max(o,v);
}
function Int32x4EqualJS(o,v){
return %Int32x4Equal(o,v);
}
function Int32x4NotEqualJS(o,v){
return %Int32x4NotEqual(o,v);
}
function Int32x4LessThanJS(o,v){
return %Int32x4LessThan(o,v);
}
function Int32x4LessThanOrEqualJS(o,v){
return %Int32x4LessThanOrEqual(o,v);
}
function Int32x4GreaterThanJS(o,v){
return %Int32x4GreaterThan(o,v);
}
function Int32x4GreaterThanOrEqualJS(o,v){
return %Int32x4GreaterThanOrEqual(o,v);
}
function Int32x4LoadJS(y,z){
return %Int32x4Load(y,z);
}
function Int32x4StoreJS(y,z,o){
return %Int32x4Store(y,z,o);
}

function Int16x8ReplaceLaneJS(s,t,p){
return %Int16x8ReplaceLane(s,t,(%_ToNumber(p)));
}
function Int16x8SelectJS(x,o,v){
return %Int16x8Select(x,o,v);
}
function Int16x8AddJS(o,v){
return %Int16x8Add(o,v);
}
function Int16x8SubJS(o,v){
return %Int16x8Sub(o,v);
}
function Int16x8MulJS(o,v){
return %Int16x8Mul(o,v);
}
function Int16x8MinJS(o,v){
return %Int16x8Min(o,v);
}
function Int16x8MaxJS(o,v){
return %Int16x8Max(o,v);
}
function Int16x8EqualJS(o,v){
return %Int16x8Equal(o,v);
}
function Int16x8NotEqualJS(o,v){
return %Int16x8NotEqual(o,v);
}
function Int16x8LessThanJS(o,v){
return %Int16x8LessThan(o,v);
}
function Int16x8LessThanOrEqualJS(o,v){
return %Int16x8LessThanOrEqual(o,v);
}
function Int16x8GreaterThanJS(o,v){
return %Int16x8GreaterThan(o,v);
}
function Int16x8GreaterThanOrEqualJS(o,v){
return %Int16x8GreaterThanOrEqual(o,v);
}
function Int16x8LoadJS(y,z){
return %Int16x8Load(y,z);
}
function Int16x8StoreJS(y,z,o){
return %Int16x8Store(y,z,o);
}

function Int8x16ReplaceLaneJS(s,t,p){
return %Int8x16ReplaceLane(s,t,(%_ToNumber(p)));
}
function Int8x16SelectJS(x,o,v){
return %Int8x16Select(x,o,v);
}
function Int8x16AddJS(o,v){
return %Int8x16Add(o,v);
}
function Int8x16SubJS(o,v){
return %Int8x16Sub(o,v);
}
function Int8x16MulJS(o,v){
return %Int8x16Mul(o,v);
}
function Int8x16MinJS(o,v){
return %Int8x16Min(o,v);
}
function Int8x16MaxJS(o,v){
return %Int8x16Max(o,v);
}
function Int8x16EqualJS(o,v){
return %Int8x16Equal(o,v);
}
function Int8x16NotEqualJS(o,v){
return %Int8x16NotEqual(o,v);
}
function Int8x16LessThanJS(o,v){
return %Int8x16LessThan(o,v);
}
function Int8x16LessThanOrEqualJS(o,v){
return %Int8x16LessThanOrEqual(o,v);
}
function Int8x16GreaterThanJS(o,v){
return %Int8x16GreaterThan(o,v);
}
function Int8x16GreaterThanOrEqualJS(o,v){
return %Int8x16GreaterThanOrEqual(o,v);
}
function Int8x16LoadJS(y,z){
return %Int8x16Load(y,z);
}
function Int8x16StoreJS(y,z,o){
return %Int8x16Store(y,z,o);
}


function Uint32x4ReplaceLaneJS(s,t,p){
return %Uint32x4ReplaceLane(s,t,(%_ToNumber(p)));
}
function Uint32x4SelectJS(x,o,v){
return %Uint32x4Select(x,o,v);
}
function Uint32x4AddJS(o,v){
return %Uint32x4Add(o,v);
}
function Uint32x4SubJS(o,v){
return %Uint32x4Sub(o,v);
}
function Uint32x4MulJS(o,v){
return %Uint32x4Mul(o,v);
}
function Uint32x4MinJS(o,v){
return %Uint32x4Min(o,v);
}
function Uint32x4MaxJS(o,v){
return %Uint32x4Max(o,v);
}
function Uint32x4EqualJS(o,v){
return %Uint32x4Equal(o,v);
}
function Uint32x4NotEqualJS(o,v){
return %Uint32x4NotEqual(o,v);
}
function Uint32x4LessThanJS(o,v){
return %Uint32x4LessThan(o,v);
}
function Uint32x4LessThanOrEqualJS(o,v){
return %Uint32x4LessThanOrEqual(o,v);
}
function Uint32x4GreaterThanJS(o,v){
return %Uint32x4GreaterThan(o,v);
}
function Uint32x4GreaterThanOrEqualJS(o,v){
return %Uint32x4GreaterThanOrEqual(o,v);
}
function Uint32x4LoadJS(y,z){
return %Uint32x4Load(y,z);
}
function Uint32x4StoreJS(y,z,o){
return %Uint32x4Store(y,z,o);
}

function Uint16x8ReplaceLaneJS(s,t,p){
return %Uint16x8ReplaceLane(s,t,(%_ToNumber(p)));
}
function Uint16x8SelectJS(x,o,v){
return %Uint16x8Select(x,o,v);
}
function Uint16x8AddJS(o,v){
return %Uint16x8Add(o,v);
}
function Uint16x8SubJS(o,v){
return %Uint16x8Sub(o,v);
}
function Uint16x8MulJS(o,v){
return %Uint16x8Mul(o,v);
}
function Uint16x8MinJS(o,v){
return %Uint16x8Min(o,v);
}
function Uint16x8MaxJS(o,v){
return %Uint16x8Max(o,v);
}
function Uint16x8EqualJS(o,v){
return %Uint16x8Equal(o,v);
}
function Uint16x8NotEqualJS(o,v){
return %Uint16x8NotEqual(o,v);
}
function Uint16x8LessThanJS(o,v){
return %Uint16x8LessThan(o,v);
}
function Uint16x8LessThanOrEqualJS(o,v){
return %Uint16x8LessThanOrEqual(o,v);
}
function Uint16x8GreaterThanJS(o,v){
return %Uint16x8GreaterThan(o,v);
}
function Uint16x8GreaterThanOrEqualJS(o,v){
return %Uint16x8GreaterThanOrEqual(o,v);
}
function Uint16x8LoadJS(y,z){
return %Uint16x8Load(y,z);
}
function Uint16x8StoreJS(y,z,o){
return %Uint16x8Store(y,z,o);
}

function Uint8x16ReplaceLaneJS(s,t,p){
return %Uint8x16ReplaceLane(s,t,(%_ToNumber(p)));
}
function Uint8x16SelectJS(x,o,v){
return %Uint8x16Select(x,o,v);
}
function Uint8x16AddJS(o,v){
return %Uint8x16Add(o,v);
}
function Uint8x16SubJS(o,v){
return %Uint8x16Sub(o,v);
}
function Uint8x16MulJS(o,v){
return %Uint8x16Mul(o,v);
}
function Uint8x16MinJS(o,v){
return %Uint8x16Min(o,v);
}
function Uint8x16MaxJS(o,v){
return %Uint8x16Max(o,v);
}
function Uint8x16EqualJS(o,v){
return %Uint8x16Equal(o,v);
}
function Uint8x16NotEqualJS(o,v){
return %Uint8x16NotEqual(o,v);
}
function Uint8x16LessThanJS(o,v){
return %Uint8x16LessThan(o,v);
}
function Uint8x16LessThanOrEqualJS(o,v){
return %Uint8x16LessThanOrEqual(o,v);
}
function Uint8x16GreaterThanJS(o,v){
return %Uint8x16GreaterThan(o,v);
}
function Uint8x16GreaterThanOrEqualJS(o,v){
return %Uint8x16GreaterThanOrEqual(o,v);
}
function Uint8x16LoadJS(y,z){
return %Uint8x16Load(y,z);
}
function Uint8x16StoreJS(y,z,o){
return %Uint8x16Store(y,z,o);
}



function Int32x4AndJS(o,v){
return %Int32x4And(o,v);
}
function Int32x4OrJS(o,v){
return %Int32x4Or(o,v);
}
function Int32x4XorJS(o,v){
return %Int32x4Xor(o,v);
}
function Int32x4NotJS(o){
return %Int32x4Not(o);
}

function Int16x8AndJS(o,v){
return %Int16x8And(o,v);
}
function Int16x8OrJS(o,v){
return %Int16x8Or(o,v);
}
function Int16x8XorJS(o,v){
return %Int16x8Xor(o,v);
}
function Int16x8NotJS(o){
return %Int16x8Not(o);
}

function Int8x16AndJS(o,v){
return %Int8x16And(o,v);
}
function Int8x16OrJS(o,v){
return %Int8x16Or(o,v);
}
function Int8x16XorJS(o,v){
return %Int8x16Xor(o,v);
}
function Int8x16NotJS(o){
return %Int8x16Not(o);
}


function Uint32x4AndJS(o,v){
return %Uint32x4And(o,v);
}
function Uint32x4OrJS(o,v){
return %Uint32x4Or(o,v);
}
function Uint32x4XorJS(o,v){
return %Uint32x4Xor(o,v);
}
function Uint32x4NotJS(o){
return %Uint32x4Not(o);
}

function Uint16x8AndJS(o,v){
return %Uint16x8And(o,v);
}
function Uint16x8OrJS(o,v){
return %Uint16x8Or(o,v);
}
function Uint16x8XorJS(o,v){
return %Uint16x8Xor(o,v);
}
function Uint16x8NotJS(o){
return %Uint16x8Not(o);
}

function Uint8x16AndJS(o,v){
return %Uint8x16And(o,v);
}
function Uint8x16OrJS(o,v){
return %Uint8x16Or(o,v);
}
function Uint8x16XorJS(o,v){
return %Uint8x16Xor(o,v);
}
function Uint8x16NotJS(o){
return %Uint8x16Not(o);
}


function Bool32x4AndJS(o,v){
return %Bool32x4And(o,v);
}
function Bool32x4OrJS(o,v){
return %Bool32x4Or(o,v);
}
function Bool32x4XorJS(o,v){
return %Bool32x4Xor(o,v);
}
function Bool32x4NotJS(o){
return %Bool32x4Not(o);
}

function Bool16x8AndJS(o,v){
return %Bool16x8And(o,v);
}
function Bool16x8OrJS(o,v){
return %Bool16x8Or(o,v);
}
function Bool16x8XorJS(o,v){
return %Bool16x8Xor(o,v);
}
function Bool16x8NotJS(o){
return %Bool16x8Not(o);
}

function Bool8x16AndJS(o,v){
return %Bool8x16And(o,v);
}
function Bool8x16OrJS(o,v){
return %Bool8x16Or(o,v);
}
function Bool8x16XorJS(o,v){
return %Bool8x16Xor(o,v);
}
function Bool8x16NotJS(o){
return %Bool8x16Not(o);
}



function Float32x4FromInt32x4JS(o){
return %Float32x4FromInt32x4(o);
}

function Float32x4FromUint32x4JS(o){
return %Float32x4FromUint32x4(o);
}

function Int32x4FromFloat32x4JS(o){
return %Int32x4FromFloat32x4(o);
}

function Int32x4FromUint32x4JS(o){
return %Int32x4FromUint32x4(o);
}

function Uint32x4FromFloat32x4JS(o){
return %Uint32x4FromFloat32x4(o);
}

function Uint32x4FromInt32x4JS(o){
return %Uint32x4FromInt32x4(o);
}

function Int16x8FromUint16x8JS(o){
return %Int16x8FromUint16x8(o);
}

function Uint16x8FromInt16x8JS(o){
return %Uint16x8FromInt16x8(o);
}

function Int8x16FromUint8x16JS(o){
return %Int8x16FromUint8x16(o);
}

function Uint8x16FromInt8x16JS(o){
return %Uint8x16FromInt8x16(o);
}


function Float32x4FromInt32x4BitsJS(o){
return %Float32x4FromInt32x4Bits(o);
}

function Float32x4FromUint32x4BitsJS(o){
return %Float32x4FromUint32x4Bits(o);
}

function Float32x4FromInt16x8BitsJS(o){
return %Float32x4FromInt16x8Bits(o);
}

function Float32x4FromUint16x8BitsJS(o){
return %Float32x4FromUint16x8Bits(o);
}

function Float32x4FromInt8x16BitsJS(o){
return %Float32x4FromInt8x16Bits(o);
}

function Float32x4FromUint8x16BitsJS(o){
return %Float32x4FromUint8x16Bits(o);
}

function Int32x4FromFloat32x4BitsJS(o){
return %Int32x4FromFloat32x4Bits(o);
}

function Int32x4FromUint32x4BitsJS(o){
return %Int32x4FromUint32x4Bits(o);
}

function Int32x4FromInt16x8BitsJS(o){
return %Int32x4FromInt16x8Bits(o);
}

function Int32x4FromUint16x8BitsJS(o){
return %Int32x4FromUint16x8Bits(o);
}

function Int32x4FromInt8x16BitsJS(o){
return %Int32x4FromInt8x16Bits(o);
}

function Int32x4FromUint8x16BitsJS(o){
return %Int32x4FromUint8x16Bits(o);
}

function Uint32x4FromFloat32x4BitsJS(o){
return %Uint32x4FromFloat32x4Bits(o);
}

function Uint32x4FromInt32x4BitsJS(o){
return %Uint32x4FromInt32x4Bits(o);
}

function Uint32x4FromInt16x8BitsJS(o){
return %Uint32x4FromInt16x8Bits(o);
}

function Uint32x4FromUint16x8BitsJS(o){
return %Uint32x4FromUint16x8Bits(o);
}

function Uint32x4FromInt8x16BitsJS(o){
return %Uint32x4FromInt8x16Bits(o);
}

function Uint32x4FromUint8x16BitsJS(o){
return %Uint32x4FromUint8x16Bits(o);
}

function Int16x8FromFloat32x4BitsJS(o){
return %Int16x8FromFloat32x4Bits(o);
}

function Int16x8FromInt32x4BitsJS(o){
return %Int16x8FromInt32x4Bits(o);
}

function Int16x8FromUint32x4BitsJS(o){
return %Int16x8FromUint32x4Bits(o);
}

function Int16x8FromUint16x8BitsJS(o){
return %Int16x8FromUint16x8Bits(o);
}

function Int16x8FromInt8x16BitsJS(o){
return %Int16x8FromInt8x16Bits(o);
}

function Int16x8FromUint8x16BitsJS(o){
return %Int16x8FromUint8x16Bits(o);
}

function Uint16x8FromFloat32x4BitsJS(o){
return %Uint16x8FromFloat32x4Bits(o);
}

function Uint16x8FromInt32x4BitsJS(o){
return %Uint16x8FromInt32x4Bits(o);
}

function Uint16x8FromUint32x4BitsJS(o){
return %Uint16x8FromUint32x4Bits(o);
}

function Uint16x8FromInt16x8BitsJS(o){
return %Uint16x8FromInt16x8Bits(o);
}

function Uint16x8FromInt8x16BitsJS(o){
return %Uint16x8FromInt8x16Bits(o);
}

function Uint16x8FromUint8x16BitsJS(o){
return %Uint16x8FromUint8x16Bits(o);
}

function Int8x16FromFloat32x4BitsJS(o){
return %Int8x16FromFloat32x4Bits(o);
}

function Int8x16FromInt32x4BitsJS(o){
return %Int8x16FromInt32x4Bits(o);
}

function Int8x16FromUint32x4BitsJS(o){
return %Int8x16FromUint32x4Bits(o);
}

function Int8x16FromInt16x8BitsJS(o){
return %Int8x16FromInt16x8Bits(o);
}

function Int8x16FromUint16x8BitsJS(o){
return %Int8x16FromUint16x8Bits(o);
}

function Int8x16FromUint8x16BitsJS(o){
return %Int8x16FromUint8x16Bits(o);
}

function Uint8x16FromFloat32x4BitsJS(o){
return %Uint8x16FromFloat32x4Bits(o);
}

function Uint8x16FromInt32x4BitsJS(o){
return %Uint8x16FromInt32x4Bits(o);
}

function Uint8x16FromUint32x4BitsJS(o){
return %Uint8x16FromUint32x4Bits(o);
}

function Uint8x16FromInt16x8BitsJS(o){
return %Uint8x16FromInt16x8Bits(o);
}

function Uint8x16FromUint16x8BitsJS(o){
return %Uint8x16FromUint16x8Bits(o);
}

function Uint8x16FromInt8x16BitsJS(o){
return %Uint8x16FromInt8x16Bits(o);
}


function Float32x4Load1JS(y,z){
return %Float32x4Load1(y,z);
}
function Float32x4Store1JS(y,z,o){
return %Float32x4Store1(y,z,o);
}

function Float32x4Load2JS(y,z){
return %Float32x4Load2(y,z);
}
function Float32x4Store2JS(y,z,o){
return %Float32x4Store2(y,z,o);
}

function Float32x4Load3JS(y,z){
return %Float32x4Load3(y,z);
}
function Float32x4Store3JS(y,z,o){
return %Float32x4Store3(y,z,o);
}

function Int32x4Load1JS(y,z){
return %Int32x4Load1(y,z);
}
function Int32x4Store1JS(y,z,o){
return %Int32x4Store1(y,z,o);
}

function Int32x4Load2JS(y,z){
return %Int32x4Load2(y,z);
}
function Int32x4Store2JS(y,z,o){
return %Int32x4Store2(y,z,o);
}

function Int32x4Load3JS(y,z){
return %Int32x4Load3(y,z);
}
function Int32x4Store3JS(y,z,o){
return %Int32x4Store3(y,z,o);
}

function Uint32x4Load1JS(y,z){
return %Uint32x4Load1(y,z);
}
function Uint32x4Store1JS(y,z,o){
return %Uint32x4Store1(y,z,o);
}

function Uint32x4Load2JS(y,z){
return %Uint32x4Load2(y,z);
}
function Uint32x4Store2JS(y,z,o){
return %Uint32x4Store2(y,z,o);
}

function Uint32x4Load3JS(y,z){
return %Uint32x4Load3(y,z);
}
function Uint32x4Store3JS(y,z,o){
return %Uint32x4Store3(y,z,o);
}


function Float32x4Splat(w){
return %CreateFloat32x4(w,w,w,w);
}
function Float32x4SwizzleJS(o,A,B,C,D){
return %Float32x4Swizzle(o,A,B,C,D);
}
function Float32x4ShuffleJS(o,v,A,B,C,D){
return %Float32x4Shuffle(o,v,A,B,C,D);
}

function Int32x4Splat(w){
return %CreateInt32x4(w,w,w,w);
}
function Int32x4SwizzleJS(o,A,B,C,D){
return %Int32x4Swizzle(o,A,B,C,D);
}
function Int32x4ShuffleJS(o,v,A,B,C,D){
return %Int32x4Shuffle(o,v,A,B,C,D);
}

function Uint32x4Splat(w){
return %CreateUint32x4(w,w,w,w);
}
function Uint32x4SwizzleJS(o,A,B,C,D){
return %Uint32x4Swizzle(o,A,B,C,D);
}
function Uint32x4ShuffleJS(o,v,A,B,C,D){
return %Uint32x4Shuffle(o,v,A,B,C,D);
}

function Bool32x4Splat(w){
return %CreateBool32x4(w,w,w,w);
}
function Bool32x4SwizzleJS(o,A,B,C,D){
return %Bool32x4Swizzle(o,A,B,C,D);
}
function Bool32x4ShuffleJS(o,v,A,B,C,D){
return %Bool32x4Shuffle(o,v,A,B,C,D);
}


function Int16x8Splat(w){
return %CreateInt16x8(w,w,w,w,w,w,w,w);
}
function Int16x8SwizzleJS(o,A,B,C,D,E,F,G,H){
return %Int16x8Swizzle(o,A,B,C,D,E,F,G,H);
}
function Int16x8ShuffleJS(o,v,A,B,C,D,E,F,G,H){
return %Int16x8Shuffle(o,v,A,B,C,D,E,F,G,H);
}

function Uint16x8Splat(w){
return %CreateUint16x8(w,w,w,w,w,w,w,w);
}
function Uint16x8SwizzleJS(o,A,B,C,D,E,F,G,H){
return %Uint16x8Swizzle(o,A,B,C,D,E,F,G,H);
}
function Uint16x8ShuffleJS(o,v,A,B,C,D,E,F,G,H){
return %Uint16x8Shuffle(o,v,A,B,C,D,E,F,G,H);
}

function Bool16x8Splat(w){
return %CreateBool16x8(w,w,w,w,w,w,w,w);
}
function Bool16x8SwizzleJS(o,A,B,C,D,E,F,G,H){
return %Bool16x8Swizzle(o,A,B,C,D,E,F,G,H);
}
function Bool16x8ShuffleJS(o,v,A,B,C,D,E,F,G,H){
return %Bool16x8Shuffle(o,v,A,B,C,D,E,F,G,H);
}


function Int8x16Splat(w){
return %CreateInt8x16(w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w);
}
function Int8x16SwizzleJS(o,A,B,C,D,E,F,G,H,c8,c9,c10,c11,
c12,c13,c14,c15){
return %Int8x16Swizzle(o,A,B,C,D,E,F,G,H,c8,c9,c10,c11,
c12,c13,c14,c15);
}
function Int8x16ShuffleJS(o,v,A,B,C,D,E,F,G,H,c8,c9,c10,
c11,c12,c13,c14,c15){
return %Int8x16Shuffle(o,v,A,B,C,D,E,F,G,H,c8,c9,c10,
c11,c12,c13,c14,c15);
}

function Uint8x16Splat(w){
return %CreateUint8x16(w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w);
}
function Uint8x16SwizzleJS(o,A,B,C,D,E,F,G,H,c8,c9,c10,c11,
c12,c13,c14,c15){
return %Uint8x16Swizzle(o,A,B,C,D,E,F,G,H,c8,c9,c10,c11,
c12,c13,c14,c15);
}
function Uint8x16ShuffleJS(o,v,A,B,C,D,E,F,G,H,c8,c9,c10,
c11,c12,c13,c14,c15){
return %Uint8x16Shuffle(o,v,A,B,C,D,E,F,G,H,c8,c9,c10,
c11,c12,c13,c14,c15);
}

function Bool8x16Splat(w){
return %CreateBool8x16(w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w);
}
function Bool8x16SwizzleJS(o,A,B,C,D,E,F,G,H,c8,c9,c10,c11,
c12,c13,c14,c15){
return %Bool8x16Swizzle(o,A,B,C,D,E,F,G,H,c8,c9,c10,c11,
c12,c13,c14,c15);
}
function Bool8x16ShuffleJS(o,v,A,B,C,D,E,F,G,H,c8,c9,c10,
c11,c12,c13,c14,c15){
return %Bool8x16Shuffle(o,v,A,B,C,D,E,F,G,H,c8,c9,c10,
c11,c12,c13,c14,c15);
}


function Float32x4Constructor(A,B,C,D){
if(!(new.target===(void 0))){
throw %make_type_error(67,"Float32x4");
}
return %CreateFloat32x4((%_ToNumber(A)),(%_ToNumber(B)),
(%_ToNumber(C)),(%_ToNumber(D)));
}
function Int32x4Constructor(A,B,C,D){
if(!(new.target===(void 0))){
throw %make_type_error(67,"Int32x4");
}
return %CreateInt32x4((%_ToNumber(A)),(%_ToNumber(B)),
(%_ToNumber(C)),(%_ToNumber(D)));
}
function Uint32x4Constructor(A,B,C,D){
if(!(new.target===(void 0))){
throw %make_type_error(67,"Uint32x4");
}
return %CreateUint32x4((%_ToNumber(A)),(%_ToNumber(B)),
(%_ToNumber(C)),(%_ToNumber(D)));
}
function Bool32x4Constructor(A,B,C,D){
if(!(new.target===(void 0))){
throw %make_type_error(67,"Bool32x4");
}
return %CreateBool32x4(A,B,C,D);
}
function Int16x8Constructor(A,B,C,D,E,F,G,H){
if(!(new.target===(void 0))){
throw %make_type_error(67,"Int16x8");
}
return %CreateInt16x8((%_ToNumber(A)),(%_ToNumber(B)),
(%_ToNumber(C)),(%_ToNumber(D)),
(%_ToNumber(E)),(%_ToNumber(F)),
(%_ToNumber(G)),(%_ToNumber(H)));
}
function Uint16x8Constructor(A,B,C,D,E,F,G,H){
if(!(new.target===(void 0))){
throw %make_type_error(67,"Uint16x8");
}
return %CreateUint16x8((%_ToNumber(A)),(%_ToNumber(B)),
(%_ToNumber(C)),(%_ToNumber(D)),
(%_ToNumber(E)),(%_ToNumber(F)),
(%_ToNumber(G)),(%_ToNumber(H)));
}
function Bool16x8Constructor(A,B,C,D,E,F,G,H){
if(!(new.target===(void 0))){
throw %make_type_error(67,"Bool16x8");
}
return %CreateBool16x8(A,B,C,D,E,F,G,H);
}
function Int8x16Constructor(A,B,C,D,E,F,G,H,c8,c9,c10,c11,
c12,c13,c14,c15){
if(!(new.target===(void 0))){
throw %make_type_error(67,"Int8x16");
}
return %CreateInt8x16((%_ToNumber(A)),(%_ToNumber(B)),
(%_ToNumber(C)),(%_ToNumber(D)),
(%_ToNumber(E)),(%_ToNumber(F)),
(%_ToNumber(G)),(%_ToNumber(H)),
(%_ToNumber(c8)),(%_ToNumber(c9)),
(%_ToNumber(c10)),(%_ToNumber(c11)),
(%_ToNumber(c12)),(%_ToNumber(c13)),
(%_ToNumber(c14)),(%_ToNumber(c15)));
}
function Uint8x16Constructor(A,B,C,D,E,F,G,H,c8,c9,c10,c11,
c12,c13,c14,c15){
if(!(new.target===(void 0))){
throw %make_type_error(67,"Uint8x16");
}
return %CreateUint8x16((%_ToNumber(A)),(%_ToNumber(B)),
(%_ToNumber(C)),(%_ToNumber(D)),
(%_ToNumber(E)),(%_ToNumber(F)),
(%_ToNumber(G)),(%_ToNumber(H)),
(%_ToNumber(c8)),(%_ToNumber(c9)),
(%_ToNumber(c10)),(%_ToNumber(c11)),
(%_ToNumber(c12)),(%_ToNumber(c13)),
(%_ToNumber(c14)),(%_ToNumber(c15)));
}
function Bool8x16Constructor(A,B,C,D,E,F,G,H,c8,c9,c10,c11,
c12,c13,c14,c15){
if(!(new.target===(void 0))){
throw %make_type_error(67,"Bool8x16");
}
return %CreateBool8x16(A,B,C,D,E,F,G,H,c8,c9,c10,c11,c12,
c13,c14,c15);
}
function Float32x4AbsJS(o){
return %Float32x4Abs(o);
}
function Float32x4SqrtJS(o){
return %Float32x4Sqrt(o);
}
function Float32x4RecipApproxJS(o){
return %Float32x4RecipApprox(o);
}
function Float32x4RecipSqrtApproxJS(o){
return %Float32x4RecipSqrtApprox(o);
}
function Float32x4DivJS(o,v){
return %Float32x4Div(o,v);
}
function Float32x4MinNumJS(o,v){
return %Float32x4MinNum(o,v);
}
function Float32x4MaxNumJS(o,v){
return %Float32x4MaxNum(o,v);
}
%AddNamedProperty(c,d,'SIMD',1|2);
%SetCode(e,Float32x4Constructor);
%FunctionSetPrototype(e,{});
%AddNamedProperty(e.prototype,'constructor',e,
2);
%AddNamedProperty(e.prototype,d,'Float32x4',
2|1);
b.InstallFunctions(e.prototype,2,[
'toLocaleString',Float32x4ToLocaleString,
'toString',Float32x4ToString,
'valueOf',Float32x4ValueOf,
]);


%SetCode(f,Int32x4Constructor);
%FunctionSetPrototype(f,{});
%AddNamedProperty(f.prototype,'constructor',f,
2);
%AddNamedProperty(f.prototype,d,'Int32x4',
2|1);
b.InstallFunctions(f.prototype,2,[
'toLocaleString',Int32x4ToLocaleString,
'toString',Int32x4ToString,
'valueOf',Int32x4ValueOf,
]);

%SetCode(g,Int16x8Constructor);
%FunctionSetPrototype(g,{});
%AddNamedProperty(g.prototype,'constructor',g,
2);
%AddNamedProperty(g.prototype,d,'Int16x8',
2|1);
b.InstallFunctions(g.prototype,2,[
'toLocaleString',Int16x8ToLocaleString,
'toString',Int16x8ToString,
'valueOf',Int16x8ValueOf,
]);

%SetCode(h,Int8x16Constructor);
%FunctionSetPrototype(h,{});
%AddNamedProperty(h.prototype,'constructor',h,
2);
%AddNamedProperty(h.prototype,d,'Int8x16',
2|1);
b.InstallFunctions(h.prototype,2,[
'toLocaleString',Int8x16ToLocaleString,
'toString',Int8x16ToString,
'valueOf',Int8x16ValueOf,
]);


%SetCode(i,Uint32x4Constructor);
%FunctionSetPrototype(i,{});
%AddNamedProperty(i.prototype,'constructor',i,
2);
%AddNamedProperty(i.prototype,d,'Uint32x4',
2|1);
b.InstallFunctions(i.prototype,2,[
'toLocaleString',Uint32x4ToLocaleString,
'toString',Uint32x4ToString,
'valueOf',Uint32x4ValueOf,
]);

%SetCode(j,Uint16x8Constructor);
%FunctionSetPrototype(j,{});
%AddNamedProperty(j.prototype,'constructor',j,
2);
%AddNamedProperty(j.prototype,d,'Uint16x8',
2|1);
b.InstallFunctions(j.prototype,2,[
'toLocaleString',Uint16x8ToLocaleString,
'toString',Uint16x8ToString,
'valueOf',Uint16x8ValueOf,
]);

%SetCode(k,Uint8x16Constructor);
%FunctionSetPrototype(k,{});
%AddNamedProperty(k.prototype,'constructor',k,
2);
%AddNamedProperty(k.prototype,d,'Uint8x16',
2|1);
b.InstallFunctions(k.prototype,2,[
'toLocaleString',Uint8x16ToLocaleString,
'toString',Uint8x16ToString,
'valueOf',Uint8x16ValueOf,
]);


%SetCode(l,Bool32x4Constructor);
%FunctionSetPrototype(l,{});
%AddNamedProperty(l.prototype,'constructor',l,
2);
%AddNamedProperty(l.prototype,d,'Bool32x4',
2|1);
b.InstallFunctions(l.prototype,2,[
'toLocaleString',Bool32x4ToLocaleString,
'toString',Bool32x4ToString,
'valueOf',Bool32x4ValueOf,
]);

%SetCode(m,Bool16x8Constructor);
%FunctionSetPrototype(m,{});
%AddNamedProperty(m.prototype,'constructor',m,
2);
%AddNamedProperty(m.prototype,d,'Bool16x8',
2|1);
b.InstallFunctions(m.prototype,2,[
'toLocaleString',Bool16x8ToLocaleString,
'toString',Bool16x8ToString,
'valueOf',Bool16x8ValueOf,
]);

%SetCode(n,Bool8x16Constructor);
%FunctionSetPrototype(n,{});
%AddNamedProperty(n.prototype,'constructor',n,
2);
%AddNamedProperty(n.prototype,d,'Bool8x16',
2|1);
b.InstallFunctions(n.prototype,2,[
'toLocaleString',Bool8x16ToLocaleString,
'toString',Bool8x16ToString,
'valueOf',Bool8x16ValueOf,
]);



b.InstallFunctions(e,2,[
'splat',Float32x4Splat,
'check',Float32x4CheckJS,
'extractLane',Float32x4ExtractLaneJS,
'replaceLane',Float32x4ReplaceLaneJS,
'neg',Float32x4NegJS,
'abs',Float32x4AbsJS,
'sqrt',Float32x4SqrtJS,
'reciprocalApproximation',Float32x4RecipApproxJS,
'reciprocalSqrtApproximation',Float32x4RecipSqrtApproxJS,
'add',Float32x4AddJS,
'sub',Float32x4SubJS,
'mul',Float32x4MulJS,
'div',Float32x4DivJS,
'min',Float32x4MinJS,
'max',Float32x4MaxJS,
'minNum',Float32x4MinNumJS,
'maxNum',Float32x4MaxNumJS,
'lessThan',Float32x4LessThanJS,
'lessThanOrEqual',Float32x4LessThanOrEqualJS,
'greaterThan',Float32x4GreaterThanJS,
'greaterThanOrEqual',Float32x4GreaterThanOrEqualJS,
'equal',Float32x4EqualJS,
'notEqual',Float32x4NotEqualJS,
'select',Float32x4SelectJS,
'swizzle',Float32x4SwizzleJS,
'shuffle',Float32x4ShuffleJS,
'fromInt32x4',Float32x4FromInt32x4JS,
'fromUint32x4',Float32x4FromUint32x4JS,
'fromInt32x4Bits',Float32x4FromInt32x4BitsJS,
'fromUint32x4Bits',Float32x4FromUint32x4BitsJS,
'fromInt16x8Bits',Float32x4FromInt16x8BitsJS,
'fromUint16x8Bits',Float32x4FromUint16x8BitsJS,
'fromInt8x16Bits',Float32x4FromInt8x16BitsJS,
'fromUint8x16Bits',Float32x4FromUint8x16BitsJS,
'load',Float32x4LoadJS,
'load1',Float32x4Load1JS,
'load2',Float32x4Load2JS,
'load3',Float32x4Load3JS,
'store',Float32x4StoreJS,
'store1',Float32x4Store1JS,
'store2',Float32x4Store2JS,
'store3',Float32x4Store3JS,
]);
b.InstallFunctions(f,2,[
'splat',Int32x4Splat,
'check',Int32x4CheckJS,
'extractLane',Int32x4ExtractLaneJS,
'replaceLane',Int32x4ReplaceLaneJS,
'neg',Int32x4NegJS,
'add',Int32x4AddJS,
'sub',Int32x4SubJS,
'mul',Int32x4MulJS,
'min',Int32x4MinJS,
'max',Int32x4MaxJS,
'and',Int32x4AndJS,
'or',Int32x4OrJS,
'xor',Int32x4XorJS,
'not',Int32x4NotJS,
'shiftLeftByScalar',Int32x4ShiftLeftByScalarJS,
'shiftRightByScalar',Int32x4ShiftRightByScalarJS,
'lessThan',Int32x4LessThanJS,
'lessThanOrEqual',Int32x4LessThanOrEqualJS,
'greaterThan',Int32x4GreaterThanJS,
'greaterThanOrEqual',Int32x4GreaterThanOrEqualJS,
'equal',Int32x4EqualJS,
'notEqual',Int32x4NotEqualJS,
'select',Int32x4SelectJS,
'swizzle',Int32x4SwizzleJS,
'shuffle',Int32x4ShuffleJS,
'fromFloat32x4',Int32x4FromFloat32x4JS,
'fromUint32x4',Int32x4FromUint32x4JS,
'fromFloat32x4Bits',Int32x4FromFloat32x4BitsJS,
'fromUint32x4Bits',Int32x4FromUint32x4BitsJS,
'fromInt16x8Bits',Int32x4FromInt16x8BitsJS,
'fromUint16x8Bits',Int32x4FromUint16x8BitsJS,
'fromInt8x16Bits',Int32x4FromInt8x16BitsJS,
'fromUint8x16Bits',Int32x4FromUint8x16BitsJS,
'load',Int32x4LoadJS,
'load1',Int32x4Load1JS,
'load2',Int32x4Load2JS,
'load3',Int32x4Load3JS,
'store',Int32x4StoreJS,
'store1',Int32x4Store1JS,
'store2',Int32x4Store2JS,
'store3',Int32x4Store3JS,
]);
b.InstallFunctions(i,2,[
'splat',Uint32x4Splat,
'check',Uint32x4CheckJS,
'extractLane',Uint32x4ExtractLaneJS,
'replaceLane',Uint32x4ReplaceLaneJS,
'add',Uint32x4AddJS,
'sub',Uint32x4SubJS,
'mul',Uint32x4MulJS,
'min',Uint32x4MinJS,
'max',Uint32x4MaxJS,
'and',Uint32x4AndJS,
'or',Uint32x4OrJS,
'xor',Uint32x4XorJS,
'not',Uint32x4NotJS,
'shiftLeftByScalar',Uint32x4ShiftLeftByScalarJS,
'shiftRightByScalar',Uint32x4ShiftRightByScalarJS,
'lessThan',Uint32x4LessThanJS,
'lessThanOrEqual',Uint32x4LessThanOrEqualJS,
'greaterThan',Uint32x4GreaterThanJS,
'greaterThanOrEqual',Uint32x4GreaterThanOrEqualJS,
'equal',Uint32x4EqualJS,
'notEqual',Uint32x4NotEqualJS,
'select',Uint32x4SelectJS,
'swizzle',Uint32x4SwizzleJS,
'shuffle',Uint32x4ShuffleJS,
'fromFloat32x4',Uint32x4FromFloat32x4JS,
'fromInt32x4',Uint32x4FromInt32x4JS,
'fromFloat32x4Bits',Uint32x4FromFloat32x4BitsJS,
'fromInt32x4Bits',Uint32x4FromInt32x4BitsJS,
'fromInt16x8Bits',Uint32x4FromInt16x8BitsJS,
'fromUint16x8Bits',Uint32x4FromUint16x8BitsJS,
'fromInt8x16Bits',Uint32x4FromInt8x16BitsJS,
'fromUint8x16Bits',Uint32x4FromUint8x16BitsJS,
'load',Uint32x4LoadJS,
'load1',Uint32x4Load1JS,
'load2',Uint32x4Load2JS,
'load3',Uint32x4Load3JS,
'store',Uint32x4StoreJS,
'store1',Uint32x4Store1JS,
'store2',Uint32x4Store2JS,
'store3',Uint32x4Store3JS,
]);
b.InstallFunctions(l,2,[
'splat',Bool32x4Splat,
'check',Bool32x4CheckJS,
'extractLane',Bool32x4ExtractLaneJS,
'replaceLane',Bool32x4ReplaceLaneJS,
'and',Bool32x4AndJS,
'or',Bool32x4OrJS,
'xor',Bool32x4XorJS,
'not',Bool32x4NotJS,
'anyTrue',Bool32x4AnyTrueJS,
'allTrue',Bool32x4AllTrueJS,
'swizzle',Bool32x4SwizzleJS,
'shuffle',Bool32x4ShuffleJS,
]);
b.InstallFunctions(g,2,[
'splat',Int16x8Splat,
'check',Int16x8CheckJS,
'extractLane',Int16x8ExtractLaneJS,
'replaceLane',Int16x8ReplaceLaneJS,
'neg',Int16x8NegJS,
'add',Int16x8AddJS,
'sub',Int16x8SubJS,
'addSaturate',Int16x8AddSaturateJS,
'subSaturate',Int16x8SubSaturateJS,
'mul',Int16x8MulJS,
'min',Int16x8MinJS,
'max',Int16x8MaxJS,
'and',Int16x8AndJS,
'or',Int16x8OrJS,
'xor',Int16x8XorJS,
'not',Int16x8NotJS,
'shiftLeftByScalar',Int16x8ShiftLeftByScalarJS,
'shiftRightByScalar',Int16x8ShiftRightByScalarJS,
'lessThan',Int16x8LessThanJS,
'lessThanOrEqual',Int16x8LessThanOrEqualJS,
'greaterThan',Int16x8GreaterThanJS,
'greaterThanOrEqual',Int16x8GreaterThanOrEqualJS,
'equal',Int16x8EqualJS,
'notEqual',Int16x8NotEqualJS,
'select',Int16x8SelectJS,
'swizzle',Int16x8SwizzleJS,
'shuffle',Int16x8ShuffleJS,
'fromUint16x8',Int16x8FromUint16x8JS,
'fromFloat32x4Bits',Int16x8FromFloat32x4BitsJS,
'fromInt32x4Bits',Int16x8FromInt32x4BitsJS,
'fromUint32x4Bits',Int16x8FromUint32x4BitsJS,
'fromUint16x8Bits',Int16x8FromUint16x8BitsJS,
'fromInt8x16Bits',Int16x8FromInt8x16BitsJS,
'fromUint8x16Bits',Int16x8FromUint8x16BitsJS,
'load',Int16x8LoadJS,
'store',Int16x8StoreJS,
]);
b.InstallFunctions(j,2,[
'splat',Uint16x8Splat,
'check',Uint16x8CheckJS,
'extractLane',Uint16x8ExtractLaneJS,
'replaceLane',Uint16x8ReplaceLaneJS,
'add',Uint16x8AddJS,
'sub',Uint16x8SubJS,
'addSaturate',Uint16x8AddSaturateJS,
'subSaturate',Uint16x8SubSaturateJS,
'mul',Uint16x8MulJS,
'min',Uint16x8MinJS,
'max',Uint16x8MaxJS,
'and',Uint16x8AndJS,
'or',Uint16x8OrJS,
'xor',Uint16x8XorJS,
'not',Uint16x8NotJS,
'shiftLeftByScalar',Uint16x8ShiftLeftByScalarJS,
'shiftRightByScalar',Uint16x8ShiftRightByScalarJS,
'lessThan',Uint16x8LessThanJS,
'lessThanOrEqual',Uint16x8LessThanOrEqualJS,
'greaterThan',Uint16x8GreaterThanJS,
'greaterThanOrEqual',Uint16x8GreaterThanOrEqualJS,
'equal',Uint16x8EqualJS,
'notEqual',Uint16x8NotEqualJS,
'select',Uint16x8SelectJS,
'swizzle',Uint16x8SwizzleJS,
'shuffle',Uint16x8ShuffleJS,
'fromInt16x8',Uint16x8FromInt16x8JS,
'fromFloat32x4Bits',Uint16x8FromFloat32x4BitsJS,
'fromInt32x4Bits',Uint16x8FromInt32x4BitsJS,
'fromUint32x4Bits',Uint16x8FromUint32x4BitsJS,
'fromInt16x8Bits',Uint16x8FromInt16x8BitsJS,
'fromInt8x16Bits',Uint16x8FromInt8x16BitsJS,
'fromUint8x16Bits',Uint16x8FromUint8x16BitsJS,
'load',Uint16x8LoadJS,
'store',Uint16x8StoreJS,
]);
b.InstallFunctions(m,2,[
'splat',Bool16x8Splat,
'check',Bool16x8CheckJS,
'extractLane',Bool16x8ExtractLaneJS,
'replaceLane',Bool16x8ReplaceLaneJS,
'and',Bool16x8AndJS,
'or',Bool16x8OrJS,
'xor',Bool16x8XorJS,
'not',Bool16x8NotJS,
'anyTrue',Bool16x8AnyTrueJS,
'allTrue',Bool16x8AllTrueJS,
'swizzle',Bool16x8SwizzleJS,
'shuffle',Bool16x8ShuffleJS,
]);
b.InstallFunctions(h,2,[
'splat',Int8x16Splat,
'check',Int8x16CheckJS,
'extractLane',Int8x16ExtractLaneJS,
'replaceLane',Int8x16ReplaceLaneJS,
'neg',Int8x16NegJS,
'add',Int8x16AddJS,
'sub',Int8x16SubJS,
'addSaturate',Int8x16AddSaturateJS,
'subSaturate',Int8x16SubSaturateJS,
'mul',Int8x16MulJS,
'min',Int8x16MinJS,
'max',Int8x16MaxJS,
'and',Int8x16AndJS,
'or',Int8x16OrJS,
'xor',Int8x16XorJS,
'not',Int8x16NotJS,
'shiftLeftByScalar',Int8x16ShiftLeftByScalarJS,
'shiftRightByScalar',Int8x16ShiftRightByScalarJS,
'lessThan',Int8x16LessThanJS,
'lessThanOrEqual',Int8x16LessThanOrEqualJS,
'greaterThan',Int8x16GreaterThanJS,
'greaterThanOrEqual',Int8x16GreaterThanOrEqualJS,
'equal',Int8x16EqualJS,
'notEqual',Int8x16NotEqualJS,
'select',Int8x16SelectJS,
'swizzle',Int8x16SwizzleJS,
'shuffle',Int8x16ShuffleJS,
'fromUint8x16',Int8x16FromUint8x16JS,
'fromFloat32x4Bits',Int8x16FromFloat32x4BitsJS,
'fromInt32x4Bits',Int8x16FromInt32x4BitsJS,
'fromUint32x4Bits',Int8x16FromUint32x4BitsJS,
'fromInt16x8Bits',Int8x16FromInt16x8BitsJS,
'fromUint16x8Bits',Int8x16FromUint16x8BitsJS,
'fromUint8x16Bits',Int8x16FromUint8x16BitsJS,
'load',Int8x16LoadJS,
'store',Int8x16StoreJS,
]);
b.InstallFunctions(k,2,[
'splat',Uint8x16Splat,
'check',Uint8x16CheckJS,
'extractLane',Uint8x16ExtractLaneJS,
'replaceLane',Uint8x16ReplaceLaneJS,
'add',Uint8x16AddJS,
'sub',Uint8x16SubJS,
'addSaturate',Uint8x16AddSaturateJS,
'subSaturate',Uint8x16SubSaturateJS,
'mul',Uint8x16MulJS,
'min',Uint8x16MinJS,
'max',Uint8x16MaxJS,
'and',Uint8x16AndJS,
'or',Uint8x16OrJS,
'xor',Uint8x16XorJS,
'not',Uint8x16NotJS,
'shiftLeftByScalar',Uint8x16ShiftLeftByScalarJS,
'shiftRightByScalar',Uint8x16ShiftRightByScalarJS,
'lessThan',Uint8x16LessThanJS,
'lessThanOrEqual',Uint8x16LessThanOrEqualJS,
'greaterThan',Uint8x16GreaterThanJS,
'greaterThanOrEqual',Uint8x16GreaterThanOrEqualJS,
'equal',Uint8x16EqualJS,
'notEqual',Uint8x16NotEqualJS,
'select',Uint8x16SelectJS,
'swizzle',Uint8x16SwizzleJS,
'shuffle',Uint8x16ShuffleJS,
'fromInt8x16',Uint8x16FromInt8x16JS,
'fromFloat32x4Bits',Uint8x16FromFloat32x4BitsJS,
'fromInt32x4Bits',Uint8x16FromInt32x4BitsJS,
'fromUint32x4Bits',Uint8x16FromUint32x4BitsJS,
'fromInt16x8Bits',Uint8x16FromInt16x8BitsJS,
'fromUint16x8Bits',Uint8x16FromUint16x8BitsJS,
'fromInt8x16Bits',Uint8x16FromInt8x16BitsJS,
'load',Uint8x16LoadJS,
'store',Uint8x16StoreJS,
]);
b.InstallFunctions(n,2,[
'splat',Bool8x16Splat,
'check',Bool8x16CheckJS,
'extractLane',Bool8x16ExtractLaneJS,
'replaceLane',Bool8x16ReplaceLaneJS,
'and',Bool8x16AndJS,
'or',Bool8x16OrJS,
'xor',Bool8x16XorJS,
'not',Bool8x16NotJS,
'anyTrue',Bool8x16AnyTrueJS,
'allTrue',Bool8x16AllTrueJS,
'swizzle',Bool8x16SwizzleJS,
'shuffle',Bool8x16ShuffleJS,
]);
})

Xharmony-string-paddingY
(function(a,b){
%CheckIsBootstrapping();
var c=a.String;
function StringPad(d,e,f){
e=(%_ToLength(e));
var g=d.length;
if(e<=g)return"";
if((f===(void 0))){
f=" ";
}else{
f=(%_ToString(f));
if(f===""){
return"";
}
}
var h=e-g;
var i=(h/f.length)|0;
var j=(h-f.length*i)|0;
var k="";
while(true){
if(i&1)k+=f;
i>>=1;
if(i===0)break;
f+=f;
}
if(j){
k+=%_SubString(f,0,j);
}
return k;
}
function StringPadStart(e,f){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.padStart")
var d=(%_ToString(this));
return StringPad(d,e,f)+d;
}
%FunctionSetLength(StringPadStart,1);
function StringPadEnd(e,f){
if((%IS_VAR(this)===null)||(this===(void 0)))throw %make_type_error(17,"String.prototype.padEnd")
var d=(%_ToString(this));
return d+StringPad(d,e,f);
}
%FunctionSetLength(StringPadEnd,1);
b.InstallFunctions(c.prototype,2,[
"padStart",StringPadStart,
"padEnd",StringPadEnd
]);
});

`datetime-format-to-partsÈ
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c=a.Intl;
var d=b.ImportNow("FormatDateToParts");
b.InstallFunctions(c.DateTimeFormat.prototype,2,[
'formatToParts',d
]);
})

@icu-case-mapping±
(function(a,b){
"use strict";
%CheckIsBootstrapping();
var c=a.String;
var d=b.OverrideFunction;
var e=b.ImportNow("ToLowerCaseI18N");
var f=b.ImportNow("ToUpperCaseI18N");
var g=b.ImportNow("ToLocaleLowerCaseI18N");
var h=b.ImportNow("ToLocaleUpperCaseI18N");
d(c.prototype,'toLowerCase',e,true);
d(c.prototype,'toUpperCase',f,true);
d(c.prototype,'toLocaleLowerCase',
g,true);
d(c.prototype,'toLocaleUpperCase',
h,true);
})

 4CommonStringsI
(function(global, binding, v8) {
  'use strict';
  binding.streamErrors = {
    illegalInvocation: 'Illegal invocation',
    illegalConstructor: 'Illegal constructor',
    invalidType: 'Invalid type is specified',
    invalidSize: 'The return value of a queuing strategy\'s size function must be a finite, non-NaN, non-negative number',
    sizeNotAFunction: 'A queuing strategy\'s size property must be a function',
    invalidHWM: 'A queueing strategy\'s highWaterMark property must be a nonnegative, non-NaN number',
  };
});
dByteLengthQueuingStrategy—
(function(global, binding, v8) {
  'use strict';
  const defineProperty = global.Object.defineProperty;
  class ByteLengthQueuingStrategy {
    constructor(options) {
      defineProperty(this, 'highWaterMark', {
        value: options.highWaterMark,
        enumerable: true,
        configurable: true,
        writable: true
      });
    }
    size(chunk) { return chunk.byteLength; }
  }
  defineProperty(global, 'ByteLengthQueuingStrategy', {
    value: ByteLengthQueuingStrategy,
    enumerable: false,
    configurable: true,
    writable: true
  });
});
PCountQueuingStrategy˝
(function(global, binding, v8) {
  'use strict';
  const defineProperty = global.Object.defineProperty;
  class CountQueuingStrategy {
    constructor(options) {
      defineProperty(this, 'highWaterMark', {
        value: options.highWaterMark,
        enumerable: true,
        configurable: true,
        writable: true
      });
    }
    size(chunk) { return 1; }
  }
  defineProperty(global, 'CountQueuingStrategy', {
    value: CountQueuingStrategy,
    enumerable: false,
    configurable: true,
    writable: true
  });
  class BuiltInCountQueuingStrategy {
    constructor(highWaterMark) {
      defineProperty(this, 'highWaterMark', {value: highWaterMark});
    }
    size(chunk) { return 1; }
  }
  binding.createBuiltInCountQueuingStrategy = highWaterMark =>
      new BuiltInCountQueuingStrategy(highWaterMark);
});
8ReadableStreamﬁ±
(function(global, binding, v8) {
  'use strict';
  const _reader = v8.createPrivateSymbol('[[reader]]');
  const _storedError = v8.createPrivateSymbol('[[storedError]]');
  const _controller = v8.createPrivateSymbol('[[controller]]');
  const _closedPromise = v8.createPrivateSymbol('[[closedPromise]]');
  const _ownerReadableStream =
      v8.createPrivateSymbol('[[ownerReadableStream]]');
  const _readRequests = v8.createPrivateSymbol('[[readRequests]]');
  const createWithExternalControllerSentinel =
      v8.createPrivateSymbol('flag for UA-created ReadableStream to pass');
  const _readableStreamBits = v8.createPrivateSymbol('bit field for [[state]] and [[disturbed]]');
  const DISTURBED = 0b1;
  const STATE_MASK = 0b110;
  const STATE_BITS_OFFSET = 1;
  const STATE_READABLE = 0;
  const STATE_CLOSED = 1;
  const STATE_ERRORED = 2;
  const _underlyingSource = v8.createPrivateSymbol('[[underlyingSource]]');
  const _controlledReadableStream =
      v8.createPrivateSymbol('[[controlledReadableStream]]');
  const _queue = v8.createPrivateSymbol('[[queue]]');
  const _totalQueuedSize = v8.createPrivateSymbol('[[totalQueuedSize]]');
  const _strategySize = v8.createPrivateSymbol('[[strategySize]]');
  const _strategyHWM = v8.createPrivateSymbol('[[strategyHWM]]');
  const _readableStreamDefaultControllerBits = v8.createPrivateSymbol(
      'bit field for [[started]], [[closeRequested]], [[pulling]], [[pullAgain]]');
  const STARTED = 0b1;
  const CLOSE_REQUESTED = 0b10;
  const PULLING = 0b100;
  const PULL_AGAIN = 0b1000;
  const EXTERNALLY_CONTROLLED = 0b10000;
  const undefined = global.undefined;
  const Infinity = global.Infinity;
  const defineProperty = global.Object.defineProperty;
  const hasOwnProperty = v8.uncurryThis(global.Object.hasOwnProperty);
  const callFunction = v8.uncurryThis(global.Function.prototype.call);
  const TypeError = global.TypeError;
  const RangeError = global.RangeError;
  const Number = global.Number;
  const Number_isNaN = Number.isNaN;
  const Number_isFinite = Number.isFinite;
  const Promise = global.Promise;
  const thenPromise = v8.uncurryThis(Promise.prototype.then);
  const Promise_resolve = v8.simpleBind(Promise.resolve, Promise);
  const Promise_reject = v8.simpleBind(Promise.reject, Promise);
  const streamErrors = binding.streamErrors;
  const errCancelLockedStream =
      'Cannot cancel a readable stream that is locked to a reader';
  const errEnqueueCloseRequestedStream =
      'Cannot enqueue a chunk into a readable stream that is closed or has been requested to be closed';
  const errCancelReleasedReader =
      'This readable stream reader has been released and cannot be used to cancel its previous owner stream';
  const errReadReleasedReader =
      'This readable stream reader has been released and cannot be used to read from its previous owner stream';
  const errCloseCloseRequestedStream =
      'Cannot close a readable stream that has already been requested to be closed';
  const errEnqueueClosedStream = 'Cannot enqueue a chunk into a closed readable stream';
  const errEnqueueErroredStream = 'Cannot enqueue a chunk into an errored readable stream';
  const errCloseClosedStream = 'Cannot close a closed readable stream';
  const errCloseErroredStream = 'Cannot close an errored readable stream';
  const errErrorClosedStream = 'Cannot error a close readable stream';
  const errErrorErroredStream =
      'Cannot error a readable stream that is already errored';
  const errGetReaderNotByteStream = 'This readable stream does not support BYOB readers';
  const errGetReaderBadMode = 'Invalid reader mode given: expected undefined or "byob"';
  const errReaderConstructorBadArgument =
      'ReadableStreamReader constructor argument is not a readable stream';
  const errReaderConstructorStreamAlreadyLocked =
      'ReadableStreamReader constructor can only accept readable streams that are not yet locked to a reader';
  const errReleaseReaderWithPendingRead =
      'Cannot release a readable stream reader when it still has outstanding read() calls that have not yet settled';
  const errReleasedReaderClosedPromise =
      'This readable stream reader has been released and cannot be used to monitor the stream\'s state';
  const errTmplMustBeFunctionOrUndefined = name =>
      `${name} must be a function or undefined`;
  class ReadableStream {
    constructor() {
      const underlyingSource = arguments[0] === undefined ? {} : arguments[0];
      const strategy = arguments[1] === undefined ? {} : arguments[1];
      const size = strategy.size;
      let highWaterMark = strategy.highWaterMark;
      if (highWaterMark === undefined) {
        highWaterMark = 1;
      }
      this[_readableStreamBits] = 0b0;
      ReadableStreamSetState(this, STATE_READABLE);
      this[_reader] = undefined;
      this[_storedError] = undefined;
      this[_controller] = undefined;
      const type = underlyingSource.type;
      const typeString = String(type);
      if (typeString === 'bytes') {
        throw new RangeError('bytes type is not yet implemented');
      } else if (type !== undefined) {
        throw new RangeError(streamErrors.invalidType);
      }
      this[_controller] =
          new ReadableStreamDefaultController(this, underlyingSource, size, highWaterMark, arguments[2] === createWithExternalControllerSentinel);
    }
    get locked() {
      if (IsReadableStream(this) === false) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      return IsReadableStreamLocked(this);
    }
    cancel(reason) {
      if (IsReadableStream(this) === false) {
        return Promise_reject(new TypeError(streamErrors.illegalInvocation));
      }
      if (IsReadableStreamLocked(this) === true) {
        return Promise_reject(new TypeError(errCancelLockedStream));
      }
      return ReadableStreamCancel(this, reason);
    }
    getReader({ mode } = {}) {
      if (IsReadableStream(this) === false) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      if (mode === 'byob') {
        throw new TypeError(errGetReaderNotByteStream);
      }
      if (mode === undefined) {
        return AcquireReadableStreamDefaultReader(this);
      }
      throw new RangeError(errGetReaderBadMode);
    }
    tee() {
      if (IsReadableStream(this) === false) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      return ReadableStreamTee(this);
    }
  }
  class ReadableStreamDefaultController {
    constructor(stream, underlyingSource, size, highWaterMark, isExternallyControlled) {
      if (IsReadableStream(stream) === false) {
        throw new TypeError(streamErrors.illegalConstructor);
      }
      if (stream[_controller] !== undefined) {
        throw new TypeError(streamErrors.illegalConstructor);
      }
      this[_controlledReadableStream] = stream;
      this[_underlyingSource] = underlyingSource;
      this[_queue] = new v8.InternalPackedArray();
      this[_totalQueuedSize] = 0;
      this[_readableStreamDefaultControllerBits] = 0b0;
      if (isExternallyControlled === true) {
        this[_readableStreamDefaultControllerBits] |= EXTERNALLY_CONTROLLED;
      }
      const normalizedStrategy =
          ValidateAndNormalizeQueuingStrategy(size, highWaterMark);
      this[_strategySize] = normalizedStrategy.size;
      this[_strategyHWM] = normalizedStrategy.highWaterMark;
      const controller = this;
      const startResult = CallOrNoop(
          underlyingSource, 'start', this, 'underlyingSource.start');
      thenPromise(Promise_resolve(startResult),
          () => {
            controller[_readableStreamDefaultControllerBits] |= STARTED;
            ReadableStreamDefaultControllerCallPullIfNeeded(controller);
          },
          r => {
            if (ReadableStreamGetState(stream) === STATE_READABLE) {
              ReadableStreamDefaultControllerError(controller, r);
            }
          });
    }
    get desiredSize() {
      if (IsReadableStreamDefaultController(this) === false) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      return ReadableStreamDefaultControllerGetDesiredSize(this);
    }
    close() {
      if (IsReadableStreamDefaultController(this) === false) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      const stream = this[_controlledReadableStream];
      if (this[_readableStreamDefaultControllerBits] & CLOSE_REQUESTED) {
        throw new TypeError(errCloseCloseRequestedStream);
      }
      const state = ReadableStreamGetState(stream);
      if (state === STATE_ERRORED) {
        throw new TypeError(errCloseErroredStream);
      }
      if (state === STATE_CLOSED) {
        throw new TypeError(errCloseClosedStream);
      }
      return ReadableStreamDefaultControllerClose(this);
    }
    enqueue(chunk) {
      if (IsReadableStreamDefaultController(this) === false) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      const stream = this[_controlledReadableStream];
      if (this[_readableStreamDefaultControllerBits] & CLOSE_REQUESTED) {
        throw new TypeError(errEnqueueCloseRequestedStream);
      }
      const state = ReadableStreamGetState(stream);
      if (state === STATE_ERRORED) {
        throw new TypeError(errEnqueueErroredStream);
      }
      if (state === STATE_CLOSED) {
        throw new TypeError(errEnqueueClosedStream);
      }
      return ReadableStreamDefaultControllerEnqueue(this, chunk);
    }
    error(e) {
      if (IsReadableStreamDefaultController(this) === false) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      const stream = this[_controlledReadableStream];
      const state = ReadableStreamGetState(stream);
      if (state === STATE_ERRORED) {
        throw new TypeError(errErrorErroredStream);
      }
      if (state === STATE_CLOSED) {
        throw new TypeError(errErrorClosedStream);
      }
      return ReadableStreamDefaultControllerError(this, e);
    }
  }
  function ReadableStreamDefaultControllerCancel(controller, reason) {
    controller[_queue] = new v8.InternalPackedArray();
    const underlyingSource = controller[_underlyingSource];
    return PromiseCallOrNoop(underlyingSource, 'cancel', reason, 'underlyingSource.cancel');
  }
  function ReadableStreamDefaultControllerPull(controller) {
    const stream = controller[_controlledReadableStream];
    if (controller[_queue].length > 0) {
      const chunk = DequeueValue(controller);
      if ((controller[_readableStreamDefaultControllerBits] & CLOSE_REQUESTED) &&
          controller[_queue].length === 0) {
        ReadableStreamClose(stream);
      } else {
        ReadableStreamDefaultControllerCallPullIfNeeded(controller);
      }
      return Promise_resolve(CreateIterResultObject(chunk, false));
    }
    const pendingPromise = ReadableStreamAddReadRequest(stream);
    ReadableStreamDefaultControllerCallPullIfNeeded(controller);
    return pendingPromise;
  }
  function ReadableStreamAddReadRequest(stream) {
    const promise = v8.createPromise();
    stream[_reader][_readRequests].push(promise);
    return promise;
  }
  class ReadableStreamDefaultReader {
    constructor(stream) {
      if (IsReadableStream(stream) === false) {
        throw new TypeError(errReaderConstructorBadArgument);
      }
      if (IsReadableStreamLocked(stream) === true) {
        throw new TypeError(errReaderConstructorStreamAlreadyLocked);
      }
      ReadableStreamReaderGenericInitialize(this, stream);
      this[_readRequests] = new v8.InternalPackedArray();
    }
    get closed() {
      if (IsReadableStreamDefaultReader(this) === false) {
        return Promise_reject(new TypeError(streamErrors.illegalInvocation));
      }
      return this[_closedPromise];
    }
    cancel(reason) {
      if (IsReadableStreamDefaultReader(this) === false) {
        return Promise_reject(new TypeError(streamErrors.illegalInvocation));
      }
      const stream = this[_ownerReadableStream];
      if (stream === undefined) {
        return Promise_reject(new TypeError(errCancelReleasedReader));
      }
      return ReadableStreamReaderGenericCancel(this, reason);
    }
    read() {
      if (IsReadableStreamDefaultReader(this) === false) {
        return Promise_reject(new TypeError(streamErrors.illegalInvocation));
      }
      if (this[_ownerReadableStream] === undefined) {
        return Promise_reject(new TypeError(errReadReleasedReader));
      }
      return ReadableStreamDefaultReaderRead(this);
    }
    releaseLock() {
      if (IsReadableStreamDefaultReader(this) === false) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      const stream = this[_ownerReadableStream];
      if (stream === undefined) {
        return undefined;
      }
      if (this[_readRequests].length > 0) {
        throw new TypeError(errReleaseReaderWithPendingRead);
      }
      ReadableStreamReaderGenericRelease(this);
    }
  }
  function ReadableStreamReaderGenericCancel(reader, reason) {
    return ReadableStreamCancel(reader[_ownerReadableStream], reason);
  }
  function AcquireReadableStreamDefaultReader(stream) {
    return new ReadableStreamDefaultReader(stream);
  }
  function ReadableStreamCancel(stream, reason) {
    stream[_readableStreamBits] |= DISTURBED;
    const state = ReadableStreamGetState(stream);
    if (state === STATE_CLOSED) {
      return Promise_resolve(undefined);
    }
    if (state === STATE_ERRORED) {
      return Promise_reject(stream[_storedError]);
    }
    ReadableStreamClose(stream);
    const sourceCancelPromise = ReadableStreamDefaultControllerCancel(stream[_controller], reason);
    return thenPromise(sourceCancelPromise, () => undefined);
  }
  function ReadableStreamDefaultControllerClose(controller) {
    const stream = controller[_controlledReadableStream];
    controller[_readableStreamDefaultControllerBits] |= CLOSE_REQUESTED;
    if (controller[_queue].length === 0) {
      ReadableStreamClose(stream);
    }
  }
  function ReadableStreamFulfillReadRequest(stream, chunk, done) {
    const reader = stream[_reader];
    const readRequest = stream[_reader][_readRequests].shift();
    v8.resolvePromise(readRequest, CreateIterResultObject(chunk, done));
  }
  function ReadableStreamDefaultControllerEnqueue(controller, chunk) {
    const stream = controller[_controlledReadableStream];
    if (IsReadableStreamLocked(stream) === true && ReadableStreamGetNumReadRequests(stream) > 0) {
      ReadableStreamFulfillReadRequest(stream, chunk, false);
    } else {
      let chunkSize = 1;
      const strategySize = controller[_strategySize];
      if (strategySize !== undefined) {
        try {
          chunkSize = strategySize(chunk);
        } catch (chunkSizeE) {
          if (ReadableStreamGetState(stream) === STATE_READABLE) {
            ReadableStreamDefaultControllerError(controller, chunkSizeE);
          }
          throw chunkSizeE;
        }
      }
      try {
        EnqueueValueWithSize(controller, chunk, chunkSize);
      } catch (enqueueE) {
        if (ReadableStreamGetState(stream) === STATE_READABLE) {
          ReadableStreamDefaultControllerError(controller, enqueueE);
        }
        throw enqueueE;
      }
    }
    ReadableStreamDefaultControllerCallPullIfNeeded(controller);
  }
  function ReadableStreamGetState(stream) {
    return (stream[_readableStreamBits] & STATE_MASK) >> STATE_BITS_OFFSET;
  }
  function ReadableStreamSetState(stream, state) {
    stream[_readableStreamBits] = (stream[_readableStreamBits] & ~STATE_MASK) |
        (state << STATE_BITS_OFFSET);
  }
  function ReadableStreamDefaultControllerError(controller, e) {
    controller[_queue] = new v8.InternalPackedArray();
    const stream = controller[_controlledReadableStream];
    ReadableStreamError(stream, e);
  }
  function ReadableStreamError(stream, e) {
    stream[_storedError] = e;
    ReadableStreamSetState(stream, STATE_ERRORED);
    const reader = stream[_reader];
    if (reader === undefined) {
      return undefined;
    }
    if (IsReadableStreamDefaultReader(reader) === true) {
      const readRequests = reader[_readRequests];
      for (let i = 0; i < readRequests.length; i++) {
        v8.rejectPromise(readRequests[i], e);
      }
      reader[_readRequests] = new v8.InternalPackedArray();
    }
    v8.rejectPromise(reader[_closedPromise], e);
  }
  function ReadableStreamClose(stream) {
    ReadableStreamSetState(stream, STATE_CLOSED);
    const reader = stream[_reader];
    if (reader === undefined) {
      return undefined;
    }
    if (IsReadableStreamDefaultReader(reader) === true) {
      const readRequests = reader[_readRequests];
      for (let i = 0; i < readRequests.length; i++) {
        v8.resolvePromise(
            readRequests[i], CreateIterResultObject(undefined, true));
      }
      reader[_readRequests] = new v8.InternalPackedArray();
    }
    v8.resolvePromise(reader[_closedPromise], undefined);
  }
  function ReadableStreamDefaultControllerGetDesiredSize(controller) {
    const queueSize = GetTotalQueueSize(controller);
    return controller[_strategyHWM] - queueSize;
  }
  function IsReadableStream(x) {
    return hasOwnProperty(x, _controller);
  }
  function IsReadableStreamDisturbed(stream) {
    return stream[_readableStreamBits] & DISTURBED;
  }
  function IsReadableStreamLocked(stream) {
    return stream[_reader] !== undefined;
  }
  function IsReadableStreamDefaultController(x) {
    return hasOwnProperty(x, _controlledReadableStream);
  }
  function IsReadableStreamDefaultReader(x) {
    return hasOwnProperty(x, _readRequests);
  }
  function IsReadableStreamReadable(stream) {
    return ReadableStreamGetState(stream) === STATE_READABLE;
  }
  function IsReadableStreamClosed(stream) {
    return ReadableStreamGetState(stream) === STATE_CLOSED;
  }
  function IsReadableStreamErrored(stream) {
    return ReadableStreamGetState(stream) === STATE_ERRORED;
  }
  function ReadableStreamReaderGenericInitialize(reader, stream) {
    const controller = stream[_controller];
    if (controller[_readableStreamDefaultControllerBits] & EXTERNALLY_CONTROLLED) {
      const underlyingSource = controller[_underlyingSource];
      callFunction(underlyingSource.notifyLockAcquired, underlyingSource);
    }
    reader[_ownerReadableStream] = stream;
    stream[_reader] = reader;
    switch (ReadableStreamGetState(stream)) {
      case STATE_READABLE:
        reader[_closedPromise] = v8.createPromise();
        break;
      case STATE_CLOSED:
        reader[_closedPromise] = Promise_resolve(undefined);
        break;
      case STATE_ERRORED:
        reader[_closedPromise] = Promise_reject(stream[_storedError]);
      break;
    }
  }
  function ReadableStreamReaderGenericRelease(reader) {
    const controller = reader[_ownerReadableStream][_controller];
    if (controller[_readableStreamDefaultControllerBits] & EXTERNALLY_CONTROLLED) {
      const underlyingSource = controller[_underlyingSource];
      callFunction(underlyingSource.notifyLockReleased, underlyingSource);
    }
    if (ReadableStreamGetState(reader[_ownerReadableStream]) === STATE_READABLE) {
      v8.rejectPromise(reader[_closedPromise], new TypeError(errReleasedReaderClosedPromise));
    } else {
      reader[_closedPromise] = Promise_reject(new TypeError(errReleasedReaderClosedPromise));
    }
    reader[_ownerReadableStream][_reader] = undefined;
    reader[_ownerReadableStream] = undefined;
  }
  function ReadableStreamDefaultReaderRead(reader) {
    const stream = reader[_ownerReadableStream];
    stream[_readableStreamBits] |= DISTURBED;
    if (ReadableStreamGetState(stream) === STATE_CLOSED) {
      return Promise_resolve(CreateIterResultObject(undefined, true));
    }
    if (ReadableStreamGetState(stream) === STATE_ERRORED) {
      return Promise_reject(stream[_storedError]);
    }
    return ReadableStreamDefaultControllerPull(stream[_controller]);
  }
  function ReadableStreamDefaultControllerCallPullIfNeeded(controller) {
    const shouldPull = ReadableStreamDefaultControllerShouldCallPull(controller);
    if (shouldPull === false) {
      return undefined;
    }
    if (controller[_readableStreamDefaultControllerBits] & PULLING) {
      controller[_readableStreamDefaultControllerBits] |= PULL_AGAIN;
      return undefined;
    }
    controller[_readableStreamDefaultControllerBits] |= PULLING;
    const underlyingSource = controller[_underlyingSource];
    const pullPromise = PromiseCallOrNoop(
        underlyingSource, 'pull', controller, 'underlyingSource.pull');
    thenPromise(pullPromise,
        () => {
          controller[_readableStreamDefaultControllerBits] &= ~PULLING;
          if (controller[_readableStreamDefaultControllerBits] & PULL_AGAIN) {
            controller[_readableStreamDefaultControllerBits] &= ~PULL_AGAIN;
            ReadableStreamDefaultControllerCallPullIfNeeded(controller);
          }
        },
        e => {
          if (ReadableStreamGetState(controller[_controlledReadableStream]) === STATE_READABLE) {
            ReadableStreamDefaultControllerError(controller, e);
          }
        });
  }
  function ReadableStreamDefaultControllerShouldCallPull(controller) {
    const stream = controller[_controlledReadableStream];
    const state = ReadableStreamGetState(stream);
    if (state === STATE_CLOSED || state === STATE_ERRORED) {
      return false;
    }
    if (controller[_readableStreamDefaultControllerBits] & CLOSE_REQUESTED) {
      return false;
    }
    if (!(controller[_readableStreamDefaultControllerBits] & STARTED)) {
      return false;
    }
    if (IsReadableStreamLocked(stream) === true && ReadableStreamGetNumReadRequests(stream) > 0) {
      return true;
    }
    const desiredSize = ReadableStreamDefaultControllerGetDesiredSize(controller);
    if (desiredSize > 0) {
      return true;
    }
    return false;
  }
  function ReadableStreamGetNumReadRequests(stream) {
    const reader = stream[_reader];
    const readRequests = reader[_readRequests];
    return readRequests.length;
  }
  function ReadableStreamTee(stream) {
    const reader = AcquireReadableStreamDefaultReader(stream);
    let closedOrErrored = false;
    let canceled1 = false;
    let canceled2 = false;
    let reason1;
    let reason2;
    let promise = v8.createPromise();
    const branch1Stream = new ReadableStream({pull, cancel: cancel1});
    const branch2Stream = new ReadableStream({pull, cancel: cancel2});
    const branch1 = branch1Stream[_controller];
    const branch2 = branch2Stream[_controller];
    thenPromise(
        reader[_closedPromise], undefined, function(r) {
          if (closedOrErrored === true) {
            return;
          }
          ReadableStreamDefaultControllerError(branch1, r);
          ReadableStreamDefaultControllerError(branch2, r);
          closedOrErrored = true;
        });
    return [branch1Stream, branch2Stream];
    function pull() {
      return thenPromise(
          ReadableStreamDefaultReaderRead(reader), function(result) {
            const value = result.value;
            const done = result.done;
            if (done === true && closedOrErrored === false) {
              if (canceled1 === false) {
                ReadableStreamDefaultControllerClose(branch1);
              }
              if (canceled2 === false) {
                ReadableStreamDefaultControllerClose(branch2);
              }
              closedOrErrored = true;
            }
            if (closedOrErrored === true) {
              return;
            }
            if (canceled1 === false) {
              ReadableStreamDefaultControllerEnqueue(branch1, value);
            }
            if (canceled2 === false) {
              ReadableStreamDefaultControllerEnqueue(branch2, value);
            }
          });
    }
    function cancel1(reason) {
      canceled1 = true;
      reason1 = reason;
      if (canceled2 === true) {
        const compositeReason = [reason1, reason2];
        const cancelResult = ReadableStreamCancel(stream, compositeReason);
        v8.resolvePromise(promise, cancelResult);
      }
      return promise;
    }
    function cancel2(reason) {
      canceled2 = true;
      reason2 = reason;
      if (canceled1 === true) {
        const compositeReason = [reason1, reason2];
        const cancelResult = ReadableStreamCancel(stream, compositeReason);
        v8.resolvePromise(promise, cancelResult);
      }
      return promise;
    }
  }
  function DequeueValue(controller) {
    const result = controller[_queue].shift();
    controller[_totalQueuedSize] -= result.size;
    return result.value;
  }
  function EnqueueValueWithSize(controller, value, size) {
    size = Number(size);
    if (Number_isNaN(size) || size === +Infinity || size < 0) {
      throw new RangeError(streamErrors.invalidSize);
    }
    controller[_totalQueuedSize] += size;
    controller[_queue].push({value, size});
  }
  function GetTotalQueueSize(controller) { return controller[_totalQueuedSize]; }
  function ValidateAndNormalizeQueuingStrategy(size, highWaterMark) {
    if (size !== undefined && typeof size !== 'function') {
      throw new TypeError(streamErrors.sizeNotAFunction);
    }
    highWaterMark = Number(highWaterMark);
    if (Number_isNaN(highWaterMark)) {
      throw new RangeError(streamErrors.errInvalidHWM);
    }
    if (highWaterMark < 0) {
      throw new RangeError(streamErrors.invalidHWM);
    }
    return {size, highWaterMark};
  }
  function CallOrNoop(O, P, arg, nameForError) {
    const method = O[P];
    if (method === undefined) {
      return undefined;
    }
    if (typeof method !== 'function') {
      throw new TypeError(errTmplMustBeFunctionOrUndefined(nameForError));
    }
    return callFunction(method, O, arg);
  }
  function PromiseCallOrNoop(O, P, arg, nameForError) {
    let method;
    try {
      method = O[P];
    } catch (methodE) {
      return Promise_reject(methodE);
    }
    if (method === undefined) {
      return Promise_resolve(undefined);
    }
    if (typeof method !== 'function') {
      return Promise_reject(new TypeError(errTmplMustBeFunctionOrUndefined(nameForError)));
    }
    try {
      return Promise_resolve(callFunction(method, O, arg));
    } catch (e) {
      return Promise_reject(e);
    }
  }
  function CreateIterResultObject(value, done) { return {value, done}; }
  defineProperty(global, 'ReadableStream', {
    value: ReadableStream,
    enumerable: false,
    configurable: true,
    writable: true
  });
  binding.AcquireReadableStreamDefaultReader = AcquireReadableStreamDefaultReader;
  binding.IsReadableStream = IsReadableStream;
  binding.IsReadableStreamDisturbed = IsReadableStreamDisturbed;
  binding.IsReadableStreamLocked = IsReadableStreamLocked;
  binding.IsReadableStreamReadable = IsReadableStreamReadable;
  binding.IsReadableStreamClosed = IsReadableStreamClosed;
  binding.IsReadableStreamErrored = IsReadableStreamErrored;
  binding.IsReadableStreamDefaultReader = IsReadableStreamDefaultReader;
  binding.ReadableStreamDefaultReaderRead = ReadableStreamDefaultReaderRead;
  binding.ReadableStreamTee = ReadableStreamTee;
  binding.ReadableStreamDefaultControllerClose = ReadableStreamDefaultControllerClose;
  binding.ReadableStreamDefaultControllerGetDesiredSize = ReadableStreamDefaultControllerGetDesiredSize;
  binding.ReadableStreamDefaultControllerEnqueue = ReadableStreamDefaultControllerEnqueue;
  binding.ReadableStreamDefaultControllerError = ReadableStreamDefaultControllerError;
  binding.createReadableStreamWithExternalController =
      (underlyingSource, strategy) => {
        return new ReadableStream(
            underlyingSource, strategy, createWithExternalControllerSentinel);
      };
});
 8WritableStreamÓú
(function(global, binding, v8) {
  'use strict';
  const _state = v8.createPrivateSymbol('[[state]]');
  const _storedError = v8.createPrivateSymbol('[[storedError]]');
  const _writer = v8.createPrivateSymbol('[[writer]]');
  const _writableStreamController =
      v8.createPrivateSymbol('[[writableStreamController]]');
  const _writeRequests = v8.createPrivateSymbol('[[writeRequests]]');
  const _closedPromise = v8.createPrivateSymbol('[[closedPromise]]');
  const _ownerWritableStream =
      v8.createPrivateSymbol('[[ownerWritableStream]]');
  const _readyPromise = v8.createPrivateSymbol('[[readyPromise]]');
  const _controlledWritableStream =
      v8.createPrivateSymbol('[[controlledWritableStream]]');
  const _queue = v8.createPrivateSymbol('[[queue]]');
  const _queueSize = v8.createPrivateSymbol('[[queueSize]]');
  const _strategyHWM = v8.createPrivateSymbol('[[strategyHWM]]');
  const _strategySize = v8.createPrivateSymbol('[[strategySize]]');
  const _underlyingSink = v8.createPrivateSymbol('[[underlyingSink]]');
  const _defaultControllerFlags =
      v8.createPrivateSymbol('[[defaultControllerFlags]]');
  const FLAG_STARTED = 0b1;
  const FLAG_WRITING = 0b10;
  const WRITABLE = 0;
  const CLOSING = 1;
  const CLOSED = 2;
  const ERRORED = 3;
  const undefined = global.undefined;
  const defineProperty = global.Object.defineProperty;
  const hasOwnProperty = v8.uncurryThis(global.Object.hasOwnProperty);
  const Function_call = v8.uncurryThis(global.Function.prototype.call);
  const Function_apply = v8.uncurryThis(global.Function.prototype.apply);
  const TypeError = global.TypeError;
  const RangeError = global.RangeError;
  const Boolean = global.Boolean;
  const Number = global.Number;
  const Number_isNaN = Number.isNaN;
  const Number_isFinite = Number.isFinite;
  const Promise = global.Promise;
  const thenPromise = v8.uncurryThis(Promise.prototype.then);
  const Promise_resolve = v8.simpleBind(Promise.resolve, Promise);
  const Promise_reject = v8.simpleBind(Promise.reject, Promise);
  const streamErrors = binding.streamErrors;
  const errAbortLockedStream = 'Cannot abort a writable stream that is locked to a writer';
  const errStreamAborted = 'The stream has been aborted';
  const errWriterLockReleasedPrefix = 'This writable stream writer has been released and cannot be ';
  const errCloseCloseRequestedStream =
      'Cannot close a writable stream that has already been requested to be closed';
  const errWriteCloseRequestedStream =
      'Cannot write to a writable stream that is due to be closed';
  const templateErrorCannotActionOnStateStream =
      (action, state) => `Cannot ${action} a ${state} writable stream`;
  const errReleasedWriterClosedPromise =
      'This writable stream writer has been released and cannot be used to monitor the stream\'s state';
  const templateErrorIsNotAFunction = f => `${f} is not a function`;
  const verbUsedToGetTheDesiredSize = 'used to get the desiredSize';
  const verbAborted = 'aborted';
  const verbClosed = 'closed';
  const verbWrittenTo = 'written to';
  function createWriterLockReleasedError(verb) {
    return new TypeError(errWriterLockReleasedPrefix + verb);
  }
  const stateNames = {[CLOSED]: 'closed', [ERRORED]: 'errored'};
  function createCannotActionOnStateStreamError(action, state) {
    TEMP_ASSERT(stateNames[state] !== undefined,
                `name for state ${state} exists in stateNames`);
    return new TypeError(
        templateErrorCannotActionOnStateStream(action, stateNames[state]));
  }
  function setDefaultControllerFlag(controller, flag, value) {
    let flags = controller[_defaultControllerFlags];
    if (value) {
      flags = flags | flag;
    } else {
      flags = flags & ~flag;
    }
    controller[_defaultControllerFlags] = flags;
  }
  function getDefaultControllerStartedFlag(controller) {
    return Boolean(controller[_defaultControllerFlags] & FLAG_STARTED);
  }
  function setDefaultControllerStartedFlag(controller, value) {
    setDefaultControllerFlag(controller, FLAG_STARTED, value);
  }
  function getDefaultControllerWritingFlag(controller) {
    return Boolean(controller[_defaultControllerFlags] & FLAG_WRITING);
  }
  function setDefaultControllerWritingFlag(controller, value) {
    setDefaultControllerFlag(controller, FLAG_WRITING, value);
  }
  function rejectPromises(array, e) {
    for (let i = 0; i < array.length; ++i) {
      v8.rejectPromise(array[i], e);
    }
  }
  function IsPropertyKey(argument) {
    return typeof argument === 'string' || typeof argument === 'symbol';
  }
  function TEMP_ASSERT(predicate, message) {
    if (predicate) {
      return;
    }
    v8.log(`Assertion failed: ${message}\n`);
    v8.logStackTrace();
    class WritableStreamInternalError {
    }
    throw new WritableStreamInternalError();
  }
  class WritableStream {
    constructor(underlyingSink = {}, { size, highWaterMark = 1 } = {}) {
      this[_state] = WRITABLE;
      this[_storedError] = undefined;
      this[_writer] = undefined;
      this[_writableStreamController] = undefined;
      this[_writeRequests] = new v8.InternalPackedArray();
      const type = underlyingSink.type;
      if (type !== undefined) {
        throw new RangeError(streamErrors.invalidType);
      }
      this[_writableStreamController] =
          new WritableStreamDefaultController(this, underlyingSink, size,
                                              highWaterMark);
    }
    get locked() {
      if (!IsWritableStream(this)) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      return IsWritableStreamLocked(this);
    }
    abort(reason) {
      if (!IsWritableStream(this)) {
        return Promise_reject(new TypeError(streamErrors.illegalInvocation));
      }
      if (IsWritableStreamLocked(this)) {
        return Promise_reject(new TypeError(errAbortLockedStream));
      }
      return WritableStreamAbort(this, reason);
    }
    getWriter() {
      if (!IsWritableStream(this)) {
         throw new TypeError(streamErrors.illegalInvocation);
      }
      return AcquireWritableStreamDefaultWriter(this);
    }
  }
  function AcquireWritableStreamDefaultWriter(stream) {
    return new WritableStreamDefaultWriter(stream);
  }
  function IsWritableStream(x) {
    return hasOwnProperty(x, _writableStreamController);
  }
  function IsWritableStreamLocked(stream) {
    TEMP_ASSERT(IsWritableStream(stream),
                '! IsWritableStream(stream) is true.');
    return stream[_writer] !== undefined;
  }
  function WritableStreamAbort(stream, reason) {
    const state = stream[_state];
    if (state === CLOSED) {
      return Promise_resolve(undefined);
    }
    if (state === ERRORED) {
      return Promise_reject(stream[_storedError]);
    }
    TEMP_ASSERT(state === WRITABLE || state === CLOSING,
               'state is "writable" or "closing".');
    const error = new TypeError(errStreamAborted);
    WritableStreamError(stream, error);
    return WritableStreamDefaultControllerAbort(
        stream[_writableStreamController], reason);
  }
  function WritableStreamAddWriteRequest(stream) {
    TEMP_ASSERT(IsWritableStreamLocked(stream),
                '! IsWritableStreamLocked(writer) is true.');
    TEMP_ASSERT(stream[_state] === WRITABLE,
                'stream.[[state]] is "writable".');
    const promise = v8.createPromise();
    stream[_writeRequests].push(promise);
    return promise;
  }
  function WritableStreamError(stream, e) {
    const state = stream[_state];
    TEMP_ASSERT(state === WRITABLE || state === CLOSING,
                'state is "writable" or "closing".');
    rejectPromises(stream[_writeRequests], e);
    stream[_writeRequests] = new v8.InternalPackedArray();
    const writer = stream[_writer];
    if (writer !== undefined) {
      v8.rejectPromise(writer[_closedPromise], e);
      if (state === WRITABLE &&
          WritableStreamDefaultControllerGetBackpressure(
              stream[_writableStreamController])) {
        v8.rejectPromise(writer[_readyPromise], e);
      } else {
        writer[_readyPromise] = Promise_reject(e);
      }
    }
    stream[_state] = ERRORED;
    stream[_storedError] = e;
  }
  function WritableStreamFinishClose(stream) {
    TEMP_ASSERT(stream[_state] === CLOSING,
                'stream.[[state]] is "closing".');
    TEMP_ASSERT(stream[_writer] !== undefined,
                'stream.[[writer]] is not undefined.');
    stream[_state] = CLOSED;
    v8.resolvePromise(stream[_writer][_closedPromise], undefined);
  }
  function WritableStreamFulfillWriteRequest(stream) {
    TEMP_ASSERT(stream[_writeRequests].length !== 0,
               'stream.[[writeRequests]] is not empty.');
    const writeRequest = stream[_writeRequests].shift();
    v8.resolvePromise(writeRequest, undefined);
  }
  function WritableStreamUpdateBackpressure(stream, backpressure) {
    TEMP_ASSERT(stream[_state] === WRITABLE,
                'stream.[[state]] is "writable".');
    const writer = stream[_writer];
    if (writer === undefined) {
      return;
    }
    if (backpressure) {
      writer[_readyPromise] = v8.createPromise();
    } else {
      TEMP_ASSERT(backpressure === false,
                  'backpressure is false.');
      v8.resolvePromise(writer[_readyPromise], undefined);
    }
  }
  class WritableStreamDefaultWriter {
    constructor(stream) {
      if (!IsWritableStream(stream)) {
        throw new TypeError(streamErrors.illegalConstructor);
      }
      if (IsWritableStreamLocked(stream)) {
        throw new TypeError(streamErrors.illegalConstructor);
      }
      this[_ownerWritableStream] = stream;
      stream[_writer] = this;
      const state = stream[_state];
      if (state === WRITABLE || state === CLOSING) {
        this[_closedPromise] = v8.createPromise();
      } else if (state === CLOSED) {
        this[_closedPromise] = Promise_resolve(undefined);
      } else {
        TEMP_ASSERT(state === ERRORED,
                    'state is "errored".');
        this[_closedPromise] = Promise_reject(stream[_storedError]);
      }
      if (state === WRITABLE &&
          WritableStreamDefaultControllerGetBackpressure(
              stream[_writableStreamController])) {
        this[_readyPromise] = v8.createPromise();
      } else {
        this[_readyPromise] = Promise_resolve(undefined);
      }
    }
    get closed() {
      if (!IsWritableStreamDefaultWriter(this)) {
        return Promise_reject(new TypeError(streamErrors.illegalInvocation));
      }
      return this[_closedPromise];
    }
    get desiredSize() {
      if (!IsWritableStreamDefaultWriter(this)) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      if (this[_ownerWritableStream] === undefined) {
        throw createWriterLockReleasedError(verbUsedToGetTheDesiredSize);
      }
      return WritableStreamDefaultWriterGetDesiredSize(this);
    }
    get ready() {
      if (!IsWritableStreamDefaultWriter(this)) {
        return Promise_reject(new TypeError(streamErrors.illegalInvocation));
      }
      return this[_readyPromise];
    }
    abort(reason) {
     if (!IsWritableStreamDefaultWriter(this)) {
        return Promise_reject(new TypeError(streamErrors.illegalInvocation));
      }
      if (this[_ownerWritableStream] === undefined) {
        return Promise_reject(createWriterLockReleasedError(verbAborted));
      }
      return WritableStreamDefaultWriterAbort(this, reason);
    }
    close() {
      if (!IsWritableStreamDefaultWriter(this)) {
        return Promise_reject(new TypeError(streamErrors.illegalInvocation));
      }
      const stream = this[_ownerWritableStream];
      if (stream === undefined) {
        return Promise_reject(createWriterLockReleasedError(verbClosed));
      }
      if (stream[_state] === CLOSING) {
        return Promise_reject(new TypeError(errCloseCloseRequestedStream));
      }
      return WritableStreamDefaultWriterClose(this);
    }
    releaseLock() {
      if (!IsWritableStreamDefaultWriter(this)) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      const stream = this[_ownerWritableStream];
      if (stream === undefined) {
        return;
      }
      TEMP_ASSERT(stream[_writer] !== undefined,
                  'stream.[[writer]] is not undefined.');
      WritableStreamDefaultWriterRelease(this);
    }
    write(chunk) {
      if (!IsWritableStreamDefaultWriter(this)) {
        return Promise_reject(new TypeError(streamErrors.illegalInvocation));
      }
      const stream = this[_ownerWritableStream];
      if (stream === undefined) {
        return Promise_reject(createWriterLockReleasedError(verbWrittenTo));
      }
      if (stream[_state] === CLOSING) {
        return Promise_reject(new TypeError(errWriteCloseRequestedStream));
      }
      return WritableStreamDefaultWriterWrite(this, chunk);
    }
  }
  function IsWritableStreamDefaultWriter(x) {
    return hasOwnProperty(x, _ownerWritableStream);
  }
  function WritableStreamDefaultWriterAbort(writer, reason) {
    const stream = writer[_ownerWritableStream];
    TEMP_ASSERT(stream !== undefined,
                'stream is not undefined.');
    return WritableStreamAbort(stream, reason);
  }
  function WritableStreamDefaultWriterClose(writer) {
    const stream = writer[_ownerWritableStream];
    TEMP_ASSERT(stream !== undefined,
                'stream is not undefined.');
    const state = stream[_state];
    if (state === CLOSED || state === ERRORED) {
      return Promise_reject(
          createCannotActionOnStateStreamError('close', state));
    }
    TEMP_ASSERT(state === WRITABLE,
                'state is "writable".');
    const promise = WritableStreamAddWriteRequest(stream);
    if (WritableStreamDefaultControllerGetBackpressure(
        stream[_writableStreamController])) {
      v8.resolvePromise(writer[_readyPromise], undefined);
    }
    stream[_state] = CLOSING;
    WritableStreamDefaultControllerClose(stream[_writableStreamController]);
    return promise;
  }
  function WritableStreamDefaultWriterGetDesiredSize(writer) {
    const stream = writer[_ownerWritableStream];
    const state = stream[_state];
    if (state === ERRORED) {
      return null;
    }
    if (state === CLOSED) {
      return 0;
    }
    return WritableStreamDefaultControllerGetDesiredSize(
        stream[_writableStreamController]);
  }
  function WritableStreamDefaultWriterRelease(writer) {
    const stream = writer[_ownerWritableStream];
    TEMP_ASSERT(stream !== undefined,
                'stream is not undefined.');
    TEMP_ASSERT(stream[_writer] === writer,
                'stream.[[writer]] is writer.');
    const releasedError = new TypeError(errReleasedWriterClosedPromise);
    const state = stream[_state];
    if (state === WRITABLE || state === CLOSING) {
      v8.rejectPromise(writer[_closedPromise], releasedError);
    } else {
      writer[_closedPromise] = Promise_reject(releasedError);
    }
    if (state === WRITABLE &&
        WritableStreamDefaultControllerGetBackpressure(
            stream[_writableStreamController])) {
      v8.rejectPromise(writer[_readyPromise], releasedError);
    } else {
      writer[_readyPromise] = Promise_reject(releasedError);
    }
    stream[_writer] = undefined;
    writer[_ownerWritableStream] = undefined;
  }
  function WritableStreamDefaultWriterWrite(writer, chunk) {
    const stream = writer[_ownerWritableStream];
    TEMP_ASSERT(stream !== undefined,
                'stream is not undefined.');
    const state = stream[_state];
    if (state === CLOSED || state === ERRORED) {
      return Promise_reject(
          createCannotActionOnStateStreamError('write to', state));
    }
    TEMP_ASSERT(state === WRITABLE,
                'state is "writable".');
    const promise = WritableStreamAddWriteRequest(stream);
    WritableStreamDefaultControllerWrite(stream[_writableStreamController],
                                         chunk);
    return promise;
  }
  class WritableStreamDefaultController {
    constructor(stream, underlyingSink, size, highWaterMark) {
      if (!IsWritableStream(stream)) {
        throw new TypeError(streamErrors.illegalConstructor);
      }
      if (stream[_writableStreamController] !== undefined) {
        throw new TypeError(streamErrors.illegalConstructor);
      }
      this[_controlledWritableStream] = stream;
      this[_underlyingSink] = underlyingSink;
      this[_queue] = new v8.InternalPackedArray();
      this[_queueSize] = 0;
      this[_defaultControllerFlags] = 0;
      const normalizedStrategy =
          ValidateAndNormalizeQueuingStrategy(size, highWaterMark);
      this[_strategySize] = normalizedStrategy.size;
      this[_strategyHWM] = normalizedStrategy.highWaterMark;
      const backpressure = WritableStreamDefaultControllerGetBackpressure(this);
      if (backpressure) {
        WritableStreamUpdateBackpressure(stream, backpressure);
      }
      const controller = this;
      const startResult = InvokeOrNoop(underlyingSink, 'start', [this]);
      const onFulfilled = () => {
        setDefaultControllerStartedFlag(controller, true);
        WritableStreamDefaultControllerAdvanceQueueIfNeeded(controller);
      };
      const onRejected = r => {
        WritableStreamDefaultControllerErrorIfNeeded(controller, r);
      };
      thenPromise(Promise_resolve(startResult), onFulfilled, onRejected);
    }
    error(e) {
      if (!IsWritableStreamDefaultController(this)) {
        throw new TypeError(streamErrors.illegalInvocation);
      }
      const state = this[_controlledWritableStream][_state];
      if (state === CLOSED || state === ERRORED) {
        throw createCannotActionOnStateStreamError('error', state);
      }
      WritableStreamDefaultControllerError(this, e);
    }
  }
  function IsWritableStreamDefaultController(x) {
    return hasOwnProperty(x, _underlyingSink);
  }
  function WritableStreamDefaultControllerAbort(controller, reason) {
    controller[_queue] = v8.InternalPackedArray();
    controller[_queueSize] = 0;
    const sinkAbortPromise =
        PromiseInvokeOrFallbackOrNoop(controller[_underlyingSink],
                                      'abort', [reason], 'close', [controller]);
    return thenPromise(sinkAbortPromise, () => undefined);
  }
  function WritableStreamDefaultControllerClose(controller) {
    EnqueueValueWithSizeForController(controller, 'close', 0);
    WritableStreamDefaultControllerAdvanceQueueIfNeeded(controller);
  }
  function WritableStreamDefaultControllerGetDesiredSize(controller) {
    const queueSize = GetTotalQueueSizeForController(controller);
    return controller[_strategyHWM] - queueSize;
  }
  function WritableStreamDefaultControllerWrite(controller, chunk) {
    const stream = controller[_controlledWritableStream];
    TEMP_ASSERT(stream[_state] === WRITABLE,
                'stream.[[state]] is "writable".');
    let chunkSize = 1;
    if (controller[_strategySize] !== undefined) {
      try {
        chunkSize = Function_call(controller[_strategySize], undefined, chunk);
      } catch (e) {
        WritableStreamDefaultControllerErrorIfNeeded(controller, e);
        return Promise_reject(e);
      }
    }
    const writeRecord = {chunk};
    const lastBackpressure =
        WritableStreamDefaultControllerGetBackpressure(controller);
    try {
      const enqueueResult =
          EnqueueValueWithSizeForController(controller, writeRecord, chunkSize);
    } catch (e) {
      WritableStreamDefaultControllerErrorIfNeeded(controller, e);
      return Promise_reject(e);
    }
    if (stream[_state] === WRITABLE) {
      const backpressure =
          WritableStreamDefaultControllerGetBackpressure(controller);
      if (lastBackpressure !== backpressure) {
        WritableStreamUpdateBackpressure(stream, backpressure);
      }
    }
    WritableStreamDefaultControllerAdvanceQueueIfNeeded(controller);
  }
  function WritableStreamDefaultControllerAdvanceQueueIfNeeded(controller) {
    const state = controller[_controlledWritableStream][_state];
    if (state === CLOSED || state === ERRORED) {
      return;
    }
    if (!getDefaultControllerStartedFlag(controller)) {
      return;
    }
    if (getDefaultControllerWritingFlag(controller)) {
      return;
    }
    if (controller[_queue].length === 0) {
      return;
    }
    const writeRecord = PeekQueueValue(controller[_queue]);
    if (writeRecord === 'close') {
      WritableStreamDefaultControllerProcessClose(controller);
    } else {
      WritableStreamDefaultControllerProcessWrite(controller,
                                                  writeRecord.chunk);
    }
  }
  function WritableStreamDefaultControllerErrorIfNeeded(controller, e) {
    const state = controller[_controlledWritableStream][_state];
    if (state === WRITABLE || state === CLOSING) {
      WritableStreamDefaultControllerError(controller, e);
    }
  }
  function WritableStreamDefaultControllerProcessClose(controller) {
    const stream = controller[_controlledWritableStream];
    TEMP_ASSERT(stream[_state] === CLOSING,
                'stream.[[state]] is "closing".');
    DequeueValueForController(controller);
    TEMP_ASSERT(controller[_queue].length === 0,
                'controller.[[queue]] is empty.');
    const sinkClosePromise = PromiseInvokeOrNoop(controller[_underlyingSink],
                                               'close', [controller]);
    thenPromise(sinkClosePromise,
                () => {
                  if (stream[_state] !== CLOSING) {
                    return;
                  }
                  WritableStreamFulfillWriteRequest(stream);
                  WritableStreamFinishClose(stream);
                },
                r => WritableStreamDefaultControllerErrorIfNeeded(controller, r)
               );
  }
  function WritableStreamDefaultControllerProcessWrite(controller, chunk) {
    setDefaultControllerWritingFlag(controller, true);
    const sinkWritePromise = PromiseInvokeOrNoop(controller[_underlyingSink],
                                               'write', [chunk, controller]);
    thenPromise(
        sinkWritePromise,
        () => {
          const stream = controller[_controlledWritableStream];
          const state = stream[_state];
          if (state === ERRORED || state === CLOSED) {
            return;
          }
          setDefaultControllerWritingFlag(controller, false);
          WritableStreamFulfillWriteRequest(stream);
          const lastBackpressure =
              WritableStreamDefaultControllerGetBackpressure(controller);
          DequeueValueForController(controller);
          if (state !== CLOSING) {
            const backpressure =
                WritableStreamDefaultControllerGetBackpressure(controller);
            if (lastBackpressure !== backpressure) {
              WritableStreamUpdateBackpressure(
                  controller[_controlledWritableStream], backpressure);
            }
          }
          WritableStreamDefaultControllerAdvanceQueueIfNeeded(controller);
        },
        r => WritableStreamDefaultControllerErrorIfNeeded(controller, r)
        );
  }
  function WritableStreamDefaultControllerGetBackpressure(controller) {
    const desiredSize =
        WritableStreamDefaultControllerGetDesiredSize(controller);
    return desiredSize <= 0;
  }
  function WritableStreamDefaultControllerError(controller, e) {
    const stream = controller[_controlledWritableStream];
    const state = stream[_state];
    TEMP_ASSERT(state === WRITABLE || state === CLOSING,
                'stream.[[state]] is "writable" or "closing".');
    WritableStreamError(stream, e);
    controller[_queue] = new v8.InternalPackedArray();
    controller[_queueSize] = 0;
  }
  function DequeueValueForController(controller) {
    TEMP_ASSERT(controller[_queue].length !== 0,
                'queue is not empty.');
    const result = controller[_queue].shift();
    controller[_queueSize] -= result.size;
    return result.value;
  }
  function EnqueueValueWithSizeForController(controller, value, size) {
    size = Number(size);
    if (!IsFiniteNonNegativeNumber(size)) {
      throw new RangeError(streamErrors.invalidSize);
    }
    controller[_queueSize] += size;
    controller[_queue].push({value, size});
  }
  function GetTotalQueueSizeForController(controller) {
    return controller[_queueSize];
  }
  function PeekQueueValue(queue) {
    TEMP_ASSERT(queue.length !== 0,
                'queue is not empty.');
    return queue[0].value;
  }
  function InvokeOrNoop(O, P, args) {
    TEMP_ASSERT(IsPropertyKey(P),
                'P is a valid property key.');
    if (args === undefined) {
      args = [];
    }
    const method = O[P];
    if (method === undefined) {
      return undefined;
    }
    if (typeof method !== 'function') {
      throw new TypeError(templateErrorIsNotAFunction(P));
    }
    return Function_apply(method, O, args);
  }
  function IsFiniteNonNegativeNumber(v) {
    return Number_isFinite(v) && v >= 0;
  }
  function PromiseInvokeOrFallbackOrNoop(O, P1, args1, P2, args2) {
    TEMP_ASSERT(IsPropertyKey(P1),
                'P1 is a valid property key.');
    TEMP_ASSERT(IsPropertyKey(P2),
                'P2 is a valid property key.');
    try {
      const method = O[P1];
      if (method === undefined) {
        return PromiseInvokeOrNoop(O, P2, args2);
      }
      if (typeof method !== 'function') {
        return Promise_reject(new TypeError(templateErrorIsNotAFunction(P1)));
      }
      return Promise_resolve(Function_apply(method, O, args1));
    } catch (e) {
      return Promise_reject(e);
    }
  }
  function PromiseInvokeOrNoop(O, P, args) {
    try {
      return Promise_resolve(InvokeOrNoop(O, P, args));
    } catch (e) {
      return Promise_reject(e);
    }
  }
  function ValidateAndNormalizeQueuingStrategy(size, highWaterMark) {
    if (size !== undefined && typeof size !== 'function') {
      throw new TypeError(streamErrors.sizeNotAFunction);
    }
    highWaterMark = Number(highWaterMark);
    if (Number_isNaN(highWaterMark)) {
      throw new RangeError(streamErrors.errInvalidHWM);
    }
    if (highWaterMark < 0) {
      throw new RangeError(streamErrors.invalidHWM);
    }
    return {size, highWaterMark};
  }
  defineProperty(global, 'WritableStream', {
    value: WritableStream,
    enumerable: false,
    configurable: true,
    writable: true
  });
});
